<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>r7rs</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p><span> ‘=̀13 </span></p>
<p>-.375in</p>
<p>plus 2pt minus 2pt plus 2pt</p>
<p>-.5in -.5in</p>
<h1 class="unnumbered" id="summary">Summary</h1>
<p>The report gives a defining description of the programming language Scheme. Scheme is a statically scoped and properly tail recursive dialect of the Lisp programming language <span class="citation" data-cites="McCarthy"></span> invented by Guy Lewis Steele Jr. and Gerald Jay Sussman. It was designed to have exceptionally clear and simple semantics and few different ways to form expressions. A wide variety of programming paradigms, including imperative, functional, and object-oriented styles, find convenient expression in Scheme.</p>
<p>The introduction offers a brief history of the language and of the report.</p>
<p>The first three chapters present the fundamental ideas of the language and describe the notational conventions used for describing the language and for writing programs in the language.</p>
<p>Chapters <a href="#expressionchapter" data-reference-type="ref" data-reference="expressionchapter">[expressionchapter]</a> and <a href="#programchapter" data-reference-type="ref" data-reference="programchapter">[programchapter]</a> describe the syntax and semantics of expressions, definitions, programs, and libraries.</p>
<p>Chapter <a href="#builtinchapter" data-reference-type="ref" data-reference="builtinchapter">[builtinchapter]</a> describes Scheme’s built-in procedures, which include all of the language’s data manipulation and input/output primitives.</p>
<p>Chapter <a href="#formalchapter" data-reference-type="ref" data-reference="formalchapter">[formalchapter]</a> provides a formal syntax for Scheme written in extended BNF, along with a formal denotational semantics. An example of the use of the language follows the formal syntax and semantics.</p>
<p>Appendix <a href="#stdlibraries" data-reference-type="ref" data-reference="stdlibraries">[stdlibraries]</a> provides a list of the standard libraries and the identifiers that they export.</p>
<p>Appendix <a href="#stdfeatures" data-reference-type="ref" data-reference="stdfeatures">[stdfeatures]</a> provides a list of optional but standardized implementation feature names.</p>
<p>The report concludes with a list of references and an alphabetic index.</p>
<p><span><em>Note:</em></span> The editors of the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS and R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS reports are listed as authors of this report in recognition of the substantial portions of this report that are copied directly from R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS and R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS. There is no intended implication that those editors, individually or collectively, support or do not support this report.</p>
<h1 class="unnumbered" id="contents">Contents</h1>
<p><span> </span></p>
<p>Programming languages should be designed not by piling feature on top of feature, but by removing the weaknesses and restrictions that make additional features appear necessary. Scheme demonstrates that a very small number of rules for forming expressions, with no restrictions on how they are composed, suffice to form a practical and efficient programming language that is flexible enough to support most of the major programming paradigms in use today.</p>
<p>Scheme was one of the first programming languages to incorporate first-class procedures as in the lambda calculus, thereby proving the usefulness of static scope rules and block structure in a dynamically typed language. Scheme was the first major dialect of Lisp to distinguish procedures from lambda expressions and symbols, to use a single lexical environment for all variables, and to evaluate the operator position of a procedure call in the same way as an operand position. By relying entirely on procedure calls to express iteration, Scheme emphasized the fact that tail-recursive procedure calls are essentially GOTOs that pass arguments, thus allowing a programming style that is both coherent and efficient. Scheme was the first widely used programming language to embrace first-class escape procedures, from which all previously known sequential control structures can be synthesized. A subsequent version of Scheme introduced the concept of exact and inexact numbers, an extension of Common Lisp’s generic arithmetic. More recently, Scheme became the first programming language to support hygienic macros, which permit the syntax of a block-structured language to be extended in a consistent and reliable manner.</p>
<h3 class="unnumbered" id="background">Background</h3>
<p>The first description of Scheme was written in 1975 <span class="citation" data-cites="Scheme75"></span>. A revised report <span class="citation" data-cites="Scheme78"></span> appeared in 1978, which described the evolution of the language as its MIT implementation was upgraded to support an innovative compiler <span class="citation" data-cites="Rabbit"></span>. Three distinct projects began in 1981 and 1982 to use variants of Scheme for courses at MIT, Yale, and Indiana University <span class="citation" data-cites="Rees82 MITScheme Scheme311"></span>. An introductory computer science textbook using Scheme was published in 1984 <span class="citation" data-cites="SICP"></span>.</p>
<p>As Scheme became more widespread, local dialects began to diverge until students and researchers occasionally found it difficult to understand code written at other sites. Fifteen representatives of the major implementations of Scheme therefore met in October 1984 to work toward a better and more widely accepted standard for Scheme. Their report, the RRRS <span class="citation" data-cites="RRRS"></span>, was published at MIT and Indiana University in the summer of 1985. Further revision took place in the spring of 1986, resulting in the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>3</mn></msup><annotation encoding="application/x-tex">^{3}</annotation></semantics></math>RS <span class="citation" data-cites="R3RS"></span>. Work in the spring of 1988 resulted in R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>4</mn></msup><annotation encoding="application/x-tex">^{4}</annotation></semantics></math>RS <span class="citation" data-cites="R4RS"></span>, which became the basis for the IEEE Standard for the Scheme Programming Language in 1991 <span class="citation" data-cites="IEEEScheme"></span>. In 1998, several additions to the IEEE standard, including high-level hygienic macros, multiple return values, and <span>eval</span>, were finalized as the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS <span class="citation" data-cites="R5RS"></span>.</p>
<p>In the fall of 2006, work began on a more ambitious standard, including many new improvements and stricter requirements made in the interest of improved portability. The resulting standard, the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS, was completed in August 2007 <span class="citation" data-cites="R6RS"></span>, and was organized as a core language and set of mandatory standard libraries. Several new implementations of Scheme conforming to it were created. However, most existing R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS implementations (even excluding those which are essentially unmaintained) did not adopt R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS, or adopted only selected parts of it.</p>
<p>In consequence, the Scheme Steering Committee decided in August 2009 to divide the standard into two separate but compatible languages — a “small” language, suitable for educators, researchers, and users of embedded languages, focused on R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS compatibility, and a “large” language focused on the practical needs of mainstream software development, intended to become a replacement for R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS. The present report describes the “small” language of that effort: therefore it cannot be considered in isolation as the successor to R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS.</p>
<p>We intend this report to belong to the entire Scheme community, and so we grant permission to copy it in whole or in part without fee. In particular, we encourage implementers of Scheme to use this report as a starting point for manuals and other documentation, modifying it as necessary.</p>
<h3 class="unnumbered" id="acknowledgments">Acknowledgments</h3>
<p>We would like to thank the members of the Steering Committee, William Clinger, Marc Feeley, Chris Hanson, Jonathan Rees, and Olin Shivers, for their support and guidance.</p>
<p>This report is very much a community effort, and we’d like to thank everyone who provided comments and feedback, including the following people: David Adler, Eli Barzilay, Taylan Ulrich Bayırlı/Kammer, Marco Benelli, Pierpaolo Bernardi, Peter Bex, Per Bothner, John Boyle, Taylor Campbell, Raffael Cavallaro, Ray Dillinger, Biep Durieux, Sztefan Edwards, Helmut Eller, Justin Ethier, Jay Reynolds Freeman, Tony Garnock-Jones, Alan Manuel Gloria, Steve Hafner, Sven Hartrumpf, Brian Harvey, Moritz Heidkamp, Jean-Michel Hufflen, Aubrey Jaffer, Takashi Kato, Shiro Kawai, Richard Kelsey, Oleg Kiselyov, Pjotr Kourzanov, Jonathan Kraut, Daniel Krueger, Christian Stigen Larsen, Noah Lavine, Stephen Leach, Larry D. Lee, Kun Liang, Thomas Lord, Vincent Stewart Manis, Perry Metzger, Michael Montague, Mikael More, Vitaly Magerya, Vincent Manis, Vassil Nikolov, Joseph Wayne Norton, Yuki Okumura, Daichi Oohashi, Jeronimo Pellegrini, Jussi Piitulainen, Alex Queiroz, Jim Rees, Grant Rettke, Andrew Robbins, Devon Schudy, Bakul Shah, Robert Smith, Arthur Smyles, Michael Sperber, John David Stone, Jay Sulzberger, Malcolm Tredinnick, Sam Tobin-Hochstadt, Andre van Tonder, Daniel Villeneuve, Denis Washington, Alan Watson, Mark H. Weaver, Göran Weinholt, David A. Wheeler, Andy Wingo, James Wise, Jörg F. Wittenberger, Kevin A. Wortman, Sascha Ziemann.</p>
<p>In addition we would like to thank all the past editors, and the people who helped them in turn: Hal Abelson, Norman Adams, David Bartley, Alan Bawden, Michael Blair, Gary Brooks, George Carrette, Andy Cromarty, Pavel Curtis, Jeff Dalton, Olivier Danvy, Ken Dickey, Bruce Duba, Robert Findler, Andy Freeman, Richard Gabriel, Yekta Gürsel, Ken Haase, Robert Halstead, Robert Hieb, Paul Hudak, Morry Katz, Eugene Kohlbecker, Chris Lindblad, Jacob Matthews, Mark Meyer, Jim Miller, Don Oxley, Jim Philbin, Kent Pitman, John Ramsdell, Guillermo Rozas, Mike Shaff, Jonathan Shapiro, Guy Steele, Julie Sussman, Perry Wagle, Mitchel Wand, Daniel Weise, Henry Wu, and Ozan Yigit. We thank Carol Fessenden, Daniel Friedman, and Christopher Haynes for permission to use text from the Scheme 311 version 4 reference manual. We thank Texas Instruments, Inc. for permission to use text from the <span><em>TI Scheme Language Reference Manual</em></span> <span class="citation" data-cites="TImanual85"></span>. We gladly acknowledge the influence of manuals for MIT Scheme <span class="citation" data-cites="MITScheme"></span>, T <span class="citation" data-cites="Rees84"></span>, Scheme 84 <span class="citation" data-cites="Scheme84"></span>, Common Lisp <span class="citation" data-cites="CLtL"></span>, and Algol 60 <span class="citation" data-cites="Naur63"></span>, as well as the following SRFIs: 0, 1, 4, 6, 9, 11, 13, 16, 30, 34, 39, 43, 46, 62, and 87, all of which are available at <span>http://srfi.schemers.org</span>.</p>
<h1 id="overview-of-scheme">Overview of Scheme</h1>
<h2 id="semantics">Semantics</h2>
<p>This section gives an overview of Scheme’s semantics. A detailed informal semantics is the subject of chapters <a href="#basicchapter" data-reference-type="ref" data-reference="basicchapter">[basicchapter]</a> through <a href="#builtinchapter" data-reference-type="ref" data-reference="builtinchapter">[builtinchapter]</a>. For reference purposes, section <a href="#formalsemanticssection" data-reference-type="ref" data-reference="formalsemanticssection">[formalsemanticssection]</a> provides a formal semantics of Scheme.</p>
<p>Scheme is a statically scoped programming language. Each use of a variable is associated with a lexically apparent binding of that variable.</p>
<p>Scheme is a dynamically typed language. Types are associated with values (also called objects) rather than with variables. Statically typed languages, by contrast, associate types with variables and expressions as well as with values.</p>
<p>All objects created in the course of a Scheme computation, including procedures and continuations, have unlimited extent. No Scheme object is ever destroyed. The reason that implementations of Scheme do not (usually!) run out of storage is that they are permitted to reclaim the storage occupied by an object if they can prove that the object cannot possibly matter to any future computation.</p>
<p>Implementations of Scheme are required to be properly tail-recursive. This allows the execution of an iterative computation in constant space, even if the iterative computation is described by a syntactically recursive procedure. Thus with a properly tail-recursive implementation, iteration can be expressed using the ordinary procedure-call mechanics, so that special iteration constructs are useful only as syntactic sugar. See section <a href="#proper tail recursion" data-reference-type="ref" data-reference="proper tail recursion">[proper tail recursion]</a>.</p>
<p>Scheme procedures are objects in their own right. Procedures can be created dynamically, stored in data structures, returned as results of procedures, and so on.</p>
<p>One distinguishing feature of Scheme is that continuations, which in most other languages only operate behind the scenes, also have “first-class” status. Continuations are useful for implementing a wide variety of advanced control constructs, including non-local exits, backtracking, and coroutines. See section <a href="#continuations" data-reference-type="ref" data-reference="continuations">[continuations]</a>.</p>
<p>Arguments to Scheme procedures are always passed by value, which means that the actual argument expressions are evaluated before the procedure gains control, regardless of whether the procedure needs the result of the evaluation.</p>
<p>Scheme’s model of arithmetic is designed to remain as independent as possible of the particular ways in which numbers are represented within a computer. In Scheme, every integer is a rational number, every rational is a real, and every real is a complex number. Thus the distinction between integer and real arithmetic, so important to many programming languages, does not appear in Scheme. In its place is a distinction between exact arithmetic, which corresponds to the mathematical ideal, and inexact arithmetic on approximations. Exact arithmetic is not limited to integers.</p>
<h2 id="syntax">Syntax</h2>
<p>Scheme, like most dialects of Lisp, employs a fully parenthesized prefix notation for programs and other data; the grammar of Scheme generates a sublanguage of the language used for data. An important consequence of this simple, uniform representation is that Scheme programs and data can easily be treated uniformly by other Scheme programs. For example, the <span>eval</span> procedure evaluates a Scheme program expressed as data.</p>
<p>The <span>read</span> procedure performs syntactic as well as lexical decomposition of the data it reads. The <span>read</span> procedure parses its input as data (section <a href="#datumsyntax" data-reference-type="ref" data-reference="datumsyntax">[datumsyntax]</a>), not as program.</p>
<p>The formal syntax of Scheme is described in section <a href="#BNF" data-reference-type="ref" data-reference="BNF">[BNF]</a>.</p>
<h2 id="notation-and-terminology">Notation and terminology</h2>
<h3 id="base-and-optional-features">Base and optional features</h3>
<p>Every identifier defined in this report appears in one or more of several <span><em>libraries</em></span>. Identifiers defined in the <span><em>base library</em></span> are not marked specially in the body of the report. This library includes the core syntax of Scheme and generally useful procedures that manipulate data. For example, the variable <span>abs</span> is bound to a procedure of one argument that computes the absolute value of a number, and the variable <span>+</span> is bound to a procedure that computes sums. The full list all the standard libraries and the identifiers they export is given in Appendix <a href="#stdlibraries" data-reference-type="ref" data-reference="stdlibraries">[stdlibraries]</a>.</p>
<p>All implementations of Scheme:</p>
<ul>
<li><p>Must provide the base library and all the identifiers exported from it.</p></li>
<li><p>May provide or omit the other libraries given in this report, but each library must either be provided in its entirety, exporting no additional identifiers, or else omitted altogether.</p></li>
<li><p>May provide other libraries not described in this report.</p></li>
<li><p>May also extend the function of any identifier in this report, provided the extensions are not in conflict with the language reported here.</p></li>
<li><p>Must support portable code by providing a mode of operation in which the lexical syntax does not conflict with the lexical syntax described in this report.</p></li>
</ul>
<h3 id="error-situations-and-unspecified-behavior">Error situations and unspecified behavior</h3>
<p>When speaking of an error situation, this report uses the phrase “an error is signaled” to indicate that implementations must detect and report the error. An error is signaled by raising a non-continuable exception, as if by the procedure <span>raise</span> as described in section <a href="#exceptionsection" data-reference-type="ref" data-reference="exceptionsection">[exceptionsection]</a>. The object raised is implementation-dependent and need not be distinct from objects previously used for the same purpose. In addition to errors signaled in situations described in this report, programmers can signal their own errors and handle signaled errors.</p>
<p>The phrase “an error that satisfies <span><em>predicate</em></span> is signaled” means that an error is signaled as above. Furthermore, if the object that is signaled is passed to the specified predicate (such as <span>file-error?</span> or <span> read-error?</span>), the predicate returns #<span>t</span>.</p>
<p>If such wording does not appear in the discussion of an error, then implementations are not required to detect or report the error, though they are encouraged to do so. Such a situation is sometimes, but not always, referred to with the phrase “an error.” In such a situation, an implementation may or may not signal an error; if it does signal an error, the object that is signaled may or may not satisfy the predicates <span>error-object?</span>, <span>file-error?</span>, or <span>read-error?</span>. Alternatively, implementations may provide non-portable extensions.</p>
<p>For example, it is an error for a procedure to be passed an argument of a type that the procedure is not explicitly specified to handle, even though such domain errors are seldom mentioned in this report. Implementations may signal an error, extend a procedure’s domain of definition to include such arguments, or fail catastrophically.</p>
<p>This report uses the phrase “may report a violation of an implementation restriction” to indicate circumstances under which an implementation is permitted to report that it is unable to continue execution of a correct program because of some restriction imposed by the implementation. Implementation restrictions are discouraged, but implementations are encouraged to report violations of implementation restrictions.</p>
<p>For example, an implementation may report a violation of an implementation restriction if it does not have enough storage to run a program, or if an arithmetic operation would produce an exact number that is too large for the implementation to represent.</p>
<p>If the value of an expression is said to be “unspecified,” then the expression must evaluate to some object without signaling an error, but the value depends on the implementation; this report explicitly does not say what value is returned.</p>
<p>Finally, the words and phrases “must,” “must not,” “shall,” “shall not,” “should,” “should not,” “may,” “required,” “recommended,” and “optional,” although not capitalized in this report, are to be interpreted as described in RFC 2119 <span class="citation" data-cites="rfc2119"></span>. They are used only with reference to implementer or implementation behavior, not with reference to programmer or program behavior.</p>
<h3 id="entry-format">Entry format</h3>
<p>Chapters <a href="#expressionchapter" data-reference-type="ref" data-reference="expressionchapter">[expressionchapter]</a> and <a href="#builtinchapter" data-reference-type="ref" data-reference="builtinchapter">[builtinchapter]</a> are organized into entries. Each entry describes one language feature or a group of related features, where a feature is either a syntactic construct or a procedure. An entry begins with one or more header lines of the form</p>
<p><em>template</em>  <em>category</em><br />
</p>
<p>for identifiers in the base library, or</p>
<p><em>template</em>  <em>name</em> library <em>category</em><br />
</p>
<p>where <em>name</em> is the short name of a library as defined in Appendix <a href="#stdlibraries" data-reference-type="ref" data-reference="stdlibraries">[stdlibraries]</a>.</p>
<p>If <em>category</em> is “syntax,” the entry describes an expression type, and the template gives the syntax of the expression type. Components of expressions are designated by syntactic variables, which are written using angle brackets, for example <span>expression</span> and <span>variable</span>. Syntactic variables are intended to denote segments of program text; for example, <span>expression</span> stands for any string of characters which is a syntactically valid expression. The notation</p>
<div class="tabbing">
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></p>
</div>
<p>indicates zero or more occurrences of a <span>thing</span>, and</p>
<div class="tabbing">
<p><span>thing<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></p>
</div>
<p>indicates one or more occurrences of a <span>thing</span>.</p>
<p>If <em>category</em> is “auxiliary syntax,” then the entry describes a syntax binding that occurs only as part of specific surrounding expressions. Any use as an independent syntactic construct or variable is an error.</p>
<p>If <em>category</em> is “procedure,” then the entry describes a procedure, and the header line gives a template for a call to the procedure. Argument names in the template are <em>italicized</em>. Thus the header line</p>
<p>(vector-ref <em>vector</em> <em>k</em>)  procedure<br />
</p>
<p>indicates that the procedure bound to the <span><code>vector-ref</code></span> variable takes two arguments, a vector <em>vector</em> and an exact non-negative integer <em>k</em> (see below). The header lines</p>
<p>(make-vector <em>k</em>)  procedure<br />
(make-vector <em>k</em> <em>fill</em>)  procedure<br />
</p>
<p>indicate that the <span><code>make-vector</code></span> procedure must be defined to take either one or two arguments.</p>
<p>It is an error for a procedure to be presented with an argument that it is not specified to handle. For succinctness, we follow the convention that if an argument name is also the name of a type listed in section <a href="#disjointness" data-reference-type="ref" data-reference="disjointness">[disjointness]</a>, then it is an error if that argument is not of the named type. For example, the header line for <span><code>vector-ref</code></span> given above dictates that the first argument to <span><code>vector-ref</code></span> is a vector. The following naming conventions also imply type restrictions:</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>i</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">alist</annotation></semantics></math></span></td>
<td style="text-align: left;">association list (list of pairs)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">boolean</annotation></semantics></math></span></td>
<td style="text-align: left;">boolean value (#<span>t</span> or #<span>f</span>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>y</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">byte</annotation></semantics></math></span></td>
<td style="text-align: left;">exact integer <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>b</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo>&lt;</mo><mn>256</mn></mrow><annotation encoding="application/x-tex">0 \leq byte &lt; 256</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>v</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">bytevector</annotation></semantics></math></span></td>
<td style="text-align: left;">bytevector</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">char</annotation></semantics></math></span></td>
<td style="text-align: left;">character</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>n</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">end</annotation></semantics></math></span></td>
<td style="text-align: left;">exact non-negative integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span>, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>k</mi><mn>1</mn></msub><annotation encoding="application/x-tex">k_1</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>k</mi><mi>j</mi></msub><annotation encoding="application/x-tex">k_j</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></td>
<td style="text-align: left;">exact non-negative integer</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">letter</annotation></semantics></math></span></td>
<td style="text-align: left;">alphabetic character</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>i</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">list</annotation></semantics></math></span>, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>i</mi><mi>s</mi><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">list_1</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>i</mi><mi>s</mi><msub><mi>t</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">list_j</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></td>
<td style="text-align: left;">list (see section <a href="#listsection" data-reference-type="ref" data-reference="listsection">[listsection]</a>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math></span>, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>j</mi></msub><annotation encoding="application/x-tex">n_j</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>obj</em></td>
<td style="text-align: left;">any object</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>i</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">pair</annotation></semantics></math></span></td>
<td style="text-align: left;">pair</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">port</annotation></semantics></math></span></td>
<td style="text-align: left;">port</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">proc</annotation></semantics></math></span></td>
<td style="text-align: left;">procedure</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math></span>, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mn>1</mn></msub><annotation encoding="application/x-tex">q_1</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>q</mi><mi>j</mi></msub><annotation encoding="application/x-tex">q_j</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></td>
<td style="text-align: left;">rational number</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">start</annotation></semantics></math></span></td>
<td style="text-align: left;">exact non-negative integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">string</annotation></semantics></math></span></td>
<td style="text-align: left;">string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>y</mi><mi>m</mi><mi>b</mi><mi>o</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">symbol</annotation></semantics></math></span></td>
<td style="text-align: left;">symbol</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>h</mi><mi>u</mi><mi>n</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">thunk</annotation></semantics></math></span></td>
<td style="text-align: left;">zero-argument procedure</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">vector</annotation></semantics></math></span></td>
<td style="text-align: left;">vector</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span>, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_j</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></td>
<td style="text-align: left;">real number</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math></span>, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">y_1</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>j</mi></msub><annotation encoding="application/x-tex">y_j</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></td>
<td style="text-align: left;">real number</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span>, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mi>j</mi></msub><annotation encoding="application/x-tex">z_j</annotation></semantics></math></span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></td>
<td style="text-align: left;">complex number</td>
</tr>
</tbody>
</table>
<p>The names <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">start</annotation></semantics></math></span> and <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>n</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">end</annotation></semantics></math></span> are used as indexes into strings, vectors, and bytevectors. Their use implies the following:</p>
<ul>
<li><p><span>It is an error if <em>start</em> is greater than <em>end</em>.</span></p></li>
<li><p><span>It is an error if <em>end</em> is greater than the length of the string, vector, or bytevector.</span></p></li>
<li><p><span>If <em>start</em> is omitted, it is assumed to be zero.</span></p></li>
<li><p><span>If <em>end</em> is omitted, it assumed to be the length of the string, vector, or bytevector.</span></p></li>
<li><p><span>The index <em>start</em> is always inclusive and the index <em>end</em> is always exclusive. As an example, consider a string. If <em>start</em> and <em>end</em> are the same, an empty substring is referred to, and if <em>start</em> is zero and <em>end</em> is the length of <em>string</em>, then the entire string is referred to.</span></p></li>
</ul>
<h3 id="evaluation-examples">Evaluation examples</h3>
<p>The symbol “⟶” used in program examples is read “evaluates to.” For example,</p>
<pre><code>  (* 5 8)      $\Longrightarrow$ 40</code></pre>
<p>means that the expression <span><code>(* 5 8)</code></span> evaluates to the object <span><code>40</code></span>. Or, more precisely: the expression given by the sequence of characters “<span><code>(* 5 8)</code></span>” evaluates, in an environment containing the base library, to an object that can be represented externally by the sequence of characters “<span><code> 40</code></span>.” See section <a href="#externalreps" data-reference-type="ref" data-reference="externalreps">[externalreps]</a> for a discussion of external representations of objects.</p>
<h3 id="naming-conventions">Naming conventions</h3>
<p>By convention, <span><code>?</code></span> is the final character of the names of procedures that always return a boolean value. Such procedures are called <span><em>predicates</em></span>. Predicates are generally understood to be side-effect free, except that they may raise an exception when passed the wrong type of argument.</p>
<p>Similarly, <span><code>!</code></span> is the final character of the names of procedures that store values into previously allocated locations (see section <a href="#storagemodel" data-reference-type="ref" data-reference="storagemodel">[storagemodel]</a>). Such procedures are called <span><em>mutation procedures</em></span>. The value returned by a mutation procedure is unspecified.</p>
<p>By convention, “<span><code>-&gt;</code></span>” appears within the names of procedures that take an object of one type and return an analogous object of another type. For example, <span>list-&gt;vector</span> takes a list and returns a vector whose elements are the same as those of the list.</p>
<p>A <span><em>command</em></span> is a procedure that does not return useful values to its continuation.</p>
<p>A <span><em>thunk</em></span> is a procedure that does not accept arguments.</p>
<h1 id="lexical-conventions">Lexical conventions</h1>
<p>This section gives an informal account of some of the lexical conventions used in writing Scheme programs. For a formal syntax of Scheme, see section <a href="#BNF" data-reference-type="ref" data-reference="BNF">[BNF]</a>.</p>
<h2 id="identifiers">Identifiers</h2>
<p>An identifier is any sequence of letters, digits, and “extended identifier characters” provided that it does not have a prefix which is a valid number. However, the <span><code>.</code></span> token (a single period) used in the list syntax is not an identifier.</p>
<p>All implementations of Scheme must support the following extended identifier characters:</p>
<pre><code>!\ \$ \% \verb&quot;&amp;&quot; * + - . / :\ &lt; = &gt; ? @ \verb&quot;^&quot; \verb&quot;_&quot; \verb&quot;~&quot; %</code></pre>
<p>Alternatively, an identifier can be represented by a sequence of zero or more characters enclosed within vertical lines (<span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="prefix">|</mo><annotation encoding="application/x-tex">|</annotation></semantics></math></span>), analogous to string literals. Any character, including whitespace characters, but excluding the backslash and vertical line characters, can appear verbatim in such an identifier. In addition, characters can be specified using either an <span>inline hex escape</span> or the same escapes available in strings.</p>
<p>For example, the identifier <code>|H\x65;llo|</code> is the same identifier as <code>Hello</code>, and in an implementation that supports the appropriate Unicode character the identifier <code>|\x3BB;|</code> is the same as the identifier <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>. What is more, <code>|\t\t|</code> and <code>|\x9;\x9;|</code> are the same. Note that <code>||</code> is a valid identifier that is different from any other identifier.</p>
<p>Here are some examples of identifiers:</p>
<pre><code>...                      {+}
+soup+                   &lt;=?
-&gt;string                 a34kTMNs
lambda                   list-&gt;vector
q                        V17a
|two words|              |two\backwhack{}x20;words|
the-word-recursion-has-many-meanings%</code></pre>
<p>See section <a href="#extendedalphas" data-reference-type="ref" data-reference="extendedalphas">[extendedalphas]</a> for the formal syntax of identifiers.</p>
<p>Identifiers have two uses within Scheme programs:</p>
<ul>
<li><p>Any identifier can be used as a variable or as a syntactic keyword (see sections <a href="#variablesection" data-reference-type="ref" data-reference="variablesection">[variablesection]</a> and <a href="#macrosection" data-reference-type="ref" data-reference="macrosection">[macrosection]</a>).</p></li>
<li><p>When an identifier appears as a literal or within a literal (see section <a href="#quote" data-reference-type="ref" data-reference="quote">[quote]</a>), it is being used to denote a <span><em>symbol</em></span> (see section <a href="#symbolsection" data-reference-type="ref" data-reference="symbolsection">[symbolsection]</a>).</p></li>
</ul>
<p>In contrast with earlier revisions of the report <span class="citation" data-cites="R5RS"></span>, the syntax distinguishes between upper and lower case in identifiers and in characters specified using their names. However, it does not distinguish between upper and lower case in numbers, nor in <span>inline hex escapes</span> used in the syntax of identifiers, characters, or strings. None of the identifiers defined in this report contain upper-case characters, even when they appear to do so as a result of the English-language convention of capitalizing the first word of a sentence.</p>
<p>The following directives give explicit control over case folding.</p>
<p><span>#!fold-case</span><br />
<span>#!no-fold-case</span></p>
<p>These directives can appear anywhere comments are permitted (see section <a href="#wscommentsection" data-reference-type="ref" data-reference="wscommentsection">[wscommentsection]</a>) but must be followed by a delimiter. They are treated as comments, except that they affect the reading of subsequent data from the same port. The <span>#!fold-case</span> directive causes subsequent identifiers and character names to be case-folded as if by <span>string-foldcase</span> (see section <a href="#stringsection" data-reference-type="ref" data-reference="stringsection">[stringsection]</a>). It has no effect on character literals. The <span>#!no-fold-case</span> directive causes a return to the default, non-folding behavior.</p>
<h2 id="whitespace-and-comments">Whitespace and comments</h2>
<p><span><em>Whitespace</em></span> characters include the space, tab, and newline characters. (Implementations may provide additional whitespace characters such as page break.) Whitespace is used for improved readability and as necessary to separate tokens from each other, a token being an indivisible lexical unit such as an identifier or number, but is otherwise insignificant. Whitespace can occur between any two tokens, but not within a token. Whitespace occurring inside a string or inside a symbol delimited by vertical lines is significant.</p>
<p>The lexical syntax includes several comment forms. Comments are treated exactly like whitespace.</p>
<p>A semicolon (<span><code>;</code></span>) indicates the start of a line comment. The comment continues to the end of the line on which the semicolon appears.</p>
<p>Another way to indicate a comment is to prefix a <span>datum</span> (cf. section <a href="#datumsyntax" data-reference-type="ref" data-reference="datumsyntax">[datumsyntax]</a>) with <span><code>#;</code></span> and optional <span>whitespace</span>. The comment consists of the comment prefix <span><code>#;</code></span>, the space, and the <span>datum</span> together. This notation is useful for “commenting out” sections of code.</p>
<p>Block comments are indicated with properly nested <span><code> #|</code></span> and <span><code>|#</code></span> pairs.</p>
<pre><code>\#|
   The FACT procedure computes the factorial
   of a non-negative integer.
|\#
(define fact
  (lambda (n)
    (if (= n 0)
        \#;(= n 1)
        1        ;Base case: return 1
        (* n (fact (- n 1))))))%</code></pre>
<h2 id="other-notations">Other notations</h2>
<p>For a description of the notations used for numbers, see section <a href="#numbersection" data-reference-type="ref" data-reference="numbersection">[numbersection]</a>.</p>
<dl>
<dt><span><code>. + -</code></span></dt>
<dd><p>These are used in numbers, and can also occur anywhere in an identifier. A delimited plus or minus sign by itself is also an identifier. A delimited period (not occurring within a number or identifier) is used in the notation for pairs (section <a href="#listsection" data-reference-type="ref" data-reference="listsection">[listsection]</a>), and to indicate a rest-parameter in a formal parameter list (section <a href="#lambda" data-reference-type="ref" data-reference="lambda">[lambda]</a>). Note that a sequence of two or more periods <span><em>is</em></span> an identifier.</p>
</dd>
<dt><code>( )</code></dt>
<dd><p>Parentheses are used for grouping and to notate lists (section <a href="#listsection" data-reference-type="ref" data-reference="listsection">[listsection]</a>).</p>
</dd>
<dt><span><code>’</code></span></dt>
<dd><p>The apostrophe (single quote) character is used to indicate literal data (section <a href="#quote" data-reference-type="ref" data-reference="quote">[quote]</a>).</p>
</dd>
<dt><span><code></code></span></dt>
<dd><p>The grave accent (backquote) character is used to indicate partly constant data (section <a href="#quasiquote" data-reference-type="ref" data-reference="quasiquote">[quasiquote]</a>).</p>
</dd>
<dt><code>, ,@</code></dt>
<dd><p>The character comma and the sequence comma at-sign are used in conjunction with quasiquotation (section <a href="#quasiquote" data-reference-type="ref" data-reference="quasiquote">[quasiquote]</a>).</p>
</dd>
<dt><code>"</code></dt>
<dd><p>The quotation mark character is used to delimit strings (section <a href="#stringsection" data-reference-type="ref" data-reference="stringsection">[stringsection]</a>).</p>
</dd>
<dt><span><code>‘ </code></span></dt>
<dd><p>Backslash is used in the syntax for character constants (section <a href="#charactersection" data-reference-type="ref" data-reference="charactersection">[charactersection]</a>) and as an escape character within string constants (section <a href="#stringsection" data-reference-type="ref" data-reference="stringsection">[stringsection]</a>) and identifiers (section <a href="#extendedalphas" data-reference-type="ref" data-reference="extendedalphas">[extendedalphas]</a>).</p>
<p><code>[ ] { }</code></p>
</dd>
<dt></dt>
<dd><p>Left and right square and curly brackets (braces) are reserved for possible future extensions to the language.</p>
</dd>
<dt><span><code>#</code></span></dt>
<dd><p>The number sign is used for a variety of purposes depending on the character that immediately follows it:</p>
</dd>
<dt>#<span>t</span> #<span>f</span></dt>
<dd><p>These are the boolean constants (section <a href="#booleansection" data-reference-type="ref" data-reference="booleansection">[booleansection]</a>), along with the alternatives <span><code>#true</code></span> and <span><code>#false</code></span>.</p>
</dd>
<dt><span><code>#</code></span><span><code>‘ </code></span></dt>
<dd><p>This introduces a character constant (section <a href="#charactersection" data-reference-type="ref" data-reference="charactersection">[charactersection]</a>).</p>
</dd>
<dt><span><code>#</code></span><code>(</code></dt>
<dd><p>This introduces a vector constant (section <a href="#vectorsection" data-reference-type="ref" data-reference="vectorsection">[vectorsection]</a>). Vector constants are terminated by <span><code>)</code></span> .</p>
</dd>
<dt><span><code>#</code></span><code>u8(</code></dt>
<dd><p>This introduces a bytevector constant (section <a href="#bytevectorsection" data-reference-type="ref" data-reference="bytevectorsection">[bytevectorsection]</a>). Bytevector constants are terminated by <span><code>)</code></span> .</p>
</dd>
<dt><span><code>#e #i #b #o #d #x</code></span></dt>
<dd><p>These are used in the notation for numbers (section <a href="#numbernotations" data-reference-type="ref" data-reference="numbernotations">[numbernotations]</a>).</p>
</dd>
<dt><code>#n= #n#</code></dt>
<dd><p>These are used for labeling and referencing other literal data (section <a href="#labelsection" data-reference-type="ref" data-reference="labelsection">[labelsection]</a>).</p>
</dd>
</dl>
<h2 id="datum-labels">Datum labels</h2>
<p>#<span>n</span>=<span>datum</span>  lexical syntax<br />
#<span>n</span>#  lexical syntax<br />
The lexical syntax #<span>n</span>=<span>datum</span> reads the same as <span>datum</span>, but also results in <span>datum</span> being labelled by <span>n</span>. It is an error if <span>n</span> is not a sequence of digits.</p>
<p>The lexical syntax #<span>n</span># serves as a reference to some object labelled by #<span>n</span>=; the result is the same object as the #<span>n</span>= (see section <a href="#equivalencesection" data-reference-type="ref" data-reference="equivalencesection">[equivalencesection]</a>).</p>
<p>Together, these syntaxes permit the notation of structures with shared or circular substructure.</p>
<pre><code>(let ((x (list &#39;a &#39;b &#39;c)))
  (set-cdr! (cddr x) x)
  x)                       \ev \#0=(a b c . \#0\#)</code></pre>
<p>The scope of a datum label is the portion of the outermost datum in which it appears that is to the right of the label. Consequently, a reference #<span>n</span># can occur only after a label #<span>n</span>=; it is an error to attempt a forward reference. In addition, it is an error if the reference appears as the labelled object itself (as in #<span>n</span>= #<span>n</span>#), because the object labelled by #<span>n</span>= is not well defined in this case.</p>
<p>It is an error for a <span>program</span> or <span>library</span> to include circular references except in literals. In particular, it is an error for <span>quasiquote</span> (section <a href="#quasiquote" data-reference-type="ref" data-reference="quasiquote">[quasiquote]</a>) to contain them.</p>
<pre><code>\#1=(begin (display \#\backwhack{}x) \#1\#)
                       \ev \scherror%</code></pre>
<h1 id="basic-concepts">Basic concepts</h1>
<h2 id="variables-syntactic-keywords-and-regions">Variables, syntactic keywords, and regions</h2>
<p>An identifier can name either a type of syntax or a location where a value can be stored. An identifier that names a type of syntax is called a <span><em>syntactic keyword</em></span> and is said to be <span><em>bound</em></span> to a transformer for that syntax. An identifier that names a location is called a <span><em>variable</em></span> and is said to be <span><em>bound</em></span> to that location. The set of all visible bindings in effect at some point in a program is known as the <span><em>environment</em></span> in effect at that point. The value stored in the location to which a variable is bound is called the variable’s value. By abuse of terminology, the variable is sometimes said to name the value or to be bound to the value. This is not quite accurate, but confusion rarely results from this practice.</p>
<p>Certain expression types are used to create new kinds of syntax and to bind syntactic keywords to those new syntaxes, while other expression types create new locations and bind variables to those locations. These expression types are called <span><em>binding constructs</em></span>.</p>
<p>Those that bind syntactic keywords are listed in section <a href="#macrosection" data-reference-type="ref" data-reference="macrosection">[macrosection]</a>. The most fundamental of the variable binding constructs is the <span>lambda</span> expression, because all other variable binding constructs (except top-level bindings) can be explained in terms of <span>lambda</span> expressions. The other variable binding constructs are <span>let</span>, <span>let*</span>, <span>letrec</span>, <span>letrec*</span>, <span>let-values</span>, <span>let*-values</span>, and <span>do</span> expressions (see sections <a href="#lambda" data-reference-type="ref" data-reference="lambda">[lambda]</a>, <a href="#letrec" data-reference-type="ref" data-reference="letrec">[letrec]</a>, and <a href="#do" data-reference-type="ref" data-reference="do">[do]</a>).</p>
<p>Scheme is a language with block structure. To each place where an identifier is bound in a program there corresponds a <span><em>region</em></span> of the program text within which the binding is visible. The region is determined by the particular binding construct that establishes the binding; if the binding is established by a <span>lambda</span> expression, for example, then its region is the entire <span>lambda</span> expression. Every mention of an identifier refers to the binding of the identifier that established the innermost of the regions containing the use. If there is no binding of the identifier whose region contains the use, then the use refers to the binding for the variable in the global environment, if any (chapters <a href="#expressionchapter" data-reference-type="ref" data-reference="expressionchapter">[expressionchapter]</a> and <a href="#initialenv" data-reference-type="ref" data-reference="initialenv">[initialenv]</a>); if there is no binding for the identifier, it is said to be <span><em>unbound</em></span>.</p>
<h2 id="disjointness-of-types">Disjointness of types</h2>
<p>No object satisfies more than one of the following predicates:</p>
<pre><code>boolean?          bytevector?
char?             eof-object?
null?             number?
pair?             port?
procedure?        string?
symbol?           vector?</code></pre>
<p>and all predicates created by <span>define-record-type</span>.</p>
<p>These predicates define the types <span><em>boolean, bytevector, character</em></span>, the empty list object, <span><em>eof-object, number, pair, port, procedure, string, symbol, vector</em></span>, and all record types.</p>
<p>Although there is a separate boolean type, any Scheme value can be used as a boolean value for the purpose of a conditional test. As explained in section <a href="#booleansection" data-reference-type="ref" data-reference="booleansection">[booleansection]</a>, all values count as true in such a test except for #<span>f</span>. This report uses the word “true” to refer to any Scheme value except #<span>f</span>, and the word “false” to refer to #<span>f</span>.</p>
<h2 id="external-representations">External representations</h2>
<p>An important concept in Scheme (and Lisp) is that of the <span><em>external representation</em></span> of an object as a sequence of characters. For example, an external representation of the integer 28 is the sequence of characters “<span><code>28</code></span>”, and an external representation of a list consisting of the integers 8 and 13 is the sequence of characters “<span><code>(8 13)</code></span>”.</p>
<p>The external representation of an object is not necessarily unique. The integer 28 also has representations “<span><code>#e28.000</code></span>” and “<span><code>#x1c</code></span>”, and the list in the previous paragraph also has the representations “<span><code>( 08 13 )</code></span>” and “<span><code>(8 . (13 . ()))</code></span>” (see section <a href="#listsection" data-reference-type="ref" data-reference="listsection">[listsection]</a>).</p>
<p>Many objects have standard external representations, but some, such as procedures, do not have standard representations (although particular implementations may define representations for them).</p>
<p>An external representation can be written in a program to obtain the corresponding object (see <span>quote</span>, section <a href="#quote" data-reference-type="ref" data-reference="quote">[quote]</a>).</p>
<p>External representations can also be used for input and output. The procedure <span>read</span> (section <a href="#read" data-reference-type="ref" data-reference="read">[read]</a>) parses external representations, and the procedure <span>write</span> (section <a href="#write" data-reference-type="ref" data-reference="write">[write]</a>) generates them. Together, they provide an elegant and powerful input/output facility.</p>
<p>Note that the sequence of characters “<span><code>(+ 2 6)</code></span>” is <span><em>not</em></span> an external representation of the integer 8, even though it <span><em>is</em></span> an expression evaluating to the integer 8; rather, it is an external representation of a three-element list, the elements of which are the symbol <span><code>+</code></span> and the integers 2 and 6. Scheme’s syntax has the property that any sequence of characters that is an expression is also the external representation of some object. This can lead to confusion, since it is not always obvious out of context whether a given sequence of characters is intended to denote data or program, but it is also a source of power, since it facilitates writing programs such as interpreters and compilers that treat programs as data (or vice versa).</p>
<p>The syntax of external representations of various kinds of objects accompanies the description of the primitives for manipulating the objects in the appropriate sections of chapter <a href="#initialenv" data-reference-type="ref" data-reference="initialenv">[initialenv]</a>.</p>
<h2 id="storage-model">Storage model</h2>
<p>Variables and objects such as pairs, strings, vectors, and bytevectors implicitly denote locations or sequences of locations. A string, for example, denotes as many locations as there are characters in the string. A new value can be stored into one of these locations using the <span><code>string-set!</code></span> procedure, but the string continues to denote the same locations as before.</p>
<p>An object fetched from a location, by a variable reference or by a procedure such as <span>car</span>, <span>vector-ref</span>, or <span>string-ref</span>, is equivalent in the sense of <span><code>eqv?</code></span> (section <a href="#equivalencesection" data-reference-type="ref" data-reference="equivalencesection">[equivalencesection]</a>) to the object last stored in the location before the fetch.</p>
<p>Every location is marked to show whether it is in use. No variable or object ever refers to a location that is not in use.</p>
<p>Whenever this report speaks of storage being newly allocated for a variable or object, what is meant is that an appropriate number of locations are chosen from the set of locations that are not in use, and the chosen locations are marked to indicate that they are now in use before the variable or object is made to denote them. Notwithstanding this, it is understood that the empty list cannot be newly allocated, because it is a unique object. It is also understood that empty strings, empty vectors, and empty bytevectors, which contain no locations, may or may not be newly allocated.</p>
<p>Every object that denotes locations is either mutable or immutable. Literal constants, the strings returned by <span><code>symbol-&gt;string</code></span>, and possibly the environment returned by <span>scheme-report-environment</span> are immutable objects. All objects created by the other procedures listed in this report are mutable. It is an error to attempt to store a new value into a location that is denoted by an immutable object.</p>
<p>These locations are to be understood as conceptual, not physical. Hence, they do not necessarily correspond to memory addresses, and even if they do, the memory address might not be constant.</p>
<p><span><em>Rationale:</em></span> In many systems it is desirable for constants (i.e. the values of literal expressions) to reside in read-only memory. Making it an error to alter constants permits this implementation strategy, while not requiring other systems to distinguish between mutable and immutable objects.</p>
<h2 id="proper-tail-recursion">Proper tail recursion</h2>
<p>Implementations of Scheme are required to be <span><em>properly tail-recursive</em></span>. Procedure calls that occur in certain syntactic contexts defined below are <span><em>tail calls</em></span>. A Scheme implementation is properly tail-recursive if it supports an unbounded number of active tail calls. A call is <span><em>active</em></span> if the called procedure might still return. Note that this includes calls that might be returned from either by the current continuation or by continuations captured earlier by <span>call-with-current-continuation</span> that are later invoked. In the absence of captured continuations, calls could return at most once and the active calls would be those that had not yet returned. A formal definition of proper tail recursion can be found in <span class="citation" data-cites="propertailrecursion"></span>.</p>
<p><span><em>Rationale:</em></span></p>
<p>Intuitively, no space is needed for an active tail call because the continuation that is used in the tail call has the same semantics as the continuation passed to the procedure containing the call. Although an improper implementation might use a new continuation in the call, a return to this new continuation would be followed immediately by a return to the continuation passed to the procedure. A properly tail-recursive implementation returns to that continuation directly.</p>
<p>Proper tail recursion was one of the central ideas in Steele and Sussman’s original version of Scheme. Their first Scheme interpreter implemented both functions and actors. Control flow was expressed using actors, which differed from functions in that they passed their results on to another actor instead of returning to a caller. In the terminology of this section, each actor finished with a tail call to another actor.</p>
<p>Steele and Sussman later observed that in their interpreter the code for dealing with actors was identical to that for functions and thus there was no need to include both in the language.</p>
<p>A <span><em>tail call</em></span> is a procedure call that occurs in a <span><em>tail context</em></span>. Tail contexts are defined inductively. Note that a tail context is always determined with respect to a particular lambda expression.</p>
<ul>
<li><p>The last expression within the body of a lambda expression, shown as <span>tail expression</span> below, occurs in a tail context. The same is true of all the bodies of <span>case-lambda</span> expressions. ̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ (lāmbda <span>formals</span> <span>expression</span> <span>tail expression</span>)</p>
<p>(case-lambda (<span>formals</span> <span>tail body</span>))</p></li>
<li><p>If one of the following expressions is in a tail context, then the subexpressions shown as <span>tail expression</span> are in a tail context. These were derived from rules in the grammar given in chapter <a href="#formalchapter" data-reference-type="ref" data-reference="formalchapter">[formalchapter]</a> by replacing some occurrences of <span>body</span> with <span>tail body</span>, some occurrences of <span>expression</span> with <span>tail expression</span>, and some occurrences of <span>sequence</span> with <span>tail sequence</span>. Only those rules that contain tail contexts are shown here.</p>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ (if <span>expression</span> <span>tail expression</span> <span>tail expression</span>) (if <span>expression</span> <span>tail expression</span>)</p>
<p>(cond <span>cond clause</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) (cond <span>cond clause</span> (else <span>tail sequence</span>))</p>
<p>(cāse <span>expression</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) (cāse <span>expression</span> (else <span>tail sequence</span>))</p>
<p>(and <span>expression</span> <span>tail expression</span>) (or <span>expression</span> <span>tail expression</span>)</p>
<p>(when <span>test</span> <span>tail sequence</span>) (unless <span>test</span> <span>tail sequence</span>)</p>
<p>(let (<span>binding spec</span>) <span>tail body</span>) (let <span>variable</span> (<span>binding spec</span>) <span>tail body</span>) (let* (<span>binding spec</span>) <span>tail body</span>) (letrec (<span>binding spec</span>) <span>tail body</span>) (letrec* (<span>binding spec</span>) <span>tail body</span>) (let-values (<span>mv binding spec</span>) <span>tail body</span>) (let*-values (<span>mv binding spec</span>) <span>tail body</span>)</p>
<p>(let-syntax (<span>syntax spec</span>) <span>tail body</span>) (letrec-syntax (<span>syntax spec</span>) <span>tail body</span>)</p>
<p>(begin <span>tail sequence</span>)</p>
<p>(dō (̄<span>iteration spec</span>) (<span>test</span> <span>tail sequence</span>) )</p>
<p><span>where</span></p>
<p><span>cond clause</span> ⟶ (<span>test</span> <span>tail sequence</span>) <span>case clause</span> ⟶ ((<span>datum</span>) <span>tail sequence</span>)</p>
<p><span>tail body</span> ⟶ <span>definition</span> <span>tail sequence</span> <span>tail sequence</span> ⟶ <span>expression</span> <span>tail expression</span></p></li>
<li><p>If a <span>cond</span> or <span>case</span> expression is in a tail context, and has a clause of the form <span>(<span>expression<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> =&gt; <span>expression<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span>)</span> then the (implied) call to the procedure that results from the evaluation of <span>expression<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> is in a tail context. <span>expression<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> itself is not in a tail context.</p></li>
</ul>
<p>Certain procedures defined in this report are also required to perform tail calls. The first argument passed to <span><code>apply</code></span> and to <span><code>call-with-current-continuation</code></span>, and the second argument passed to <span><code>call-with-values</code></span>, must be called via a tail call. Similarly, <span><code>eval</code></span> must evaluate its first argument as if it were in tail position within the <span><code>eval</code></span> procedure.</p>
<p>In the following example the only tail call is the call to <span>f</span>. None of the calls to <span>g</span> or <span>h</span> are tail calls. The reference to <span>x</span> is in a tail context, but it is not a call and thus is not a tail call.</p>
<pre><code>%
(lambda ()
  (if (g)
      (let ((x (h)))
        x)
      (and (g) (f))))</code></pre>
<p><span><em>Note:</em></span> Implementations may recognize that some non-tail calls, such as the call to <span>h</span> above, can be evaluated as though they were tail calls. In the example above, the <span>let</span> expression could be compiled as a tail call to <span>h</span>. (The possibility of <span>h</span> returning an unexpected number of values can be ignored, because in that case the effect of the <span>let</span> is explicitly unspecified and implementation-dependent.)</p>
<h1 id="expressions">Expressions</h1>
<p>Expression types are categorized as <span><em>primitive</em></span> or <span><em>derived</em></span>. Primitive expression types include variables and procedure calls. Derived expression types are not semantically primitive, but can instead be defined as macros. Suitable syntax definitions of some of the derived expressions are given in section <a href="#derivedsection" data-reference-type="ref" data-reference="derivedsection">[derivedsection]</a>.</p>
<p>The procedures <span>force</span>, <span>promise?</span>, <span>make-promise</span>, and <span>make-parameter</span> are also described in this chapter because they are intimately associated with the <span>delay</span>, <span>delay-force</span>, and <span>parameterize</span> expression types.</p>
<h2 id="primitive-expression-types">Primitive expression types</h2>
<h3 id="variable-references">Variable references</h3>
<p><span>-2ex</span></p>
<p>variable  syntax<br />
An expression consisting of a variable (section <a href="#variablesection" data-reference-type="ref" data-reference="variablesection">[variablesection]</a>) is a variable reference. The value of the variable reference is the value stored in the location to which the variable is bound. It is an error to reference an unbound variable.</p>
<pre><code>(define x 28)
x   \ev  28%</code></pre>
<h3 id="literal-expressions">Literal expressions</h3>
<p><span>-2ex</span></p>
<p>(quote<span> <em><span>datum</span></em></span>)  syntax<br />
<span><code>’</code></span><span>datum</span>  syntax<br />
constant  syntax<br />
<span>(quote <span>datum</span>)</span> evaluates to <span>datum</span>. <span>Datum</span> can be any external representation of a Scheme object (see section <a href="#externalreps" data-reference-type="ref" data-reference="externalreps">[externalreps]</a>). This notation is used to include literal constants in Scheme code.</p>
<pre><code>%
(quote a)                     \ev  a
(quote \sharpsign(a b c))     \ev  \#(a b c)
(quote (+ 1 2))               \ev  (+ 1 2)%</code></pre>
<p><span>(quote <span>datum</span>)</span> can be abbreviated as <span><code>’</code></span><span>datum</span>. The two notations are equivalent in all respects.</p>
<pre><code>&#39;a                   \ev  a
&#39;\#(a b c)           \ev  \#(a b c)
&#39;()                  \ev  ()
&#39;(+ 1 2)             \ev  (+ 1 2)
&#39;(quote a)           \ev  (quote a)
&#39;&#39;a                  \ev  (quote a)%</code></pre>
<p>Numerical constants, string constants, character constants, vector constants, bytevector constants, and boolean constants evaluate to themselves; they need not be quoted.</p>
<pre><code>&#39;145932    \ev  145932
145932     \ev  145932
&#39;&quot;abc&quot;     \ev  &quot;abc&quot;
&quot;abc&quot;      \ev  &quot;abc&quot;
&#39;\#\backwhack{}a   \ev  \#\backwhack{}a
\#\backwhack{}a   \ev  \#\backwhack{}a
&#39;\#(a 10)  \ev  \#(a 10)
\#(a 10)  \ev  \#(a 10)
&#39;\#u8(64 65)  \ev  \#u8(64 65)
\#u8(64 65)  \ev  \#u8(64 65)
&#39;\schtrue  \ev  \schtrue
\schtrue   \ev  \schtrue%</code></pre>
<p>As noted in section <a href="#storagemodel" data-reference-type="ref" data-reference="storagemodel">[storagemodel]</a>, it is an error to attempt to alter a constant (i.e. the value of a literal expression) using a mutation procedure like <span>set-car!</span> or <span>string-set!</span>.</p>
<h3 id="procedure-calls">Procedure calls</h3>
<p><span>-2ex</span></p>
<p>(<span>operator</span> <span>operand<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math>)  syntax<br />
A procedure call is written by enclosing in parentheses an expression for the procedure to be called followed by expressions for the arguments to be passed to it. The operator and operand expressions are evaluated (in an unspecified order) and the resulting procedure is passed the resulting arguments.</p>
<pre><code>%
(+ 3 4)                          \ev  7
((if \schfalse + *) 3 4)         \ev  12%</code></pre>
<p>The procedures in this document are available as the values of variables exported by the standard libraries. For example, the addition and multiplication procedures in the above examples are the values of the variables <span>+</span> and <span>*</span> in the base library. New procedures are created by evaluating <span>lambda</span> expressions (see section <a href="#lambda" data-reference-type="ref" data-reference="lambda">[lambda]</a>).</p>
<p>Procedure calls can return any number of values (see <span><code>values</code></span> in section <a href="#proceduresection" data-reference-type="ref" data-reference="proceduresection">[proceduresection]</a>). Most of the procedures defined in this report return one value or, for procedures such as <span>apply</span>, pass on the values returned by a call to one of their arguments. Exceptions are noted in the individual descriptions.</p>
<p><span><em>Note:</em></span> In contrast to other dialects of Lisp, the order of evaluation is unspecified, and the operator expression and the operand expressions are always evaluated with the same evaluation rules.</p>
<p><span><em>Note:</em></span> Although the order of evaluation is otherwise unspecified, the effect of any concurrent evaluation of the operator and operand expressions is constrained to be consistent with some sequential order of evaluation. The order of evaluation may be chosen differently for each procedure call.</p>
<p><span><em>Note:</em></span> In many dialects of Lisp, the empty list, <span><code> ()</code></span>, is a legitimate expression evaluating to itself. In Scheme, it is an error.</p>
<h3 id="procedures">Procedures</h3>
<p><span>-2ex</span></p>
<p>(lambda<span> <em><span>formals</span> <span>body</span></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> <span>Formals</span> is a formal arguments list as described below, and <span>body</span> is a sequence of zero or more definitions followed by one or more expressions.</p>
<p><span><em>Semantics:</em> </span> A <span>lambda</span> expression evaluates to a procedure. The environment in effect when the <span>lambda</span> expression was evaluated is remembered as part of the procedure. When the procedure is later called with some actual arguments, the environment in which the <span>lambda</span> expression was evaluated will be extended by binding the variables in the formal argument list to fresh locations, and the corresponding actual argument values will be stored in those locations. (A <span><em>fresh</em></span> location is one that is distinct from every previously existing location.) Next, the expressions in the body of the lambda expression (which, if it contains definitions, represents a <span>letrec*</span> form — see section <a href="#letrecstar" data-reference-type="ref" data-reference="letrecstar">[letrecstar]</a>) will be evaluated sequentially in the extended environment. The results of the last expression in the body will be returned as the results of the procedure call.</p>
<pre><code>(lambda (x) (+ x x))      \ev  {\em{}a procedure}
((lambda (x) (+ x x)) 4)  \ev  8

(define reverse-subtract
  (lambda (x y) (- y x)))
(reverse-subtract 7 10)         \ev  3

(define add4
  (let ((x 4))
    (lambda (y) (+ x y))))
(add4 6)                        \ev  10%</code></pre>
<p><span>Formals</span> have one of the following forms:</p>
<ul>
<li><p><span><code>(variable_1 \ldots\,)</code></span>: The procedure takes a fixed number of arguments; when the procedure is called, the arguments will be stored in fresh locations that are bound to the corresponding variables.</p></li>
<li><p><span>variable</span>: The procedure takes any number of arguments; when the procedure is called, the sequence of actual arguments is converted into a newly allocated list, and the list is stored in a fresh location that is bound to <span>variable</span>.</p></li>
<li><p><span><code>(variable_1 \ldots\, variable_{n} . variable_{n+1})</code></span>: If a space-delimited period precedes the last variable, then the procedure takes <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> or more arguments, where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> is the number of formal arguments before the period (it is an error if there is not at least one). The value stored in the binding of the last variable will be a newly allocated list of the actual arguments left over after all the other actual arguments have been matched up against the other formal arguments.</p></li>
</ul>
<p>It is an error for a <span>variable</span> to appear more than once in <span>formals</span>.</p>
<pre><code>((lambda x x) 3 4 5 6)          \ev  (3 4 5 6)
((lambda (x y . z) z)
 3 4 5 6)                       \ev  (5 6)%</code></pre>
<p>Each procedure created as the result of evaluating a <span>lambda</span> expression is (conceptually) tagged with a storage location, in order to make <span><code>eqv?</code></span> and <span><code>eq?</code></span> work on procedures (see section <a href="#equivalencesection" data-reference-type="ref" data-reference="equivalencesection">[equivalencesection]</a>).</p>
<h3 id="conditionals">Conditionals</h3>
<p><span>-2ex</span></p>
<p>(if<span> <em><span>test</span> <span>consequent</span> <span>alternate</span></em></span>)  syntax<br />
(if<span> <em><span>test</span> <span>consequent</span></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> <span>Test</span>, <span>consequent</span>, and <span>alternate</span> are expressions.</p>
<p><span><em>Semantics:</em> </span> An <span>if</span> expression is evaluated as follows: first, <span>test</span> is evaluated. If it yields a true value (see section <a href="#booleansection" data-reference-type="ref" data-reference="booleansection">[booleansection]</a>), then <span>consequent</span> is evaluated and its values are returned. Otherwise <span>alternate</span> is evaluated and its values are returned. If <span>test</span> yields a false value and no <span>alternate</span> is specified, then the result of the expression is unspecified.</p>
<pre><code>(if (&gt; 3 2) &#39;yes &#39;no)           \ev  yes
(if (&gt; 2 3) &#39;yes &#39;no)           \ev  no
(if (&gt; 3 2)
    (- 3 2)
    (+ 3 2))                    \ev  1%</code></pre>
<h3 id="assignments">Assignments</h3>
<p><span>-2ex</span></p>
<p>(set!<span> <em><span>variable</span> <span>expression</span></em></span>)  syntax<br />
<span><em>Semantics:</em> </span> <span>Expression</span> is evaluated, and the resulting value is stored in the location to which <span>variable</span> is bound. It is an error if <span>variable</span> is not bound either in some region enclosing the <span>set!</span> expression or else globally. The result of the <span>set!</span> expression is unspecified.</p>
<pre><code>(define x 2)
(+ x 1)                 \ev  3
(set! x 4)              \ev  \unspecified
(+ x 1)                 \ev  5%</code></pre>
<h3 id="inclusion">Inclusion</h3>
<p><span>-2ex</span></p>
<p>(include<span> <em><span>string<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>string<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
(include-ci<span> <em><span>string<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>string<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
<span><em>Semantics:</em> </span> Both <span><code>include</code></span> and <span><code>include-ci</code></span> take one or more filenames expressed as string literals, apply an implementation-specific algorithm to find corresponding files, read the contents of the files in the specified order as if by repeated applications of <span>read</span>, and effectively replace the <span>include</span> or <span>include-ci</span> expression with a <span>begin</span> expression containing what was read from the files. The difference between the two is that <span><code>include-ci</code></span> reads each file as if it began with the <span>#!fold-case</span> directive, while <span><code>include</code></span> does not.</p>
<p><span><em>Note:</em></span> Implementations are encouraged to search for files in the directory which contains the including file, and to provide a way for users to specify other directories to search.</p>
<h2 id="derived-expression-types">Derived expression types</h2>
<p>The constructs in this section are hygienic, as discussed in section <a href="#macrosection" data-reference-type="ref" data-reference="macrosection">[macrosection]</a>. For reference purposes, section <a href="#derivedsection" data-reference-type="ref" data-reference="derivedsection">[derivedsection]</a> gives syntax definitions that will convert most of the constructs described in this section into the primitive constructs described in the previous section.</p>
<h3 id="conditionals-1">Conditionals</h3>
<p><span>-2ex</span></p>
<p>(cond<span> <em><span>clause<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>clause<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
else  auxiliary syntax<br />
=&gt;  auxiliary syntax<br />
<span><em>Syntax:</em> </span> <span>Clauses</span> take one of two forms, either</p>
<pre><code>(\hyper{test} \hyperi{expression} \dotsfoo)%</code></pre>
<p>where <span>test</span> is any expression, or</p>
<pre><code>(\hyper{test} =&gt; \hyper{expression})%</code></pre>
<p>The last <span>clause</span> can be an “else clause,” which has the form</p>
<pre><code>(else \hyperi{expression} \hyperii{expression} \dotsfoo)\rm.%</code></pre>
<p><span><em>Semantics:</em> </span> A <span>cond</span> expression is evaluated by evaluating the <span>test</span> expressions of successive <span>clause</span>s in order until one of them evaluates to a true value (see section <a href="#booleansection" data-reference-type="ref" data-reference="booleansection">[booleansection]</a>). When a <span>test</span> evaluates to a true value, the remaining <span>expression</span>s in its <span>clause</span> are evaluated in order, and the results of the last <span>expression</span> in the <span>clause</span> are returned as the results of the entire <span>cond</span> expression.</p>
<p>If the selected <span>clause</span> contains only the <span>test</span> and no <span>expression</span>s, then the value of the <span>test</span> is returned as the result. If the selected <span>clause</span> uses the <span><code>=&gt;</code></span> alternate form, then the <span>expression</span> is evaluated. It is an error if its value is not a procedure that accepts one argument. This procedure is then called on the value of the <span>test</span> and the values returned by this procedure are returned by the <span>cond</span> expression.</p>
<p>If all <span>test</span>s evaluate to #<span>f</span>, and there is no else clause, then the result of the conditional expression is unspecified; if there is an else clause, then its <span>expression</span>s are evaluated in order, and the values of the last one are returned.</p>
<pre><code>(cond ((&gt; 3 2) &#39;greater)
      ((&lt; 3 2) &#39;less))         \ev  greater%

(cond ((&gt; 3 3) &#39;greater)
      ((&lt; 3 3) &#39;less)
      (else &#39;equal))            \ev  equal%

(cond ((assv &#39;b &#39;((a 1) (b 2))) =&gt; cadr)
      (else \schfalse{}))         \ev  2%</code></pre>
<p>(case<span> <em><span>key</span> <span>clause<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>clause<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> <span>Key</span> can be any expression. Each <span>clause</span> has the form</p>
<pre><code>((\hyperi{datum} \dotsfoo) \hyperi{expression} \hyperii{expression} \dotsfoo)\rm,%</code></pre>
<p>where each <span>datum</span> is an external representation of some object. It is an error if any of the <span>datum</span>s are the same anywhere in the expression. Alternatively, a <span>clause</span> can be of the form</p>
<pre><code>((\hyperi{datum} \dotsfoo) =&gt; \hyper{expression})%</code></pre>
<p>The last <span>clause</span> can be an “else clause,” which has one of the forms</p>
<pre><code>(else \hyperi{expression} \hyperii{expression} \dotsfoo)</code></pre>
<p>or</p>
<pre><code>(else =&gt; \hyper{expression})\rm.%</code></pre>
<p><span><em>Semantics:</em> </span> A <span>case</span> expression is evaluated as follows. <span>Key</span> is evaluated and its result is compared against each <span>datum</span>. If the result of evaluating <span>key</span> is the same (in the sense of <span>eqv?</span>; see section <a href="#eqv?" data-reference-type="ref" data-reference="eqv?">[eqv?]</a>) to a <span>datum</span>, then the expressions in the corresponding <span>clause</span> are evaluated in order and the results of the last expression in the <span>clause</span> are returned as the results of the <span>case</span> expression.</p>
<p>If the result of evaluating <span>key</span> is different from every <span>datum</span>, then if there is an else clause, its expressions are evaluated and the results of the last are the results of the <span>case</span> expression; otherwise the result of the <span>case</span> expression is unspecified.</p>
<p>If the selected <span>clause</span> or else clause uses the <span><code>=&gt;</code></span> alternate form, then the <span>expression</span> is evaluated. It is an error if its value is not a procedure accepting one argument. This procedure is then called on the value of the <span>key</span> and the values returned by this procedure are returned by the <span>case</span> expression.</p>
<pre><code>(case (* 2 3)
  ((2 3 5 7) &#39;prime)
  ((1 4 6 8 9) &#39;composite))     \ev  composite
(case (car &#39;(c d))
  ((a) &#39;a)
  ((b) &#39;b))                     \ev  \unspecified
(case (car &#39;(c d))
  ((a e i o u) &#39;vowel)
  ((w y) &#39;semivowel)
  (else =&gt; (lambda (x) x)))     \ev  c%</code></pre>
<p>(and<span> <em><span>test<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
<span><em>Semantics:</em> </span> The <span>test</span> expressions are evaluated from left to right, and if any expression evaluates to #<span>f</span> (see section <a href="#booleansection" data-reference-type="ref" data-reference="booleansection">[booleansection]</a>), then #<span>f</span> is returned. Any remaining expressions are not evaluated. If all the expressions evaluate to true values, the values of the last expression are returned. If there are no expressions, then #<span>t</span> is returned.</p>
<pre><code>(and (= 2 2) (&gt; 2 1))           \ev  \schtrue
(and (= 2 2) (&lt; 2 1))           \ev  \schfalse
(and 1 2 &#39;c &#39;(f g))             \ev  (f g)
(and)                           \ev  \schtrue%</code></pre>
<p>(or<span> <em><span>test<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
<span><em>Semantics:</em> </span> The <span>test</span> expressions are evaluated from left to right, and the value of the first expression that evaluates to a true value (see section <a href="#booleansection" data-reference-type="ref" data-reference="booleansection">[booleansection]</a>) is returned. Any remaining expressions are not evaluated. If all expressions evaluate to #<span>f</span> or if there are no expressions, then #<span>f</span> is returned.</p>
<pre><code>(or (= 2 2) (&gt; 2 1))            \ev  \schtrue
(or (= 2 2) (&lt; 2 1))            \ev  \schtrue
(or \schfalse \schfalse \schfalse) \ev  \schfalse
(or (memq &#39;b &#39;(a b c))
    (/ 3 0))                    \ev  (b c)%</code></pre>
<p>(when<span> <em><span>test</span> <span>expression<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>expression<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> The <span>test</span> is an expression.</p>
<p><span><em>Semantics:</em> </span> The test is evaluated, and if it evaluates to a true value, the expressions are evaluated in order. The result of the <span>when</span> expression is unspecified.</p>
<pre><code>(when (= 1 1.0)
  (display &quot;1&quot;)
  (display &quot;2&quot;))  \ev  \unspecified
 \&gt;{\em and prints}  12%</code></pre>
<p>(unless<span> <em><span>test</span> <span>expression<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>expression<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> The <span>test</span> is an expression.</p>
<p><span><em>Semantics:</em> </span> The test is evaluated, and if it evaluates to #<span>f</span>, the expressions are evaluated in order. The result of the <span>unless</span> expression is unspecified.</p>
<pre><code>(unless (= 1 1.0)
  (display &quot;1&quot;)
  (display &quot;2&quot;))  \ev  \unspecified
 \&gt;{\em and prints nothing}%</code></pre>
<p>(cond-expand<span> <em><span>ce-clause<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>ce-clause<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> The <span><code>cond-expand</code></span> expression type provides a way to statically expand different expressions depending on the implementation. A <span>ce-clause</span> takes the following form:</p>
<p><span><code>(feature requirement expression \ldots\,)</code></span></p>
<p>The last clause can be an “else clause,” which has the form</p>
<p><span><code>(else expression \ldots\,)</code></span></p>
<p>A <span>feature requirement</span> takes one of the following forms:</p>
<ul>
<li><p><span><code>feature identifier</code></span></p></li>
<li><p><span><code>(library library name)</code></span></p></li>
<li><p><span><code>(and feature requirement \ldots\,)</code></span></p></li>
<li><p><span><code>(or feature requirement \ldots\,)</code></span></p></li>
<li><p><span><code>(not feature requirement)</code></span></p></li>
</ul>
<p><span><em>Semantics:</em> </span> Each implementation maintains a list of feature identifiers which are present, as well as a list of libraries which can be imported. The value of a <span>feature requirement</span> is determined by replacing each <span>feature identifier</span> and <span><code>(library library name)</code></span> on the implementation’s lists with #<span>t</span>, and all other feature identifiers and library names with #<span>f</span>, then evaluating the resulting expression as a Scheme boolean expression under the normal interpretation of <span>and</span>, <span>or</span>, and <span>not</span>.</p>
<p>A <span><code>cond-expand</code></span> is then expanded by evaluating the <span>feature requirement</span>s of successive <span>ce-clause</span>s in order until one of them returns #<span>t</span>. When a true clause is found, the corresponding <span>expression</span>s are expanded to a <span>begin</span>, and the remaining clauses are ignored. If none of the <span>feature requirement</span>s evaluate to #<span>t</span>, then if there is an else clause, its <span>expression</span>s are included. Otherwise, the behavior of the <span><code>cond-expand</code></span> is unspecified. Unlike <span>cond</span>, <span>cond-expand</span> does not depend on the value of any variables.</p>
<p>The exact features provided are implementation-defined, but for portability a core set of features is given in appendix <a href="#stdfeatures" data-reference-type="ref" data-reference="stdfeatures">[stdfeatures]</a>.</p>
<h3 id="binding-constructs">Binding constructs</h3>
<p>The binding constructs <span>let</span>, <span>let*</span>, <span>letrec</span>, <span>letrec*</span>, <span>let-values</span>, and <span>let*-values</span> give Scheme a block structure, like Algol 60. The syntax of the first four constructs is identical, but they differ in the regions they establish for their variable bindings. In a <span>let</span> expression, the initial values are computed before any of the variables become bound; in a <span>let*</span> expression, the bindings and evaluations are performed sequentially; while in <span>letrec</span> and <span>letrec*</span> expressions, all the bindings are in effect while their initial values are being computed, thus allowing mutually recursive definitions. The <span>let-values</span> and <span>let*-values</span> constructs are analogous to <span>let</span> and <span>let*</span> respectively, but are designed to handle multiple-valued expressions, binding different identifiers to the returned values.</p>
<p>(let<span> <em><span>bindings</span> <span>body</span></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> <span>Bindings</span> has the form</p>
<pre><code>((\hyperi{variable} \hyperi{init}) \dotsfoo)\rm,%</code></pre>
<p>where each <span>init</span> is an expression, and <span>body</span> is a sequence of zero or more definitions followed by a sequence of one or more expressions as described in section <a href="#lambda" data-reference-type="ref" data-reference="lambda">[lambda]</a>. It is an error for a <span>variable</span> to appear more than once in the list of variables being bound.</p>
<p><span><em>Semantics:</em> </span> The <span>init</span>s are evaluated in the current environment (in some unspecified order), the <span>variable</span>s are bound to fresh locations holding the results, the <span>body</span> is evaluated in the extended environment, and the values of the last expression of <span>body</span> are returned. Each binding of a <span>variable</span> has <span>body</span> as its region.</p>
<pre><code>(let ((x 2) (y 3))
  (* x y))                      \ev  6

(let ((x 2) (y 3))
  (let ((x 7)
        (z (+ x y)))
    (* z x)))                   \ev  35%</code></pre>
<p>See also “named <span>let</span>,” section <a href="#namedlet" data-reference-type="ref" data-reference="namedlet">[namedlet]</a>.</p>
<p>(let*<span> <em><span>bindings</span> <span>body</span></em></span>)  syntax<br />
</p>
<p><span><em>Syntax:</em> </span> <span>Bindings</span> has the form</p>
<pre><code>((\hyperi{variable} \hyperi{init}) \dotsfoo)\rm,%</code></pre>
<p>and <span>body</span> is a sequence of zero or more definitions followed by one or more expressions as described in section <a href="#lambda" data-reference-type="ref" data-reference="lambda">[lambda]</a>.</p>
<p><span><em>Semantics:</em> </span> The <span>let*</span> binding construct is similar to <span>let</span>, but the bindings are performed sequentially from left to right, and the region of a binding indicated by <span>(<span>variable</span> <span>init</span>)</span> is that part of the <span>let*</span> expression to the right of the binding. Thus the second binding is done in an environment in which the first binding is visible, and so on. The <span>variable</span>s need not be distinct.</p>
<pre><code>(let ((x 2) (y 3))
  (let* ((x 7)
         (z (+ x y)))
    (* z x)))             \ev  70%</code></pre>
<p>(letrec<span> <em><span>bindings</span> <span>body</span></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> <span>Bindings</span> has the form</p>
<pre><code>((\hyperi{variable} \hyperi{init}) \dotsfoo)\rm,%</code></pre>
<p>and <span>body</span> is a sequence of zero or more definitions followed by one or more expressions as described in section <a href="#lambda" data-reference-type="ref" data-reference="lambda">[lambda]</a>. It is an error for a <span>variable</span> to appear more than once in the list of variables being bound.</p>
<p><span><em>Semantics:</em> </span> The <span>variable</span>s are bound to fresh locations holding unspecified values, the <span>init</span>s are evaluated in the resulting environment (in some unspecified order), each <span>variable</span> is assigned to the result of the corresponding <span>init</span>, the <span>body</span> is evaluated in the resulting environment, and the values of the last expression in <span>body</span> are returned. Each binding of a <span>variable</span> has the entire <span>letrec</span> expression as its region, making it possible to define mutually recursive procedures.</p>
<pre><code>(letrec ((even?
          (lambda (n)
            (if (zero? n)
                \schtrue
                (odd? (- n 1)))))
         (odd?
          (lambda (n)
            (if (zero? n)
                \schfalse
                (even? (- n 1))))))
  (even? 88))
		\ev  \schtrue%</code></pre>
<p>One restriction on <span>letrec</span> is very important: if it is not possible to evaluate each <span>init</span> without assigning or referring to the value of any <span>variable</span>, it is an error. The restriction is necessary because <span>letrec</span> is defined in terms of a procedure call where a <span>lambda</span> expression binds the <span>variable</span>s to the values of the <span>init</span>s. In the most common uses of <span>letrec</span>, all the <span>init</span>s are <span>lambda</span> expressions and the restriction is satisfied automatically.</p>
<p>(letrec*<span> <em><span>bindings</span> <span>body</span></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> <span>Bindings</span> has the form</p>
<pre><code>((\hyperi{variable} \hyperi{init}) \dotsfoo)\rm,%</code></pre>
<p>and <span>body</span> is a sequence of zero or more definitions followed by one or more expressions as described in section <a href="#lambda" data-reference-type="ref" data-reference="lambda">[lambda]</a>. It is an error for a <span>variable</span> to appear more than once in the list of variables being bound.</p>
<p><span><em>Semantics:</em> </span> The <span>variable</span>s are bound to fresh locations, each <span>variable</span> is assigned in left-to-right order to the result of evaluating the corresponding <span>init</span> (interleaving evaluations and assignments), the <span>body</span> is evaluated in the resulting environment, and the values of the last expression in <span>body</span> are returned. Despite the left-to-right evaluation and assignment order, each binding of a <span>variable</span> has the entire <span>letrec*</span> expression as its region, making it possible to define mutually recursive procedures.</p>
<p>If it is not possible to evaluate each <span>init</span> without assigning or referring to the value of the corresponding <span>variable</span> or the <span>variable</span> of any of the bindings that follow it in <span>bindings</span>, it is an error. Another restriction is that it is an error to invoke the continuation of an <span>init</span> more than once.</p>
<pre><code>;; Returns the arithmetic, geometric, and
;; harmonic means of a nested list of numbers
(define (means ton)
  (letrec*
     ((mean
        (lambda (f g)
          (f (/ (sum g ton) n))))
      (sum
        (lambda (g ton)
          (if (null? ton)
            (+)
            (if (number? ton)
                (g ton)
                (+ (sum g (car ton))
                   (sum g (cdr ton)))))))
      (n (sum (lambda (x) 1) ton)))
    (values (mean values values)
            (mean exp log)
            (mean / /))))</code></pre>
<p>Evaluating <span>(means ’(3 (1 4)))</span> returns three values: 8/3, 2.28942848510666 (approximately), and 36/19.</p>
<p>(let-values<span> <em><span>mv binding spec</span> <span>body</span></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> <span>Mv binding spec</span> has the form</p>
<pre><code>((\hyperi{formals} \hyperi{init}) \dotsfoo)\rm,%</code></pre>
<p>where each <span>init</span> is an expression, and <span>body</span> is zero or more definitions followed by a sequence of one or more expressions as described in section <a href="#lambda" data-reference-type="ref" data-reference="lambda">[lambda]</a>. It is an error for a variable to appear more than once in the set of <span>formals</span>.</p>
<p><span><em>Semantics:</em> </span> The <span>init</span>s are evaluated in the current environment (in some unspecified order) as if by invoking <span>call-with-values</span>, and the variables occurring in the <span>formals</span> are bound to fresh locations holding the values returned by the <span>init</span>s, where the <span>formals</span> are matched to the return values in the same way that the <span>formals</span> in a <span>lambda</span> expression are matched to the arguments in a procedure call. Then, the <span>body</span> is evaluated in the extended environment, and the values of the last expression of <span>body</span> are returned. Each binding of a <span>variable</span> has <span>body</span> as its region.</p>
<p>It is an error if the <span>formals</span> do not match the number of values returned by the corresponding <span>init</span>.</p>
<pre><code>(let-values (((root rem) (exact-integer-sqrt 32)))
  (* root rem))                \ev  35%</code></pre>
<p>(let*-values<span> <em><span>mv binding spec</span> <span>body</span></em></span>)  syntax<br />
</p>
<p><span><em>Syntax:</em> </span> <span>Mv binding spec</span> has the form</p>
<pre><code>((\hyper{formals} \hyper{init}) \dotsfoo)\rm,%</code></pre>
<p>and <span>body</span> is a sequence of zero or more definitions followed by one or more expressions as described in section <a href="#lambda" data-reference-type="ref" data-reference="lambda">[lambda]</a>. In each <span>formals</span>, it is an error if any variable appears more than once.</p>
<p><span><em>Semantics:</em> </span> The <span>let*-values</span> construct is similar to <span>let-values</span>, but the <span>init</span>s are evaluated and bindings created sequentially from left to right, with the region of the bindings of each <span>formals</span> including the <span>init</span>s to its right as well as <span>body</span>. Thus the second <span>init</span> is evaluated in an environment in which the first set of bindings is visible and initialized, and so on.</p>
<pre><code>(let ((a &#39;a) (b &#39;b) (x &#39;x) (y &#39;y))
  (let*-values (((a b) (values x y))
                ((x y) (values a b)))
    (list a b x y)))     \ev (x y x y)%</code></pre>
<h3 id="sequencing">Sequencing</h3>
<p><span>-2ex</span></p>
<p>Both of Scheme’s sequencing constructs are named <span>begin</span>, but the two have slightly different forms and uses:</p>
<p>(begin<span> <em><span>expression or definition</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
This form of <span>begin</span> can appear as part of a <span>body</span>, or at the outermost level of a <span>program</span>, or at the REPL, or directly nested in a <span>begin</span> that is itself of this form. It causes the contained expressions and definitions to be evaluated exactly as if the enclosing <span>begin</span> construct were not present.</p>
<p><span><em>Rationale:</em></span> This form is commonly used in the output of macros (see section <a href="#macrosection" data-reference-type="ref" data-reference="macrosection">[macrosection]</a>) which need to generate multiple definitions and splice them into the context in which they are expanded.</p>
<p>(begin<span> <em><span>expression<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>expression<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  syntax<br />
This form of <span>begin</span> can be used as an ordinary expression. The <span>expression</span>s are evaluated sequentially from left to right, and the values of the last <span>expression</span> are returned. This expression type is used to sequence side effects such as assignments or input and output.</p>
<pre><code>(define x 0)

(and (= x 0)
     (begin (set! x 5)
            (+ x 1)))              \ev  6

(begin (display &quot;4 plus 1 equals &quot;)
       (display (+ 4 1)))      \ev  \unspecified
 \&gt;{\em and prints}  4 plus 1 equals 5%</code></pre>
<p>Note that there is a third form of <span>begin</span> used as a library declaration: see section <a href="#librarydeclarations" data-reference-type="ref" data-reference="librarydeclarations">[librarydeclarations]</a>.</p>
<h3 id="iteration">Iteration</h3>
<p>(do ((<span>variable<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>init<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>step<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span>)  syntax<br />
<span><code> \ldots\,) (test expression \ldots\,) command \ldots\,)</code></span></p>
<p><span><em>Syntax:</em> </span> All of <span>init</span>, <span>step</span>, <span>test</span>, and <span>command</span> are expressions.</p>
<p><span><em>Semantics:</em> </span> A <span>do</span> expression is an iteration construct. It specifies a set of variables to be bound, how they are to be initialized at the start, and how they are to be updated on each iteration. When a termination condition is met, the loop exits after evaluating the <span>expression</span>s.</p>
<p>A <span>do</span> expression is evaluated as follows: The <span>init</span> expressions are evaluated (in some unspecified order), the <span>variable</span>s are bound to fresh locations, the results of the <span>init</span> expressions are stored in the bindings of the <span>variable</span>s, and then the iteration phase begins.</p>
<p>Each iteration begins by evaluating <span>test</span>; if the result is false (see section <a href="#booleansection" data-reference-type="ref" data-reference="booleansection">[booleansection]</a>), then the <span>command</span> expressions are evaluated in order for effect, the <span>step</span> expressions are evaluated in some unspecified order, the <span>variable</span>s are bound to fresh locations, the results of the <span>step</span>s are stored in the bindings of the <span>variable</span>s, and the next iteration begins.</p>
<p>If <span>test</span> evaluates to a true value, then the <span>expression</span>s are evaluated from left to right and the values of the last <span>expression</span> are returned. If no <span>expression</span>s are present, then the value of the <span>do</span> expression is unspecified.</p>
<p>The region of the binding of a <span>variable</span> consists of the entire <span>do</span> expression except for the <span>init</span>s. It is an error for a <span>variable</span> to appear more than once in the list of <span>do</span> variables.</p>
<p>A <span>step</span> can be omitted, in which case the effect is the same as if <span>(<span>variable</span> <span>init</span> <span>variable</span>)</span> had been written instead of <span>(<span>variable</span> <span>init</span>)</span>.</p>
<pre><code>(do ((vec (make-vector 5))
     (i 0 (+ i 1)))
    ((= i 5) vec)
  (vector-set! vec i i))          \ev  \#(0 1 2 3 4)

(let ((x &#39;(1 3 5 7 9)))
  (do ((x x (cdr x))
       (sum 0 (+ sum (car x))))
      ((null? x) sum)))             \ev  25%</code></pre>
<p>(let<span> <em><span>variable</span> <span>bindings</span> <span>body</span></em></span>)  syntax<br />
<span><em>Semantics:</em> </span> “Named <span>let</span>” is a variant on the syntax of <span><code>let</code></span> which provides a more general looping construct than <span>do</span> and can also be used to express recursion. It has the same syntax and semantics as ordinary <span>let</span> except that <span>variable</span> is bound within <span>body</span> to a procedure whose formal arguments are the bound variables and whose body is <span>body</span>. Thus the execution of <span>body</span> can be repeated by invoking the procedure named by <span>variable</span>.</p>
<pre><code>(let loop ((numbers &#39;(3 -2 1 6 -5))
           (nonneg &#39;())
           (neg &#39;()))
  (cond ((null? numbers) (list nonneg neg))
        ((&gt;= (car numbers) 0)
         (loop (cdr numbers)
               (cons (car numbers) nonneg)
               neg))
        ((&lt; (car numbers) 0)
         (loop (cdr numbers)
               nonneg
               (cons (car numbers) neg))))) %
  \lev  ((6 1 3) (-5 -2))%</code></pre>
<h3 id="delayed-evaluation">Delayed evaluation</h3>
<p><span>-2ex</span></p>
<p>(delay<span> <em><span>expression</span></em></span>)  lazy library syntax<br />
<span><em>Semantics:</em> </span> The <span>delay</span> construct is used together with the procedure <span><code>force</code></span> to implement <span><em>lazy evaluation</em></span> or <span><em>call by need</em></span>. <span><code>(delay expression)</code></span> returns an object called a <span><em>promise</em></span> which at some point in the future can be asked (by the <span>force</span> procedure) to evaluate <span>expression</span>, and deliver the resulting value.</p>
<p>The effect of <span>expression</span> returning multiple values is unspecified.</p>
<p>(delay-force<span> <em><span>expression</span></em></span>)  lazy library syntax<br />
<span><em>Semantics:</em> </span> The expression <span>(delay-force <em>expression</em>)</span> is conceptually similar to <span>(delay (force <em>expression</em>))</span>, with the difference that forcing the result of <span>delay-force</span> will in effect result in a tail call to <span>(force <em>expression</em>)</span>, while forcing the result of <span>(delay (force <em>expression</em>))</span> might not. Thus iterative lazy algorithms that might result in a long series of chains of <span>delay</span> and <span>force</span> can be rewritten using <span>delay-force</span> to prevent consuming unbounded space during evaluation.</p>
<p>(force<span> <em>promise</em></span>)  lazy library procedure<br />
The <span>force</span> procedure forces the value of a <em>promise</em> created by <span><code>delay</code></span>, <span><code>delay-force</code></span>, or <span><code>make-promise</code></span>. If no value has been computed for the promise, then a value is computed and returned. The value of the promise must be cached (or “memoized”) so that if it is forced a second time, the previously computed value is returned. Consequently, a delayed expression is evaluated using the parameter values and exception handler of the call to <span>force</span> which first requested its value. If <em>promise</em> is not a promise, it may be returned unchanged.</p>
<pre><code>(force (delay (+ 1 2)))   \ev  3
(let ((p (delay (+ 1 2))))
  (list (force p) (force p)))  
                               \ev  (3 3)

(define integers
  (letrec ((next
            (lambda (n)
              (delay (cons n (next (+ n 1)))))))
    (next 0)))
(define head
  (lambda (stream) (car (force stream))))
(define tail
  (lambda (stream) (cdr (force stream))))

(head (tail (tail integers)))  
                               \ev  2%</code></pre>
<p>The following example is a mechanical transformation of a lazy stream-filtering algorithm into Scheme. Each call to a constructor is wrapped in <span>delay</span>, and each argument passed to a deconstructor is wrapped in <span>force</span>. The use of <span>(delay-force ...)</span> instead of <span> (delay (force ...))</span> around the body of the procedure ensures that an ever-growing sequence of pending promises does not exhaust available storage, because <span>force</span> will in effect force such sequences iteratively.</p>
<pre><code>(define (stream-filter p? s)
  (delay-force
   (if (null? (force s)) 
       (delay &#39;())
       (let ((h (car (force s)))
             (t (cdr (force s))))
         (if (p? h)
             (delay (cons h (stream-filter p? t)))
             (stream-filter p? t))))))

(head (tail (tail (stream-filter odd? integers))))
                               \ev 5%</code></pre>
<p>The following examples are not intended to illustrate good programming style, as <span>delay</span>, <span>force</span>, and <span>delay-force</span> are mainly intended for programs written in the functional style. However, they do illustrate the property that only one value is computed for a promise, no matter how many times it is forced.</p>
<pre><code>(define count 0)
(define p
  (delay (begin (set! count (+ count 1))
                (if (&gt; count x)
                    count
                    (force p)))))
(define x 5)
p                     \ev  {\it{}a promise}
(force p)             \ev  6
p                     \ev  {\it{}a promise, still}
(begin (set! x 10)
       (force p))     \ev  6%</code></pre>
<p>Various extensions to this semantics of <span>delay</span>, <span>force</span> and <span>delay-force</span> are supported in some implementations:</p>
<ul>
<li><p>Calling <span>force</span> on an object that is not a promise may simply return the object.</p></li>
<li><p>It may be the case that there is no means by which a promise can be operationally distinguished from its forced value. That is, expressions like the following may evaluate to either #<span>t</span> or to #<span>f</span>, depending on the implementation:</p>
<pre><code>(eqv? (delay 1) 1)          \ev  \unspecified
(pair? (delay (cons 1 2)))  \ev  \unspecified%</code></pre></li>
<li><p>Implementations may implement “implicit forcing,” where the value of a promise is forced by procedures that operate only on arguments of a certain type, like <span>cdr</span> and <span>*</span>. However, procedures that operate uniformly on their arguments, like <span>list</span>, must not force them.</p>
<pre><code>(+ (delay (* 3 7)) 13)  \ev  \unspecified
(car
  (list (delay (* 3 7)) 13))    \ev {\it{}a promise}%</code></pre></li>
</ul>
<p>(promise?<span> <em><em>obj</em></em></span>)  lazy library procedure<br />
The <span>promise?</span> procedure returns #<span>t</span> if its argument is a promise, and #<span>f</span> otherwise. Note that promises are not necessarily disjoint from other Scheme types such as procedures.</p>
<p>(make-promise<span> <em><em>obj</em></em></span>)  lazy library procedure<br />
The <span>make-promise</span> procedure returns a promise which, when forced, will return <em>obj</em>. It is similar to <span>delay</span>, but does not delay its argument: it is a procedure rather than syntax. If <em>obj</em> is already a promise, it is returned.</p>
<h3 id="dynamic-bindings">Dynamic bindings</h3>
<p><span>-2ex</span></p>
<p>The <span><em>dynamic extent</em></span> of a procedure call is the time between when it is initiated and when it returns. In Scheme, <span> call-with-current-continuation</span> (section <a href="#continuations" data-reference-type="ref" data-reference="continuations">[continuations]</a>) allows reentering a dynamic extent after its procedure call has returned. Thus, the dynamic extent of a call might not be a single, continuous time period.</p>
<p>This sections introduces <span><em>parameter objects</em></span>, which can be bound to new values for the duration of a dynamic extent. The set of all parameter bindings at a given time is called the <span><em>dynamic environment</em></span>.</p>
<p>(make-parameter<span> <em>init</em></span>)  procedure<br />
(make-parameter<span> <em>init converter</em></span>)  procedure<br />
Returns a newly allocated parameter object, which is a procedure that accepts zero arguments and returns the value associated with the parameter object. Initially, this value is the value of <span>(<em>converter</em> <em>init</em>)</span>, or of <em>init</em> if the conversion procedure <em>converter</em> is not specified. The associated value can be temporarily changed using <span>parameterize</span>, which is described below.</p>
<p>The effect of passing arguments to a parameter object is implementation-dependent.</p>
<p>(parameterize ((<span>param<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <span>value<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math>)  syntax<br />
<span><code> )</code></span></p>
<p><span><em>Syntax:</em> </span> Both <span>param<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> and <span>value<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> are expressions.</p>
<p><span>It is an error if the value of any <span>param</span> expression is not a parameter object.</span></p>
<p><span><em>Semantics:</em> </span> A <span>parameterize</span> expression is used to change the values returned by specified parameter objects during the evaluation of the body.</p>
<p>The <span>param</span> and <span>value</span> expressions are evaluated in an unspecified order. The <span>body</span> is evaluated in a dynamic environment in which calls to the parameters return the results of passing the corresponding values to the conversion procedure specified when the parameters were created. Then the previous values of the parameters are restored without passing them to the conversion procedure. The results of the last expression in the <span>body</span> are returned as the results of the entire <span>parameterize</span> expression.</p>
<p><span><em>Note:</em></span> If the conversion procedure is not idempotent, the results of <span>(parameterize ((x (x))) ...)</span>, which appears to bind the parameter <em>x</em> to its current value, might not be what the user expects.</p>
<p>If an implementation supports multiple threads of execution, then <span>parameterize</span> must not change the associated values of any parameters in any thread other than the current thread and threads created inside <span>body</span>.</p>
<p>Parameter objects can be used to specify configurable settings for a computation without the need to pass the value to every procedure in the call chain explicitly.</p>
<pre><code>(define radix
  (make-parameter
   10
   (lambda (x)
     (if (and (exact-integer? x) (&lt;= 2 x 16))
         x
         (error &quot;invalid radix&quot;)))))

(define (f n) (number-&gt;string n (radix)))

(f 12)                                       \ev &quot;12&quot;
(parameterize ((radix 2))
  (f 12))                                    \ev &quot;1100&quot;
(f 12)                                       \ev &quot;12&quot;

(radix 16)                                   \ev \unspecified

(parameterize ((radix 0))
  (f 12))                                    \ev \scherror%</code></pre>
<h3 id="exception-handling">Exception handling</h3>
<p><span>-2ex</span></p>
<p>(guard (<span>variable</span>  syntax<br />
<span><code> cond clause_2 \ldots\,) )</code></span><br />
<span><em>Syntax:</em> </span> Each <span>cond clause</span> is as in the specification of <span>cond</span>.</p>
<p><span><em>Semantics:</em> </span> The <span>body</span> is evaluated with an exception handler that binds the raised object (see <span><code>raise</code></span> in section <a href="#exceptionsection" data-reference-type="ref" data-reference="exceptionsection">[exceptionsection]</a>) to <span>variable</span> and, within the scope of that binding, evaluates the clauses as if they were the clauses of a <span>cond</span> expression. That implicit <span>cond</span> expression is evaluated with the continuation and dynamic environment of the <span>guard</span> expression. If every <span>cond clause</span>’s <span>test</span> evaluates to #<span>f</span> and there is no else clause, then <span>raise-continuable</span> is invoked on the raised object within the dynamic environment of the original call to <span>raise</span> or <span>raise-continuable</span>, except that the current exception handler is that of the <span>guard</span> expression.</p>
<p>See section <a href="#exceptionsection" data-reference-type="ref" data-reference="exceptionsection">[exceptionsection]</a> for a more complete discussion of exceptions.</p>
<pre><code>(guard (condition
         ((assq &#39;a condition) =&gt; cdr)
         ((assq &#39;b condition)))
  (raise (list (cons &#39;a 42))))
\ev 42

(guard (condition
         ((assq &#39;a condition) =&gt; cdr)
         ((assq &#39;b condition)))
  (raise (list (cons &#39;b 23))))
\ev (b . 23)%</code></pre>
<h3 id="quasiquotation">Quasiquotation</h3>
<p><span>-2ex</span></p>
<p>(quasiquote<span> <em><span>qq template</span></em></span>)  syntax<br />
<span><code></code></span><span>qq template</span>  syntax<br />
unquote  auxiliary syntax<br />
<code>‘ </code>  auxiliary syntax<br />
unquote-splicing  auxiliary syntax<br />
<span><code>‘ </code></span><span><code>‘</code></span>  auxiliary syntax<br />
“Quasiquote” expressions are useful for constructing a list or vector structure when some but not all of the desired structure is known in advance. If no commas appear within the <span>qq template</span>, the result of evaluating <span><code></code></span><span>qq template</span> is equivalent to the result of evaluating <span><code>’</code></span><span>qq template</span>. If a comma appears within the <span>qq template</span>, however, the expression following the comma is evaluated (“unquoted”) and its result is inserted into the structure instead of the comma and the expression. If a comma appears followed without intervening whitespace by a commercial at-sign (<span><code>‘</code></span>), then it is an error if the following expression does not evaluate to a list; the opening and closing parentheses of the list are then “stripped away” and the elements of the list are inserted in place of the comma at-sign expression sequence. A comma at-sign normally appears only within a list or vector <span>qq template</span>.</p>
<p><span><em>Note:</em></span> In order to unquote an identifier beginning with <span>@</span>, it is necessary to use either an explicit <span>unquote</span> or to put whitespace after the comma, to avoid colliding with the comma at-sign sequence.</p>
<pre><code>`(list ,(+ 1 2) 4)  \ev  (list 3 4)
(let ((name &#39;a)) `(list ,name &#39;,name)) %
          \lev  (list a (quote a))
`(a ,(+ 1 2) ,@(map abs &#39;(4 -5 6)) b) %
          \lev  (a 3 4 5 6 b)
`(({\cf foo} ,(- 10 3)) ,@(cdr &#39;(c)) . ,(car &#39;(cons))) %
          \lev  ((foo 7) . cons)
`\#(10 5 ,(sqrt 4) ,@(map sqrt &#39;(16 9)) 8) %
          \lev  \#(10 5 2 4 3 8)
(let ((foo &#39;(foo bar)) (@baz &#39;baz))
  `(list ,@foo , @baz))%
          \lev  (list foo bar baz)%</code></pre>
<p>Quasiquote expressions can be nested. Substitutions are made only for unquoted components appearing at the same nesting level as the outermost quasiquote. The nesting level increases by one inside each successive quasiquotation, and decreases by one inside each unquotation.</p>
<pre><code>`(a `(b ,(+ 1 2) ,(foo ,(+ 1 3) d) e) f) %
          \lev  (a `(b ,(+ 1 2) ,(foo 4 d) e) f)
(let ((name1 &#39;x)
      (name2 &#39;y))
  `(a `(b ,,name1 ,&#39;,name2 d) e)) %
          \lev  (a `(b ,x ,&#39;y d) e)%</code></pre>
<p>A quasiquote expression may return either newly allocated, mutable objects or literal structure for any structure that is constructed at run time during the evaluation of the expression. Portions that do not need to be rebuilt are always literal. Thus,</p>
<pre><code>(let ((a 3)) `((1 2) ,a ,4 ,&#39;five 6))%</code></pre>
<p>may be treated as equivalent to either of the following expressions:</p>
<pre><code>`((1 2) 3 4 five 6)

(let ((a 3))
  (cons &#39;(1 2)
        (cons a (cons 4 (cons &#39;five &#39;(6))))))%</code></pre>
<p>However, it is not equivalent to this expression:</p>
<pre><code>(let ((a 3)) (list (list 1 2) a 4 &#39;five 6))%</code></pre>
<p>The two notations <span><code></code></span><span>qq template</span> and <span><code>(quasiquote qq template)</code></span> are identical in all respects. <span>,<span>expression</span></span> is identical to <span>(unquote <span>expression</span>)</span>, and <span>,@<span>expression</span></span> is identical to <span>(unquote-splicing <span>expression</span>)</span>. The <span><code>write</code></span> procedure may output either format.</p>
<pre><code>(quasiquote (list (unquote (+ 1 2)) 4)) %
          \lev  (list 3 4)
&#39;(quasiquote (list (unquote (+ 1 2)) 4)) %
          \lev  `(list ,(+ 1 2) 4)
     {\em{}i.e.,} (quasiquote (list (unquote (+ 1 2)) 4))%</code></pre>
<p>It is an error if any of the identifiers <span>quasiquote</span>, <span>unquote</span>, or <span>unquote-splicing</span> appear in positions within a <span>qq template</span> otherwise than as described above.</p>
<h3 id="case-lambda">Case-lambda</h3>
<p><span>-2ex</span></p>
<p>(case-lambda<span> <em><span>clause</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  case-lambda library syntax<br />
<span><em>Syntax:</em> </span> Each <span>clause</span> is of the form (<span>formals</span> <span>body</span>), where <span>formals</span> and <span>body</span> have the same syntax as in a <span>lambda</span> expression.</p>
<p><span><em>Semantics:</em> </span> A <span>case-lambda</span> expression evaluates to a procedure that accepts a variable number of arguments and is lexically scoped in the same manner as a procedure resulting from a <span>lambda</span> expression. When the procedure is called, the first <span>clause</span> for which the arguments agree with <span>formals</span> is selected, where agreement is specified as for the <span>formals</span> of a <span>lambda</span> expression. The variables of <span>formals</span> are bound to fresh locations, the values of the arguments are stored in those locations, the <span>body</span> is evaluated in the extended environment, and the results of <span>body</span> are returned as the results of the procedure call.</p>
<p>It is an error for the arguments not to agree with the <span>formals</span> of any <span>clause</span>.</p>
<pre><code>(define range
  (case-lambda
   ((e) (range 0 e))
   ((b e) (do ((r &#39;() (cons e r))
               (e (- e 1) (- e 1)))
              ((&lt; e b) r)))))

(range 3)    \ev (0 1 2)
(range 3 5)  \ev (3 4)%</code></pre>
<h2 id="macros">Macros</h2>
<p>Scheme programs can define and use new derived expression types, called <span><em>macros</em></span>. Program-defined expression types have the syntax</p>
<pre><code>(\hyper{keyword} {\hyper{datum}} ...)%</code></pre>
<p>where <span>keyword</span> is an identifier that uniquely determines the expression type. This identifier is called the <span><em>syntactic keyword</em></span>, or simply <span> <em>keyword</em></span>, of the macro. The number of the <span>datum</span>s, and their syntax, depends on the expression type.</p>
<p>Each instance of a macro is called a <span><em>use</em></span> of the macro. The set of rules that specifies how a use of a macro is transcribed into a more primitive expression is called the <span><em>transformer</em></span> of the macro.</p>
<p>The macro definition facility consists of two parts:</p>
<ul>
<li><p>A set of expressions used to establish that certain identifiers are macro keywords, associate them with macro transformers, and control the scope within which a macro is defined, and</p></li>
<li><p>a pattern language for specifying macro transformers.</p></li>
</ul>
<p>The syntactic keyword of a macro can shadow variable bindings, and local variable bindings can shadow syntactic bindings. Two mechanisms are provided to prevent unintended conflicts:</p>
<ul>
<li><p>If a macro transformer inserts a binding for an identifier (variable or keyword), the identifier will in effect be renamed throughout its scope to avoid conflicts with other identifiers. Note that a global variable definition may or may not introduce a binding; see section <a href="#defines" data-reference-type="ref" data-reference="defines">[defines]</a>.</p></li>
<li><p>If a macro transformer inserts a free reference to an identifier, the reference refers to the binding that was visible where the transformer was specified, regardless of any local bindings that surround the use of the macro.</p></li>
</ul>
<p>In consequence, all macros defined using the pattern language are “hygienic” and “referentially transparent” and thus preserve Scheme’s lexical scoping. <span class="citation" data-cites="Kohlbecker86 hygienic Bawden88 macrosthatwork syntacticabstraction"></span></p>
<p>Implementations may provide macro facilities of other types.</p>
<h3 id="binding-constructs-for-syntactic-keywords">Binding constructs for syntactic keywords</h3>
<p>The <span>let-syntax</span> and <span>letrec-syntax</span> binding constructs are analogous to <span>let</span> and <span>letrec</span>, but they bind syntactic keywords to macro transformers instead of binding variables to locations that contain values. Syntactic keywords can also be bound globally or locally with <span>define-syntax</span>; see section <a href="#define-syntax" data-reference-type="ref" data-reference="define-syntax">[define-syntax]</a>.</p>
<p>(let-syntax<span> <em><span>bindings</span> <span>body</span></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> <span>Bindings</span> has the form</p>
<pre><code>((\hyper{keyword} \hyper{transformer spec}) \dotsfoo)%</code></pre>
<p>Each <span>keyword</span> is an identifier, each <span>transformer spec</span> is an instance of <span>syntax-rules</span>, and <span>body</span> is a sequence of zero or more definitions followed by one or more expressions. It is an error for a <span>keyword</span> to appear more than once in the list of keywords being bound.</p>
<p><span><em>Semantics:</em> </span> The <span>body</span> is expanded in the syntactic environment obtained by extending the syntactic environment of the <span>let-syntax</span> expression with macros whose keywords are the <span>keyword</span>s, bound to the specified transformers. Each binding of a <span>keyword</span> has <span>body</span> as its region.</p>
<pre><code>(let-syntax ((given-that (syntax-rules ()
                     ((given-that test stmt1 stmt2 ...)
                      (if test
                          (begin stmt1
                                 stmt2 ...))))))
  (let ((if \schtrue))
    (given-that if (set! if &#39;now))
    if))                           \ev  now

(let ((x &#39;outer))
  (let-syntax ((m (syntax-rules () ((m) x))))
    (let ((x &#39;inner))
      (m))))                       \ev  outer%</code></pre>
<p>(letrec-syntax<span> <em><span>bindings</span> <span>body</span></em></span>)  syntax<br />
<span><em>Syntax:</em> </span> Same as for <span>let-syntax</span>.</p>
<p><span><em>Semantics:</em> </span> The <span>body</span> is expanded in the syntactic environment obtained by extending the syntactic environment of the <span>letrec-syntax</span> expression with macros whose keywords are the <span>keyword</span>s, bound to the specified transformers. Each binding of a <span>keyword</span> has the <span>transformer spec</span>s as well as the <span>body</span> within its region, so the transformers can transcribe expressions into uses of the macros introduced by the <span>letrec-syntax</span> expression.</p>
<pre><code>(letrec-syntax
    ((my-or (syntax-rules ()
              ((my-or) \schfalse)
              ((my-or e) e)
              ((my-or e1 e2 ...)
               (let ((temp e1))
                 (if temp
                     temp
                     (my-or e2 ...)))))))
  (let ((x \schfalse)
        (y 7)
        (temp 8)
        (let odd?)
        (if even?))
    (my-or x
           (let temp)
           (if y)
           y)))        \ev  7%</code></pre>
<h3 id="pattern-language">Pattern language</h3>
<p>A <span>transformer spec</span> has one of the following forms:</p>
<p>(syntax-rules (<span>pattern literal</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math>)  syntax<br />
<span><code> \ldots\,) </code></span> (syntax-rules <span>ellipsis</span> (<span>pattern literal</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math>)  syntax<br />
<span><code> \ldots\,)</code></span><br />
_  auxiliary syntax<br />
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math>  auxiliary syntax<br />
<span><em>Syntax:</em> </span> It is an error if any of the <span>pattern literal</span>s, or the <span>ellipsis</span> in the second form, is not an identifier. It is also an error if <span>syntax rule</span> is not of the form</p>
<pre><code>(\hyper{pattern} \hyper{template})%</code></pre>
<p>The <span>pattern</span> in a <span>syntax rule</span> is a list <span>pattern</span> whose first element is an identifier.</p>
<p>A <span>pattern</span> is either an identifier, a constant, or one of the following</p>
<pre><code>(\hyper{pattern} \ldots)
(\hyper{pattern} \hyper{pattern} \ldots . \hyper{pattern})
(\hyper{pattern} \ldots \hyper{pattern} \hyper{ellipsis} \hyper{pattern} \ldots)
(\hyper{pattern} \ldots \hyper{pattern} \hyper{ellipsis} \hyper{pattern} \ldots
  . \hyper{pattern})
\#(\hyper{pattern} \ldots)
\#(\hyper{pattern} \ldots \hyper{pattern} \hyper{ellipsis} \hyper{pattern} \ldots)%</code></pre>
<p>and a <span>template</span> is either an identifier, a constant, or one of the following</p>
<pre><code>(\hyper{element} \ldots)
(\hyper{element} \hyper{element} \ldots . \hyper{template})
(\hyper{ellipsis} \hyper{template})
\#(\hyper{element} \ldots)%</code></pre>
<p>where an <span>element</span> is a <span>template</span> optionally followed by an <span>ellipsis</span>. An <span>ellipsis</span> is the identifier specified in the second form of <span>syntax-rules</span>, or the default identifier <span>...</span> (three consecutive periods) otherwise.</p>
<p><span><em>Semantics:</em> </span>An instance of <span>syntax-rules</span> produces a new macro transformer by specifying a sequence of hygienic rewrite rules. A use of a macro whose keyword is associated with a transformer specified by <span>syntax-rules</span> is matched against the patterns contained in the <span>syntax rule</span>s, beginning with the leftmost <span>syntax rule</span>. When a match is found, the macro use is transcribed hygienically according to the template.</p>
<p>An identifier appearing within a <span>pattern</span> can be an underscore (<span>_</span>), a literal identifier listed in the list of <span>pattern literal</span>s, or the <span>ellipsis</span>. All other identifiers appearing within a <span>pattern</span> are <span><em>pattern variables</em></span>.</p>
<p>The keyword at the beginning of the pattern in a <span>syntax rule</span> is not involved in the matching and is considered neither a pattern variable nor a literal identifier.</p>
<p>Pattern variables match arbitrary input elements and are used to refer to elements of the input in the template. It is an error for the same pattern variable to appear more than once in a <span>pattern</span>.</p>
<p>Underscores also match arbitrary input elements but are not pattern variables and so cannot be used to refer to those elements. If an underscore appears in the <span>pattern literal</span>s list, then that takes precedence and underscores in the <span>pattern</span> match as literals. Multiple underscores can appear in a <span>pattern</span>.</p>
<p>Identifiers that appear in (<span>pattern literal</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math>) are interpreted as literal identifiers to be matched against corresponding elements of the input. An element in the input matches a literal identifier if and only if it is an identifier and either both its occurrence in the macro expression and its occurrence in the macro definition have the same lexical binding, or the two identifiers are the same and both have no lexical binding.</p>
<p>A subpattern followed by <span>ellipsis</span> can match zero or more elements of the input, unless <span>ellipsis</span> appears in the <span>pattern literal</span>s, in which case it is matched as a literal.</p>
<p>More formally, an input expression <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math> matches a pattern <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> if and only if:</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> is an underscore (<span>_</span>).</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> is a non-literal identifier; or</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> is a literal identifier and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math> is an identifier with the same binding; or</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> is a list <span>(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\dots</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math>)</span> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math> is a list of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> elements that match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> through <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math>, respectively; or</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> is an improper list <span>(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>2</mn></msub><annotation encoding="application/x-tex">P_2</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\dots</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math> . <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">P_{n+1}</annotation></semantics></math>)</span> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math> is a list or improper list of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> or more elements that match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> through <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math>, respectively, and whose <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>th tail matches <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">P_{n+1}</annotation></semantics></math>; or</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> is of the form <span>(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\dots</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>k</mi></msub><annotation encoding="application/x-tex">P_k</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>e</mi></msub><annotation encoding="application/x-tex">P_e</annotation></semantics></math> <span>ellipsis</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>m</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">P_{m+1}</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math>)</span> where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math> is a proper list of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> elements, the first <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> of which match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> through <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>k</mi></msub><annotation encoding="application/x-tex">P_k</annotation></semantics></math>, respectively, whose next <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">m-k</annotation></semantics></math> elements each match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>e</mi></msub><annotation encoding="application/x-tex">P_e</annotation></semantics></math>, whose remaining <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n-m</annotation></semantics></math> elements match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>m</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">P_{m+1}</annotation></semantics></math> through <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math>; or</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> is of the form <span>(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\dots</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>k</mi></msub><annotation encoding="application/x-tex">P_k</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>e</mi></msub><annotation encoding="application/x-tex">P_{e}</annotation></semantics></math> <span>ellipsis</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>m</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">P_{m+1}</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math> . <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>x</mi></msub><annotation encoding="application/x-tex">P_x</annotation></semantics></math>)</span> where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math> is a list or improper list of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> elements, the first <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> of which match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> through <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>k</mi></msub><annotation encoding="application/x-tex">P_k</annotation></semantics></math>, whose next <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">m-k</annotation></semantics></math> elements each match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>e</mi></msub><annotation encoding="application/x-tex">P_e</annotation></semantics></math>, whose remaining <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n-m</annotation></semantics></math> elements match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>m</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">P_{m+1}</annotation></semantics></math> through <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math>, and whose <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>th and final cdr matches <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>x</mi></msub><annotation encoding="application/x-tex">P_x</annotation></semantics></math>; or</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> is a vector of the form <span>#(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\dots</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math>)</span> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math> is a vector of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> elements that match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> through <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math>; or</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> is of the form <span>#(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\dots</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>k</mi></msub><annotation encoding="application/x-tex">P_k</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>e</mi></msub><annotation encoding="application/x-tex">P_{e}</annotation></semantics></math> <span>ellipsis</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>m</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">P_{m+1}</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math>)</span> where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math> is a vector of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> elements the first <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> of which match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>1</mn></msub><annotation encoding="application/x-tex">P_1</annotation></semantics></math> through <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>k</mi></msub><annotation encoding="application/x-tex">P_k</annotation></semantics></math>, whose next <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">m-k</annotation></semantics></math> elements each match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>e</mi></msub><annotation encoding="application/x-tex">P_e</annotation></semantics></math>, and whose remaining <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n-m</annotation></semantics></math> elements match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>m</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">P_{m+1}</annotation></semantics></math> through <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>n</mi></msub><annotation encoding="application/x-tex">P_n</annotation></semantics></math>; or</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> is a constant and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math> is equal to <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> in the sense of the <span>equal?</span> procedure.</p></li>
</ul>
<p>It is an error to use a macro keyword, within the scope of its binding, in an expression that does not match any of the patterns.</p>
<p>When a macro use is transcribed according to the template of the matching <span>syntax rule</span>, pattern variables that occur in the template are replaced by the elements they match in the input. Pattern variables that occur in subpatterns followed by one or more instances of the identifier <span>ellipsis</span> are allowed only in subtemplates that are followed by as many instances of <span>ellipsis</span>. They are replaced in the output by all of the elements they match in the input, distributed as indicated. It is an error if the output cannot be built up as specified.</p>
<p>Identifiers that appear in the template but are not pattern variables or the identifier <span>ellipsis</span> are inserted into the output as literal identifiers. If a literal identifier is inserted as a free identifier then it refers to the binding of that identifier within whose scope the instance of <span>syntax-rules</span> appears. If a literal identifier is inserted as a bound identifier then it is in effect renamed to prevent inadvertent captures of free identifiers.</p>
<p>A template of the form <span>(<span>ellipsis</span> <span>template</span>)</span> is identical to <span>template</span>, except that ellipses within the template have no special meaning. That is, any ellipses contained within <span>template</span> are treated as ordinary identifiers. In particular, the template <span>(<span>ellipsis</span> <span>ellipsis</span>)</span> produces a single <span>ellipsis</span>. This allows syntactic abstractions to expand into code containing ellipses.</p>
<pre><code>(define-syntax be-like-begin
  (syntax-rules ()
    ((be-like-begin name)
     (define-syntax name
       (syntax-rules ()
         ((name expr (... ...))
          (begin expr (... ...))))))))

(be-like-begin sequence)
(sequence 1 2 3 4) \ev 4%</code></pre>
<p>As an example, if <span><code>let</code></span> and <span><code>cond</code></span> are defined as in section <a href="#derivedsection" data-reference-type="ref" data-reference="derivedsection">[derivedsection]</a> then they are hygienic (as required) and the following is not an error.</p>
<pre><code>(let ((=&gt; \schfalse))
  (cond (\schtrue =&gt; &#39;ok)))           \ev ok%</code></pre>
<p>The macro transformer for <span>cond</span> recognizes <span>=&gt;</span> as a local variable, and hence an expression, and not as the base identifier <span>=&gt;</span>, which the macro transformer treats as a syntactic keyword. Thus the example expands into</p>
<pre><code>(let ((=&gt; \schfalse))
  (if \schtrue (begin =&gt; &#39;ok)))%</code></pre>
<p>instead of</p>
<pre><code>(let ((=&gt; \schfalse))
  (let ((temp \schtrue))
    (if temp (&#39;ok temp))))%</code></pre>
<p>which would result in an invalid procedure call.</p>
<h3 id="signaling-errors-in-macro-transformers">Signaling errors in macro transformers</h3>
<p>(syntax-error <span>message</span> <span>args</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math>)  syntax<br />
<span>syntax-error</span> behaves similarly to <span>error</span> (<a href="#exceptionsection" data-reference-type="ref" data-reference="exceptionsection">[exceptionsection]</a>) except that implementations with an expansion pass separate from evaluation should signal an error as soon as <span>syntax-error</span> is expanded. This can be used as a <span>syntax-rules</span> <span>template</span> for a <span>pattern</span> that is an invalid use of the macro, which can provide more descriptive error messages. <span>message</span> is a string literal, and <span>args</span> arbitrary expressions providing additional information. Applications cannot count on being able to catch syntax errors with exception handlers or guards.</p>
<pre><code>(define-syntax simple-let
  (syntax-rules ()
    ((\_ (head ... ((x . y) val) . tail)
        body1 body2 ...)
     (syntax-error
      &quot;expected an identifier but got&quot;
      (x . y)))
    ((\_ ((name val) ...) body1 body2 ...)
     ((lambda (name ...) body1 body2 ...)
       val ...))))%</code></pre>
<h1 id="program-structure">Program structure</h1>
<h2 id="programs">Programs</h2>
<p>A Scheme program consists of one or more import declarations followed by a sequence of expressions and definitions. Import declarations specify the libraries on which a program or library depends; a subset of the identifiers exported by the libraries are made available to the program. Expressions are described in chapter <a href="#expressionchapter" data-reference-type="ref" data-reference="expressionchapter">[expressionchapter]</a>. Definitions are either variable definitions, syntax definitions, or record-type definitions, all of which are explained in this chapter. They are valid in some, but not all, contexts where expressions are allowed, specifically at the outermost level of a <span>program</span> and at the beginning of a <span>body</span>.</p>
<p>At the outermost level of a program, <span><code>(begin expression or definition_1 \ldots\,)</code></span> is equivalent to the sequence of expressions and definitions in the <span><code>begin</code></span>. Similarly, in a <span>body</span>, <span><code>(begin definition_1 \ldots\,)</code></span> is equivalent to the sequence <span>definition<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math>. Macros can expand into such <span>begin</span> forms. For the formal definition, see <a href="#sequencing" data-reference-type="ref" data-reference="sequencing">[sequencing]</a>.</p>
<p>Import declarations and definitions cause bindings to be created in the global environment or modify the value of existing global bindings. The initial environment of a program is empty, so at least one import declaration is needed to introduce initial bindings.</p>
<p>Expressions occurring at the outermost level of a program do not create any bindings. They are executed in order when the program is invoked or loaded, and typically perform some kind of initialization.</p>
<p>Programs and libraries are typically stored in files, although in some implementations they can be entered interactively into a running Scheme system. Other paradigms are possible. Implementations which store libraries in files should document the mapping from the name of a library to its location in the file system.</p>
<h2 id="import-declarations">Import declarations</h2>
<p>An import declaration takes the following form:</p>
<pre><code>(import \hyper{import-set} \dotsfoo)</code></pre>
<p>An import declaration provides a way to import identifiers exported by a library. Each <span>import set</span> names a set of bindings from a library and possibly specifies local names for the imported bindings. It takes one of the following forms:</p>
<ul>
<li><p><span><code>library name</code></span></p></li>
<li><p><span><code>(only import set identifier \ldots\,)</code></span></p></li>
<li><p><span><code>(except import set identifier \ldots\,)</code></span></p></li>
<li><p><span><code>(prefix import set identifier)</code></span></p></li>
<li><p><span><code>(rename import set  (identifier_1 identifier_2) \ldots\,)</code></span></p></li>
</ul>
<p>In the first form, all of the identifiers in the named library’s export clauses are imported with the same names (or the exported names if exported with <span><code>rename</code></span>). The additional <span>import set</span> forms modify this set as follows:</p>
<ul>
<li><p><span><code>only</code></span> produces a subset of the given <span>import set</span> including only the listed identifiers (after any renaming). It is an error if any of the listed identifiers are not found in the original set.</p></li>
<li><p><span><code>except</code></span> produces a subset of the given <span>import set</span>, excluding the listed identifiers (after any renaming). It is an error if any of the listed identifiers are not found in the original set.</p></li>
<li><p><span><code>rename</code></span> modifies the given <span>import set</span>, replacing each instance of <span>identifier<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> with <span>identifier<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span>. It is an error if any of the listed <span>identifier<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span>s are not found in the original set.</p></li>
<li><p><span><code>prefix</code></span> automatically renames all identifiers in the given <span>import set</span>, prefixing each with the specified <span>identifier</span>.</p></li>
</ul>
<p>In a program or library declaration, it is an error to import the same identifier more than once with different bindings, or to redefine or mutate an imported binding with a definition or with <span>set!</span>, or to refer to an identifier before it is imported. However, a REPL should permit these actions.</p>
<h2 id="variable-definitions">Variable definitions</h2>
<p>A variable definition binds one or more identifiers and specifies an initial value for each of them. The simplest kind of variable definition takes one of the following forms:</p>
<ul>
<li><p><span><code>(define variable expression)</code></span></p></li>
<li><p><span><code>(define (variable formals) body)</code></span></p>
<p><span>Formals</span> are either a sequence of zero or more variables, or a sequence of one or more variables followed by a space-delimited period and another variable (as in a lambda expression). This form is equivalent to</p>
<pre><code>(define \hyper{variable}
  (lambda (\hyper{formals}) \hyper{body}))\rm.%</code></pre></li>
<li><p><span><code>(define (variable . formal) body)</code></span></p>
<p><span>Formal</span> is a single variable. This form is equivalent to</p>
<pre><code>(define \hyper{variable}
  (lambda \hyper{formal} \hyper{body}))\rm.%</code></pre></li>
</ul>
<h3 id="top-level-definitions">Top level definitions</h3>
<p>At the outermost level of a program, a definition</p>
<pre><code>(define \hyper{variable} \hyper{expression})%</code></pre>
<p>has essentially the same effect as the assignment expression</p>
<pre><code>(\ide{set!}\ \hyper{variable} \hyper{expression})%</code></pre>
<p>if <span>variable</span> is bound to a non-syntax value. However, if <span>variable</span> is not bound, or is a syntactic keyword, then the definition will bind <span>variable</span> to a new location before performing the assignment, whereas it would be an error to perform a <span>set!</span> on an unbound variable.</p>
<pre><code>(define add3
  (lambda (x) (+ x 3)))
(add3 3)                            \ev  6
(define first car)
(first &#39;(1 2))                      \ev  1%</code></pre>
<h3 id="internal-definitions">Internal definitions</h3>
<p>Definitions can occur at the beginning of a <span>body</span> (that is, the body of a <span><code>lambda</code></span>, <span><code>let</code></span>, <span><code>let*</code></span>, <span><code>letrec</code></span>, <span><code>letrec*</code></span>, <span><code>let-values</code></span>, <span><code>let*-values</code></span>, <span><code>let-syntax</code></span>, <span><code>letrec-syntax</code></span>, <span><code>parameterize</code></span>, <span><code>guard</code></span>, or <span><code>case-lambda</code></span>). Note that such a body might not be apparent until after expansion of other syntax. Such definitions are known as <span><em>internal definitions</em></span> as opposed to the global definitions described above. The variables defined by internal definitions are local to the <span>body</span>. That is, <span>variable</span> is bound rather than assigned, and the region of the binding is the entire <span>body</span>. For example,</p>
<pre><code>(let ((x 5))
  (define foo (lambda (y) (bar x y)))
  (define bar (lambda (a b) (+ (* a b) a)))
  (foo (+ x 3)))                \ev  45%</code></pre>
<p>An expanded <span>body</span> containing internal definitions can always be converted into a completely equivalent <span>letrec*</span> expression. For example, the <span>let</span> expression in the above example is equivalent to</p>
<pre><code>(let ((x 5))
  (letrec* ((foo (lambda (y) (bar x y)))
            (bar (lambda (a b) (+ (* a b) a))))
    (foo (+ x 3))))%</code></pre>
<p>Just as for the equivalent <span>letrec*</span> expression, it is an error if it is not possible to evaluate each <span>expression</span> of every internal definition in a <span>body</span> without assigning or referring to the value of the corresponding <span>variable</span> or the <span>variable</span> of any of the definitions that follow it in <span>body</span>.</p>
<p>It is an error to define the same identifier more than once in the same <span>body</span>.</p>
<p>Wherever an internal definition can occur, <span><code>(begin definition_1 \ldots\,)</code></span> is equivalent to the sequence of definitions that form the body of the <span><code>begin</code></span>.</p>
<h3 id="multiple-value-definitions">Multiple-value definitions</h3>
<p>Another kind of definition is provided by <span>define-values</span>, which creates multiple definitions from a single expression returning multiple values. It is allowed wherever <span>define</span> is allowed.</p>
<p>(define-values<span> <em><span>formals</span> <span>expression</span></em></span>)  syntax<br />
</p>
<p>It is an error if a variable appears more than once in the set of <span>formals</span>.</p>
<p><span><em>Semantics:</em> </span> <span>Expression</span> is evaluated, and the <span>formals</span> are bound to the return values in the same way that the <span>formals</span> in a <span>lambda</span> expression are matched to the arguments in a procedure call.</p>
<pre><code>(define-values (x y) (exact-integer-sqrt 17))
(list x y) \ev (4 1)

(let ()
  (define-values (x y) (values 1 2))
  (+ x y))     \ev 3%</code></pre>
<h2 id="syntax-definitions">Syntax definitions</h2>
<p>Syntax definitions have this form:</p>
<p><span><code>(define-syntax keyword transformer spec)</code></span></p>
<p><span>Keyword</span> is an identifier, and the <span>transformer spec</span> is an instance of <span><code>syntax-rules</code></span>. Like variable definitions, syntax definitions can appear at the outermost level or nested within a <span><code>body</code></span>.</p>
<p>If the <span>define-syntax</span> occurs at the outermost level, then the global syntactic environment is extended by binding the <span>keyword</span> to the specified transformer, but previous expansions of any global binding for <span>keyword</span> remain unchanged. Otherwise, it is an <span><em>internal syntax definition</em></span>, and is local to the <span>body</span> in which it is defined. Any use of a syntax keyword before its corresponding definition is an error. In particular, a use that precedes an inner definition will not apply an outer definition.</p>
<pre><code>(let ((x 1) (y 2))
  (define-syntax swap!
    (syntax-rules ()
      ((swap! a b)
       (let ((tmp a))
         (set! a b)
         (set! b tmp)))))
  (swap! x y)
  (list x y))                \ev (2 1)%</code></pre>
<p>Macros can expand into definitions in any context that permits them. However, it is an error for a definition to define an identifier whose binding has to be known in order to determine the meaning of the definition itself, or of any preceding definition that belongs to the same group of internal definitions. Similarly, it is an error for an internal definition to define an identifier whose binding has to be known in order to determine the boundary between the internal definitions and the expressions of the body it belongs to. For example, the following are errors:</p>
<pre><code>(define define 3)

(begin (define begin list))

(let-syntax
    ((foo (syntax-rules ()
            ((foo (proc args ...) body ...)
             (define proc
               (lambda (args ...)
                 body ...))))))
  (let ((x 3))
    (foo (plus x y) (+ x y))
    (define foo x)
    (plus foo x)))%</code></pre>
<h2 id="record-type-definitions">Record-type definitions</h2>
<p><span><em>Record-type definitions</em></span> are used to introduce new data types, called <span><em>record types</em></span>. Like other definitions, they can appear either at the outermost level or in a body. The values of a record type are called <span><em>records</em></span> and are aggregations of zero or more <span><em>fields</em></span>, each of which holds a single location. A predicate, a constructor, and field accessors and mutators are defined for each record type.</p>
<p>(define-record-type <span>name</span>  syntax<br />
)</p>
<p><span><em>Syntax:</em> </span> <span>name</span> and <span>pred</span> are identifiers. The <span>constructor</span> is of the form</p>
<pre><code>(\hyper{constructor name} \hyper{field name} \dotsfoo)%</code></pre>
<p>and each <span>field</span> is either of the form</p>
<pre><code>(\hyper{field name} \hyper{accessor name})%</code></pre>
<p>or of the form</p>
<pre><code>(\hyper{field name} \hyper{accessor name} \hyper{modifier name})%</code></pre>
<p>It is an error for the same identifier to occur more than once as a field name. It is also an error for the same identifier to occur more than once as an accessor or mutator name.</p>
<p>The <span>define-record-type</span> construct is generative: each use creates a new record type that is distinct from all existing types, including Scheme’s predefined types and other record types — even record types of the same name or structure.</p>
<p>An instance of <span>define-record-type</span> is equivalent to the following definitions:</p>
<ul>
<li><p><span>name</span> is bound to a representation of the record type itself. This may be a run-time object or a purely syntactic representation. The representation is not utilized in this report, but it serves as a means to identify the record type for use by further language extensions.</p></li>
<li><p><span>constructor name</span> is bound to a procedure that takes as many arguments as there are <span>field name</span>s in the (<span>constructor name</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math>) subexpression and returns a new record of type <span>name</span>. Fields whose names are listed with <span>constructor name</span> have the corresponding argument as their initial value. The initial values of all other fields are unspecified. It is an error for a field name to appear in <span>constructor</span> but not as a <span>field name</span>.</p></li>
<li><p><span>pred</span> is bound to a predicate that returns #<span>t</span> when given a value returned by the procedure bound to <span>constructor name</span> and #<span>f</span> for everything else.</p></li>
<li><p>Each <span>accessor name</span> is bound to a procedure that takes a record of type <span>name</span> and returns the current value of the corresponding field. It is an error to pass an accessor a value which is not a record of the appropriate type.</p></li>
<li><p>Each <span>modifier name</span> is bound to a procedure that takes a record of type <span>name</span> and a value which becomes the new value of the corresponding field; an unspecified value is returned. It is an error to pass a modifier a first argument which is not a record of the appropriate type.</p></li>
</ul>
<p>For instance, the following record-type definition</p>
<pre><code>(define-record-type &lt;pare&gt;
  (kons x y)
  pare?
  (x kar set-kar!)
  (y kdr))</code></pre>
<p>defines <span>kons</span> to be a constructor, <span>kar</span> and <span>kdr</span> to be accessors, <span>set-kar!</span> to be a modifier, and <span>pare?</span> to be a predicate for instances of <span>&lt;pare&gt;</span>.</p>
<pre><code>  (pare? (kons 1 2))        \ev \schtrue
  (pare? (cons 1 2))        \ev \schfalse
  (kar (kons 1 2))          \ev 1
  (kdr (kons 1 2))          \ev 2
  (let ((k (kons 1 2)))
    (set-kar! k 3)
    (kar k))                \ev 3</code></pre>
<h2 id="libraries">Libraries</h2>
<p>Libraries provide a way to organize Scheme programs into reusable parts with explicitly defined interfaces to the rest of the program. This section defines the notation and semantics for libraries.</p>
<h3 id="library-syntax">Library Syntax</h3>
<p>A library definition takes the following form:</p>
<pre><code>(define-library \hyper{library name}
  \hyper{library declaration} \dotsfoo)</code></pre>
<p><span>library name</span> is a list whose members are identifiers and exact non-negative integers. It is used to identify the library uniquely when importing from other programs or libraries. Libraries whose first identifier is <span>scheme</span> are reserved for use by this report and future versions of this report. Libraries whose first identifier is <span>srfi</span> are reserved for libraries implementing Scheme Requests for Implementation. It is inadvisable, but not an error, for identifiers in library names to contain any of the characters <span>| <span><code>‘ </code></span> ? * &lt; " : &gt; + [ ] /</span> or control characters after escapes are expanded.</p>
<p>A <span>library declaration</span> is any of:</p>
<ul>
<li><p><span><code>(export export spec \ldots\,)</code></span></p></li>
<li><p><span><code>(import import set \ldots\,)</code></span></p></li>
<li><p><span><code>(begin command or definition \ldots\,)</code></span></p></li>
<li><p><span><code>(include filename_1 filename_2 \ldots\,)</code></span></p></li>
<li><p><span><code>(include-ci filename_1 filename_2 \ldots\,)</code></span></p></li>
<li><p><span><code>(include-library-declarations filename_1 filename_2 \ldots\,)</code></span></p></li>
<li><p><span><code>(cond-expand ce-clause_1 ce-clause_2 \ldots\,)</code></span></p></li>
</ul>
<p>An <span><code>export</code></span> declaration specifies a list of identifiers which can be made visible to other libraries or programs. An <span>export spec</span> takes one of the following forms:</p>
<ul>
<li><p><span>identifier</span></p></li>
<li><p><span><code>(rename identifier_1 identifier_2)</code></span></p></li>
</ul>
<p>In an <span>export spec</span>, an <span>identifier</span> names a single binding defined within or imported into the library, where the external name for the export is the same as the name of the binding within the library. A <span><code>rename</code></span> spec exports the binding defined within or imported into the library and named by <span>identifier<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></span> in each <span><code>(identifier_1 identifier_2)</code></span> pairing, using <span>identifier<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></span> as the external name.</p>
<p>An <span><code>import</code></span> declaration provides a way to import the identifiers exported by another library. It has the same syntax and semantics as an import declaration used in a program or at the REPL (see section <a href="#import" data-reference-type="ref" data-reference="import">[import]</a>).</p>
<p>The <span><code>begin</code></span>, <span><code>include</code></span>, and <span><code>include-ci</code></span> declarations are used to specify the body of the library. They have the same syntax and semantics as the corresponding expression types. This form of <span>begin</span> is analogous to, but not the same as, the two types of <span>begin</span> defined in section <a href="#sequencing" data-reference-type="ref" data-reference="sequencing">[sequencing]</a>.</p>
<p>The <span><code>include-library-declarations</code></span> declaration is similar to <span><code>include</code></span> except that the contents of the file are spliced directly into the current library definition. This can be used, for example, to share the same <span><code>export</code></span> declaration among multiple libraries as a simple form of library interface.</p>
<p>The <span><code>cond-expand</code></span> declaration has the same syntax and semantics as the <span><code>cond-expand</code></span> expression type, except that it expands to spliced-in library declarations rather than expressions enclosed in <span>begin</span>.</p>
<p>One possible implementation of libraries is as follows: After all <span><code>cond-expand</code></span> library declarations are expanded, a new environment is constructed for the library consisting of all imported bindings. The expressions from all <span><code>begin</code></span>, <span><code>include</code></span> and <span><code>include-ci</code></span> library declarations are expanded in that environment in the order in which they occur in the library. Alternatively, <span><code>cond-expand</code></span> and <span><code>import</code></span> declarations may be processed in left to right order interspersed with the processing of other declarations, with the environment growing as imported bindings are added to it by each <span><code>import</code></span> declaration.</p>
<p>When a library is loaded, its expressions are executed in textual order. If a library’s definitions are referenced in the expanded form of a program or library body, then that library must be loaded before the expanded program or library body is evaluated. This rule applies transitively. If a library is imported by more than one program or library, it may possibly be loaded additional times.</p>
<p>Similarly, during the expansion of a library <span>(foo)</span>, if any syntax keywords imported from another library <span>(bar)</span> are needed to expand the library, then the library <span>(bar)</span> must be expanded and its syntax definitions evaluated before the expansion of <span>(foo)</span>.</p>
<p>Regardless of the number of times that a library is loaded, each program or library that imports bindings from a library must do so from a single loading of that library, regardless of the number of import declarations in which it appears. That is, <span>(import (only (foo) a))</span> followed by <span>(import (only (foo) b))</span> has the same effect as <span>(import (only (foo) a b))</span>.</p>
<h3 id="library-example">Library example</h3>
<p>The following example shows how a program can be divided into libraries plus a relatively small main program <span class="citation" data-cites="life"></span>. If the main program is entered into a REPL, it is not necessary to import the base library.</p>
<pre><code>(define-library (example grid)
  (export make rows cols ref each
          (rename put! set!))
  (import (scheme base))
  (begin
    ;; Create an NxM grid.
    (define (make n m)
      (let ((grid (make-vector n)))
        (do ((i 0 (+ i 1)))
            ((= i n) grid)
          (let ((v (make-vector m \sharpfalse{})))
            (vector-set! grid i v)))))
    (define (rows grid)
      (vector-length grid))
    (define (cols grid)
      (vector-length (vector-ref grid 0)))
    ;; Return \sharpfalse{} if out of range.
    (define (ref grid n m)
      (and (&lt; -1 n (rows grid))
           (&lt; -1 m (cols grid))
           (vector-ref (vector-ref grid n) m)))
    (define (put! grid n m v)
      (vector-set! (vector-ref grid n) m v))
    (define (each grid proc)
      (do ((j 0 (+ j 1)))
          ((= j (rows grid)))
        (do ((k 0 (+ k 1)))
            ((= k (cols grid)))
          (proc j k (ref grid j k)))))))

(define-library (example life)
  (export life)
  (import (except (scheme base) set!)
          (scheme write)
          (example grid))
  (begin
    (define (life-count grid i j)
      (define (count i j)
        (if (ref grid i j) 1 0))
      (+ (count (- i 1) (- j 1))
         (count (- i 1) j)
         (count (- i 1) (+ j 1))
         (count i (- j 1))
         (count i (+ j 1))
         (count (+ i 1) (- j 1))
         (count (+ i 1) j)
         (count (+ i 1) (+ j 1))))
    (define (life-alive? grid i j)
      (case (life-count grid i j)
        ((3) \sharptrue{})
        ((2) (ref grid i j))
        (else \sharpfalse{})))
    (define (life-print grid)
      (display &quot;\backwhack{}x1B;[1H\backwhack{}x1B;[J&quot;)  ; clear vt100
      (each grid
       (lambda (i j v)
         (display (if v &quot;*&quot; &quot; &quot;))
         (when (= j (- (cols grid) 1))
           (newline)))))
    (define (life grid iterations)
      (do ((i 0 (+ i 1))
           (grid0 grid grid1)
           (grid1 (make (rows grid) (cols grid))
                  grid0))
          ((= i iterations))
        (each grid0
         (lambda (j k v)
           (let ((a (life-alive? grid0 j k)))
             (set! grid1 j k a))))
        (life-print grid1)))))

;; Main program.
(import (scheme base)
        (only (example life) life)
        (rename (prefix (example grid) grid-)
                (grid-make make-grid)))

;; Initialize a grid with a glider.
(define grid (make-grid 24 24))
(grid-set! grid 1 1 \sharptrue{})
(grid-set! grid 2 2 \sharptrue{})
(grid-set! grid 3 0 \sharptrue{})
(grid-set! grid 3 1 \sharptrue{})
(grid-set! grid 3 2 \sharptrue{})

;; Run for 80 iterations.
(life grid 80)
</code></pre>
<h2 id="the-repl">The REPL</h2>
<p>Implementations may provide an interactive session called a <span><em>REPL</em></span> (Read-Eval-Print Loop), where import declarations, expressions and definitions can be entered and evaluated one at a time. For convenience and ease of use, the global Scheme environment in a REPL must not be empty, but must start out with at least the bindings provided by the base library. This library includes the core syntax of Scheme and generally useful procedures that manipulate data. For example, the variable <span>abs</span> is bound to a procedure of one argument that computes the absolute value of a number, and the variable <span>+</span> is bound to a procedure that computes sums. The full list of <span>(scheme base)</span> bindings can be found in Appendix <a href="#stdlibraries" data-reference-type="ref" data-reference="stdlibraries">[stdlibraries]</a>.</p>
<p>Implementations may provide an initial REPL environment which behaves as if all possible variables are bound to locations, most of which contain unspecified values. Top level REPL definitions in such an implementation are truly equivalent to assignments, unless the identifier is defined as a syntax keyword.</p>
<p>An implementation may provide a mode of operation in which the REPL reads its input from a file. Such a file is not, in general, the same as a program, because it can contain import declarations in places other than the beginning.</p>
<h1 id="standard-procedures">Standard procedures</h1>
<p>This chapter describes Scheme’s built-in procedures.</p>
<p>The procedures <span>force</span>, <span>promise?</span>, and <span>make-promise</span> are intimately associated with the expression types <span>delay</span> and <span>delay-force</span>, and are described with them in section <a href="#force" data-reference-type="ref" data-reference="force">[force]</a>. In the same way, the procedure <span>make-parameter</span> is intimately associated with the expression type <span>parameterize</span>, and is described with it in section <a href="#make-parameter" data-reference-type="ref" data-reference="make-parameter">[make-parameter]</a>.</p>
<p>A program can use a global variable definition to bind any variable. It may subsequently alter any such binding by an assignment (see section <a href="#assignment" data-reference-type="ref" data-reference="assignment">[assignment]</a>). These operations do not modify the behavior of any procedure defined in this report or imported from a library (see section <a href="#libraries" data-reference-type="ref" data-reference="libraries">[libraries]</a>). Altering any global binding that has not been introduced by a definition has an unspecified effect on the behavior of the procedures defined in this chapter.</p>
<p>When a procedure is said to return a <span><em>newly allocated</em></span> object, it means that the locations in the object are fresh.</p>
<h2 id="equivalence-predicates">Equivalence predicates</h2>
<p>A <span><em>predicate</em></span> is a procedure that always returns a boolean value (#<span>t</span> or #<span>f</span>). An <span><em>equivalence predicate</em></span> is the computational analogue of a mathematical equivalence relation; it is symmetric, reflexive, and transitive. Of the equivalence predicates described in this section, <span>eq?</span> is the finest or most discriminating, <span>equal?</span> is the coarsest, and <span>eqv?</span> is slightly less discriminating than <span>eq?</span>.</p>
<p>(eqv?<span> <em><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em></em></span>)  procedure<br />
The <span>eqv?</span> procedure defines a useful equivalence relation on objects. Briefly, it returns #<span>t</span> if <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are normally regarded as the same object. This relation is left slightly open to interpretation, but the following partial specification of <span>eqv?</span> holds for all implementations of Scheme.</p>
<p>The <span>eqv?</span> procedure returns #<span>t</span> if:</p>
<ul>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are both #<span>t</span> or both #<span>f</span>.</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are both symbols and are the same symbol according to the <span>symbol=?</span> procedure (section <a href="#symbolsection" data-reference-type="ref" data-reference="symbolsection">[symbolsection]</a>).</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are both exact numbers and are numerically equal (in the sense of <span>=</span>).</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are both inexact numbers such that they are numerically equal (in the sense of <span>=</span>) and they yield the same results (in the sense of <span>eqv?</span>) when passed as arguments to any other procedure that can be defined as a finite composition of Scheme’s standard arithmetic procedures, provided it does not result in a NaN value.</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are both characters and are the same character according to the <span>char=?</span> procedure (section <a href="#charactersection" data-reference-type="ref" data-reference="charactersection">[charactersection]</a>).</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are both the empty list.</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are pairs, vectors, bytevectors, records, or strings that denote the same location in the store (section <a href="#storagemodel" data-reference-type="ref" data-reference="storagemodel">[storagemodel]</a>).</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are procedures whose location tags are equal (section <a href="#lambda" data-reference-type="ref" data-reference="lambda">[lambda]</a>).</p></li>
</ul>
<p>The <span>eqv?</span> procedure returns #<span>f</span> if:</p>
<ul>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are of different types (section <a href="#disjointness" data-reference-type="ref" data-reference="disjointness">[disjointness]</a>).</p></li>
<li><p>one of <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> is #<span>t</span> but the other is #<span>f</span>.</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are symbols but are not the same symbol according to the <span>symbol=?</span> procedure (section <a href="#symbolsection" data-reference-type="ref" data-reference="symbolsection">[symbolsection]</a>).</p></li>
<li><p>one of <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> is an exact number but the other is an inexact number.</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are both exact numbers and are numerically unequal (in the sense of <span>=</span>).</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are both inexact numbers such that either they are numerically unequal (in the sense of <span>=</span>), or they do not yield the same results (in the sense of <span>eqv?</span>) when passed as arguments to any other procedure that can be defined as a finite composition of Scheme’s standard arithmetic procedures, provided it does not result in a NaN value. As an exception, the behavior of <span>eqv?</span> is unspecified when both <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are NaN.</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are characters for which the <span>char=?</span> procedure returns #<span>f</span>.</p></li>
<li><p>one of <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> is the empty list but the other is not.</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are pairs, vectors, bytevectors, records, or strings that denote distinct locations.</p></li>
<li><p><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> are procedures that would behave differently (return different values or have different side effects) for some arguments.</p></li>
</ul>
<pre><code>(eqv? &#39;a &#39;a)                     \ev  \schtrue
(eqv? &#39;a &#39;b)                     \ev  \schfalse
(eqv? 2 2)                       \ev  \schtrue
(eqv? 2 2.0)                     \ev  \schfalse
(eqv? &#39;() &#39;())                   \ev  \schtrue
(eqv? 100000000 100000000)       \ev  \schtrue
(eqv? 0.0 +nan.0)                \ev  \schfalse
(eqv? (cons 1 2) (cons 1 2))     \ev  \schfalse
(eqv? (lambda () 1)
      (lambda () 2))             \ev  \schfalse
(let ((p (lambda (x) x)))
  (eqv? p p))                    \ev  \schtrue
(eqv? \#f &#39;nil)                  \ev  \schfalse%</code></pre>
<p>The following examples illustrate cases in which the above rules do not fully specify the behavior of <span>eqv?</span>. All that can be said about such cases is that the value returned by <span>eqv?</span> must be a boolean.</p>
<pre><code>(eqv? &quot;&quot; &quot;&quot;)             \ev  \unspecified
(eqv? &#39;\#() &#39;\#())         \ev  \unspecified
(eqv? (lambda (x) x)
      (lambda (x) x))    \ev  \unspecified
(eqv? (lambda (x) x)
      (lambda (y) y))    \ev  \unspecified
(eqv? 1.0e0 1.0f0)       \ev  \unspecified
(eqv? +nan.0 +nan.0)     \ev  \unspecified%</code></pre>
<p>Note that <span>(eqv? 0.0 -0.0)</span> will return #<span>f</span> if negative zero is distinguished, and #<span>t</span> if negative zero is not distinguished.</p>
<p>The next set of examples shows the use of <span>eqv?</span> with procedures that have local state. The <span>gen-counter</span> procedure must return a distinct procedure every time, since each procedure has its own internal counter. The <span>gen-loser</span> procedure, however, returns operationally equivalent procedures each time, since the local state does not affect the value or side effects of the procedures. However, <span>eqv?</span> may or may not detect this equivalence.</p>
<pre><code>(define gen-counter
  (lambda ()
    (let ((n 0))
      (lambda () (set! n (+ n 1)) n))))
(let ((g (gen-counter)))
  (eqv? g g))           \ev  \schtrue
(eqv? (gen-counter) (gen-counter))
                        \ev  \schfalse
(define gen-loser
  (lambda ()
    (let ((n 0))
      (lambda () (set! n (+ n 1)) 27))))
(let ((g (gen-loser)))
  (eqv? g g))           \ev  \schtrue
(eqv? (gen-loser) (gen-loser))
                        \ev  \unspecified

(letrec ((f (lambda () (if (eqv? f g) &#39;both &#39;f)))
         (g (lambda () (if (eqv? f g) &#39;both &#39;g))))
  (eqv? f g))
                        \ev  \unspecified

(letrec ((f (lambda () (if (eqv? f g) &#39;f &#39;both)))
         (g (lambda () (if (eqv? f g) &#39;g &#39;both))))
  (eqv? f g))
                        \ev  \schfalse%</code></pre>
<p>Since it is an error to modify constant objects (those returned by literal expressions), implementations may share structure between constants where appropriate. Thus the value of <span>eqv?</span> on constants is sometimes implementation-dependent.</p>
<pre><code>(eqv? &#39;(a) &#39;(a))                 \ev  \unspecified
(eqv? &quot;a&quot; &quot;a&quot;)                   \ev  \unspecified
(eqv? &#39;(b) (cdr &#39;(a b)))	 \ev  \unspecified
(let ((x &#39;(a)))
  (eqv? x x))                    \ev  \schtrue%</code></pre>
<p>The above definition of <span>eqv?</span> allows implementations latitude in their treatment of procedures and literals: implementations may either detect or fail to detect that two procedures or two literals are equivalent to each other, and can decide whether or not to merge representations of equivalent objects by using the same pointer or bit pattern to represent both.</p>
<p><span><em>Note:</em></span> If inexact numbers are represented as IEEE binary floating-point numbers, then an implementation of <span>eqv?</span> that simply compares equal-sized inexact numbers for bitwise equality is correct by the above definition.</p>
<p>(eq?<span> <em><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em></em></span>)  procedure<br />
The <span>eq?</span> procedure is similar to <span>eqv?</span> except that in some cases it is capable of discerning distinctions finer than those detectable by <span>eqv?</span>. It must always return #<span>f</span> when <span>eqv?</span> also would, but may return #<span>f</span> in some cases where <span>eqv?</span> would return #<span>t</span>.</p>
<p>On symbols, booleans, the empty list, pairs, and records, and also on non-empty strings, vectors, and bytevectors, <span>eq?</span> and <span>eqv?</span> are guaranteed to have the same behavior. On procedures, <span>eq?</span> must return true if the arguments’ location tags are equal. On numbers and characters, <span>eq?</span>’s behavior is implementation-dependent, but it will always return either true or false. On empty strings, empty vectors, and empty bytevectors, <span>eq?</span> may also behave differently from <span>eqv?</span>.</p>
<pre><code>(eq? &#39;a &#39;a)                     \ev  \schtrue
(eq? &#39;(a) &#39;(a))                 \ev  \unspecified
(eq? (list &#39;a) (list &#39;a))       \ev  \schfalse
(eq? &quot;a&quot; &quot;a&quot;)                   \ev  \unspecified
(eq? &quot;&quot; &quot;&quot;)                     \ev  \unspecified
(eq? &#39;() &#39;())                   \ev  \schtrue
(eq? 2 2)                       \ev  \unspecified
(eq? \#\backwhack{}A \#\backwhack{}A) \ev  \unspecified
(eq? car car)                   \ev  \schtrue
(let ((n (+ 2 3)))
  (eq? n n))      \ev  \unspecified
(let ((x &#39;(a)))
  (eq? x x))      \ev  \schtrue
(let ((x &#39;\#()))
  (eq? x x))      \ev  \schtrue
(let ((p (lambda (x) x)))
  (eq? p p))      \ev  \schtrue%</code></pre>
<p><span><em>Rationale:</em></span> It will usually be possible to implement <span>eq?</span> much more efficiently than <span>eqv?</span>, for example, as a simple pointer comparison instead of as some more complicated operation. One reason is that it is not always possible to compute <span>eqv?</span> of two numbers in constant time, whereas <span>eq?</span> implemented as pointer comparison will always finish in constant time.</p>
<p>(equal?<span> <em><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em></em></span>)  procedure<br />
The <span>equal?</span> procedure, when applied to pairs, vectors, strings and bytevectors, recursively compares them, returning #<span>t</span> when the unfoldings of its arguments into (possibly infinite) trees are equal (in the sense of <span>equal?</span>) as ordered trees, and #<span>f</span> otherwise. It returns the same as <span>eqv?</span> when applied to booleans, symbols, numbers, characters, ports, procedures, and the empty list. If two objects are <span>eqv?</span>, they must be <span>equal?</span> as well. In all other cases, <span>equal?</span> may return either #<span>t</span> or #<span>f</span>.</p>
<p>Even if its arguments are circular data structures, <span>equal?</span> must always terminate.</p>
<pre><code>(equal? &#39;a &#39;a)                  \ev  \schtrue
(equal? &#39;(a) &#39;(a))              \ev  \schtrue
(equal? &#39;(a (b) c)
        &#39;(a (b) c))             \ev  \schtrue
(equal? &quot;abc&quot; &quot;abc&quot;)            \ev  \schtrue
(equal? 2 2)                    \ev  \schtrue
(equal? (make-vector 5 &#39;a)
        (make-vector 5 &#39;a))     \ev  \schtrue
(equal? &#39;\#1=(a b . \#1\#)
        &#39;\#2=(a b a b . \#2\#))    \ev  \schtrue
(equal? (lambda (x) x)
        (lambda (y) y))  \ev  \unspecified%</code></pre>
<p><span><em>Note:</em></span> A rule of thumb is that objects are generally <span>equal?</span> if they print the same.</p>
<h2 id="numbers">Numbers</h2>
<p>It is important to distinguish between mathematical numbers, the Scheme numbers that attempt to model them, the machine representations used to implement the Scheme numbers, and notations used to write numbers. This report uses the types <span><em>number</em></span>, <span><em>complex</em></span>, <span><em>real</em></span>, <span><em>rational</em></span>, and <span><em>integer</em></span> to refer to both mathematical numbers and Scheme numbers.</p>
<h3 id="numerical-types">Numerical types</h3>
<p>Mathematically, numbers are arranged into a tower of subtypes in which each level is a subset of the level above it:</p>
<div class="tabbing">
<p>         n̄umber<br />
<span>complex number</span><br />
<span>real number</span><br />
<span>rational number</span><br />
<span>integer</span></p>
</div>
<p>For example, 3 is an integer. Therefore 3 is also a rational, a real, and a complex number. The same is true of the Scheme numbers that model 3. For Scheme numbers, these types are defined by the predicates <span><code>number?</code></span>, <span><code>complex?</code></span>, <span><code>real?</code></span>, <span><code>rational?</code></span>, and <span><code>integer?</code></span>.</p>
<p>There is no simple relationship between a number’s type and its representation inside a computer. Although most implementations of Scheme will offer at least two different representations of 3, these different representations denote the same integer.</p>
<p>Scheme’s numerical operations treat numbers as abstract data, as independent of their representation as possible. Although an implementation of Scheme may use multiple internal representations of numbers, this ought not to be apparent to a casual programmer writing simple programs.</p>
<h3 id="exactness">Exactness</h3>
<p>It is useful to distinguish between numbers that are represented exactly and those that might not be. For example, indexes into data structures must be known exactly, as must some polynomial coefficients in a symbolic algebra system. On the other hand, the results of measurements are inherently inexact, and irrational numbers may be approximated by rational and therefore inexact approximations. In order to catch uses of inexact numbers where exact numbers are required, Scheme explicitly distinguishes exact from inexact numbers. This distinction is orthogonal to the dimension of type.</p>
<p>A Scheme number is <span><em>exact</em></span> if it was written as an exact constant or was derived from <span>exact</span> numbers using only <span>exact</span> operations. A number is <span><em>inexact</em></span> if it was written as an inexact constant, if it was derived using <span>inexact</span> ingredients, or if it was derived using <span>inexact</span> operations. Thus <span>inexact</span>ness is a contagious property of a number. In particular, an <span><em>exact complex number</em></span> has an exact real part and an exact imaginary part; all other complex numbers are <span><em>inexact complex numbers</em></span>.</p>
<p>If two implementations produce <span>exact</span> results for a computation that did not involve <span>inexact</span> intermediate results, the two ultimate results will be mathematically equal. This is generally not true of computations involving <span>inexact</span> numbers since approximate methods such as floating-point arithmetic may be used, but it is the duty of each implementation to make the result as close as practical to the mathematically ideal result.</p>
<p>Rational operations such as <span>+</span> should always produce <span>exact</span> results when given <span>exact</span> arguments. If the operation is unable to produce an <span>exact</span> result, then it may either report the violation of an implementation restriction or it may silently coerce its result to an <span>inexact</span> value. However, <span>(/ 3 4)</span> must not return the mathematically incorrect value <span>0</span>. See section <a href="#restrictions" data-reference-type="ref" data-reference="restrictions">[restrictions]</a>.</p>
<p>Except for <span><code>exact</code></span>, the operations described in this section must generally return inexact results when given any inexact arguments. An operation may, however, return an <span>exact</span> result if it can prove that the value of the result is unaffected by the inexactness of its arguments. For example, multiplication of any number by an <span>exact</span> zero may produce an <span>exact</span> zero result, even if the other argument is <span>inexact</span>.</p>
<p>Specifically, the expression <span>(* 0 +inf.0)</span> may return <span>0</span>, or <span>+nan.0</span>, or report that inexact numbers are not supported, or report that non-rational real numbers are not supported, or fail silently or noisily in other implementation-specific ways.</p>
<h3 id="implementation-restrictions">Implementation restrictions</h3>
<p>Implementations of Scheme are not required to implement the whole tower of subtypes given in section <a href="#numericaltypes" data-reference-type="ref" data-reference="numericaltypes">[numericaltypes]</a>, but they must implement a coherent subset consistent with both the purposes of the implementation and the spirit of the Scheme language. For example, implementations in which all numbers are <span>real</span>, or in which non-<span>real</span> numbers are always <span>inexact</span>, or in which <span>exact</span> numbers are always <span>integer</span>, are still quite useful.</p>
<p>Implementations may also support only a limited range of numbers of any type, subject to the requirements of this section. The supported range for <span>exact</span> numbers of any type may be different from the supported range for <span>inexact</span> numbers of that type. For example, an implementation that uses IEEE binary double-precision floating-point numbers to represent all its <span>inexact</span> <span>real</span> numbers may also support a practically unbounded range of <span>exact</span> <span>integer</span>s and <span>rational</span>s while limiting the range of <span>inexact</span> <span>real</span>s (and therefore the range of <span>inexact</span> <span>integer</span>s and <span>rational</span>s) to the dynamic range of the IEEE binary double format. Furthermore, the gaps between the representable <span>inexact</span> <span>integer</span>s and <span>rational</span>s are likely to be very large in such an implementation as the limits of this range are approached.</p>
<p>An implementation of Scheme must support exact integers throughout the range of numbers permitted as indexes of lists, vectors, bytevectors, and strings or that result from computing the length of one of these. The <span><code>length</code></span>, <span><code>vector-length</code></span>, <span><code>bytevector-length</code></span>, and <span><code>string-length</code></span> procedures must return an exact integer, and it is an error to use anything but an exact integer as an index. Furthermore, any integer constant within the index range, if expressed by an exact integer syntax, must be read as an exact integer, regardless of any implementation restrictions that apply outside this range. Finally, the procedures listed below will always return exact integer results provided all their arguments are exact integers and the mathematically expected results are representable as exact integers within the implementation:</p>
<pre><code>-                     *
+                     abs
ceiling               denominator
exact-integer-sqrt    expt
floor                 floor/
floor-quotient        floor-remainder
gcd                   lcm
max                   min
modulo                numerator
quotient              rationalize
remainder             round
square                truncate
truncate/             truncate-quotient
truncate-remainder</code></pre>
<p>It is recommended, but not required, that implementations support <span>exact</span> <span>integer</span>s and <span>exact</span> <span>rational</span>s of practically unlimited size and precision, and to implement the above procedures and the <span>/</span> procedure in such a way that they always return <span>exact</span> results when given <span>exact</span> arguments. If one of these procedures is unable to deliver an <span>exact</span> result when given <span>exact</span> arguments, then it may either report a violation of an implementation restriction or it may silently coerce its result to an <span>inexact</span> number; such a coercion can cause an error later. Nevertheless, implementations that do not provide <span>exact</span> rational numbers should return <span>inexact</span> rational numbers rather than reporting an implementation restriction.</p>
<p>An implementation may use floating-point and other approximate representation strategies for <span>inexact</span> numbers. This report recommends, but does not require, that implementations that use floating-point representations follow the IEEE 754 standard, and that implementations using other representations should match or exceed the precision achievable using these floating-point standards <span class="citation" data-cites="IEEE"></span>. In particular, the description of transcendental functions in IEEE 754-2008 should be followed by such implementations, particularly with respect to infinities and NaNs.</p>
<p>Although Scheme allows a variety of written notations for numbers, any particular implementation may support only some of them. For example, an implementation in which all numbers are <span>real</span> need not support the rectangular and polar notations for complex numbers. If an implementation encounters an <span>exact</span> numerical constant that it cannot represent as an <span>exact</span> number, then it may either report a violation of an implementation restriction or it may silently represent the constant by an <span>inexact</span> number.</p>
<h3 id="implementation-extensions">Implementation extensions</h3>
<p>Implementations may provide more than one representation of floating-point numbers with differing precisions. In an implementation which does so, an inexact result must be represented with at least as much precision as is used to express any of the inexact arguments to that operation. Although it is desirable for potentially inexact operations such as <span>sqrt</span> to produce <span>exact</span> answers when applied to <span>exact</span> arguments, if an <span>exact</span> number is operated upon so as to produce an <span>inexact</span> result, then the most precise representation available must be used. For example, the value of <span> (sqrt 4)</span> should be <span>2</span>, but in an implementation that provides both single and double precision floating point numbers it may be the latter but must not be the former.</p>
<p>It is the programmer’s responsibility to avoid using inexact number objects with magnitude or significand too large to be represented in the implementation.</p>
<p>In addition, implementations may distinguish special numbers called <span>positive infinity</span>, <span>negative infinity</span>, <span>NaN</span>, and <span>negative zero</span>.</p>
<p>Positive infinity is regarded as an inexact real (but not rational) number that represents an indeterminate value greater than the numbers represented by all rational numbers. Negative infinity is regarded as an inexact real (but not rational) number that represents an indeterminate value less than the numbers represented by all rational numbers.</p>
<p>Adding or multiplying an infinite value by any finite real value results in an appropriately signed infinity; however, the sum of positive and negative infinities is a NaN. Positive infinity is the reciprocal of zero, and negative infinity is the reciprocal of negative zero. The behavior of the transcendental functions is sensitive to infinity in accordance with IEEE 754.</p>
<p>A NaN is regarded as an inexact real (but not rational) number so indeterminate that it might represent any real value, including positive or negative infinity, and might even be greater than positive infinity or less than negative infinity. An implementation that does not support non-real numbers may use NaN to represent non-real values like <span>(sqrt -1.0)</span> and <span>(asin 2.0)</span>.</p>
<p>A NaN always compares false to any number, including a NaN. An arithmetic operation where one operand is NaN returns NaN, unless the implementation can prove that the result would be the same if the NaN were replaced by any rational number. Dividing zero by zero results in NaN unless both zeros are exact.</p>
<p>Negative zero is an inexact real value written <span>-0.0</span> and is distinct (in the sense of <span>eqv?</span>) from <span>0.0</span>. A Scheme implementation is not required to distinguish negative zero. If it does, however, the behavior of the transcendental functions is sensitive to the distinction in accordance with IEEE 754. Specifically, in a Scheme implementing both complex numbers and negative zero, the branch cut of the complex logarithm function is such that <span>(imag-part (log -1.0-0.0i))</span> is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>π</mi></mrow><annotation encoding="application/x-tex">-\pi</annotation></semantics></math> rather than <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>.</p>
<p>Furthermore, the negation of negative zero is ordinary zero and vice versa. This implies that the sum of two or more negative zeros is negative, and the result of subtracting (positive) zero from a negative zero is likewise negative. However, numerical comparisons treat negative zero as equal to zero.</p>
<p>Note that both the real and the imaginary parts of a complex number can be infinities, NaNs, or negative zero.</p>
<h3 id="syntax-of-numerical-constants">Syntax of numerical constants</h3>
<p>The syntax of the written representations for numbers is described formally in section <a href="#numbersyntax" data-reference-type="ref" data-reference="numbersyntax">[numbersyntax]</a>. Note that case is not significant in numerical constants.</p>
<p>A number can be written in binary, octal, decimal, or hexadecimal by the use of a radix prefix. The radix prefixes are <span> #b</span> (binary), <span>#o</span> (octal), <span> #d</span> (decimal), and <span>#x</span> (hexadecimal). With no radix prefix, a number is assumed to be expressed in decimal.</p>
<p>A numerical constant can be specified to be either <span>exact</span> or <span>inexact</span> by a prefix. The prefixes are <span>#e</span> for <span>exact</span>, and <span>#i</span> for <span>inexact</span>. An exactness prefix can appear before or after any radix prefix that is used. If the written representation of a number has no exactness prefix, the constant is <span>inexact</span> if it contains a decimal point or an exponent. Otherwise, it is <span>exact</span>.</p>
<p>In systems with <span>inexact</span> numbers of varying precisions it can be useful to specify the precision of a constant. For this purpose, implementations may accept numerical constants written with an exponent marker that indicates the desired precision of the <span>inexact</span> representation. If so, the letter <span>s</span>, <span>f</span>, <span>d</span>, or <span>l</span>, meaning <em>short</em>, <em>single</em>, <em>double</em>, or <em>long</em> precision, respectively, can be used in place of <span>e</span>. The default precision has at least as much precision as <em>double</em>, but implementations may allow this default to be set by the user.</p>
<pre><code>3.14159265358979F0
       {\rm Round to single ---} 3.141593
0.6L0
       {\rm Extend to long ---} .600000000000000%</code></pre>
<p>The numbers positive infinity, negative infinity, and NaN are written <span>+inf.0</span>, <span>-inf.0</span> and <span>+nan.0</span> respectively. NaN may also be written <span>-nan.0</span>. The use of signs in the written representation does not necessarily reflect the underlying sign of the NaN value, if any. Implementations are not required to support these numbers, but if they do, they must do so in general conformance with IEEE 754. However, implementations are not required to support signaling NaNs, nor to provide a way to distinguish between different NaNs.</p>
<p>There are two notations provided for non-real complex numbers: the <span><em>rectangular notation</em></span> <em>a</em><span>+</span><em>b</em><span>i</span>, where <em>a</em> is the real part and <em>b</em> is the imaginary part; and the <span><em>polar notation</em></span> <em>r</em><span>@</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>, where <em>r</em> is the magnitude and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math> is the phase (angle) in radians. These are related by the equation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mstyle mathvariant="normal"><mi>i</mi></mstyle><mo>=</mo><mi>r</mi><mo>cos</mo><mi>θ</mi><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo>sin</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mstyle mathvariant="normal"><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">a+b\mathrm{i} = r \cos\theta + (r \sin\theta) \mathrm{i}</annotation></semantics></math>. All of <em>a</em>, <em>b</em>, <em>r</em>, and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math> are real numbers.</p>
<h3 id="numerical-operations">Numerical operations</h3>
<p>The reader is referred to section <a href="#typeconventions" data-reference-type="ref" data-reference="typeconventions">[typeconventions]</a> for a summary of the naming conventions used to specify restrictions on the types of arguments to numerical routines. The examples used in this section assume that any numerical constant written using an <span>exact</span> notation is indeed represented as an <span>exact</span> number. Some examples also assume that certain numerical constants written using an <span>inexact</span> notation can be represented without loss of accuracy; the <span>inexact</span> constants were chosen so that this is likely to be true in implementations that use IEEE binary doubles to represent inexact numbers.</p>
<p>(number?<span> <em>obj</em></span>)  procedure<br />
(complex?<span> <em>obj</em></span>)  procedure<br />
(real?<span> <em>obj</em></span>)  procedure<br />
(rational?<span> <em>obj</em></span>)  procedure<br />
(integer?<span> <em>obj</em></span>)  procedure<br />
These numerical type predicates can be applied to any kind of argument, including non-numbers. They return #<span>t</span> if the object is of the named type, and otherwise they return #<span>f</span>. In general, if a type predicate is true of a number then all higher type predicates are also true of that number. Consequently, if a type predicate is false of a number, then all lower type predicates are also false of that number.</p>
<p>If <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span> is a complex number, then <span>(real? <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span>)</span> is true if and only if <span>(zero? (imag-part <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span>))</span> is true. If <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span> is an inexact real number, then <span> (integer? <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span>)</span> is true if and only if <span>(= <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span> (round <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span>))</span>.</p>
<p>The numbers <span>+inf.0</span>, <span>-inf.0</span>, and <span>+nan.0</span> are real but not rational.</p>
<pre><code>(complex? 3+4i)         \ev  \schtrue
(complex? 3)            \ev  \schtrue
(real? 3)               \ev  \schtrue
(real? -2.5+0i)         \ev  \schtrue
(real? -2.5+0.0i)       \ev  \schfalse
(real? \#e1e10)          \ev  \schtrue
(real? +inf.0)           \ev  \schtrue
(real? +nan.0)           \ev  \schtrue
(rational? -inf.0)       \ev  \schfalse
(rational? 3.5)          \ev  \schtrue
(rational? 6/10)        \ev  \schtrue
(rational? 6/3)         \ev  \schtrue
(integer? 3+0i)         \ev  \schtrue
(integer? 3.0)          \ev  \schtrue
(integer? 8/4)          \ev  \schtrue%</code></pre>
<p><span><em>Note:</em></span> The behavior of these type predicates on <span>inexact</span> numbers is unreliable, since any inaccuracy might affect the result.</p>
<p><span><em>Note:</em></span> In many implementations the <span><code>complex?</code></span> procedure will be the same as <span><code>number?</code></span>, but unusual implementations may represent some irrational numbers exactly or may extend the number system to support some kind of non-complex numbers.</p>
<p>(exact?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  procedure<br />
(inexact?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  procedure<br />
These numerical predicates provide tests for the exactness of a quantity. For any Scheme number, precisely one of these predicates is true.</p>
<pre><code>(exact? 3.0)           \ev  \schfalse
(exact? \#e3.0)         \ev  \schtrue
(inexact? 3.)          \ev  \schtrue%</code></pre>
<p>(exact-integer?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  procedure<br />
Returns #<span>t</span> if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span> is both <span>exact</span> and an <span>integer</span>; otherwise returns #<span>f</span>.</p>
<pre><code>(exact-integer? 32) \ev \schtrue{}
(exact-integer? 32.0) \ev \schfalse{}
(exact-integer? 32/5) \ev \schfalse{}%</code></pre>
<p>(finite?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
The <span>finite?</span> procedure returns #<span>t</span> on all real numbers except <span>+inf.0</span>, <span>-inf.0</span>, and <span>+nan.0</span>, and on complex numbers if their real and imaginary parts are both finite. Otherwise it returns #<span>f</span>.</p>
<pre><code>(finite? 3)         \ev  \schtrue
(finite? +inf.0)       \ev  \schfalse
(finite? 3.0+inf.0i)   \ev  \schfalse%</code></pre>
<p>(infinite?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
The <span>infinite?</span> procedure returns #<span>t</span> on the real numbers <span>+inf.0</span> and <span>-inf.0</span>, and on complex numbers if their real or imaginary parts or both are infinite. Otherwise it returns #<span>f</span>.</p>
<pre><code>(infinite? 3)         \ev  \schfalse
(infinite? +inf.0)       \ev  \schtrue
(infinite? +nan.0)       \ev  \schfalse
(infinite? 3.0+inf.0i)   \ev  \schtrue%</code></pre>
<p>(nan?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
The <span>nan?</span> procedure returns #<span>t</span> on <span>+nan.0</span>, and on complex numbers if their real or imaginary parts or both are <span>+nan.0</span>. Otherwise it returns #<span>f</span>.</p>
<pre><code>(nan? +nan.0)          \ev  \schtrue
(nan? 32)              \ev  \schfalse
(nan? +nan.0+5.0i)     \ev  \schtrue
(nan? 1+2i)            \ev  \schfalse%</code></pre>
<p>(=<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>2</mn></msub><annotation encoding="application/x-tex">z_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>3</mn></msub><annotation encoding="application/x-tex">z_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(&lt;<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>2</mn></msub><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>3</mn></msub><annotation encoding="application/x-tex">x_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(&gt;<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>2</mn></msub><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>3</mn></msub><annotation encoding="application/x-tex">x_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(&lt;=<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>2</mn></msub><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>3</mn></msub><annotation encoding="application/x-tex">x_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(&gt;=<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>2</mn></msub><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>3</mn></msub><annotation encoding="application/x-tex">x_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
These procedures return #<span>t</span> if their arguments are (respectively): equal, monotonically increasing, monotonically decreasing, monotonically non-decreasing, or monotonically non-increasing, and #<span>f</span> otherwise. If any of the arguments are <span>+nan.0</span>, all the predicates return #<span>f</span>. They do not distinguish between inexact zero and inexact negative zero.</p>
<p>These predicates are required to be transitive.</p>
<p><span><em>Note:</em></span> The implementation approach of converting all arguments to inexact numbers if any argument is inexact is not transitive. For example, let <span>big</span> be <span>(expt 2 1000)</span>, and assume that <span>big</span> is exact and that inexact numbers are represented by 64-bit IEEE binary floating point numbers. Then <span>(= (- big 1) (inexact big))</span> and <span>(= (inexact big) (+ big 1))</span> would both be true with this approach, because of the limitations of IEEE representations of large integers, whereas <span>(= (- big 1) (+ big 1))</span> is false. Converting inexact values to exact numbers that are the same (in the sense of <span>=</span>) to them will avoid this problem, though special care must be taken with infinities.</p>
<p><span><em>Note:</em></span> While it is not an error to compare <span>inexact</span> numbers using these predicates, the results are unreliable because a small inaccuracy can affect the result; this is especially true of <span><code>=</code></span> and <span><code>zero?</code></span>. When in doubt, consult a numerical analyst.</p>
<p>(zero?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  procedure<br />
(positive?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span></em></span>)  procedure<br />
(negative?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span></em></span>)  procedure<br />
(odd?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math></span></em></span>)  procedure<br />
(even?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math></span></em></span>)  procedure<br />
These numerical predicates test a number for a particular property, returning #<span>t</span> or #<span>f</span>. See note above.</p>
<p>(max<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>2</mn></msub><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(min<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>2</mn></msub><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
These procedures return the maximum or minimum of their arguments.</p>
<pre><code>(max 3 4)              \ev  4    ; exact
(max 3.9 4)            \ev  4.0  ; inexact%</code></pre>
<p><span><em>Note:</em></span> If any argument is inexact, then the result will also be inexact (unless the procedure can prove that the inaccuracy is not large enough to affect the result, which is possible only in unusual implementations). If <span>min</span> or <span>max</span> is used to compare numbers of mixed exactness, and the numerical value of the result cannot be represented as an inexact number without loss of accuracy, then the procedure may report a violation of an implementation restriction.</p>
<p>(+<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(*<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
These procedures return the sum or product of their arguments.</p>
<pre><code>(+ 3 4)                 \ev  7
(+ 3)                   \ev  3
(+)                     \ev  0
(* 4)                   \ev  4
(*)                     \ev  1%</code></pre>
<p>(-<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  procedure<br />
(-<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>2</mn></msub><annotation encoding="application/x-tex">z_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(/<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  procedure<br />
(/<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>2</mn></msub><annotation encoding="application/x-tex">z_2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
With two or more arguments, these procedures return the difference or quotient of their arguments, associating to the left. With one argument, however, they return the additive or multiplicative inverse of their argument.</p>
<p>It is an error if any argument of <span>/</span> other than the first is an exact zero. If the first argument is an exact zero, an implementation may return an exact zero unless one of the other arguments is a NaN.</p>
<pre><code>(- 3 4)                 \ev  -1
(- 3 4 5)               \ev  -6
(- 3)                   \ev  -3
(/ 3 4 5)               \ev  3/20
(/ 3)                   \ev  1/3%</code></pre>
<p>(abs<span> <em>x</em></span>)  procedure<br />
The <span>abs</span> procedure returns the absolute value of its argument.</p>
<pre><code>(abs -7)                \ev  7%</code></pre>
<p>(floor/<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span></em></span>)  procedure<br />
(floor-quotient<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span></em></span>)  procedure<br />
(floor-remainder<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span></em></span>)  procedure<br />
(truncate/<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span></em></span>)  procedure<br />
(truncate-quotient<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span></em></span>)  procedure<br />
(truncate-remainder<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span></em></span>)  procedure<br />
These procedures implement number-theoretic (integer) division. It is an error if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span> is zero. The procedures ending in <span>/</span> return two integers; the other procedures return an integer. All the procedures compute a quotient <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>q</mi></msub><annotation encoding="application/x-tex">n_q</annotation></semantics></math></span> and remainder <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>r</mi></msub><annotation encoding="application/x-tex">n_r</annotation></semantics></math></span> such that <span class="math inline">${\hbox{$n_1$\/}} = {\hbox{$n_2$\/}} {\hbox{$n_q$\/}} + {\hbox{$n_r$\/}}$</span>. For each of the division operators, there are three procedures defined as follows:</p>
<pre><code>(\hyper{operator}/ \vri{n} \vrii{n})             \ev \vr{n_q} \vr{n_r}
(\hyper{operator}-quotient \vri{n} \vrii{n})     \ev \vr{n_q}
(\hyper{operator}-remainder \vri{n} \vrii{n})    \ev \vr{n_r}%</code></pre>
<p>The remainder <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>r</mi></msub><annotation encoding="application/x-tex">n_r</annotation></semantics></math></span> is determined by the choice of integer <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>q</mi></msub><annotation encoding="application/x-tex">n_q</annotation></semantics></math></span>: <span class="math inline">${\hbox{$n_r$\/}} = {\hbox{$n_1$\/}} - {\hbox{$n_2$\/}} {\hbox{$n_q$\/}}$</span>. Each set of operators uses a different choice of <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>q</mi></msub><annotation encoding="application/x-tex">n_q</annotation></semantics></math></span>:</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">floor</td>
<td style="text-align: left;"><span class="math inline">${\hbox{$n_q$\/}} = \lfloor{\hbox{$n_1$\/}} / {\hbox{$n_2$\/}}\rfloor$</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">truncate</td>
<td style="text-align: left;"><span class="math inline">${\hbox{$n_q$\/}} = \text{truncate}({\hbox{$n_1$\/}} / {\hbox{$n_2$\/}})$</span></td>
</tr>
</tbody>
</table>
<p>For any of the operators, and for integers <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> and <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span> with <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span> not equal to 0,</p>
<pre><code>     (= \vri{n} (+ (* \vrii{n} (\hyper{operator}-quotient \vri{n} \vrii{n}))
           (\hyper{operator}-remainder \vri{n} \vrii{n})))
                                 \ev  \schtrue%</code></pre>
<p>provided all numbers involved in that computation are exact.</p>
<p>Examples:</p>
<pre><code>(floor/ 5 2)         \ev 2 1
(floor/ -5 2)        \ev -3 1
(floor/ 5 -2)        \ev -3 -1
(floor/ -5 -2)       \ev 2 -1
(truncate/ 5 2)      \ev 2 1
(truncate/ -5 2)     \ev -2 -1
(truncate/ 5 -2)     \ev -2 1
(truncate/ -5 -2)    \ev 2 -1
(truncate/ -5.0 -2)  \ev 2.0 -1.0%</code></pre>
<p>(quotient<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span></em></span>)  procedure<br />
(remainder<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span></em></span>)  procedure<br />
(modulo<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>2</mn></msub><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span></em></span>)  procedure<br />
The <span>quotient</span> and <span>remainder</span> procedures are equivalent to <span> truncate-quotient</span> and <span>truncate-remainder</span>, respectively, and <span> modulo</span> is equivalent to <span>floor-remainder</span>.</p>
<p><span><em>Note:</em></span> These procedures are provided for backward compatibility with earlier versions of this report.</p>
<p>(gcd<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(lcm<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mn>1</mn></msub><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
These procedures return the greatest common divisor or least common multiple of their arguments. The result is always non-negative.</p>
<pre><code>(gcd 32 -36)            \ev  4
(gcd)                   \ev  0
(lcm 32 -36)            \ev  288
(lcm 32.0 -36)          \ev  288.0  ; inexact
(lcm)                   \ev  1%</code></pre>
<p>(numerator<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math></span></em></span>)  procedure<br />
(denominator<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math></span></em></span>)  procedure<br />
These procedures return the numerator or denominator of their argument; the result is computed as if the argument was represented as a fraction in lowest terms. The denominator is always positive. The denominator of 0 is defined to be 1.</p>
<pre><code>(numerator (/ 6 4))  \ev  3
(denominator (/ 6 4))  \ev  2
(denominator
  (inexact (/ 6 4))) \ev 2.0%</code></pre>
<p>(floor<span> <em>x</em></span>)  procedure<br />
(ceiling<span> <em>x</em></span>)  procedure<br />
(truncate<span> <em>x</em></span>)  procedure<br />
(round<span> <em>x</em></span>)  procedure<br />
These procedures return integers. The <span>floor</span> procedure returns the largest integer not larger than <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span>. The <span>ceiling</span> procedure returns the smallest integer not smaller than <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span>, <span>truncate</span> returns the integer closest to <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span> whose absolute value is not larger than the absolute value of <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span>, and <span>round</span> returns the closest integer to <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span>, rounding to even when <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span> is halfway between two integers.</p>
<p><span><em>Rationale:</em></span> The <span>round</span> procedure rounds to even for consistency with the default rounding mode specified by the IEEE 754 IEEE floating-point standard.</p>
<p><span><em>Note:</em></span> If the argument to one of these procedures is inexact, then the result will also be inexact. If an exact value is needed, the result can be passed to the <span>exact</span> procedure. If the argument is infinite or a NaN, then it is returned.</p>
<pre><code>(floor -4.3)          \ev  -5.0
(ceiling -4.3)        \ev  -4.0
(truncate -4.3)       \ev  -4.0
(round -4.3)          \ev  -4.0

(floor 3.5)           \ev  3.0
(ceiling 3.5)         \ev  4.0
(truncate 3.5)        \ev  3.0
(round 3.5)           \ev  4.0  ; inexact

(round 7/2)           \ev  4    ; exact
(round 7)             \ev  7%</code></pre>
<p>(rationalize<span> <em>x y</em></span>)  procedure<br />
The <span>rationalize</span> procedure returns the <span><em>simplest</em></span> rational number differing from <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span> by no more than <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math></span>. A rational number <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mn>1</mn></msub><annotation encoding="application/x-tex">r_1</annotation></semantics></math> is <span><em>simpler</em></span> than another rational number <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mn>2</mn></msub><annotation encoding="application/x-tex">r_2</annotation></semantics></math> if <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mn>1</mn></msub><mo>=</mo><msub><mi>p</mi><mn>1</mn></msub><mi>/</mi><msub><mi>q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">r_1 = p_1/q_1</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mn>2</mn></msub><mo>=</mo><msub><mi>p</mi><mn>2</mn></msub><mi>/</mi><msub><mi>q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">r_2 = p_2/q_2</annotation></semantics></math> (in lowest terms) and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>p</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">|</mo></mrow><mo>≤</mo><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>p</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">|</mo></mrow></mrow><annotation encoding="application/x-tex">|p_1|
\leq |p_2|</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>q</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">|</mo></mrow><mo>≤</mo><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>q</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">|</mo></mrow></mrow><annotation encoding="application/x-tex">|q_1| \leq |q_2|</annotation></semantics></math>. Thus <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mi>/</mi><mn>5</mn></mrow><annotation encoding="application/x-tex">3/5</annotation></semantics></math> is simpler than <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mi>/</mi><mn>7</mn></mrow><annotation encoding="application/x-tex">4/7</annotation></semantics></math>. Although not all rationals are comparable in this ordering (consider <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>/</mi><mn>7</mn></mrow><annotation encoding="application/x-tex">2/7</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mi>/</mi><mn>5</mn></mrow><annotation encoding="application/x-tex">3/5</annotation></semantics></math>), any interval contains a rational number that is simpler than every other rational number in that interval (the simpler <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>/</mi><mn>5</mn></mrow><annotation encoding="application/x-tex">2/5</annotation></semantics></math> lies between <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>/</mi><mn>7</mn></mrow><annotation encoding="application/x-tex">2/7</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mi>/</mi><mn>5</mn></mrow><annotation encoding="application/x-tex">3/5</annotation></semantics></math>). Note that <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>=</mo><mn>0</mn><mi>/</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">0 = 0/1</annotation></semantics></math> is the simplest rational of all.</p>
<pre><code>(rationalize
  (exact .3) 1/10)  \ev 1/3    ; exact
(rationalize .3 1/10)        \ev \#i1/3  ; inexact%</code></pre>
<p>(exp<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
(log<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
(log<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>2</mn></msub><annotation encoding="application/x-tex">z_2</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
(sin<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
(cos<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
(tan<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
(asin<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
(acos<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
(atan<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
(atan<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
These procedures compute the usual transcendental functions. The <span>log</span> procedure computes the natural logarithm of <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span> (not the base ten logarithm) if a single argument is given, or the base-<span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>2</mn></msub><annotation encoding="application/x-tex">z_2</annotation></semantics></math></span> logarithm of <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span> if two arguments are given. The <span>asin</span>, <span>acos</span>, and <span>atan</span> procedures compute arcsine (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mo>sin</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">\sin^{-1}</annotation></semantics></math>), arc-cosine (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mo>cos</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">\cos^{-1}</annotation></semantics></math>), and arctangent (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mo>tan</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">\tan^{-1}</annotation></semantics></math>), respectively. The two-argument variant of <span>atan</span> computes <span><code>(angle (make-rectangular x y))</code></span> (see below), even in implementations that don’t support complex numbers.</p>
<p>In general, the mathematical functions log, arcsine, arc-cosine, and arctangent are multiply defined. The value of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">\log z</annotation></semantics></math> is defined to be the one whose imaginary part lies in the range from <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>π</mi></mrow><annotation encoding="application/x-tex">-\pi</annotation></semantics></math> (inclusive if <span>-0.0</span> is distinguished, exclusive otherwise) to <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math> (inclusive). The value of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\log 0</annotation></semantics></math> is mathematically undefined. With <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>log</mo><annotation encoding="application/x-tex">\log</annotation></semantics></math> defined this way, the values of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo>sin</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>z</mi></mrow><annotation encoding="application/x-tex">\sin^{-1} z</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo>cos</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>z</mi></mrow><annotation encoding="application/x-tex">\cos^{-1} z</annotation></semantics></math>, and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo>tan</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>z</mi></mrow><annotation encoding="application/x-tex">\tan^{-1} z</annotation></semantics></math> are according to the following formulæ: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo>sin</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>z</mi><mo>=</mo><mo>−</mo><mi>i</mi><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mi>z</mi><mo>+</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>z</mi><mn>2</mn></msup></mrow></msqrt><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\sin^{-1} z = -i \log (i z + \sqrt{1 - z^2})</annotation></semantics></math> <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo>cos</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>z</mi><mo>=</mo><mi>π</mi><mi>/</mi><mn>2</mn><mo>−</mo><msup><mo>sin</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>z</mi></mrow><annotation encoding="application/x-tex">\cos^{-1} z = \pi / 2 - \sin^{-1} z</annotation></semantics></math> <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo>tan</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>z</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mi>i</mi><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>i</mi><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\tan^{-1} z = (\log (1 + i z) - \log (1 - i z)) / (2 i)</annotation></semantics></math></p>
<p>However, <span>(log 0.0)</span> returns <span>-inf.0</span> (and <span>(log -0.0)</span> returns <span>-inf.0+<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>i</span>) if the implementation supports infinities (and <span>-0.0</span>).</p>
<p>The range of (<span>atan</span> <em>y</em> <em>x</em>) is as in the following table. The asterisk (*) indicates that the entry applies to implementations that distinguish minus zero.</p>
<div class="center">
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math> condition</th>
<th style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math> condition</th>
<th style="text-align: left;">range of result <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&gt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x &gt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.0</mn><annotation encoding="application/x-tex">0.0</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>*</mo><annotation encoding="application/x-tex">\ast</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>+</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = +0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&gt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x &gt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>+</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">+0.0</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>*</mo><annotation encoding="application/x-tex">\ast</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>−</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = -0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&gt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x &gt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">-0.0</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>&gt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y &gt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&gt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x &gt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.0</mn><mo>&lt;</mo><mi>r</mi><mo>&lt;</mo><mfrac><mi>π</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">0.0 &lt; r &lt; \frac{\pi}{2}</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>&gt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y &gt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x = 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mi>π</mi><mn>2</mn></mfrac><annotation encoding="application/x-tex">\frac{\pi}{2}</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>&gt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y &gt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&lt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x &lt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>π</mi><mn>2</mn></mfrac><mo>&lt;</mo><mi>r</mi><mo>&lt;</mo><mi>π</mi></mrow><annotation encoding="application/x-tex">\frac{\pi}{2} &lt; r &lt; \pi</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x &lt; 0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>*</mo><annotation encoding="application/x-tex">\ast</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>+</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = +0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&lt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x &lt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>*</mo><annotation encoding="application/x-tex">\ast</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>−</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = -0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&lt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x &lt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>π</mi></mrow><annotation encoding="application/x-tex">-\pi</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>&lt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y &lt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&lt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x &lt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>π</mi><mo>&lt;</mo><mi>r</mi><mo>&lt;</mo><mo>−</mo><mfrac><mi>π</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">-\pi&lt; r&lt; -\frac{\pi}{2}</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>&lt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y &lt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x = 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mfrac><mi>π</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">-\frac{\pi}{2}</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>&lt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y &lt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&gt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x &gt; 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mfrac><mi>π</mi><mn>2</mn></mfrac><mo>&lt;</mo><mi>r</mi><mo>&lt;</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">-\frac{\pi}{2} &lt; r&lt; 0.0</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = 0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x = 0.0</annotation></semantics></math></td>
<td style="text-align: left;">undefined</td>
</tr>
<tr class="even">
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>*</mo><annotation encoding="application/x-tex">\ast</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>+</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = +0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mo>+</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x = +0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>+</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">+0.0</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>*</mo><annotation encoding="application/x-tex">\ast</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>−</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = -0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mo>+</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x = +0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">-0.0</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>*</mo><annotation encoding="application/x-tex">\ast</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>+</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = +0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mo>−</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x = -0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>*</mo><annotation encoding="application/x-tex">\ast</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>−</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = -0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mo>−</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">x = -0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>π</mi></mrow><annotation encoding="application/x-tex">-\pi</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>*</mo><annotation encoding="application/x-tex">\ast</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>+</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = +0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x = 0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mi>π</mi><mn>2</mn></mfrac><annotation encoding="application/x-tex">\frac{\pi}{2}</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>*</mo><annotation encoding="application/x-tex">\ast</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>−</mo><mn>0.0</mn></mrow><annotation encoding="application/x-tex">y = -0.0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x = 0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mfrac><mi>π</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">-\frac{\pi}{2}</annotation></semantics></math></td>
</tr>
</tbody>
</table>
</div>
<p>The above specification follows <span class="citation" data-cites="CLtL"></span>, which in turn cites <span class="citation" data-cites="Penfield81"></span>; refer to these sources for more detailed discussion of branch cuts, boundary conditions, and implementation of these functions. When it is possible, these procedures produce a real result from a real argument.</p>
<p>(square<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  procedure<br />
Returns the square of <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span>. This is equivalent to (<span>*</span> <em>z</em> <em>z</em>).</p>
<pre><code>(square 42)       \ev 1764
(square 2.0)     \ev 4.0%</code></pre>
<p>(sqrt<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  inexact library procedure<br />
Returns the principal square root of <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span>. The result will have either a positive real part, or a zero real part and a non-negative imaginary part.</p>
<pre><code>(sqrt 9)  \ev 3
(sqrt -1) \ev +i%</code></pre>
<p>(exact-integer-sqrt<span> <em>k</em></span>)  procedure<br />
Returns two non-negative exact integers <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math> where <span class="math inline">$\hbox{\it{}k\/} = s^2 + r$</span> and <span class="math inline">$\hbox{\it{}k\/} &lt; (s+1)^2$</span>.</p>
<pre><code>(exact-integer-sqrt 4) \ev 2 0
(exact-integer-sqrt 5) \ev 2 1%</code></pre>
<p>(expt<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>2</mn></msub><annotation encoding="application/x-tex">z_2</annotation></semantics></math></span></em></span>)  procedure<br />
Returns <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span> raised to the power <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>2</mn></msub><annotation encoding="application/x-tex">z_2</annotation></semantics></math></span>. For nonzero <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span>, this is <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><msub><mi>z</mi><mn>1</mn></msub><msub><mi>z</mi><mn>2</mn></msub></msup><mo>=</mo><msup><mi>e</mi><mrow><msub><mi>z</mi><mn>2</mn></msub><mo>log</mo><msub><mi>z</mi><mn>1</mn></msub></mrow></msup></mrow><annotation encoding="application/x-tex">{z_1}^{z_2} = e^{z_2 \log {z_1}}</annotation></semantics></math> The value of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>0</mn><mi>z</mi></msup><annotation encoding="application/x-tex">0^z</annotation></semantics></math> is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math> if <span>(zero? z)</span>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math> if <span>(real-part z)</span> is positive, and an error otherwise. Similarly for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>0.0</mn><mi>z</mi></msup><annotation encoding="application/x-tex">0.0^z</annotation></semantics></math>, with inexact results.</p>
<p>(make-rectangular<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>2</mn></msub><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span></em></span>)  complex library procedure<br />
(make-polar<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>3</mn></msub><annotation encoding="application/x-tex">x_3</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>4</mn></msub><annotation encoding="application/x-tex">x_4</annotation></semantics></math></span></em></span>)  complex library procedure<br />
(real-part<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  complex library procedure<br />
(imag-part<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  complex library procedure<br />
(magnitude<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  complex library procedure<br />
(angle<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  complex library procedure<br />
Let <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span>, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>2</mn></msub><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span>, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>3</mn></msub><annotation encoding="application/x-tex">x_3</annotation></semantics></math></span>, and <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>4</mn></msub><annotation encoding="application/x-tex">x_4</annotation></semantics></math></span> be real numbers and <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span> be a complex number such that <span class="math display">$${\hbox{$z$\/}} = {\hbox{$x_1$\/}} + {\hbox{$x_2$\/}}\hbox{$i$}
 = {\hbox{$x_3$\/}} \cdot e^{i x_4}$$</span> Then all of</p>
<pre><code>(make-rectangular \vri{x} \vrii{x}) \ev \vr{z}
(make-polar \vriii{x} \vriv{x})     \ev \vr{z}
(real-part \vr{z})                  \ev \vri{x}
(imag-part \vr{z})                  \ev \vrii{x}
(magnitude \vr{z})                  \ev $|\vriii{x}|$
(angle \vr{z})                      \ev $x_{angle}$%</code></pre>
<p>are true, where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>π</mi><mo>≤</mo><msub><mi>x</mi><mrow><mi>a</mi><mi>n</mi><mi>g</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>≤</mo><mi>π</mi></mrow><annotation encoding="application/x-tex">-\pi \le x_{angle} \le \pi</annotation></semantics></math> with <span class="math inline">$x_{angle} = {\hbox{$x_4$\/}} + 2\pi n$</span> for some integer <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>.</p>
<p>The <span>make-polar</span> procedure may return an inexact complex number even if its arguments are exact. The <span>real-part</span> and <span>imag-part</span> procedures may return exact real numbers when applied to an inexact complex number if the corresponding argument passed to <span>make-rectangular</span> was exact.</p>
<p><span><em>Rationale:</em></span> The <span>magnitude</span> procedure is the same as <span><code>abs</code></span> for a real argument, but <span>abs</span> is in the base library, whereas <span>magnitude</span> is in the optional complex library.</p>
<p>(inexact<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  procedure<br />
(exact<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span></em></span>)  procedure<br />
The procedure <span>inexact</span> returns an <span>inexact</span> representation of <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span>. The value returned is the <span>inexact</span> number that is numerically closest to the argument. For inexact arguments, the result is the same as the argument. For exact complex numbers, the result is a complex number whose real and imaginary parts are the result of applying <span>inexact</span> to the real and imaginary parts of the argument, respectively. If an <span>exact</span> argument has no reasonably close <span>inexact</span> equivalent (in the sense of <span>=</span>), then a violation of an implementation restriction may be reported.</p>
<p>The procedure <span>exact</span> returns an <span>exact</span> representation of <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span>. The value returned is the <span>exact</span> number that is numerically closest to the argument. For exact arguments, the result is the same as the argument. For inexact non-integral real arguments, the implementation may return a rational approximation, or may report an implementation violation. For inexact complex arguments, the result is a complex number whose real and imaginary parts are the result of applying <span>exact</span> to the real and imaginary parts of the argument, respectively. If an <span>inexact</span> argument has no reasonably close <span>exact</span> equivalent, (in the sense of <span>=</span>), then a violation of an implementation restriction may be reported.</p>
<p>These procedures implement the natural one-to-one correspondence between <span>exact</span> and <span>inexact</span> integers throughout an implementation-dependent range. See section <a href="#restrictions" data-reference-type="ref" data-reference="restrictions">[restrictions]</a>.</p>
<p><span><em>Note:</em></span> These procedures were known in R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS as <span>exact-&gt;inexact</span> and <span>inexact-&gt;exact</span>, respectively, but they have always accepted arguments of any exactness. The new names are clearer and shorter, as well as being compatible with R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS.</p>
<h3 id="numerical-input-and-output">Numerical input and output</h3>
<p>(number-&gt;string<span> <em>z</em></span>)  procedure<br />
(number-&gt;string<span> <em>z radix</em></span>)  procedure<br />
<span>It is an error if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>d</mi><mi>i</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">radix</annotation></semantics></math></span> is not one of 2, 8, 10, or 16.</span></p>
<p>The procedure <span>numberstring</span> takes a number and a radix and returns as a string an external representation of the given number in the given radix such that</p>
<pre><code>(let ((number \vr{number})
      (radix \vr{radix}))
  (eqv? number
        (string-&gt;number (number-&gt;string number
                                        radix)
                        radix)))%</code></pre>
<p>is true. It is an error if no possible result makes this expression true. If omitted, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>d</mi><mi>i</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">radix</annotation></semantics></math></span> defaults to 10.</p>
<p>If <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span> is inexact, the radix is 10, and the above expression can be satisfied by a result that contains a decimal point, then the result contains a decimal point and is expressed using the minimum number of digits (exclusive of exponent and trailing zeroes) needed to make the above expression true <span class="citation" data-cites="howtoprint howtoread"></span>; otherwise the format of the result is unspecified.</p>
<p>The result returned by <span>numberstring</span> never contains an explicit radix prefix.</p>
<p><span><em>Note:</em></span> The error case can occur only when <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span> is not a complex number or is a complex number with a non-rational real or imaginary part.</p>
<p><span><em>Rationale:</em></span> If <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></span> is an inexact number and the radix is 10, then the above expression is normally satisfied by a result containing a decimal point. The unspecified case allows for infinities, NaNs, and unusual representations.</p>
<p>(string-&gt;number<span> <em>string</em></span>)  procedure<br />
(string-&gt;number<span> <em>string radix</em></span>)  procedure<br />
Returns a number of the maximally precise representation expressed by the given <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">string</annotation></semantics></math></span>. <span>It is an error if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>d</mi><mi>i</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">radix</annotation></semantics></math></span> is not 2, 8, 10, or 16.</span></p>
<p>If supplied, <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>d</mi><mi>i</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">radix</annotation></semantics></math></span> is a default radix that will be overridden if an explicit radix prefix is present in <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">string</annotation></semantics></math></span> (e.g. <span><code>"#o177"</code></span>). If <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>d</mi><mi>i</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">radix</annotation></semantics></math></span> is not supplied, then the default radix is 10. If <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">string</annotation></semantics></math></span> is not a syntactically valid notation for a number, or would result in a number that the implementation cannot represent, then <span>string-&gt;number</span> returns #<span>f</span>. An error is never signaled due to the content of <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">string</annotation></semantics></math></span>.</p>
<pre><code>(string-&gt;number &quot;100&quot;)        \ev  100
(string-&gt;number &quot;100&quot; 16)     \ev  256
(string-&gt;number &quot;1e2&quot;)        \ev  100.0%</code></pre>
<p><span><em>Note:</em></span> The domain of <span>string-&gt;number</span> may be restricted by implementations in the following ways. If all numbers supported by an implementation are real, then <span>string-&gt;number</span> is permitted to return #<span>f</span> whenever <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">string</annotation></semantics></math></span> uses the polar or rectangular notations for complex numbers. If all numbers are integers, then <span>string-&gt;number</span> may return #<span>f</span> whenever the fractional notation is used. If all numbers are exact, then <span>string-&gt;number</span> may return #<span>f</span> whenever an exponent marker or explicit exactness prefix is used. If all inexact numbers are integers, then <span>string-&gt;number</span> may return #<span>f</span> whenever a decimal point is used.</p>
<p>The rules used by a particular implementation for <span>string-&gt;number</span> must also be applied to <span>read</span> and to the routine that reads programs, in order to maintain consistency between internal numeric processing, I/O, and the processing of programs. As a consequence, the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS permission to return #<span>f</span> when <em>string</em> has an explicit radix prefix has been withdrawn.</p>
<h2 id="booleans">Booleans</h2>
<p>The standard boolean objects for true and false are written as #<span>t</span> and #<span>f</span>. Alternatively, they can be written #<span>true</span> and #<span>false</span>, respectively. What really matters, though, are the objects that the Scheme conditional expressions (<span>if</span>, <span>cond</span>, <span>and</span>, <span>or</span>, <span>when</span>, <span>unless</span>, <span>do</span>) treat as true or false. The phrase “a true value” (or sometimes just “true”) means any object treated as true by the conditional expressions, and the phrase “a false value” (or “false”) means any object treated as false by the conditional expressions.</p>
<p>Of all the Scheme values, only #<span>f</span> counts as false in conditional expressions. All other Scheme values, including #<span>t</span>, count as true.</p>
<p><span><em>Note:</em></span> Unlike some other dialects of Lisp, Scheme distinguishes #<span>f</span> and the empty list from each other and from the symbol <span><code>nil</code></span>.</p>
<p>Boolean constants evaluate to themselves, so they do not need to be quoted in programs.</p>
<pre><code>\schtrue         \ev  \schtrue
\schfalse        \ev  \schfalse
&#39;\schfalse       \ev  \schfalse%</code></pre>
<p>(not<span> <em>obj</em></span>)  procedure<br />
The <span>not</span> procedure returns #<span>t</span> if <em>obj</em> is false, and returns #<span>f</span> otherwise.</p>
<pre><code>(not \schtrue)   \ev  \schfalse
(not 3)          \ev  \schfalse
(not (list 3))   \ev  \schfalse
(not \schfalse)  \ev  \schtrue
(not &#39;())        \ev  \schfalse
(not (list))     \ev  \schfalse
(not &#39;nil)       \ev  \schfalse%</code></pre>
<p>(boolean?<span> <em>obj</em></span>)  procedure<br />
The <span>boolean?</span> predicate returns #<span>t</span> if <em>obj</em> is either #<span>t</span> or #<span>f</span> and returns #<span>f</span> otherwise.</p>
<pre><code>(boolean? \schfalse)  \ev  \schtrue
(boolean? 0)          \ev  \schfalse
(boolean? &#39;())        \ev  \schfalse%</code></pre>
<p>(boolean=?<span> <em><em>boolean<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>boolean<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> <em>boolean<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>3</mn></msub><annotation encoding="application/x-tex">_3</annotation></semantics></math></em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
Returns #<span>t</span> if all the arguments are #<span>t</span> or all are #<span>f</span>.</p>
<h2 id="pairs-and-lists">Pairs and lists</h2>
<p>A <span><em>pair</em></span> (sometimes called a <span><em>dotted pair</em></span>) is a record structure with two fields called the car and cdr fields (for historical reasons). Pairs are created by the procedure <span>cons</span>. The car and cdr fields are accessed by the procedures <span>car</span> and <span>cdr</span>. The car and cdr fields are assigned by the procedures <span>set-car!</span> and <span>set-cdr!</span>.</p>
<p>Pairs are used primarily to represent lists. A <span><em>list</em></span> can be defined recursively as either the empty list or a pair whose cdr is a list. More precisely, the set of lists is defined as the smallest set <em>X</em> such that</p>
<ul>
<li><p>The empty list is in <em>X</em>.</p></li>
<li><p>If <em>list</em> is in <em>X</em>, then any pair whose cdr field contains <em>list</em> is also in <em>X</em>.</p></li>
</ul>
<p>The objects in the car fields of successive pairs of a list are the elements of the list. For example, a two-element list is a pair whose car is the first element and whose cdr is a pair whose car is the second element and whose cdr is the empty list. The length of a list is the number of elements, which is the same as the number of pairs.</p>
<p>The empty list is a special object of its own type. It is not a pair, it has no elements, and its length is zero.</p>
<p><span><em>Note:</em></span> The above definitions imply that all lists have finite length and are terminated by the empty list.</p>
<p>The most general notation (external representation) for Scheme pairs is the “dotted” notation (<em>c<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> . <em>c<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em>) where <em>c<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> is the value of the car field and <em>c<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> is the value of the cdr field. For example <span>(4 . 5)</span> is a pair whose car is 4 and whose cdr is 5. Note that <span>(4 . 5)</span> is the external representation of a pair, not an expression that evaluates to a pair.</p>
<p>A more streamlined notation can be used for lists: the elements of the list are simply enclosed in parentheses and separated by spaces. The empty list is written <span><code>()</code></span>. For example,</p>
<pre><code>(a b c d e)%</code></pre>
<p>and</p>
<pre><code>(a . (b . (c . (d . (e . ())))))%</code></pre>
<p>are equivalent notations for a list of symbols.</p>
<p>A chain of pairs not ending in the empty list is called an <span><em>improper list</em></span>. Note that an improper list is not a list. The list and dotted notations can be combined to represent improper lists:</p>
<pre><code>(a b c . d)%</code></pre>
<p>is equivalent to</p>
<pre><code>(a . (b . (c . d)))%</code></pre>
<p>Whether a given pair is a list depends upon what is stored in the cdr field. When the <span><code>set-cdr!</code></span> procedure is used, an object can be a list one moment and not the next:</p>
<pre><code>(define x (list &#39;a &#39;b &#39;c))
(define y x)
y                       \ev  (a b c)
(list? y)               \ev  \schtrue
(set-cdr! x 4)          \ev  \unspecified
x                       \ev  (a . 4)
(eqv? x y)              \ev  \schtrue
y                       \ev  (a . 4)
(list? y)               \ev  \schfalse
(set-cdr! x x)          \ev  \unspecified
(list? x)               \ev  \schfalse%</code></pre>
<p>Within literal expressions and representations of objects read by the <span><code>read</code></span> procedure, the forms <span><code>’</code></span><span>datum</span>, <span><code></code></span><span>datum</span>, <span><code>,</code></span><span>datum</span>, and <span><code>,@</code></span><span>datum</span> denote two-element lists whose first elements are the symbols <span><code>quote</code></span>, <span><code>quasiquote</code></span>, <code>unquote</code>, and <span><code>unquote-splicing</code></span>, respectively. The second element in each case is <span>datum</span>. This convention is supported so that arbitrary Scheme programs can be represented as lists. That is, according to Scheme’s grammar, every <span>expression</span> is also a <span>datum</span> (see section <a href="#datum" data-reference-type="ref" data-reference="datum">[datum]</a>). Among other things, this permits the use of the <span>read</span> procedure to parse Scheme programs. See section <a href="#externalreps" data-reference-type="ref" data-reference="externalreps">[externalreps]</a>.</p>
<p>(pair?<span> <em>obj</em></span>)  procedure<br />
The <span>pair?</span> predicate returns #<span>t</span> if <em>obj</em> is a pair, and otherwise returns #<span>f</span>.</p>
<pre><code>(pair? &#39;(a . b))        \ev  \schtrue
(pair? &#39;(a b c))        \ev  \schtrue
(pair? &#39;())             \ev  \schfalse
(pair? &#39;\#(a b))         \ev  \schfalse%</code></pre>
<p>(cons<span> <em><em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em></em></span>)  procedure<br />
Returns a newly allocated pair whose car is <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> and whose cdr is <em>obj<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em>. The pair is guaranteed to be different (in the sense of <span>eqv?</span>) from every existing object.</p>
<pre><code>(cons &#39;a &#39;())           \ev  (a)
(cons &#39;(a) &#39;(b c d))    \ev  ((a) b c d)
(cons &quot;a&quot; &#39;(b c))       \ev  (&quot;a&quot; b c)
(cons &#39;a 3)             \ev  (a . 3)
(cons &#39;(a b) &#39;c)        \ev  ((a b) . c)%</code></pre>
<p>(car<span> <em>pair</em></span>)  procedure<br />
Returns the contents of the car field of <em>pair</em>. Note that it is an error to take the car of the empty list.</p>
<pre><code>(car &#39;(a b c))          \ev  a
(car &#39;((a) b c d))      \ev  (a)
(car &#39;(1 . 2))          \ev  1
(car &#39;())               \ev  \scherror%</code></pre>
<p>(cdr<span> <em>pair</em></span>)  procedure<br />
Returns the contents of the cdr field of <em>pair</em>. Note that it is an error to take the cdr of the empty list.</p>
<pre><code>(cdr &#39;((a) b c d))      \ev  (b c d)
(cdr &#39;(1 . 2))          \ev  2
(cdr &#39;())               \ev  \scherror%</code></pre>
<p>(set-car!<span> <em>pair obj</em></span>)  procedure<br />
Stores <em>obj</em> in the car field of <em>pair</em>.</p>
<pre><code>(define (f) (list &#39;not-a-constant-list))
(define (g) &#39;(constant-list))
(set-car! (f) 3)             \ev  \unspecified
(set-car! (g) 3)             \ev  \scherror%</code></pre>
<p>(set-cdr!<span> <em>pair obj</em></span>)  procedure<br />
Stores <em>obj</em> in the cdr field of <em>pair</em>.</p>
<p><code>(cadr pair)</code> procedure</p>
<p>(caar<span> <em>pair</em></span>)  procedure<br />
(cadr<span> <em>pair</em></span>)  procedure<br />
(cdar<span> <em>pair</em></span>)  procedure<br />
(cddr<span> <em>pair</em></span>)  procedure<br />
These procedures are compositions of <span>car</span> and <span>cdr</span> as follows:</p>
<pre><code>(define (caar x) (car (car x)))
(define (cadr x) (car (cdr x)))
(define (cdar x) (cdr (car x)))
(define (cddr x) (cdr (cdr x)))%</code></pre>
<p>(caaar<span> <em>pair</em></span>)  cxr library procedure<br />
(caadr<span> <em>pair</em></span>)  cxr library procedure<br />
to 1 <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>⋮</mi><annotation encoding="application/x-tex">\vdots</annotation></semantics></math></span>  to 1 <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>⋮</mi><annotation encoding="application/x-tex">\vdots</annotation></semantics></math></span><br />
(cdddar<span> <em>pair</em></span>)  cxr library procedure<br />
(cddddr<span> <em>pair</em></span>)  cxr library procedure<br />
These twenty-four procedures are further compositions of <span>car</span> and <span>cdr</span> on the same principles. For example, <span>caddr</span> could be defined by</p>
<pre><code>(define caddr (lambda (x) (car (cdr (cdr x))))){\rm.}%</code></pre>
<p>Arbitrary compositions up to four deep are provided.</p>
<p>(null?<span> <em>obj</em></span>)  procedure<br />
Returns #<span>t</span> if <em>obj</em> is the empty list, otherwise returns #<span>f</span>.</p>
<p>(list?<span> <em>obj</em></span>)  procedure<br />
Returns #<span>t</span> if <em>obj</em> is a list. Otherwise, it returns #<span>f</span>. By definition, all lists have finite length and are terminated by the empty list.</p>
<pre><code>        (list? &#39;(a b c))     \ev  \schtrue
        (list? &#39;())          \ev  \schtrue
        (list? &#39;(a . b))     \ev  \schfalse
        (let ((x (list &#39;a)))
          (set-cdr! x x)
          (list? x))         \ev  \schfalse%</code></pre>
<p>(make-list<span> <em>k</em></span>)  procedure<br />
(make-list<span> <em>k fill</em></span>)  procedure<br />
Returns a newly allocated list of <em>k</em> elements. If a second argument is given, then each element is initialized to <em>fill</em>. Otherwise the initial contents of each element is unspecified.</p>
<pre><code>(make-list 2 3)   \ev   (3 3)%</code></pre>
<p>(list<span> <em><em>obj</em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
Returns a newly allocated list of its arguments.</p>
<pre><code>(list &#39;a (+ 3 4) &#39;c)            \ev  (a 7 c)
(list)                          \ev  ()%</code></pre>
<p>(length<span> <em>list</em></span>)  procedure<br />
Returns the length of <em>list</em>.</p>
<pre><code>(length &#39;(a b c))               \ev  3
(length &#39;(a (b) (c d e)))       \ev  3
(length &#39;())                    \ev  0%</code></pre>
<p>(append<span> <em>list <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
<span>The last argument, if there is one, can be of any type.</span></p>
<p>Returns a list consisting of the elements of the first <em>list</em> followed by the elements of the other <em>list</em>s. If there are no arguments, the empty list is returned. If there is exactly one argument, it is returned. Otherwise the resulting list is always newly allocated, except that it shares structure with the last argument. An improper list results if the last argument is not a proper list.</p>
<pre><code>(append &#39;(x) &#39;(y))              \ev  (x y)
(append &#39;(a) &#39;(b c d))          \ev  (a b c d)
(append &#39;(a (b)) &#39;((c)))        \ev  (a (b) (c))%</code></pre>
<pre><code>(append &#39;(a b) &#39;(c . d))        \ev  (a b c . d)
(append &#39;() &#39;a)                 \ev  a%</code></pre>
<p>(reverse<span> <em>list</em></span>)  procedure<br />
Returns a newly allocated list consisting of the elements of <em>list</em> in reverse order.</p>
<pre><code>(reverse &#39;(a b c))              \ev  (c b a)
(reverse &#39;(a (b c) d (e (f))))  \lev  ((e (f)) d (b c) a)%</code></pre>
<p>(list-tail<span> <em>list <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span></em></span>)  procedure<br />
<span>It is an error if <em>list</em> has fewer than <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> elements.</span></p>
<p>Returns the sublist of <em>list</em> obtained by omitting the first <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> elements. The <span>list-tail</span> procedure could be defined by</p>
<pre><code>(define list-tail
  (lambda (x k)
    (if (zero? k)
        x
        (list-tail (cdr x) (- k 1)))))%</code></pre>
<p>(list-ref<span> <em>list <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span></em></span>)  procedure<br />
<span>The <em>list</em> argument can be circular, but it is an error if <em>list</em> has <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> or fewer elements.</span></p>
<p>Returns the <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span>th element of <em>list</em>. (This is the same as the car of <span><code>(list-tail list k)</code></span>.)</p>
<pre><code>(list-ref &#39;(a b c d) 2)                 \ev  c
(list-ref &#39;(a b c d)
          (exact (round 1.8))) \lev  c%</code></pre>
<p>(list-set!<span> <em>list k obj</em></span>)  procedure<br />
<span>It is an error if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> is not a valid index of <em>list</em>.</span></p>
<p>The <span>list-set!</span> procedure stores <em>obj</em> in element <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> of <em>list</em>.</p>
<pre><code>(let ((ls (list &#39;one &#39;two &#39;five!)))
  (list-set! ls 2 &#39;three)
  ls)      \lev  (one two three)

(list-set! &#39;(0 1 2) 1 &quot;oops&quot;)  \lev  \scherror  ; constant list%</code></pre>
<p>(memq<span> <em>obj list</em></span>)  procedure<br />
(memv<span> <em>obj list</em></span>)  procedure<br />
(member<span> <em>obj list</em></span>)  procedure<br />
(member<span> <em>obj list compare</em></span>)  procedure<br />
These procedures return the first sublist of <em>list</em> whose car is <em>obj</em>, where the sublists of <em>list</em> are the non-empty lists returned by <span><code>(list-tail list k)</code></span> for <em>k</em> less than the length of <em>list</em>. If <em>obj</em> does not occur in <em>list</em>, then #<span>f</span> (not the empty list) is returned. The <span>memq</span> procedure uses <span>eq?</span> to compare <em>obj</em> with the elements of <em>list</em>, while <span>memv</span> uses <span>eqv?</span> and <span>member</span> uses <em>compare</em>, if given, and <span>equal?</span> otherwise.</p>
<pre><code>(memq &#39;a &#39;(a b c))              \ev  (a b c)
(memq &#39;b &#39;(a b c))              \ev  (b c)
(memq &#39;a &#39;(b c d))              \ev  \schfalse
(memq (list &#39;a) &#39;(b (a) c))     \ev  \schfalse
(member (list &#39;a)
        &#39;(b (a) c))             \ev  ((a) c)
(member &quot;B&quot;
        &#39;(&quot;a&quot; &quot;b&quot; &quot;c&quot;)
        string-ci=?)            \ev  (&quot;b&quot; &quot;c&quot;)
(memq 101 &#39;(100 101 102))       \ev  \unspecified
(memv 101 &#39;(100 101 102))       \ev  (101 102)%</code></pre>
<p>(assq<span> <em>obj alist</em></span>)  procedure<br />
(assv<span> <em>obj alist</em></span>)  procedure<br />
(assoc<span> <em>obj alist</em></span>)  procedure<br />
(assoc<span> <em>obj alist compare</em></span>)  procedure<br />
<span>It is an error if <em>alist</em> (for “association list”) is not a list of pairs.</span></p>
<p>These procedures find the first pair in <em>alist</em> whose car field is <em>obj</em>, and returns that pair. If no pair in <em>alist</em> has <em>obj</em> as its car, then #<span>f</span> (not the empty list) is returned. The <span>assq</span> procedure uses <span>eq?</span> to compare <em>obj</em> with the car fields of the pairs in <em>alist</em>, while <span>assv</span> uses <span>eqv?</span> and <span>assoc</span> uses <em>compare</em> if given and <span>equal?</span> otherwise.</p>
<pre><code>(define e &#39;((a 1) (b 2) (c 3)))
(assq &#39;a e)     \ev  (a 1)
(assq &#39;b e)     \ev  (b 2)
(assq &#39;d e)     \ev  \schfalse
(assq (list &#39;a) &#39;(((a)) ((b)) ((c))))
                \ev  \schfalse
(assoc (list &#39;a) &#39;(((a)) ((b)) ((c))))   
                           \ev  ((a))
(assoc 2.0 &#39;((1 1) (2 4) (3 9)) =)
                           \ev (2 4)
(assq 5 &#39;((2 3) (5 7) (11 13)))    
                           \ev  \unspecified
(assv 5 &#39;((2 3) (5 7) (11 13)))    
                           \ev  (5 7)%</code></pre>
<p><span><em>Rationale:</em></span> Although they are often used as predicates, <span>memq</span>, <span>memv</span>, <span>member</span>, <span>assq</span>, <span>assv</span>, and <span>assoc</span> do not have question marks in their names because they return potentially useful values rather than just #<span>t</span> or #<span>f</span>.</p>
<p>(list-copy<span> <em>obj</em></span>)  procedure<br />
Returns a newly allocated copy of the given <em>obj</em> if it is a list. Only the pairs themselves are copied; the cars of the result are the same (in the sense of <span>eqv?</span>) as the cars of <em>list</em>. If <em>obj</em> is an improper list, so is the result, and the final cdrs are the same in the sense of <span>eqv?</span>. An <em>obj</em> which is not a list is returned unchanged. It is an error if <em>obj</em> is a circular list.</p>
<pre><code>(define a &#39;(1 8 2 8)) ; a may be immutable
(define b (list-copy a))
(set-car! b 3)        ; b is mutable
b \ev (3 8 2 8)
a \ev (1 8 2 8)%</code></pre>
<h2 id="symbols">Symbols</h2>
<p>Symbols are objects whose usefulness rests on the fact that two symbols are identical (in the sense of <span>eqv?</span>) if and only if their names are spelled the same way. For instance, they can be used the way enumerated values are used in other languages.</p>
<p>The rules for writing a symbol are exactly the same as the rules for writing an identifier; see sections <a href="#syntaxsection" data-reference-type="ref" data-reference="syntaxsection">[syntaxsection]</a> and <a href="#identifiersyntax" data-reference-type="ref" data-reference="identifiersyntax">[identifiersyntax]</a>.</p>
<p>It is guaranteed that any symbol that has been returned as part of a literal expression, or read using the <span>read</span> procedure, and subsequently written out using the <span>write</span> procedure, will read back in as the identical symbol (in the sense of <span>eqv?</span>).</p>
<p><span><em>Note:</em></span> Some implementations have values known as “uninterned symbols,” which defeat write/read invariance, and also violate the rule that two symbols are the same if and only if their names are spelled the same. This report does not specify the behavior of implementation-dependent extensions.</p>
<p>(symbol?<span> <em>obj</em></span>)  procedure<br />
Returns #<span>t</span> if <em>obj</em> is a symbol, otherwise returns #<span>f</span>.</p>
<pre><code>(symbol? &#39;foo)          \ev  \schtrue
(symbol? (car &#39;(a b)))  \ev  \schtrue
(symbol? &quot;bar&quot;)         \ev  \schfalse
(symbol? &#39;nil)          \ev  \schtrue
(symbol? &#39;())           \ev  \schfalse
(symbol? \schfalse)     \ev  \schfalse%</code></pre>
<p>(symbol=?<span> <em><em>symbol<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>symbol<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> <em>symbol<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>3</mn></msub><annotation encoding="application/x-tex">_3</annotation></semantics></math></em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
Returns #<span>t</span> if all the arguments all have the same names in the sense of <span>string=?</span>.</p>
<p><span><em>Note:</em></span> The definition above assumes that none of the arguments are uninterned symbols.</p>
<p>(symbol-&gt;string<span> <em>symbol</em></span>)  procedure<br />
Returns the name of <em>symbol</em> as a string, but without adding escapes. It is an error to apply mutation procedures like <span><code>string-set!</code></span> to strings returned by this procedure.</p>
<pre><code>(symbol-&gt;string &#39;flying-fish)     
                                  \ev  &quot;flying-fish&quot;
(symbol-&gt;string &#39;Martin)          \ev  &quot;Martin&quot;
(symbol-&gt;string
   (string-&gt;symbol &quot;Malvina&quot;))     
                                  \ev  &quot;Malvina&quot;%</code></pre>
<p>(string-&gt;symbol<span> <em>string</em></span>)  procedure<br />
Returns the symbol whose name is <em>string</em>. This procedure can create symbols with names containing special characters that would require escaping when written, but does not interpret escapes in its input.</p>
<pre><code>(string-&gt;symbol &quot;mISSISSIppi&quot;)  \lev%
  mISSISSIppi
(eqv? &#39;bitBlt (string-&gt;symbol &quot;bitBlt&quot;))     \lev  \schtrue
(eqv? &#39;LollyPop
     (string-&gt;symbol
       (symbol-&gt;string &#39;LollyPop)))  \lev  \schtrue
(string=? &quot;K. Harper, M.D.&quot;
          (symbol-&gt;string
            (string-&gt;symbol &quot;K. Harper, M.D.&quot;)))  \lev  \schtrue%</code></pre>
<h2 id="characters">Characters</h2>
<p>Characters are objects that represent printed characters such as letters and digits. All Scheme implementations must support at least the ASCII character repertoire: that is, Unicode characters U+0000 through U+007F. Implementations may support any other Unicode characters they see fit, and may also support non-Unicode characters as well. Except as otherwise specified, the result of applying any of the following procedures to a non-Unicode character is implementation-dependent.</p>
<p>Characters are written using the notation <span><code>#</code></span><span><code>‘ </code></span><span>character</span> or <span><code>#</code></span><span><code>‘ </code></span><span>character name</span> or <span><code>#</code></span><span><code>‘ </code></span>x<span>hex scalar value</span>.</p>
<p>The following character names must be supported by all implementations with the given values. Implementations may add other names provided they cannot be interpreted as hex scalar values preceded by <span>x</span>.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; <span class="roman">U+0007</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; <span class="roman">U+0008</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; <span class="roman">U+007F</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; <span class="roman">U+001B</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; the linefeed character, <span class="roman">U+000A</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; the null character, <span class="roman">U+0000</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; the return character, <span class="roman">U+000D</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; the preferred way to write a space</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; the tab character, <span class="roman">U+0009</span></td>
</tr>
</tbody>
</table>
<p>Here are some additional examples:</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; lower case letter</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; upper case letter</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; left parenthesis</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; the space character</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> (if character is supported)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">; <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ι</mi><annotation encoding="application/x-tex">\iota</annotation></semantics></math> (if character and name are supported)</td>
</tr>
</tbody>
</table>
<p>Case is significant in <span><code>#</code></span><span><code>‘ </code></span><span>character</span>, and in <span><code>#</code></span><span><code>‘ </code></span><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="prefix">⟨</mo><annotation encoding="application/x-tex">\langle</annotation></semantics></math>character name<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">⟩</mo><annotation encoding="application/x-tex">\rangle</annotation></semantics></math></span>, but not in <span><span><code>#</code></span><span><code>‘ </code></span>x</span><span>hex scalar value</span>. If <span>character</span> in <span><code>#</code></span><span><code>‘ </code></span><span>character</span> is alphabetic, then any character immediately following <span>character</span> cannot be one that can appear in an identifier. This rule resolves the ambiguous case where, for example, the sequence of characters “<span><code>#‘ space</code></span>” could be taken to be either a representation of the space character or a representation of the character “<span><code>#‘ s</code></span>” followed by a representation of the symbol “<span><code>pace</code></span>.”</p>
<p>Characters written in the <span><code>#</code></span><span><code>‘ </code></span> notation are self-evaluating. That is, they do not have to be quoted in programs.</p>
<p>Some of the procedures that operate on characters ignore the difference between upper case and lower case. The procedures that ignore case have “<span><code>-ci</code></span>” (for “case insensitive”) embedded in their names.</p>
<p>(char?<span> <em>obj</em></span>)  procedure<br />
Returns #<span>t</span> if <em>obj</em> is a character, otherwise returns #<span>f</span>.</p>
<p>(char=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">char_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">char_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">char_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(char&lt;?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">char_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">char_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">char_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(char&gt;?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">char_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">char_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">char_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(char&lt;=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">char_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">char_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">char_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(char&gt;=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">char_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">char_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">char_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
These procedures return #<span>t</span> if the results of passing their arguments to <span>charinteger</span> are respectively equal, monotonically increasing, monotonically decreasing, monotonically non-decreasing, or monotonically non-increasing.</p>
<p>These predicates are required to be transitive.</p>
<p>(char-ci=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">char_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">char_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">char_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  char library procedure<br />
(char-ci&lt;?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">char_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">char_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">char_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  char library procedure<br />
(char-ci&gt;?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">char_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">char_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">char_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  char library procedure<br />
(char-ci&lt;=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">char_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">char_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">char_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  char library procedure<br />
(char-ci&gt;=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">char_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">char_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>a</mi><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">char_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  char library procedure<br />
These procedures are similar to <span>char=?</span> et cetera, but they treat upper case and lower case letters as the same. For example, <span> (char-ci=? #<span><code>‘ </code></span>A #<span><code>‘ </code></span>a)</span> returns #<span>t</span>.</p>
<p>Specifically, these procedures behave as if <span>char-foldcase</span> were applied to their arguments before they were compared.</p>
<p>(char-alphabetic?<span> <em>char</em></span>)  char library procedure<br />
(char-numeric?<span> <em>char</em></span>)  char library procedure<br />
(char-whitespace?<span> <em>char</em></span>)  char library procedure<br />
(char-upper-case?<span> <em>letter</em></span>)  char library procedure<br />
(char-lower-case?<span> <em>letter</em></span>)  char library procedure<br />
These procedures return #<span>t</span> if their arguments are alphabetic, numeric, whitespace, upper case, or lower case characters, respectively, otherwise they return #<span>f</span>.</p>
<p>Specifically, they must return #<span>t</span> when applied to characters with the Unicode properties Alphabetic, Numeric_Type=Decimal, White_Space, Uppercase, and Lowercase respectively, and #<span>f</span> when applied to any other Unicode characters. Note that many Unicode characters are alphabetic but neither upper nor lower case.</p>
<p>(digit-value<span> <em>char</em></span>)  char library procedure<br />
This procedure returns the numeric value (0 to 9) of its argument if it is a numeric digit (that is, if <span>char-numeric?</span> returns #<span>t</span>), or #<span>f</span> on any other character.</p>
<pre><code>(digit-value \#\backwhack{}3) \ev 3
(digit-value \#\backwhack{}x0664) \ev 4
(digit-value \#\backwhack{}x0AE6) \ev 0
(digit-value \#\backwhack{}x0EA6) \ev \schfalse%</code></pre>
<p>(char-&gt;integer<span> <em>char</em></span>)  procedure<br />
(integer-&gt;char<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math></span></em></span>)  procedure<br />
Given a Unicode character, <span>charinteger</span> returns an exact integer between 0 and <span><code>#xD7FF</code></span> or between <span><code>#xE000</code></span> and <span><code>#x10FFFF</code></span> which is equal to the Unicode scalar value of that character. Given a non-Unicode character, it returns an exact integer greater than <span><code>#x10FFFF</code></span>. This is true independent of whether the implementation uses the Unicode representation internally.</p>
<p>Given an exact integer that is the value returned by a character when <span>charinteger</span> is applied to it, <span>integerchar</span> returns that character.</p>
<p>(char-upcase<span> <em>char</em></span>)  char library procedure<br />
(char-downcase<span> <em>char</em></span>)  char library procedure<br />
(char-foldcase<span> <em>char</em></span>)  char library procedure<br />
The <span>char-upcase</span> procedure, given an argument that is the lowercase part of a Unicode casing pair, returns the uppercase member of the pair, provided that both characters are supported by the Scheme implementation. Note that language-sensitive casing pairs are not used. If the argument is not the lowercase member of such a pair, it is returned.</p>
<p>The <span>char-downcase</span> procedure, given an argument that is the uppercase part of a Unicode casing pair, returns the lowercase member of the pair, provided that both characters are supported by the Scheme implementation. Note that language-sensitive casing pairs are not used. If the argument is not the uppercase member of such a pair, it is returned.</p>
<p>The <span>char-foldcase</span> procedure applies the Unicode simple case-folding algorithm to its argument and returns the result. Note that language-sensitive folding is not used. If the character that results from folding is not supported by the implementation, the argument is returned. See UAX #44 <span class="citation" data-cites="uax44"></span> (part of the Unicode Standard) for details.</p>
<p>Note that many Unicode lowercase characters do not have uppercase equivalents.</p>
<h2 id="strings">Strings</h2>
<p>Strings are sequences of characters. Strings are written as sequences of characters enclosed within quotation marks (<span>"</span>). Within a string literal, various escape sequences represent characters other than themselves. Escape sequences always start with a backslash (<span><code>‘ </code></span>):</p>
<ul>
<li><p><span><span><code>‘ </code></span>a</span> : alarm, U+0007</p></li>
<li><p><span><span><code>‘ </code></span>b</span> : backspace, U+0008</p></li>
<li><p><span><span><code>‘ </code></span>t</span> : character tabulation, U+0009</p></li>
<li><p><span><span><code>‘ </code></span>n</span> : linefeed, U+000A</p></li>
<li><p><span><span><code>‘ </code></span>r</span> : return, U+000D</p></li>
<li><p><span><span><code>‘ </code></span></span><code>"</code> : double quote, U+0022</p></li>
<li><p><span><span><code>‘ </code></span><span><code>‘ </code></span></span> : backslash, U+005C</p></li>
<li><p><span><span><code>‘ </code></span>|</span> : vertical line, U+007C</p></li>
<li><p><span><span><code>‘ </code></span><span>intraline whitespace</span><span>line ending</span> <span>intraline whitespace</span></span> : nothing</p></li>
<li><p><span><span><code>‘ </code></span>x<span>hex scalar value</span>;</span> : specified character (note the terminating semi-colon).</p></li>
</ul>
<p>The result is unspecified if any other character in a string occurs after a backslash.</p>
<p>Except for a line ending, any character outside of an escape sequence stands for itself in the string literal. A line ending which is preceded by <span><span><code>‘ </code></span><span>intraline whitespace</span></span> expands to nothing (along with any trailing intraline whitespace), and can be used to indent strings for improved legibility. Any other line ending has the same effect as inserting a <span><span><code>‘ </code></span>n</span> character into the string.</p>
<p>Examples:</p>
<pre><code>&quot;The word \backwhack{}&quot;recursion\backwhack{}&quot; has many meanings.&quot;
&quot;Another example:\backwhack{}ntwo lines of text&quot;
&quot;Here&#39;s text \backwhack{} 
   containing just one line&quot;
&quot;\backwhack{}x03B1; is named GREEK SMALL LETTER ALPHA.&quot;%</code></pre>
<p>The <span><em>length</em></span> of a string is the number of characters that it contains. This number is an exact, non-negative integer that is fixed when the string is created. The <span><em>valid indexes</em></span> of a string are the exact non-negative integers less than the length of the string. The first character of a string has index 0, the second has index 1, and so on.</p>
<p>Some of the procedures that operate on strings ignore the difference between upper and lower case. The names of the versions that ignore case end with “<span>-ci</span>” (for “case insensitive”).</p>
<p>Implementations may forbid certain characters from appearing in strings. However, with the exception of <span><code>#‘ null</code></span>, ASCII characters must not be forbidden. For example, an implementation might support the entire Unicode repertoire, but only allow characters U+0001 to U+00FF (the Latin-1 repertoire without <span><code>#‘ null</code></span>) in strings.</p>
<p>It is an error to pass such a forbidden character to <span>make-string</span>, <span>string</span>, <span>string-set!</span>, or <span>string-fill!</span>, as part of the list passed to <span>liststring</span>, or as part of the vector passed to <span>vectorstring</span> (see section <a href="#vectortostring" data-reference-type="ref" data-reference="vectortostring">[vectortostring]</a>), or in UTF-8 encoded form within a bytevector passed to <span>utf8string</span> (see section <a href="#utf8tostring" data-reference-type="ref" data-reference="utf8tostring">[utf8tostring]</a>). It is also an error for a procedure passed to <span>string-map</span> (see section <a href="#stringmap" data-reference-type="ref" data-reference="stringmap">[stringmap]</a>) to return a forbidden character, or for <span>read-string</span> (see section <a href="#readstring" data-reference-type="ref" data-reference="readstring">[readstring]</a>) to attempt to read one.</p>
<p>(string?<span> <em>obj</em></span>)  procedure<br />
Returns #<span>t</span> if <em>obj</em> is a string, otherwise returns #<span>f</span>.</p>
<p>(make-string<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span></em></span>)  procedure<br />
(make-string<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> char</em></span>)  procedure<br />
The <span>make-string</span> procedure returns a newly allocated string of length <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span>. If <em>char</em> is given, then all the characters of the string are initialized to <em>char</em>, otherwise the contents of the string are unspecified.</p>
<p>(string<span> <em>char <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
Returns a newly allocated string composed of the arguments. It is analogous to <span>list</span>.</p>
<p>(string-length<span> <em>string</em></span>)  procedure<br />
Returns the number of characters in the given <em>string</em>.</p>
<p>(string-ref<span> <em>string <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span></em></span>)  procedure<br />
<span>It is an error if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> is not a valid index of <em>string</em>.</span></p>
<p>The <span>string-ref</span> procedure returns character <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> of <em>string</em> using zero-origin indexing. There is no requirement for this procedure to execute in constant time.</p>
<p>(string-set!<span> <em>string k char</em></span>)  procedure<br />
<span>It is an error if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> is not a valid index of <em>string</em>.</span></p>
<p>The <span>string-set!</span> procedure stores <em>char</em> in element <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> of <em>string</em>. There is no requirement for this procedure to execute in constant time.</p>
<pre><code>(define (f) (make-string 3 \sharpsign\backwhack{}*))
(define (g) &quot;***&quot;)
(string-set! (f) 0 \sharpsign\backwhack{}?)  \ev  \unspecified
(string-set! (g) 0 \sharpsign\backwhack{}?)  \ev  \scherror
(string-set! (symbol-&gt;string &#39;immutable)
             0
             \sharpsign\backwhack{}?)  \ev  \scherror%</code></pre>
<p>(string=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">string_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">string_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">string_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
Returns #<span>t</span> if all the strings are the same length and contain exactly the same characters in the same positions, otherwise returns #<span>f</span>.</p>
<p>(string-ci=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">string_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">string_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">string_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  char library procedure<br />
Returns #<span>t</span> if, after case-folding, all the strings are the same length and contain the same characters in the same positions, otherwise returns #<span>f</span>. Specifically, these procedures behave as if <span>string-foldcase</span> were applied to their arguments before comparing them.</p>
<p>(string&lt;?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">string_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">string_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">string_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(string-ci&lt;?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">string_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">string_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">string_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  char library procedure<br />
(string&gt;?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">string_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">string_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">string_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(string-ci&gt;?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">string_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">string_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">string_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  char library procedure<br />
(string&lt;=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">string_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">string_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">string_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(string-ci&lt;=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">string_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">string_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">string_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  char library procedure<br />
(string&gt;=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">string_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">string_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">string_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
(string-ci&gt;=?<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">string_1</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">string_2</annotation></semantics></math></span> <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">string_3</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  char library procedure<br />
These procedures return #<span>t</span> if their arguments are (respectively): monotonically increasing, monotonically decreasing, monotonically non-decreasing, or monotonically non-increasing.</p>
<p>These predicates are required to be transitive.</p>
<p>These procedures compare strings in an implementation-defined way. One approach is to make them the lexicographic extensions to strings of the corresponding orderings on characters. In that case, <span>string&lt;?</span> would be the lexicographic ordering on strings induced by the ordering <span>char&lt;?</span> on characters, and if the two strings differ in length but are the same up to the length of the shorter string, the shorter string would be considered to be lexicographically less than the longer string. However, it is also permitted to use the natural ordering imposed by the implementation’s internal representation of strings, or a more complex locale-specific ordering.</p>
<p>In all cases, a pair of strings must satisfy exactly one of <span>string&lt;?</span>, <span>string=?</span>, and <span>string&gt;?</span>, and must satisfy <span>string&lt;=?</span> if and only if they do not satisfy <span>string&gt;?</span> and <span>string&gt;=?</span> if and only if they do not satisfy <span>string&lt;?</span>.</p>
<p>The “<span><code>-ci</code></span>” procedures behave as if they applied <span>string-foldcase</span> to their arguments before invoking the corresponding procedures without “<span><code>-ci</code></span>”.</p>
<p>(string-upcase<span> <em>string</em></span>)  char library procedure<br />
(string-downcase<span> <em>string</em></span>)  char library procedure<br />
(string-foldcase<span> <em>string</em></span>)  char library procedure<br />
These procedures apply the Unicode full string uppercasing, lowercasing, and case-folding algorithms to their arguments and return the result. In certain cases, the result differs in length from the argument. If the result is equal to the argument in the sense of <span>string=?</span>, the argument may be returned. Note that language-sensitive mappings and foldings are not used.</p>
<p>The Unicode Standard prescribes special treatment of the Greek letter <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Σ</mi><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math>, whose normal lower-case form is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math> but which becomes <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>ς</mo><annotation encoding="application/x-tex">\varsigma</annotation></semantics></math> at the end of a word. See UAX #44 <span class="citation" data-cites="uax44"></span> (part of the Unicode Standard) for details. However, implementations of <span> string-downcase</span> are not required to provide this behavior, and may choose to change <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Σ</mi><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math> to <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math> in all cases.</p>
<p>(substring<span> <em>string start end</em></span>)  procedure<br />
The <span>substring</span> procedure returns a newly allocated string formed from the characters of <em>string</em> beginning with index <em>start</em> and ending with index <em>end</em>. This is equivalent to calling <span>string-copy</span> with the same arguments, but is provided for backward compatibility and stylistic flexibility.</p>
<p>(string-append<span> <em><em>string</em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
Returns a newly allocated string whose characters are the concatenation of the characters in the given strings.</p>
<p>(string-&gt;list<span> <em>string</em></span>)  procedure<br />
(string-&gt;list<span> <em>string start</em></span>)  procedure<br />
(string-&gt;list<span> <em>string start end</em></span>)  procedure<br />
(list-&gt;string<span> <em>list</em></span>)  procedure<br />
<span>It is an error if any element of <em>list</em> is not a character.</span></p>
<p>The <span>stringlist</span> procedure returns a newly allocated list of the characters of <em>string</em> between <em>start</em> and <em>end</em>. <span>liststring</span> returns a newly allocated string formed from the elements in the list <em>list</em>. In both procedures, order is preserved. <span>stringlist</span> and <span>liststring</span> are inverses so far as <span>equal?</span> is concerned.</p>
<p>(string-copy<span> <em>string</em></span>)  procedure<br />
(string-copy<span> <em>string start</em></span>)  procedure<br />
(string-copy<span> <em>string start end</em></span>)  procedure<br />
Returns a newly allocated copy of the part of the given <em>string</em> between <em>start</em> and <em>end</em>.</p>
<p>(string-copy!<span> <em>to at from</em></span>)  procedure<br />
(string-copy!<span> <em>to at from start</em></span>)  procedure<br />
(string-copy!<span> <em>to at from start end</em></span>)  procedure<br />
<span>It is an error if <em>at</em> is less than zero or greater than the length of <em>to</em>. It is also an error if <span>(- (string-length <em>to</em>) <em>at</em>)</span> is less than <span>(- <em>end</em> <em>start</em>)</span>.</span></p>
<p>Copies the characters of string <em>from</em> between <em>start</em> and <em>end</em> to string <em>to</em>, starting at <em>at</em>. The order in which characters are copied is unspecified, except that if the source and destination overlap, copying takes place as if the source is first copied into a temporary string and then into the destination. This can be achieved without allocating storage by making sure to copy in the correct direction in such circumstances.</p>
<pre><code>(define a &quot;12345&quot;)
(define b (string-copy &quot;abcde&quot;))
(string-copy! b 1 a 0 2)
b \ev &quot;a12de&quot;%</code></pre>
<p>(string-fill!<span> <em>string fill</em></span>)  procedure<br />
(string-fill!<span> <em>string fill start</em></span>)  procedure<br />
(string-fill!<span> <em>string fill start end</em></span>)  procedure<br />
<span>It is an error if <em>fill</em> is not a character.</span></p>
<p>The <span>string-fill!</span> procedure stores <em>fill</em> in the elements of <em>string</em> between <em>start</em> and <em>end</em>.</p>
<h2 id="vectors">Vectors</h2>
<p>Vectors are heterogeneous structures whose elements are indexed by integers. A vector typically occupies less space than a list of the same length, and the average time needed to access a randomly chosen element is typically less for the vector than for the list.</p>
<p>The <span><em>length</em></span> of a vector is the number of elements that it contains. This number is a non-negative integer that is fixed when the vector is created. The <span><em>valid indexes</em></span> of a vector are the exact non-negative integers less than the length of the vector. The first element in a vector is indexed by zero, and the last element is indexed by one less than the length of the vector.</p>
<p>Vectors are written using the notation <span><code>#(obj \ldots\,)</code></span>. For example, a vector of length 3 containing the number zero in element 0, the list <span>(2 2 2 2)</span> in element 1, and the string <span>"Anna"</span> in element 2 can be written as follows:</p>
<pre><code>\#(0 (2 2 2 2) &quot;Anna&quot;)%</code></pre>
<p>Vector constants are self-evaluating, so they do not need to be quoted in programs.</p>
<p>(vector?<span> <em>obj</em></span>)  procedure<br />
Returns #<span>t</span> if <em>obj</em> is a vector; otherwise returns #<span>f</span>.</p>
<p>(make-vector<span> <em>k</em></span>)  procedure<br />
(make-vector<span> <em>k fill</em></span>)  procedure<br />
Returns a newly allocated vector of <em>k</em> elements. If a second argument is given, then each element is initialized to <em>fill</em>. Otherwise the initial contents of each element is unspecified.</p>
<p>(vector<span> <em>obj <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
Returns a newly allocated vector whose elements contain the given arguments. It is analogous to <span>list</span>.</p>
<pre><code>(vector &#39;a &#39;b &#39;c)               \ev  \#(a b c)%</code></pre>
<p>(vector-length<span> <em>vector</em></span>)  procedure<br />
Returns the number of elements in <em>vector</em> as an exact integer.</p>
<p>(vector-ref<span> <em>vector k</em></span>)  procedure<br />
<span>It is an error if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> is not a valid index of <em>vector</em>.</span></p>
<p>The <span>vector-ref</span> procedure returns the contents of element <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> of <em>vector</em>.</p>
<pre><code>(vector-ref &#39;\#(1 1 2 3 5 8 13 21)
            5)  \lev  8
(vector-ref &#39;\#(1 1 2 3 5 8 13 21)
            (exact
             (round (* 2 (acos -1))))) \lev 13%</code></pre>
<p>(vector-set!<span> <em>vector k obj</em></span>)  procedure<br />
<span>It is an error if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> is not a valid index of <em>vector</em>.</span></p>
<p>The <span>vector-set!</span> procedure stores <em>obj</em> in element <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> of <em>vector</em>.</p>
<pre><code>(let ((vec (vector 0 &#39;(2 2 2 2) &quot;Anna&quot;)))
  (vector-set! vec 1 &#39;(&quot;Sue&quot; &quot;Sue&quot;))
  vec)      \lev  \#(0 (&quot;Sue&quot; &quot;Sue&quot;) &quot;Anna&quot;)

(vector-set! &#39;\#(0 1 2) 1 &quot;doe&quot;)  \lev  \scherror  ; constant vector%</code></pre>
<p>(vector-&gt;list<span> <em>vector</em></span>)  procedure<br />
(vector-&gt;list<span> <em>vector start</em></span>)  procedure<br />
(vector-&gt;list<span> <em>vector start end</em></span>)  procedure<br />
(list-&gt;vector<span> <em>list</em></span>)  procedure<br />
The <span>vector-&gt;list</span> procedure returns a newly allocated list of the objects contained in the elements of <em>vector</em> between <em>start</em> and <em>end</em>. The <span>list-&gt;vector</span> procedure returns a newly created vector initialized to the elements of the list <em>list</em>.</p>
<p>In both procedures, order is preserved.</p>
<pre><code>(vector-&gt;list &#39;\#(dah dah didah))  \lev  (dah dah didah)
(vector-&gt;list &#39;\#(dah dah didah) 1 2) \lev (dah)
(list-&gt;vector &#39;(dididit dah))   \lev  \#(dididit dah)%</code></pre>
<p>(vector-&gt;string<span> <em>vector</em></span>)  procedure<br />
(vector-&gt;string<span> <em>vector start</em></span>)  procedure<br />
(vector-&gt;string<span> <em>vector start end</em></span>)  procedure<br />
(string-&gt;vector<span> <em>string</em></span>)  procedure<br />
(string-&gt;vector<span> <em>string start</em></span>)  procedure<br />
(string-&gt;vector<span> <em>string start end</em></span>)  procedure<br />
<span>It is an error if any element of <em>vector</em> between <em>start</em> and <em>end</em> is not a character.</span></p>
<p>The <span>vector-&gt;string</span> procedure returns a newly allocated string of the objects contained in the elements of <em>vector</em> between <em>start</em> and <em>end</em>. The <span>string-&gt;vector</span> procedure returns a newly created vector initialized to the elements of the string <em>string</em> between <em>start</em> and <em>end</em>.</p>
<p>In both procedures, order is preserved.</p>
<pre><code>(string-&gt;vector &quot;ABC&quot;)  \ev   \#(\#\backwhack{}A \#\backwhack{}B \#\backwhack{}C)
(vector-&gt;string
  \#(\#\backwhack{}1 \#\backwhack{}2 \#\backwhack{}3) \ev &quot;123&quot;</code></pre>
<p>(vector-copy<span> <em>vector</em></span>)  procedure<br />
(vector-copy<span> <em>vector start</em></span>)  procedure<br />
(vector-copy<span> <em>vector start end</em></span>)  procedure<br />
Returns a newly allocated copy of the elements of the given <em>vector</em> between <em>start</em> and <em>end</em>. The elements of the new vector are the same (in the sense of <span>eqv?</span>) as the elements of the old.</p>
<pre><code>(define a \#(1 8 2 8)) ; a may be immutable
(define b (vector-copy a))
(vector-set! b 0 3)   ; b is mutable
b \ev \#(3 8 2 8)
(define c (vector-copy b 1 3))
c \ev \#(8 2)%</code></pre>
<p>(vector-copy!<span> <em>to at from</em></span>)  procedure<br />
(vector-copy!<span> <em>to at from start</em></span>)  procedure<br />
(vector-copy!<span> <em>to at from start end</em></span>)  procedure<br />
<span>It is an error if <em>at</em> is less than zero or greater than the length of <em>to</em>. It is also an error if <span>(- (vector-length <em>to</em>) <em>at</em>)</span> is less than <span>(- <em>end</em> <em>start</em>)</span>.</span></p>
<p>Copies the elements of vector <em>from</em> between <em>start</em> and <em>end</em> to vector <em>to</em>, starting at <em>at</em>. The order in which elements are copied is unspecified, except that if the source and destination overlap, copying takes place as if the source is first copied into a temporary vector and then into the destination. This can be achieved without allocating storage by making sure to copy in the correct direction in such circumstances.</p>
<pre><code>(define a (vector 1 2 3 4 5))
(define b (vector 10 20 30 40 50))
(vector-copy! b 1 a 0 2)
b \ev \#(10 1 2 40 50)%</code></pre>
<p>(vector-append<span> <em><em>vector</em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
Returns a newly allocated vector whose elements are the concatenation of the elements of the given vectors.</p>
<pre><code>(vector-append \#(a b c) \#(d e f)) \lev \#(a b c d e f)%</code></pre>
<p>(vector-fill!<span> <em>vector fill</em></span>)  procedure<br />
(vector-fill!<span> <em>vector fill start</em></span>)  procedure<br />
(vector-fill!<span> <em>vector fill start end</em></span>)  procedure<br />
The <span>vector-fill!</span> procedure stores <em>fill</em> in the elements of <em>vector</em> between <em>start</em> and <em>end</em>.</p>
<pre><code>(define a (vector 1 2 3 4 5))
(vector-fill! a &#39;smash 2 4)
a \lev \#(1 2 smash smash 5)%</code></pre>
<h2 id="bytevectors">Bytevectors</h2>
<p><span><em>Bytevectors</em></span> represent blocks of binary data. They are fixed-length sequences of bytes, where a <span><em>byte</em></span> is an exact integer in the range from 0 to 255 inclusive. A bytevector is typically more space-efficient than a vector containing the same values.</p>
<p>The <span><em>length</em></span> of a bytevector is the number of elements that it contains. This number is a non-negative integer that is fixed when the bytevector is created. The <span><em>valid indexes</em></span> of a bytevector are the exact non-negative integers less than the length of the bytevector, starting at index zero as with vectors.</p>
<p>Bytevectors are written using the notation <span><code>#u8(byte \ldots\,)</code></span>. For example, a bytevector of length 3 containing the byte 0 in element 0, the byte 10 in element 1, and the byte 5 in element 2 can be written as follows:</p>
<pre><code>\#u8(0 10 5)%</code></pre>
<p>Bytevector constants are self-evaluating, so they do not need to be quoted in programs.</p>
<p>(bytevector?<span> <em>obj</em></span>)  procedure<br />
Returns #<span>t</span> if <em>obj</em> is a bytevector. Otherwise, #<span>f</span> is returned.</p>
<p>(make-bytevector<span> <em>k</em></span>)  procedure<br />
(make-bytevector<span> <em>k byte</em></span>)  procedure<br />
The <span>make-bytevector</span> procedure returns a newly allocated bytevector of length <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span>. If <em>byte</em> is given, then all elements of the bytevector are initialized to <em>byte</em>, otherwise the contents of each element are unspecified.</p>
<pre><code>(make-bytevector 2 12) \ev \#u8(12 12)%</code></pre>
<p>(bytevector<span> <em><em>byte</em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
Returns a newly allocated bytevector containing its arguments.</p>
<pre><code>(bytevector 1 3 5 1 3 5)        \ev  \#u8(1 3 5 1 3 5)
(bytevector)                          \ev  \#u8()%</code></pre>
<p>(bytevector-length<span> <em>bytevector</em></span>)  procedure<br />
Returns the length of <em>bytevector</em> in bytes as an exact integer.</p>
<p>(bytevector-u8-ref<span> <em>bytevector k</em></span>)  procedure<br />
<span>It is an error if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> is not a valid index of <em>bytevector</em>.</span></p>
<p>Returns the <em>k</em>th byte of <em>bytevector</em>.</p>
<pre><code>(bytevector-u8-ref &#39;\#u8(1 1 2 3 5 8 13 21)
            5)  \lev  8%</code></pre>
<p>(bytevector-u8-set!<span> <em>bytevector k byte</em></span>)  procedure<br />
<span>It is an error if <span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math></span> is not a valid index of <em>bytevector</em>.</span></p>
<p>Stores <em>byte</em> as the <em>k</em>th byte of <em>bytevector</em>.</p>
<pre><code>(let ((bv (bytevector 1 2 3 4)))
  (bytevector-u8-set! bv 1 3)
  bv) \lev \#u8(1 3 3 4)%</code></pre>
<p>(bytevector-copy<span> <em>bytevector</em></span>)  procedure<br />
(bytevector-copy<span> <em>bytevector start</em></span>)  procedure<br />
(bytevector-copy<span> <em>bytevector start end</em></span>)  procedure<br />
Returns a newly allocated bytevector containing the bytes in <em>bytevector</em> between <em>start</em> and <em>end</em>.</p>
<pre><code>(define a \#u8(1 2 3 4 5))
(bytevector-copy a 2 4)) \ev \#u8(3 4)%</code></pre>
<p>(bytevector-copy!<span> <em>to at from</em></span>)  procedure<br />
(bytevector-copy!<span> <em>to at from start</em></span>)  procedure<br />
(bytevector-copy!<span> <em>to at from start end</em></span>)  procedure<br />
<span>It is an error if <em>at</em> is less than zero or greater than the length of <em>to</em>. It is also an error if <span>(- (bytevector-length <em>to</em>) <em>at</em>)</span> is less than <span>(- <em>end</em> <em>start</em>)</span>.</span></p>
<p>Copies the bytes of bytevector <em>from</em> between <em>start</em> and <em>end</em> to bytevector <em>to</em>, starting at <em>at</em>. The order in which bytes are copied is unspecified, except that if the source and destination overlap, copying takes place as if the source is first copied into a temporary bytevector and then into the destination. This can be achieved without allocating storage by making sure to copy in the correct direction in such circumstances.</p>
<pre><code>(define a (bytevector 1 2 3 4 5))
(define b (bytevector 10 20 30 40 50))
(bytevector-copy! b 1 a 0 2)
b \ev \#u8(10 1 2 40 50)%</code></pre>
<p><span><em>Note:</em></span> This procedure appears in R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS, but places the source before the destination, contrary to other such procedures in Scheme.</p>
<p>(bytevector-append<span> <em><em>bytevector</em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
Returns a newly allocated bytevector whose elements are the concatenation of the elements in the given bytevectors.</p>
<pre><code>(bytevector-append \#u8(0 1 2) \#u8(3 4 5)) \lev \#u8(0 1 2 3 4 5)%</code></pre>
<p>(utf8-&gt;string<span> <em>bytevector</em></span>)  procedure<br />
(utf8-&gt;string<span> <em>bytevector start</em></span>)  procedure<br />
(utf8-&gt;string<span> <em>bytevector start end</em></span>)  procedure<br />
(string-&gt;utf8<span> <em>string</em></span>)  procedure<br />
(string-&gt;utf8<span> <em>string start</em></span>)  procedure<br />
(string-&gt;utf8<span> <em>string start end</em></span>)  procedure<br />
<span>It is an error for <em>bytevector</em> to contain invalid UTF-8 byte sequences.</span></p>
<p>These procedures translate between strings and bytevectors that encode those strings using the UTF-8 encoding. The <span>utf8string</span> procedure decodes the bytes of a bytevector between <em>start</em> and <em>end</em> and returns the corresponding string; the <span>stringutf8</span> procedure encodes the characters of a string between <em>start</em> and <em>end</em> and returns the corresponding bytevector.</p>
<pre><code>(utf8-&gt;string \#u8(\#x41)) \ev &quot;A&quot;
(string-&gt;utf8 &quot;$\lambda$&quot;) \ev \#u8(\#xCE \#xBB)%</code></pre>
<h2 id="control-features">Control features</h2>
<p>This section describes various primitive procedures which control the flow of program execution in special ways. Procedures in this section that invoke procedure arguments always do so in the same dynamic environment as the call of the original procedure. The <span>procedure?</span> predicate is also described here.</p>
<p>(procedure?<span> <em>obj</em></span>)  procedure<br />
Returns #<span>t</span> if <em>obj</em> is a procedure, otherwise returns #<span>f</span>.</p>
<pre><code>(procedure? car)            \ev  \schtrue
(procedure? &#39;car)           \ev  \schfalse
(procedure? (lambda (x) (* x x)))   
                            \ev  \schtrue
(procedure? &#39;(lambda (x) (* x x)))  
                            \ev  \schfalse
(call-with-current-continuation procedure?)
                            \ev  \schtrue%</code></pre>
<p>(apply<span> <em>proc <em>arg<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math> args</em></span>)  procedure<br />
The <span>apply</span> procedure calls <em>proc</em> with the elements of the list <span>(append (list <em>arg<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math>) <em>args</em>)</span> as the actual arguments.</p>
<pre><code>(apply + (list 3 4))              \ev  7

(define compose
  (lambda (f g)
    (lambda args
      (f (apply g args)))))

((compose sqrt *) 12 75)              \ev  30%</code></pre>
<p>(map<span> <em>proc <em>list<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>list<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
<span>It is an error if <em>proc</em> does not accept as many arguments as there are <span><em>list</em></span>s and return a single value.</span></p>
<p>The <span>map</span> procedure applies <em>proc</em> element-wise to the elements of the <em>list</em>s and returns a list of the results, in order. If more than one <em>list</em> is given and not all lists have the same length, <span>map</span> terminates when the shortest list runs out. The <em>list</em>s can be circular, but it is an error if all of them are circular. It is an error for <em>proc</em> to mutate any of the lists. The dynamic order in which <em>proc</em> is applied to the elements of the <em>list</em>s is unspecified. If multiple returns occur from <span>map</span>, the values returned by earlier returns are not mutated.</p>
<pre><code>(map cadr &#39;((a b) (d e) (g h)))   \lev  (b e h)

(map (lambda (n) (expt n n))
     &#39;(1 2 3 4 5))                \lev  (1 4 27 256 3125)

(map + &#39;(1 2 3) &#39;(4 5 6 7))         \ev  (5 7 9)

(let ((count 0))
  (map (lambda (ignored)
         (set! count (+ count 1))
         count)
       &#39;(a b)))                 \ev  (1 2) \var{or} (2 1)%</code></pre>
<p>(string-map<span> <em>proc <em>string<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>string<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
<span>It is an error if <em>proc</em> does not accept as many arguments as there are <span><em>string</em></span>s and return a single character.</span></p>
<p>The <span>string-map</span> procedure applies <em>proc</em> element-wise to the elements of the <em>string</em>s and returns a string of the results, in order. If more than one <em>string</em> is given and not all strings have the same length, <span>string-map</span> terminates when the shortest string runs out. The dynamic order in which <em>proc</em> is applied to the elements of the <em>string</em>s is unspecified. If multiple returns occur from <span>string-map</span>, the values returned by earlier returns are not mutated.</p>
<pre><code>(string-map char-foldcase &quot;AbdEgH&quot;) \lev  &quot;abdegh&quot;

(string-map
 (lambda (c)
   (integer-&gt;char (+ 1 (char-&gt;integer c))))
 &quot;HAL&quot;)                \lev  &quot;IBM&quot;

(string-map
 (lambda (c k)
   ((if (eqv? k \sharpsign\backwhack{}u) char-upcase char-downcase)
    c))
 &quot;studlycaps xxx&quot;
 &quot;ululululul&quot;)   \lev   &quot;StUdLyCaPs&quot;%</code></pre>
<p>(vector-map<span> <em>proc <em>vector<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>vector<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
<span>It is an error if <em>proc</em> does not accept as many arguments as there are <span><em>vector</em></span>s and return a single value.</span></p>
<p>The <span>vector-map</span> procedure applies <em>proc</em> element-wise to the elements of the <em>vector</em>s and returns a vector of the results, in order. If more than one <em>vector</em> is given and not all vectors have the same length, <span>vector-map</span> terminates when the shortest vector runs out. The dynamic order in which <em>proc</em> is applied to the elements of the <em>vector</em>s is unspecified. If multiple returns occur from <span>vector-map</span>, the values returned by earlier returns are not mutated.</p>
<pre><code>(vector-map cadr &#39;\#((a b) (d e) (g h)))   \lev  \#(b e h)

(vector-map (lambda (n) (expt n n))
            &#39;\#(1 2 3 4 5))                \lev  \#(1 4 27 256 3125)

(vector-map + &#39;\#(1 2 3) &#39;\#(4 5 6 7))       \lev  \#(5 7 9)

(let ((count 0))
  (vector-map
   (lambda (ignored)
     (set! count (+ count 1))
     count)
   &#39;\#(a b)))                     \ev  \#(1 2) \var{or} \#(2 1)%</code></pre>
<p>(for-each<span> <em>proc <em>list<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>list<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
<span>It is an error if <em>proc</em> does not accept as many arguments as there are <span><em>list</em></span>s.</span></p>
<p>The arguments to <span>for-each</span> are like the arguments to <span>map</span>, but <span>for-each</span> calls <em>proc</em> for its side effects rather than for its values. Unlike <span>map</span>, <span>for-each</span> is guaranteed to call <em>proc</em> on the elements of the <em>list</em>s in order from the first element(s) to the last, and the value returned by <span>for-each</span> is unspecified. If more than one <em>list</em> is given and not all lists have the same length, <span>for-each</span> terminates when the shortest list runs out. The <em>list</em>s can be circular, but it is an error if all of them are circular.</p>
<p>It is an error for <em>proc</em> to mutate any of the lists.</p>
<pre><code>(let ((v (make-vector 5)))
  (for-each (lambda (i)
              (vector-set! v i (* i i)))
            &#39;(0 1 2 3 4))
  v)                                \ev  \#(0 1 4 9 16)%</code></pre>
<p>(string-for-each<span> <em>proc <em>string<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>string<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
<span>It is an error if <em>proc</em> does not accept as many arguments as there are <span><em>string</em></span>s.</span></p>
<p>The arguments to <span>string-for-each</span> are like the arguments to <span> string-map</span>, but <span>string-for-each</span> calls <em>proc</em> for its side effects rather than for its values. Unlike <span>string-map</span>, <span> string-for-each</span> is guaranteed to call <em>proc</em> on the elements of the <em>string</em>s in order from the first element(s) to the last, and the value returned by <span>string-for-each</span> is unspecified. If more than one <em>string</em> is given and not all strings have the same length, <span>string-for-each</span> terminates when the shortest string runs out. It is an error for <em>proc</em> to mutate any of the strings.</p>
<pre><code>(let ((v &#39;()))
  (string-for-each
   (lambda (c) (set! v (cons (char-&gt;integer c) v)))
   &quot;abcde&quot;)
  v)                         \ev  (101 100 99 98 97)%</code></pre>
<p>(vector-for-each<span> <em>proc <em>vector<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math></em> <em>vector<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math></em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  procedure<br />
<span>It is an error if <em>proc</em> does not accept as many arguments as there are <span><em>vector</em></span>s.</span></p>
<p>The arguments to <span>vector-for-each</span> are like the arguments to <span> vector-map</span>, but <span>vector-for-each</span> calls <em>proc</em> for its side effects rather than for its values. Unlike <span>vector-map</span>, <span> vector-for-each</span> is guaranteed to call <em>proc</em> on the elements of the <em>vector</em>s in order from the first element(s) to the last, and the value returned by <span>vector-for-each</span> is unspecified. If more than one <em>vector</em> is given and not all vectors have the same length, <span>vector-for-each</span> terminates when the shortest vector runs out. It is an error for <em>proc</em> to mutate any of the vectors.</p>
<pre><code>(let ((v (make-list 5)))
  (vector-for-each
   (lambda (i) (list-set! v i (* i i)))
   &#39;\#(0 1 2 3 4))
  v)                                \ev  (0 1 4 9 16)%</code></pre>
<p>(call-with-current-continuation<span> <em>proc</em></span>)  procedure<br />
(call/cc<span> <em>proc</em></span>)  procedure<br />
<span>It is an error if <em>proc</em> does not accept one argument.</span></p>
<p>The procedure <span>call-with-current-continuation</span> (or its equivalent abbreviation <span>call/cc</span>) packages the current continuation (see the rationale below) as an “escape procedure” and passes it as an argument to <em>proc</em>. The escape procedure is a Scheme procedure that, if it is later called, will abandon whatever continuation is in effect at that later time and will instead use the continuation that was in effect when the escape procedure was created. Calling the escape procedure will cause the invocation of <em>before</em> and <em>after</em> thunks installed using <span><code>dynamic-wind</code></span>.</p>
<p>The escape procedure accepts the same number of arguments as the continuation to the original call to <span><code>call-with-current-continuation</code></span>. Most continuations take only one value. Continuations created by the <span>call-with-values</span> procedure (including the initialization expressions of <span>define-values</span>, <span>let-values</span>, and <span>let*-values</span> expressions), take the number of values that the consumer expects. The continuations of all non-final expressions within a sequence of expressions, such as in <span>lambda</span>, <span>case-lambda</span>, <span>begin</span>, <span>let</span>, <span>let*</span>, <span>letrec</span>, <span>letrec*</span>, <span>let-values</span>, <span>let*-values</span>, <span>let-syntax</span>, <span>letrec-syntax</span>, <span>parameterize</span>, <span>guard</span>, <span>case</span>, <span>cond</span>, <span>when</span>, and <span>unless</span> expressions, take an arbitrary number of values because they discard the values passed to them in any event. The effect of passing no values or more than one value to continuations that were not created in one of these ways is unspecified.</p>
<p>The escape procedure that is passed to <em>proc</em> has unlimited extent just like any other procedure in Scheme. It can be stored in variables or data structures and can be called as many times as desired. However, like the <span>raise</span> and <span>error</span> procedures, it never returns to its caller.</p>
<p>The following examples show only the simplest ways in which <span>call-with-current-continuation</span> is used. If all real uses were as simple as these examples, there would be no need for a procedure with the power of <span>call-with-current-continuation</span>.</p>
<pre><code>(call-with-current-continuation
  (lambda (exit)
    (for-each (lambda (x)
                (if (negative? x)
                    (exit x)))
              &#39;(54 0 37 -3 245 19))
    \schtrue))                        \ev  -3

(define list-length
  (lambda (obj)
    (call-with-current-continuation
      (lambda (return)
        (letrec ((r
                  (lambda (obj)
                    (cond ((null? obj) 0)
                          ((pair? obj)
                           (+ (r (cdr obj)) 1))
                          (else (return \schfalse))))))
          (r obj))))))

(list-length &#39;(1 2 3 4))            \ev  4

(list-length &#39;(a b . c))            \ev  \schfalse%</code></pre>
<p><span><em>Rationale:</em></span></p>
<p>A common use of <span>call-with-current-continuation</span> is for structured, non-local exits from loops or procedure bodies, but in fact <span>call-with-current-continuation</span> is useful for implementing a wide variety of advanced control structures. In fact, <span>raise</span> and <span>guard</span> provide a more structured mechanism for non-local exits.</p>
<p>Whenever a Scheme expression is evaluated there is a <span><em>continuation</em></span> wanting the result of the expression. The continuation represents an entire (default) future for the computation. If the expression is evaluated at the REPL, for example, then the continuation might take the result, print it on the screen, prompt for the next input, evaluate it, and so on forever. Most of the time the continuation includes actions specified by user code, as in a continuation that will take the result, multiply it by the value stored in a local variable, add seven, and give the answer to the REPL’s continuation to be printed. Normally these ubiquitous continuations are hidden behind the scenes and programmers do not think much about them. On rare occasions, however, a programmer needs to deal with continuations explicitly. The <span>call-with-current-continuation</span> procedure allows Scheme programmers to do that by creating a procedure that acts just like the current continuation.</p>
<p>(values<span> <em>obj <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></em></span>)  procedure<br />
Delivers all of its arguments to its continuation. The <span><code>values</code></span> procedure might be defined as follows:</p>
<pre><code>(define (values . things)
  (call-with-current-continuation 
    (lambda (cont) (apply cont things))))%</code></pre>
<p>(call-with-values<span> <em>producer consumer</em></span>)  procedure<br />
Calls its <em>producer</em> argument with no arguments and a continuation that, when passed some values, calls the <em>consumer</em> procedure with those values as arguments. The continuation for the call to <em>consumer</em> is the continuation of the call to <span><code>call-with-values</code></span>.</p>
<pre><code>(call-with-values (lambda () (values 4 5))
                  (lambda (a b) b))
                                                   \ev  5

(call-with-values * -)                             \ev  -1%</code></pre>
<p>(dynamic-wind<span> <em>before thunk after</em></span>)  procedure<br />
Calls <em>thunk</em> without arguments, returning the result(s) of this call. <em>Before</em> and <em>after</em> are called, also without arguments, as required by the following rules. Note that, in the absence of calls to continuations captured using <span><code>call-with-current-continuation</code></span>, the three arguments are called once each, in order. <em>Before</em> is called whenever execution enters the dynamic extent of the call to <em>thunk</em> and <em>after</em> is called whenever it exits that dynamic extent. The dynamic extent of a procedure call is the period between when the call is initiated and when it returns. The <em>before</em> and <em>after</em> thunks are called in the same dynamic environment as the call to <span>dynamic-wind</span>. In Scheme, because of <span>call-with-current-continuation</span>, the dynamic extent of a call is not always a single, connected time period. It is defined as follows:</p>
<ul>
<li><p>The dynamic extent is entered when execution of the body of the called procedure begins.</p></li>
<li><p>The dynamic extent is also entered when execution is not within the dynamic extent and a continuation is invoked that was captured (using <span>call-with-current-continuation</span>) during the dynamic extent.</p></li>
<li><p>It is exited when the called procedure returns.</p></li>
<li><p>It is also exited when execution is within the dynamic extent and a continuation is invoked that was captured while not within the dynamic extent.</p></li>
</ul>
<p>If a second call to <span>dynamic-wind</span> occurs within the dynamic extent of the call to <em>thunk</em> and then a continuation is invoked in such a way that the <em>after</em>s from these two invocations of <span>dynamic-wind</span> are both to be called, then the <em>after</em> associated with the second (inner) call to <span>dynamic-wind</span> is called first.</p>
<p>If a second call to <span>dynamic-wind</span> occurs within the dynamic extent of the call to <em>thunk</em> and then a continuation is invoked in such a way that the <em>before</em>s from these two invocations of <span>dynamic-wind</span> are both to be called, then the <em>before</em> associated with the first (outer) call to <span>dynamic-wind</span> is called first.</p>
<p>If invoking a continuation requires calling the <em>before</em> from one call to <span>dynamic-wind</span> and the <em>after</em> from another, then the <em>after</em> is called first.</p>
<p>The effect of using a captured continuation to enter or exit the dynamic extent of a call to <em>before</em> or <em>after</em> is unspecified.</p>
<pre><code>(let ((path &#39;())
      (c \#f))
  (let ((add (lambda (s)
               (set! path (cons s path)))))
    (dynamic-wind
      (lambda () (add &#39;connect))
      (lambda ()
        (add (call-with-current-continuation
               (lambda (c0)
                 (set! c c0)
                 &#39;talk1))))
      (lambda () (add &#39;disconnect)))
    (if (&lt; (length path) 4)
        (c &#39;talk2)
        (reverse path))))
    \lev (connect talk1 disconnect
               connect talk2 disconnect)%</code></pre>
<h2 id="exceptions">Exceptions</h2>
<p>This section describes Scheme’s exception-handling and exception-raising procedures. For the concept of Scheme exceptions, see section <a href="#errorsituations" data-reference-type="ref" data-reference="errorsituations">[errorsituations]</a>. See also <a href="#guard" data-reference-type="ref" data-reference="guard">[guard]</a> for the <span>guard</span> syntax.</p>
<p><span><em>Exception handler</em></span>s are one-argument procedures that determine the action the program takes when an exceptional situation is signaled. The system implicitly maintains a current exception handler in the dynamic environment.</p>
<p>The program raises an exception by invoking the current exception handler, passing it an object encapsulating information about the exception. Any procedure accepting one argument can serve as an exception handler and any object can be used to represent an exception.</p>
<p>(with-exception-handler<span> <em><em>handler</em> <em>thunk</em></em></span>)  procedure<br />
<span>It is an error if <em>handler</em> does not accept one argument. It is also an error if <em>thunk</em> does not accept zero arguments.</span></p>
<p>The <span>with-exception-handler</span> procedure returns the results of invoking <em>thunk</em>. <em>Handler</em> is installed as the current exception handler in the dynamic environment used for the invocation of <em>thunk</em>.</p>
<pre><code>(call-with-current-continuation
 (lambda (k)
  (with-exception-handler
   (lambda (x)
    (display &quot;condition: &quot;)
    (write x)
    (newline)
    (k &#39;exception))
   (lambda ()
    (+ 1 (raise &#39;an-error))))))
        \ev exception
 \&gt;{\em and prints}  condition: an-error

(with-exception-handler
 (lambda (x)
  (display &quot;something went wrong\backwhack{}n&quot;))
 (lambda ()
  (+ 1 (raise &#39;an-error))))
 \&gt;{\em prints}  something went wrong%</code></pre>
<p>After printing, the second example then raises another exception.</p>
<p>(raise<span> <em><em>obj</em></em></span>)  procedure<br />
Raises an exception by invoking the current exception handler on <em>obj</em>. The handler is called with the same dynamic environment as that of the call to <span>raise</span>, except that the current exception handler is the one that was in place when the handler being called was installed. If the handler returns, a secondary exception is raised in the same dynamic environment as the handler. The relationship between <em>obj</em> and the object raised by the secondary exception is unspecified.</p>
<p>(raise-continuable<span> <em><em>obj</em></em></span>)  procedure<br />
Raises an exception by invoking the current exception handler on <em>obj</em>. The handler is called with the same dynamic environment as the call to <span>raise-continuable</span>, except that: (1) the current exception handler is the one that was in place when the handler being called was installed, and (2) if the handler being called returns, then it will again become the current exception handler. If the handler returns, the values it returns become the values returned by the call to <span>raise-continuable</span>.</p>
<pre><code>(with-exception-handler
  (lambda (con)
    (cond
      ((string? con)
       (display con))
      (else
       (display &quot;a warning has been issued&quot;)))
    42)
  (lambda ()
    (+ (raise-continuable &quot;should be a number&quot;)
       23)))
   {\it prints:} should be a number
   \ev 65%</code></pre>
<p>(error<span> <em><em>message</em> <em>obj</em> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>…</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math></em></span>)  procedure<br />
<span><em>Message</em> should be a string.</span></p>
<p>Raises an exception as if by calling <span>raise</span> on a newly allocated implementation-defined object which encapsulates the information provided by <em>message</em>, as well as any <em>obj</em>s, known as the <span><em>irritants</em></span>. The procedure <span>error-object?</span> must return #<span>t</span> on such objects.</p>
<pre><code>(define (null-list? l)
  (cond ((pair? l) \#f)
        ((null? l) \#t)
        (else
          (error
            &quot;null-list?: argument out of domain&quot;
            l))))%</code></pre>
<p>(error-object?<span> <em>obj</em></span>)  procedure<br />
Returns #<span>t</span> if <em>obj</em> is an object created by <span>error</span> or one of an implementation-defined set of objects. Otherwise, it returns #<span>f</span>. The objects used to signal errors, including those which satisfy the predicates <span>file-error?</span> and <span>read-error?</span>, may or may not satisfy <span>error-object?</span>.</p>
<p>(error-object-message<span> <em>error-object</em></span>)  procedure<br />
Returns the message encapsulated by <em>error-object</em>.</p>
<p>(error-object-irritants<span> <em>error-object</em></span>)  procedure<br />
Returns a list of the irritants encapsulated by <em>error-object</em>.</p>
<p>(read-error?<span> <em>obj</em></span>)  procedure<br />
(file-error?<span> <em>obj</em></span>)  procedure<br />
Error type predicates. Returns #<span>t</span> if <em>obj</em> is an object raised by the <span>read</span> procedure or by the inability to open an input or output port on a file, respectively. Otherwise, it returns #<span>f</span>.</p>
<h2 id="environments-and-evaluation">Environments and evaluation</h2>
<p>(environment<span> <em><span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>i</mi><mi>s</mi><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">list_1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>…</mi><mspace width="0.167em"></mspace></mrow><annotation encoding="application/x-tex">\ldots\,</annotation></semantics></math></em></span>)  eval library procedure<br />
This procedure returns a specifier for the environment that results by starting with an empty environment and then importing each <em>list</em>, considered as an import set, into it. (See section <a href="#libraries" data-reference-type="ref" data-reference="libraries">[libraries]</a> for a description of import sets.) The bindings of the environment represented by the specifier are immutable, as is the environment itself.</p>
<p>(scheme-report-environment<span> <em>version</em></span>)  r5rs library procedure<br />
If <em>version</em> is equal to <span>5</span>, corresponding to R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS, <span>scheme-report-environment</span> returns a specifier for an environment that contains only the bindings defined in the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS library. Implementations must support this value of <em>version</em>.</p>
<p>Implementations may also support other values of <em>version</em>, in which case they return a specifier for an environment containing bindings corresponding to the specified version of the report. If <em>version</em> is neither <span>5</span> nor another value supported by the implementation, an error is signaled.</p>
<p>The effect of defining or assigning (through the use of <span>eval</span>) an identifier bound in a <span>scheme-report-environment</span> (for example <span>car</span>) is unspecified. Thus both the environment and the bindings it contains may be immutable.</p>
<p>(null-environment<span> <em>version</em></span>)  r5rs library procedure<br />
If <em>version</em> is equal to <span>5</span>, corresponding to R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS, the <span>null-environment</span> procedure returns a specifier for an environment that contains only the bindings for all syntactic keywords defined in the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS library. Implementations must support this value of <em>version</em>.</p>
<p>Implementations may also support other values of <em>version</em>, in which case they return a specifier for an environment containing appropriate bindings corresponding to the specified version of the report. If <em>version</em> is neither <span>5</span> nor another value supported by the implementation, an error is signaled.</p>
<p>The effect of defining or assigning (through the use of <span>eval</span>) an identifier bound in a <span>scheme-report-environment</span> (for example <span>car</span>) is unspecified. Thus both the environment and the bindings it contains may be immutable.</p>
<p>(interaction-environment<span><em></em></span>)  repl library procedure<br />
This procedure returns a specifier for a mutable environment that contains an implementation-defined set of bindings, typically a superset of those exported by <span>(scheme base)</span>. The intent is that this procedure will return the environment in which the implementation would evaluate expressions entered by the user into a REPL.</p>
<p>(eval<span> <em>expr-or-def environment-specifier</em></span>)  eval library procedure<br />
If <em>expr-or-def</em> is an expression, it is evaluated in the specified environment and its values are returned. If it is a definition, the specified identifier(s) are defined in the specified environment, provided the environment is not immutable. Implementations may extend <span>eval</span> to allow other objects.</p>
<pre><code>(eval &#39;(* 7 3) (environment &#39;(scheme base)))
                                                   \ev  21

(let ((f (eval &#39;(lambda (f x) (f x x))
               (null-environment 5))))
  (f + 10))
                                                   \ev  20
(eval &#39;(define foo 32)
      (environment &#39;(scheme base)))
                                                   \ev {\it{} error is signaled}%</code></pre>
<h2 id="input-and-output">Input and output</h2>
<h3 id="ports">Ports</h3>
<p>Ports represent input and output devices. To Scheme, an input port is a Scheme object that can deliver data upon command, while an output port is a Scheme object that can accept data. Whether the input and output port types are disjoint is implementation-dependent.</p>
<p>Different <span><em>port types</em></span> operate on different data. Scheme implementations are required to support <span><em>textual ports</em></span> and <span><em>binary ports</em></span>, but may also provide other port types.</p>
<p>A textual port supports reading or writing of individual characters from or to a backing store containing characters using <span>read-char</span> and <span>write-char</span> below, and it supports operations defined in terms of characters, such as <span>read</span> and <span>write</span>.</p>
<p>A binary port supports reading or writing of individual bytes from or to a backing store containing bytes using <span>read-u8</span> and <span> write-u8</span> below, as well as operations defined in terms of bytes. Whether the textual and binary port types are disjoint is implementation-dependent.</p>
<p>Ports can be used to access files, devices, and similar things on the host system on which the Scheme program is running.</p>
<p>(call-with-port<span> <em>port proc</em></span>)  procedure<br />
<span>It is an error if <em>proc</em> does not accept one argument.</span></p>
<p>The <span>call-with-port</span> procedure calls <em>proc</em> with <em>port</em> as an argument. If <em>proc</em> returns, then the port is closed automatically and the values yielded by the <em>proc</em> are returned. If <em>proc</em> does not return, then the port must not be closed automatically unless it is possible to prove that the port will never again be used for a read or write operation.</p>
<p><span><em>Rationale:</em></span> Because Scheme’s escape procedures have unlimited extent, it is possible to escape from the current continuation but later to resume it. If implementations were permitted to close the port on any escape from the current continuation, then it would be impossible to write portable code using both <span>call-with-current-continuation</span> and <span>call-with-port</span>.</p>
<p>(call-with-input-file<span> <em>string proc</em></span>)  file library procedure<br />
(call-with-output-file<span> <em>string proc</em></span>)  file library procedure<br />
<span>It is an error if <em>proc</em> does not accept one argument.</span></p>
<p>These procedures obtain a textual port obtained by opening the named file for input or output as if by <span>open-input-file</span> or <span>open-output-file</span>. The port and <em>proc</em> are then passed to a procedure equivalent to <span>call-with-port</span>.</p>
<p>(input-port?<span> <em>obj</em></span>)  procedure<br />
(output-port?<span> <em>obj</em></span>)  procedure<br />
(textual-port?<span> <em>obj</em></span>)  procedure<br />
(binary-port?<span> <em>obj</em></span>)  procedure<br />
(port?<span> <em>obj</em></span>)  procedure<br />
These procedures return #<span>t</span> if <em>obj</em> is an input port, output port, textual port, binary port, or any kind of port, respectively. Otherwise they return #<span>f</span>.</p>
<p>(input-port-open?<span> <em>port</em></span>)  procedure<br />
(output-port-open?<span> <em>port</em></span>)  procedure<br />
Returns #<span>t</span> if <em>port</em> is still open and capable of performing input or output, respectively, and #<span>f</span> otherwise.</p>
<p>(current-input-port<span><em></em></span>)  procedure<br />
(current-output-port<span><em></em></span>)  procedure<br />
(current-error-port<span><em></em></span>)  procedure<br />
Returns the current default input port, output port, or error port (an output port), respectively. These procedures are parameter objects, which can be overridden with <span>parameterize</span> (see section <a href="#make-parameter" data-reference-type="ref" data-reference="make-parameter">[make-parameter]</a>). The initial bindings for these are implementation-defined textual ports.</p>
<p>(with-input-from-file<span> <em>string thunk</em></span>)  file library procedure<br />
(with-output-to-file<span> <em>string thunk</em></span>)  file library procedure<br />
The file is opened for input or output as if by <span>open-input-file</span> or <span>open-output-file</span>, and the new port is made to be the value returned by <span>current-input-port</span> or <span>current-output-port</span> (as used by <span><code>(read)</code></span>, <span><code>(write obj)</code></span>, and so forth). The <em>thunk</em> is then called with no arguments. When the <em>thunk</em> returns, the port is closed and the previous default is restored. It is an error if <em>thunk</em> does not accept zero arguments. Both procedures return the values yielded by <em>thunk</em>. If an escape procedure is used to escape from the continuation of these procedures, they behave exactly as if the current input or output port had been bound dynamically with <span>parameterize</span>.</p>
<p>(open-input-file<span> <em>string</em></span>)  file library procedure<br />
(open-binary-input-file<span> <em>string</em></span>)  file library procedure<br />
Takes a <em>string</em> for an existing file and returns a textual input port or binary input port that is capable of delivering data from the file. If the file does not exist or cannot be opened, an error that satisfies <span>file-error?</span> is signaled.</p>
<p>(open-output-file<span> <em>string</em></span>)  file library procedure<br />
(open-binary-output-file<span> <em>string</em></span>)  file library procedure<br />
Takes a <em>string</em> naming an output file to be created and returns a textual output port or binary output port that is capable of writing data to a new file by that name.</p>
<p>If a file with the given name already exists, the effect is unspecified. If the file cannot be opened, an error that satisfies <span>file-error?</span> is signaled.</p>
<p>(close-port<span> <em>port</em></span>)  procedure<br />
(close-input-port<span> <em>port</em></span>)  procedure<br />
(close-output-port<span> <em>port</em></span>)  procedure<br />
Closes the resource associated with <em>port</em>, rendering the <em>port</em> incapable of delivering or accepting data. It is an error to apply the last two procedures to a port which is not an input or output port, respectively. Scheme implementations may provide ports which are simultaneously input and output ports, such as sockets; the <span>close-input-port</span> and <span>close-output-port</span> procedures can then be used to close the input and output sides of the port independently.</p>
<p>These routines have no effect if the port has already been closed.</p>
<p>(open-input-string<span> <em>string</em></span>)  procedure<br />
Takes a string and returns a textual input port that delivers characters from the string. If the string is modified, the effect is unspecified.</p>
<p>(open-output-string<span><em></em></span>)  procedure<br />
Returns a textual output port that will accumulate characters for retrieval by <span>get-output-string</span>.</p>
<p>(get-output-string<span> <em>port</em></span>)  procedure<br />
<span>It is an error if <em>port</em> was not created with <span>open-output-string</span>.</span></p>
<p>Returns a string consisting of the characters that have been output to the port so far in the order they were output. If the result string is modified, the effect is unspecified.</p>
<pre><code>(parameterize
    ((current-output-port
      (open-output-string)))
    (display &quot;piece&quot;)
    (display &quot; by piece &quot;)
    (display &quot;by piece.&quot;)
    (newline)
    (get-output-string (current-output-port)))
\lev &quot;piece by piece by piece.\backwhack{}n&quot;%</code></pre>
<p>(open-input-bytevector<span> <em>bytevector</em></span>)  procedure<br />
Takes a bytevector and returns a binary input port that delivers bytes from the bytevector.</p>
<p>(open-output-bytevector<span><em></em></span>)  procedure<br />
Returns a binary output port that will accumulate bytes for retrieval by <span>get-output-bytevector</span>.</p>
<p>(get-output-bytevector<span> <em>port</em></span>)  procedure<br />
<span>It is an error if <em>port</em> was not created with <span>open-output-bytevector</span>.</span></p>
<p>Returns a bytevector consisting of the bytes that have been output to the port so far in the order they were output.</p>
<h3 id="input">Input</h3>
<p>If <em>port</em> is omitted from any input procedure, it defaults to the value returned by <span>(current-input-port)</span>. It is an error to attempt an input operation on a closed port.</p>
<p> </p>
<p>(read<span><em></em></span>)  read library procedure<br />
(read<span> <em>port</em></span>)  read library procedure<br />
The <span>read</span> procedure converts external representations of Scheme objects into the objects themselves. That is, it is a parser for the non-terminal <span>datum</span> (see sections <a href="#datum" data-reference-type="ref" data-reference="datum">[datum]</a> and <a href="#listsection" data-reference-type="ref" data-reference="listsection">[listsection]</a>). It returns the next object parsable from the given textual input <em>port</em>, updating <em>port</em> to point to the first character past the end of the external representation of the object.</p>
<p>Implementations may support extended syntax to represent record types or other types that do not have datum representations.</p>
<p>If an end of file is encountered in the input before any characters are found that can begin an object, then an end-of-file object is returned. The port remains open, and further attempts to read will also return an end-of-file object. If an end of file is encountered after the beginning of an object’s external representation, but the external representation is incomplete and therefore not parsable, an error that satisfies <span>read-error?</span> is signaled.</p>
<p>(read-char<span><em></em></span>)  procedure<br />
(read-char<span> <em>port</em></span>)  procedure<br />
Returns the next character available from the textual input <em>port</em>, updating the <em>port</em> to point to the following character. If no more characters are available, an end-of-file object is returned.</p>
<p>(peek-char<span><em></em></span>)  procedure<br />
(peek-char<span> <em>port</em></span>)  procedure<br />
Returns the next character available from the textual input <em>port</em>, but <span><em>without</em></span> updating the <em>port</em> to point to the following character. If no more characters are available, an end-of-file object is returned.</p>
<p><span><em>Note:</em></span> The value returned by a call to <span>peek-char</span> is the same as the value that would have been returned by a call to <span>read-char</span> with the same <em>port</em>. The only difference is that the very next call to <span>read-char</span> or <span>peek-char</span> on that <em>port</em> will return the value returned by the preceding call to <span>peek-char</span>. In particular, a call to <span>peek-char</span> on an interactive port will hang waiting for input whenever a call to <span>read-char</span> would have hung.</p>
<p>(read-line<span><em></em></span>)  procedure<br />
(read-line<span> <em>port</em></span>)  procedure<br />
Returns the next line of text available from the textual input <em>port</em>, updating the <em>port</em> to point to the following character. If an end of line is read, a string containing all of the text up to (but not including) the end of line is returned, and the port is updated to point just past the end of line. If an end of file is encountered before any end of line is read, but some characters have been read, a string containing those characters is returned. If an end of file is encountered before any characters are read, an end-of-file object is returned. For the purpose of this procedure, an end of line consists of either a linefeed character, a carriage return character, or a sequence of a carriage return character followed by a linefeed character. Implementations may also recognize other end of line characters or sequences.</p>
<p>(eof-object?<span> <em>obj</em></span>)  procedure<br />
Returns #<span>t</span> if <em>obj</em> is an end-of-file object, otherwise returns #<span>f</span>. The precise set of end-of-file objects will vary among implementations, but in any case no end-of-file object will ever be an object that can be read in using <span>read</span>.</p>
<p>(eof-object<span><em></em></span>)  procedure<br />
Returns an end-of-file object, not necessarily unique.</p>
<p>(char-ready?<span><em></em></span>)  procedure<br />
(char-ready?<span> <em>port</em></span>)  procedure<br />
Returns #<span>t</span> if a character is ready on the textual input <em>port</em> and returns #<span>f</span> otherwise. If <span>char-ready</span> returns #<span>t</span> then the next <span>read-char</span> operation on the given <em>port</em> is guaranteed not to hang. If the <em>port</em> is at end of file then <span>char-ready?</span> returns #<span>t</span>.</p>
<p><span><em>Rationale:</em></span> The <span>char-ready?</span> procedure exists to make it possible for a program to accept characters from interactive ports without getting stuck waiting for input. Any input editors associated with such ports must ensure that characters whose existence has been asserted by <span>char-ready?</span> cannot be removed from the input. If <span>char-ready?</span> were to return #<span>f</span> at end of file, a port at end of file would be indistinguishable from an interactive port that has no ready characters.</p>
<p>(read-string<span> <em>k</em></span>)  procedure<br />
(read-string<span> <em>k port</em></span>)  procedure<br />
Reads the next <em>k</em> characters, or as many as are available before the end of file, from the textual input <em>port</em> into a newly allocated string in left-to-right order and returns the string. If no characters are available before the end of file, an end-of-file object is returned.</p>
<p>(read-u8<span><em></em></span>)  procedure<br />
(read-u8<span> <em>port</em></span>)  procedure<br />
Returns the next byte available from the binary input <em>port</em>, updating the <em>port</em> to point to the following byte. If no more bytes are available, an end-of-file object is returned.</p>
<p>(peek-u8<span><em></em></span>)  procedure<br />
(peek-u8<span> <em>port</em></span>)  procedure<br />
Returns the next byte available from the binary input <em>port</em>, but <span><em>without</em></span> updating the <em>port</em> to point to the following byte. If no more bytes are available, an end-of-file object is returned.</p>
<p>(u8-ready?<span><em></em></span>)  procedure<br />
(u8-ready?<span> <em>port</em></span>)  procedure<br />
Returns #<span>t</span> if a byte is ready on the binary input <em>port</em> and returns #<span>f</span> otherwise. If <span>u8-ready?</span> returns #<span>t</span> then the next <span>read-u8</span> operation on the given <em>port</em> is guaranteed not to hang. If the <em>port</em> is at end of file then <span>u8-ready?</span> returns #<span>t</span>.</p>
<p>(read-bytevector<span> <em>k</em></span>)  procedure<br />
(read-bytevector<span> <em>k port</em></span>)  procedure<br />
Reads the next <em>k</em> bytes, or as many as are available before the end of file, from the binary input <em>port</em> into a newly allocated bytevector in left-to-right order and returns the bytevector. If no bytes are available before the end of file, an end-of-file object is returned.</p>
<p>(read-bytevector!<span> <em>bytevector</em></span>)  procedure<br />
(read-bytevector!<span> <em>bytevector port</em></span>)  procedure<br />
(read-bytevector!<span> <em>bytevector port start</em></span>)  procedure<br />
(read-bytevector!<span> <em>bytevector port start end</em></span>)  procedure<br />
Reads the next <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>n</mi><mi>d</mi><mo>−</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">end - start</annotation></semantics></math> bytes, or as many as are available before the end of file, from the binary input <em>port</em> into <em>bytevector</em> in left-to-right order beginning at the <em>start</em> position. If <em>end</em> is not supplied, reads until the end of <em>bytevector</em> has been reached. If <em>start</em> is not supplied, reads beginning at position 0. Returns the number of bytes read. If no bytes are available, an end-of-file object is returned.</p>
<h3 id="output">Output</h3>
<p>If <em>port</em> is omitted from any output procedure, it defaults to the value returned by <span>(current-output-port)</span>. It is an error to attempt an output operation on a closed port.</p>
<p>(write<span> <em>obj</em></span>)  write library procedure<br />
(write<span> <em>obj port</em></span>)  write library procedure<br />
Writes a representation of <em>obj</em> to the given textual output <em>port</em>. Strings that appear in the written representation are enclosed in quotation marks, and within those strings backslash and quotation mark characters are escaped by backslashes. Symbols that contain non-ASCII characters are escaped with vertical lines. Character objects are written using the <span>#<span><code>‘ </code></span></span> notation.</p>
<p>If <em>obj</em> contains cycles which would cause an infinite loop using the normal written representation, then at least the objects that form part of the cycle must be represented using datum labels as described in section <a href="#labelsection" data-reference-type="ref" data-reference="labelsection">[labelsection]</a>. Datum labels must not be used if there are no cycles.</p>
<p>Implementations may support extended syntax to represent record types or other types that do not have datum representations.</p>
<p>The <span>write</span> procedure returns an unspecified value.</p>
<p>(write-shared<span> <em>obj</em></span>)  write library procedure<br />
(write-shared<span> <em>obj port</em></span>)  write library procedure<br />
The <span>write-shared</span> procedure is the same as <span>write</span>, except that shared structure must be represented using datum labels for all pairs and vectors that appear more than once in the output.</p>
<p>(write-simple<span> <em>obj</em></span>)  write library procedure<br />
(write-simple<span> <em>obj port</em></span>)  write library procedure<br />
The <span>write-simple</span> procedure is the same as <span>write</span>, except that shared structure is never represented using datum labels. This can cause <span>write-simple</span> not to terminate if <em>obj</em> contains circular structure.</p>
<p>(display<span> <em>obj</em></span>)  write library procedure<br />
(display<span> <em>obj port</em></span>)  write library procedure<br />
Writes a representation of <em>obj</em> to the given textual output <em>port</em>. Strings that appear in the written representation are output as if by <span>write-string</span> instead of by <span>write</span>. Symbols are not escaped. Character objects appear in the representation as if written by <span>write-char</span> instead of by <span>write</span>.</p>
<p>The <span>display</span> representation of other objects is unspecified. However, <span>display</span> must not loop forever on self-referencing pairs, vectors, or records. Thus if the normal <span>write</span> representation is used, datum labels are needed to represent cycles as in <span>write</span>.</p>
<p>Implementations may support extended syntax to represent record types or other types that do not have datum representations.</p>
<p>The <span>display</span> procedure returns an unspecified value.</p>
<p><span><em>Rationale:</em></span> The <span>write</span> procedure is intended for producing machine-readable output and <span>display</span> for producing human-readable output.</p>
<p>(newline<span><em></em></span>)  procedure<br />
(newline<span> <em>port</em></span>)  procedure<br />
Writes an end of line to textual output <em>port</em>. Exactly how this is done differs from one operating system to another. Returns an unspecified value.</p>
<p>(write-char<span> <em>char</em></span>)  procedure<br />
(write-char<span> <em>char port</em></span>)  procedure<br />
Writes the character <em>char</em> (not an external representation of the character) to the given textual output <em>port</em> and returns an unspecified value.</p>
<p>(write-string<span> <em>string</em></span>)  procedure<br />
(write-string<span> <em>string port</em></span>)  procedure<br />
(write-string<span> <em>string port start</em></span>)  procedure<br />
(write-string<span> <em>string port start end</em></span>)  procedure<br />
Writes the characters of <em>string</em> from <em>start</em> to <em>end</em> in left-to-right order to the textual output <em>port</em>.</p>
<p>(write-u8<span> <em>byte</em></span>)  procedure<br />
(write-u8<span> <em>byte port</em></span>)  procedure<br />
Writes the <em>byte</em> to the given binary output <em>port</em> and returns an unspecified value.</p>
<p>(write-bytevector<span> <em>bytevector</em></span>)  procedure<br />
(write-bytevector<span> <em>bytevector port</em></span>)  procedure<br />
(write-bytevector<span> <em>bytevector port start</em></span>)  procedure<br />
(write-bytevector<span> <em>bytevector port start end</em></span>)  procedure<br />
Writes the bytes of <em>bytevector</em> from <em>start</em> to <em>end</em> in left-to-right order to the binary output <em>port</em>.</p>
<p>(flush-output-port<span><em></em></span>)  procedure<br />
(flush-output-port<span> <em>port</em></span>)  procedure<br />
Flushes any buffered output from the buffer of output-port to the underlying file or device and returns an unspecified value.</p>
<h2 id="system-interface">System interface</h2>
<p>Questions of system interface generally fall outside of the domain of this report. However, the following operations are important enough to deserve description here.</p>
<p>(load<span> <em>filename</em></span>)  load library procedure<br />
(load<span> <em>filename environment-specifier</em></span>)  load library procedure<br />
<span>It is an error if <em>filename</em> is not a string.</span></p>
<p>An implementation-dependent operation is used to transform <em>filename</em> into the name of an existing file containing Scheme source code. The <span>load</span> procedure reads expressions and definitions from the file and evaluates them sequentially in the environment specified by <em>environment-specifier</em>. If <em>environment-specifier</em> is omitted, <span>(interaction-environment)</span> is assumed.</p>
<p>It is unspecified whether the results of the expressions are printed. The <span>load</span> procedure does not affect the values returned by <span>current-input-port</span> and <span>current-output-port</span>. It returns an unspecified value.</p>
<p><span><em>Rationale:</em></span> For portability, <span>load</span> must operate on source files. Its operation on other kinds of files necessarily varies among implementations.</p>
<p>(file-exists?<span> <em>filename</em></span>)  file library procedure<br />
<span>It is an error if <em>filename</em> is not a string.</span></p>
<p>The <span>file-exists?</span> procedure returns #<span>t</span> if the named file exists at the time the procedure is called, and #<span>f</span> otherwise.</p>
<p>(delete-file<span> <em>filename</em></span>)  file library procedure<br />
<span>It is an error if <em>filename</em> is not a string.</span></p>
<p>The <span>delete-file</span> procedure deletes the named file if it exists and can be deleted, and returns an unspecified value. If the file does not exist or cannot be deleted, an error that satisfies <span>file-error?</span> is signaled.</p>
<p>(command-line<span><em></em></span>)  process-context library procedure<br />
Returns the command line passed to the process as a list of strings. The first string corresponds to the command name, and is implementation-dependent. It is an error to mutate any of these strings.</p>
<p>(exit<span><em></em></span>)  process-context library procedure<br />
(exit<span> <em>obj</em></span>)  process-context library procedure<br />
Runs all outstanding dynamic-wind <em>after</em> procedures, terminates the running program, and communicates an exit value to the operating system. If no argument is supplied, or if <em>obj</em> is #<span>t</span>, the <span> exit</span> procedure should communicate to the operating system that the program exited normally. If <em>obj</em> is #<span>f</span>, the <span>exit</span> procedure should communicate to the operating system that the program exited abnormally. Otherwise, <span>exit</span> should translate <em>obj</em> into an appropriate exit value for the operating system, if possible.</p>
<p>The <span>exit</span> procedure must not signal an exception or return to its continuation.</p>
<p><span><em>Note:</em></span> Because of the requirement to run handlers, this procedure is not just the operating system’s exit procedure.</p>
<p>(emergency-exit<span><em></em></span>)  process-context library procedure<br />
(emergency-exit<span> <em>obj</em></span>)  process-context library procedure<br />
Terminates the program without running any outstanding dynamic-wind <em>after</em> procedures and communicates an exit value to the operating system in the same manner as <span>exit</span>.</p>
<p><span><em>Note:</em></span> The <span>emergency-exit</span> procedure corresponds to the <span>_exit</span> procedure in Windows and Posix.</p>
<p>(get-environment-variable<span> <em>name</em></span>)  process-context library procedure<br />
Many operating systems provide each running process with an <span><em>environment</em></span> consisting of <span><em>environment variables</em></span>. (This environment is not to be confused with the Scheme environments that can be passed to <span>eval</span>: see section <a href="#environments" data-reference-type="ref" data-reference="environments">[environments]</a>.) Both the name and value of an environment variable are strings. The procedure <span>get-environment-variable</span> returns the value of the environment variable <em>name</em>, or #<span>f</span> if the named environment variable is not found. It may use locale information to encode the name and decode the value of the environment variable. It is an error if<br />
<span>get-environment-variable</span> can’t decode the value. It is also an error to mutate the resulting string.</p>
<pre><code>(get-environment-variable &quot;PATH&quot;) \lev &quot;/usr/local/bin:/usr/bin:/bin&quot;%</code></pre>
<p>(get-environment-variables<span><em></em></span>)  process-context library procedure<br />
Returns the names and values of all the environment variables as an alist, where the car of each entry is the name of an environment variable and the cdr is its value, both as strings. The order of the list is unspecified. It is an error to mutate any of these strings or the alist itself.</p>
<pre><code>(get-environment-variables) \lev ((&quot;USER&quot; . &quot;root&quot;) (&quot;HOME&quot; . &quot;/&quot;))%</code></pre>
<p>(current-second<span><em></em></span>)  time library procedure<br />
Returns an inexact number representing the current time on the International Atomic Time (TAI) scale. The value 0.0 represents midnight on January 1, 1970 TAI (equivalent to 8.000082 seconds before midnight Universal Time) and the value 1.0 represents one TAI second later. Neither high accuracy nor high precision are required; in particular, returning Coordinated Universal Time plus a suitable constant might be the best an implementation can do.</p>
<p>As of 2018, a TAI-UTC offset table can be found at <span class="citation" data-cites="TAI"></span>.</p>
<p>(current-jiffy<span><em></em></span>)  time library procedure<br />
Returns the number of <span><em>jiffies</em></span> as an exact integer that have elapsed since an arbitrary, implementation-defined epoch. A jiffy is an implementation-defined fraction of a second which is defined by the return value of the <span>jiffies-per-second</span> procedure. The starting epoch is guaranteed to be constant during a run of the program, but may vary between runs.</p>
<p><span><em>Rationale:</em></span> Jiffies are allowed to be implementation-dependent so that <span>current-jiffy</span> can execute with minimum overhead. It should be very likely that a compactly represented integer will suffice as the returned value. Any particular jiffy size will be inappropriate for some implementations: a microsecond is too long for a very fast machine, while a much smaller unit would force many implementations to return integers which have to be allocated for most calls, rendering <span>current-jiffy</span> less useful for accurate timing measurements.</p>
<p>(jiffies-per-second<span><em></em></span>)  time library procedure<br />
Returns an exact integer representing the number of jiffies per SI second. This value is an implementation-specified constant.</p>
<pre><code>(define (time-length)
  (let ((list (make-list 100000))
        (start (current-jiffy)))
    (length list)
    (/ (- (current-jiffy) start)
       (jiffies-per-second))))%</code></pre>
<p>(features<span><em></em></span>)  procedure<br />
Returns a list of the feature identifiers which <span>cond-expand</span> treats as true. It is an error to modify this list. Here is an example of what <span>features</span> might return:</p>
<pre><code>(features) \ev
  (r7rs ratios exact-complex full-unicode
   gnu-linux little-endian 
   fantastic-scheme
   fantastic-scheme-1.0
   space-ship-control-system)%</code></pre>
<h1 id="formal-syntax-and-semantics">Formal syntax and semantics</h1>
<p>This chapter provides formal descriptions of what has already been described informally in previous chapters of this report.</p>
<h2 id="formal-syntax">Formal syntax</h2>
<p>This section provides a formal syntax for Scheme written in an extended BNF.</p>
<p>All spaces in the grammar are for legibility. Case is not significant except in the definitions of <span>letter</span>, <span>character name</span> and <span>mnemonic escape</span>; for example, <span>#x1A</span> and <span>#X1a</span> are equivalent, but <span>foo</span> and <span>Foo</span> and <span>#<span><code>‘ </code></span>space</span> and <span>#<span><code>‘ </code></span>Space</span> are distinct. <span>empty</span> stands for the empty string.</p>
<p>The following extensions to BNF are used to make the description more concise: <span>thing</span> means zero or more occurrences of <span>thing</span>; and <span>thing</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> means at least one <span>thing</span>.</p>
<h3 id="lexical-structure">Lexical structure</h3>
<p>This section describes how individual tokens (identifiers, numbers, etc.) are formed from sequences of characters. The following sections describe how expressions and programs are formed from sequences of tokens.</p>
<p><span>Intertoken space</span> can occur on either side of any token, but not within a token.</p>
<p>Identifiers that do not begin with a vertical line are terminated by a <span>delimiter</span> or by the end of the input. So are dot, numbers, characters, and booleans. Identifiers that begin with a vertical line are terminated by another vertical line.</p>
<p>The following four characters from the ASCII repertoire are reserved for future extensions to the language: <span><code>[ ] { }</code></span></p>
<p>In addition to the identifier characters of the ASCII repertoire specified below, Scheme implementations may permit any additional repertoire of non-ASCII Unicode characters to be employed in identifiers, provided that each such character has a Unicode general category of Lu, Ll, Lt, Lm, Lo, Mn, Mc, Me, Nd, Nl, No, Pd, Pc, Po, Sc, Sm, Sk, So, or Co, or is U+200C or U+200D (the zero-width non-joiner and joiner, respectively, which are needed for correct spelling in Persian, Hindi, and other languages). However, it is an error for the first character to have a general category of Nd, Mc, or Me. It is also an error to use a non-Unicode character in symbols or identifiers.</p>
<p>All Scheme implementations must permit the escape sequence <span><code>‘ x&lt;hexdigits&gt;;</code></span> to appear in Scheme identifiers that are enclosed in vertical lines. If the character with the given Unicode scalar value is supported by the implementation, identifiers containing such a sequence are equivalent to identifiers containing the corresponding character.</p>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>token</span> ⟶ <span>identifier</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>boolean</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>number</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>character</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>string</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ( <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>#</code></span>( <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>#</code></span>u8( <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>’</code></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code></code></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> , <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ,@ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><strong>.</strong></span> <span>delimiter</span> ⟶ <span>whitespace</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>vertical line</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ( <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> " <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ; <span>intraline whitespace</span> ⟶ <span>space or tab</span> <span>whitespace</span> ⟶ <span>intraline whitespace</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>line ending</span> <span>vertical line</span> ⟶ | <span>line ending</span> ⟶ <span>newline</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>return</span> <span>newline</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>return</span> <span>comment</span> ⟶ ; ̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="prefix">⟨</mo><annotation encoding="application/x-tex">\langle</annotation></semantics></math>all subsequent characters up to a  line ending<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">⟩</mo><annotation encoding="application/x-tex">\rangle</annotation></semantics></math> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>nested comment</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #; <span>intertoken space</span> <span>datum</span> <span>nested comment</span> ⟶ #| c̄omment text <span>comment cont</span> |# <span>comment text</span> ⟶ ̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="prefix">⟨</mo><annotation encoding="application/x-tex">\langle</annotation></semantics></math>character sequence not containing  <span><code>#|</code></span> or <span><code>|#</code></span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">⟩</mo><annotation encoding="application/x-tex">\rangle</annotation></semantics></math> <span>comment cont</span> ⟶ <span>nested comment</span> <span>comment text</span> <span>directive</span> ⟶ #!fold-case <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #!no-fold-case</p>
<p>Note that it is ungrammatical to follow a <span>directive</span> with anything but a <span>delimiter</span> or the end of file.</p>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>atmosphere</span> ⟶ <span>whitespace</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>comment</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>directive</span> <span>intertoken space</span> ⟶ <span>atmosphere</span></p>
<p><span>identifier</span> ⟶ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="prefix">⟨</mo><annotation encoding="application/x-tex">\langle</annotation></semantics></math></p>
<p>Note that <span>+i</span>, <span>-i</span> and <span>infnan</span> below are exceptions to the <span>peculiar identifier</span> rule; they are parsed as numbers, not identifiers.</p>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>identifier</span> ⟶ <span>initial</span> <span>subsequent</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>vertical line</span> <span>symbol element</span> <span>vertical line</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>peculiar identifier</span> <span>initial</span> ⟶ <span>letter</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>special initial</span> <span>letter</span> ⟶ a <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> b <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> c <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ... <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> z <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> A <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> B <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> C <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ... <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> Z <span>special initial</span> ⟶ ! <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> $ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> % <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <code>&amp;</code> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> * <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> / <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> : <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> &lt; <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> = <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> &gt; <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ? <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> @ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <code>^</code> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <code>_</code> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <code>~</code> <span>subsequent</span> ⟶ <span>initial</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>digit</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>special subsequent</span> <span>digit</span> ⟶ 0 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 1 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 2 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 3 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 4 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 5 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 6 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 7 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 8 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 9 <span>hex digit</span> ⟶ <span>digit</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> a <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> b <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> c <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> d <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> e <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> f <span>explicit sign</span> ⟶ + <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> - <span>special subsequent</span> ⟶ <span>explicit sign</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> . <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> @ <span>inline hex escape</span> ⟶ <span><code>‘ </code></span>x<span>hex scalar value</span>; <span>hex scalar value</span> ⟶ <span>hex digit</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> <span>mnemonic escape</span> ⟶ <span><code>‘ </code></span>a <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>‘ </code></span>b <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>‘ </code></span>t <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>‘ </code></span>n <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>‘ </code></span>r <span>peculiar identifier</span> ⟶ <span>explicit sign</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>explicit sign</span> <span>sign subsequent</span> <span>subsequent</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>explicit sign</span> . <span>dot subsequent</span> <span>subsequent</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> . <span>dot subsequent</span> <span>subsequent</span> <span>dot subsequent</span> ⟶ <span>sign subsequent</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> . <span>sign subsequent</span> ⟶ <span>initial</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>explicit sign</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> @ <span>symbol element</span> ⟶ <span>any character other than <span>vertical line</span> or <span><code>‘ </code></span></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>inline hex escape</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>mnemonic escape</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>‘ </code></span>|</p>
<p><span>boolean</span> ⟶ #<span>t</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #<span>f</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #<span>true</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #<span>false</span></p>
<p><span>character</span> ⟶ #<span><code>‘ </code></span> <span>any character</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #<span><code>‘ </code></span> <span>character name</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #<span><code>‘ </code></span>x<span>hex scalar value</span> <span>character name</span> ⟶ alarm <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> backspace <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> delete <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> escape <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> newline <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> null <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> return <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> space <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> tab</p>
<p><span>string</span> ⟶ " <span>string element</span> " <span>string element</span> ⟶ <span>any character other than <span><code>"</code></span> or <span><code>‘ </code></span></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>mnemonic escape</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>‘ </code></span><span><code>"</code></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>‘ </code></span><span><code>‘ </code></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>‘ </code></span>| <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span><code>‘ </code></span><span>intraline whitespace</span><span>line ending</span> <span>intraline whitespace</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>inline hex escape</span> <span>bytevector</span> ⟶ #u8(<span>byte</span>) <span>byte</span> ⟶ <span>any exact integer between 0 and 255</span></p>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>number</span> ⟶ <span>num <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>num <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>8</mn><annotation encoding="application/x-tex">8</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>num <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>num <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>16</mn><annotation encoding="application/x-tex">16</annotation></semantics></math></span></p>
<p>The following rules for <span>num <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span>, <span>complex <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span>, <span>real <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span>, <span>ureal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span>, <span>uinteger <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span>, and <span>prefix <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> are implicitly replicated for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>=</mo><mn>2</mn><mo>,</mo><mn>8</mn><mo>,</mo><mn>10</mn><mo>,</mo></mrow><annotation encoding="application/x-tex">R = 2, 8, 10,</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>16</mn><annotation encoding="application/x-tex">16</annotation></semantics></math>. There are no rules for <span>decimal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math></span>, <span>decimal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>8</mn><annotation encoding="application/x-tex">8</annotation></semantics></math></span>, and <span>decimal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>16</mn><annotation encoding="application/x-tex">16</annotation></semantics></math></span>, which means that numbers containing decimal points or exponents are always in decimal radix. Although not shown below, all alphabetic characters used in the grammar of numbers can appear in either upper or lower case. ̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>num <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> ⟶ <span>prefix <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <span>complex <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <span>complex <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> ⟶ <span>real <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>real <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> @ <span>real <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>real <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> + <span>ureal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> i <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>real <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> - <span>ureal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> i <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>real <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> + i <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>real <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> - i <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>real <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <span>infnan</span> i <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> + <span>ureal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> i <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> - <span>ureal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> i <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>infnan</span> i <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> + i <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> - i <span>real <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> ⟶ <span>sign</span> <span>ureal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>infnan</span> <span>ureal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> ⟶ <span>uinteger <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>uinteger <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> / <span>uinteger <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>decimal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <span>decimal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math></span> ⟶ <span>uinteger <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math></span> <span>suffix</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> . <span>digit <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math></span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> <span>suffix</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>digit <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math></span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> . <span>digit <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math></span> <span>suffix</span> <span>uinteger <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> ⟶ <span>digit <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> <span>prefix <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> ⟶ <span>radix <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <span>exactness</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>exactness</span> <span>radix <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math></span> <span>infnan</span> ⟶ +inf.0 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> -inf.0 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> +nan.0 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> -nan.0</p>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>suffix</span> ⟶ <span>empty</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>exponent marker</span> <span>sign</span> <span>digit <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math></span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> <span>exponent marker</span> ⟶ e <span>sign</span> ⟶ <span>empty</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> + <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> - <span>exactness</span> ⟶ <span>empty</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #i <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #e <span>radix 2</span> ⟶ #b <span>radix 8</span> ⟶ #o <span>radix 10</span> ⟶ <span>empty</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #d <span>radix 16</span> ⟶ #x <span>digit 2</span> ⟶ 0 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 1 <span>digit 8</span> ⟶ 0 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 1 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 2 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 3 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 4 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 5 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 6 <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> 7 <span>digit 10</span> ⟶ <span>digit</span> <span>digit 16</span> ⟶ <span>digit <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> a <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> b <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> c <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> d <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> e <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> f</p>
<h3 id="external-representations-1">External representations</h3>
<p><span>Datum</span> is what the <span><code>read</code></span> procedure (section <a href="#read" data-reference-type="ref" data-reference="read">[read]</a>) successfully parses. Note that any string that parses as an <span>expression</span> will also parse as a <span>datum</span>.</p>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>datum</span> ⟶ <span>simple datum</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>compound datum</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>label</span> = <span>datum</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>label</span> # <span>simple datum</span> ⟶ <span>boolean</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>number</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>character</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>string</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>symbol</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>bytevector</span> <span>symbol</span> ⟶ <span>identifier</span> <span>compound datum</span> ⟶ <span>list</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>vector</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>abbreviation</span> <span>list</span> ⟶ (<span>datum</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>datum</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> . <span>datum</span>) <span>abbreviation</span> ⟶ <span>abbrev prefix</span> <span>datum</span> <span>abbrev prefix</span> ⟶ ’ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ‘ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> , <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ,@ <span>vector</span> ⟶ #(<span>datum</span>) <span>label</span> ⟶ # <span>uinteger 10</span></p>
<h3 id="expressions-1">Expressions</h3>
<p>The definitions in this and the following subsections assume that all the syntax keywords defined in this report have been properly imported from their libraries, and that none of them have been redefined or shadowed.</p>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>expression</span> ⟶ <span>identifier</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>literal</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>procedure call</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>lambda expression</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>conditional</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>assignment</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>derived expression</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>macro use</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>macro block</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>includer</span></p>
<p><span>literal</span> ⟶ <span>quotation</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>self-evaluating</span> <span>self-evaluating</span> ⟶ <span>boolean</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>number</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>vector</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>character</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>string</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>bytevector</span> <span>quotation</span> ⟶ ’<span>datum</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (quote <span>datum</span>) <span>procedure call</span> ⟶ (<span>operator</span> <span>operand</span>) <span>operator</span> ⟶ <span>expression</span> <span>operand</span> ⟶ <span>expression</span></p>
<p><span>lambda expression</span> ⟶ (lambda <span>formals</span> <span>body</span>) <span>formals</span> ⟶ (<span>identifier</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>identifier</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>identifier</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> . <span>identifier</span>) <span>body</span> ⟶ <span>definition</span> <span>sequence</span> <span>sequence</span> ⟶ <span>command</span> <span>expression</span> <span>command</span> ⟶ <span>expression</span></p>
<p><span>conditional</span> ⟶ (if <span>test</span> <span>consequent</span> <span>alternate</span>) <span>test</span> ⟶ <span>expression</span> <span>consequent</span> ⟶ <span>expression</span> <span>alternate</span> ⟶ <span>expression</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>empty</span></p>
<p><span>assignment</span> ⟶ (set! <span>identifier</span> <span>expression</span>)</p>
<p><span>derived expression</span> ⟶ (cond <span>cond clause</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (cond <span>cond clause</span> (else <span>sequence</span>)) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (cāse <span>expression</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (cāse <span>expression</span> (else <span>sequence</span>)) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (cāse <span>expression</span> (else =&gt; <span>recipient</span>)) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (and <span>test</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (or <span>test</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (when <span>test</span> <span>sequence</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (unless <span>test</span> <span>sequence</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (let (<span>binding spec</span>) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (let <span>identifier</span> (<span>binding spec</span>) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (let* (<span>binding spec</span>) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (letrec (<span>binding spec</span>) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (letrec* (<span>binding spec</span>) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (let-values (<span>mv binding spec</span>) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (let*-values (<span>mv binding spec</span>) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (begin <span>sequence</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (dō (̄<span>iteration spec</span>) (<span>test</span> <span>do result</span>) ) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (delay <span>expression</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (delay-force <span>expression</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (pārameterize ((<span>expression</span> <span>expression</span>)) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (guard (<span>identifier</span> <span>cond clause</span>) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>quasiquotation</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (cāse-lambda <span>case-lambda clause</span>)</p>
<p><span>cond clause</span> ⟶ (<span>test</span> <span>sequence</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>test</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>test</span> =&gt; <span>recipient</span>) <span>recipient</span> ⟶ <span>expression</span> <span>case clause</span> ⟶ ((<span>datum</span>) <span>sequence</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ((<span>datum</span>) =&gt; <span>recipient</span>) <span>binding spec</span> ⟶ (<span>identifier</span> <span>expression</span>) <span>mv binding spec</span> ⟶ (<span>formals</span> <span>expression</span>) <span>iteration spec</span> ⟶ (<span>identifier</span> <span>init</span> <span>step</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>identifier</span> <span>init</span>) <span>case-lambda clause</span> ⟶ (<span>formals</span> <span>body</span>) <span>init</span> ⟶ <span>expression</span> <span>step</span> ⟶ <span>expression</span> <span>do result</span> ⟶ <span>sequence</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>empty</span></p>
<p><span>macro use</span> ⟶ (<span>keyword</span> <span>datum</span>) <span>keyword</span> ⟶ <span>identifier</span></p>
<p><span>macro block</span> ⟶ (let-syntax (<span>syntax spec</span>) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (letrec-syntax (<span>syntax spec</span>) <span>body</span>) <span>syntax spec</span> ⟶ (<span>keyword</span> <span>transformer spec</span>)</p>
<p><span>includer</span> ⟶ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (include <span>string</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (include-ci <span>string</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>)</p>
<h3 id="quasiquotations">Quasiquotations</h3>
<p>The following grammar for quasiquote expressions is not context-free. It is presented as a recipe for generating an infinite number of production rules. Imagine a copy of the following rules for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo>,</mo><mi>…</mi></mrow><annotation encoding="application/x-tex">D = 1, 2,
3, \ldots</annotation></semantics></math>, where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math> is the nesting depth.</p>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>quasiquotation</span> ⟶ <span>quasiquotation 1</span> <span>qq template 0</span> ⟶ <span>expression</span> <span>quasiquotation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> ⟶ ‘<span>qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (quasiquote <span>qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span>) <span>qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> ⟶ <span>simple datum</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>list qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>vector qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>unquotation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> <span>list qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> ⟶ (<span>qq template or splice <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>qq template or splice <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> . <span>qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ’<span>qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>quasiquotation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">D+1</annotation></semantics></math></span> <span>vector qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> ⟶ #(<span>qq template or splice <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span>) <span>unquotation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> ⟶ ,<span>qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">D-1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (unquote <span>qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">D-1</annotation></semantics></math></span>) <span>qq template or splice <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> ⟶ <span>qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>splicing unquotation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> <span>splicing unquotation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> ⟶ ,@<span>qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">D-1</annotation></semantics></math></span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (unquote-splicing <span>qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">D-1</annotation></semantics></math></span>)</p>
<p>In <span>quasiquotation</span>s, a <span>list qq template <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> can sometimes be confused with either an <span>unquotation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> or a <span>splicing unquotation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span>. The interpretation as an <span>unquotation</span> or <span>splicing unquotation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></span> takes precedence.</p>
<h3 id="transformers">Transformers</h3>
<p><span><em>Note:</em></span> Though this grammar does not say so, a top-level <span><code>syntax-rules</code></span> pattern must be a list pattern, not a vector pattern or an identifier pattern.</p>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>transformer spec</span> ⟶ (syntax-rules (<span>identifier</span>) <span>syntax rule</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (syntax-rules <span>identifier</span> (<span>identifier</span>)   <span>syntax rule</span>) <span>syntax rule</span> ⟶ (<span>pattern</span> <span>template</span>) <span>pattern</span> ⟶ <span>pattern identifier</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>underscore</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>pattern</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>pattern</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> . <span>pattern</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>pattern</span> <span>pattern</span> <span>ellipsis</span> <span>pattern</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>pattern</span> <span>pattern</span> <span>ellipsis</span> <span>pattern</span>   . <span>pattern</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #(<span>pattern</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #(<span>pattern</span> <span>pattern</span> <span>ellipsis</span> <span>pattern</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>pattern datum</span> <span>pattern datum</span> ⟶ <span>string</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>character</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>boolean</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>number</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>bytevector</span> <span>template</span> ⟶ <span>pattern identifier</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>template element</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>template element</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> . <span>template</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> #(<span>template element</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>template datum</span> <span>template element</span> ⟶ <span>template</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>template</span> <span>ellipsis</span> <span>template datum</span> ⟶ <span>pattern datum</span> <span>pattern identifier</span> ⟶ <span>any identifier except <span>...</span></span> <span>ellipsis</span> ⟶ <span>an identifier defaulting to <span>...</span></span> <span>underscore</span> ⟶ <span>the identifier <span>_</span></span></p>
<h3 id="programs-and-definitions">Programs and definitions</h3>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>program</span> ⟶ <span>import declaration</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> <span>command or definition</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> <span>command or definition</span> ⟶ <span>command</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>definition</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (begin <span>command or definition</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <span>definition</span> ⟶ (define <span>identifier</span> <span>expression</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (define (<span>identifier</span> <span>def formals</span>) <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>syntax definition</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (define-values <span>formals</span> <span>body</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (define-record-type <span>identifier</span>   <span>constructor</span> <span>identifier</span> <span>field spec</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (begin <span>definition</span>) <span>def formals</span> ⟶ <span>identifier</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>identifier</span> . <span>identifier</span> <span>constructor</span> ⟶ (<span>identifier</span> <span>field name</span>) <span>field spec</span> ⟶ (<span>field name</span> <span>accessor</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (<span>field name</span> <span>accessor</span> <span>mutator</span>) <span>field name</span> ⟶ <span>identifier</span> <span>accessor</span> ⟶ <span>identifier</span> <span>mutator</span> ⟶ <span>identifier</span> <span>syntax definition</span> ⟶ (define-syntax <span>keyword</span> <span>transformer spec</span>)</p>
<h3 id="libraries-1">Libraries</h3>
<p>̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄ <span>library</span> ⟶ (dēfine-library <span>library name</span> <span>library declaration</span>) <span>library name</span> ⟶ (<span>library name part</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <span>library name part</span> ⟶ <span>identifier</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>uinteger 10</span> <span>library declaration</span> ⟶ (export <span>export spec</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>import declaration</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (begin <span>command or definition</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> <span>includer</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (include-library-declarations <span>string</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (cond-expand <span>cond-expand clause</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (cond-expand <span>cond-expand clause</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math> to 1 (else <span>library declaration</span>)) <span>import declaration</span> ⟶ (import <span>import set</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <span>export spec</span> ⟶ <span>identifier</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (rename <span>identifier</span> <span>identifier</span>) <span>import set</span> ⟶ <span>library name</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (only <span>import set</span> <span>identifier</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (except <span>import set</span> <span>identifier</span><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (prefix <span>import set</span> <span>identifier</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (rename <span>import set</span> (<span>identifier</span> <span>identifier</span>)<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>+</mo></msup><annotation encoding="application/x-tex">^+</annotation></semantics></math>) <span>cond-expand clause</span> ⟶ (<span>feature requirement</span> <span>library declaration</span>) <span>feature requirement</span> ⟶ <span>identifier</span> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (library <span>library name</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (and <span>feature requirement</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (or <span>feature requirement</span>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (not <span>feature requirement</span>)</p>
<h2 id="formal-semantics">Formal semantics</h2>
<p>This section provides a formal denotational semantics for the primitive expressions of Scheme and selected built-in procedures. The concepts and notation used here are described in <span class="citation" data-cites="Stoy77"></span>; the definition of <span>dynamic-wind</span> is taken from <span class="citation" data-cites="GasbichlerKnauelSperberKelsey2003"></span>. The notation is summarized below:</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">⟨</mo><mspace width="0.167em"></mspace><mi>…</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">⟩</mo></mrow><annotation encoding="application/x-tex">\langle\,\ldots\,\rangle</annotation></semantics></math></td>
<td style="text-align: left;">sequence formation</td>
</tr>
<tr class="even">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>↓</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">s \downarrow k</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>th member of the sequence <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math> (1-based)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>#</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">\#s</annotation></semantics></math></td>
<td style="text-align: left;">length of sequence <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">$s ⟶{}\S⟶{} t$</span></td>
<td style="text-align: left;">concatenation of sequences <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>†</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">s \dagger k</annotation></semantics></math></td>
<td style="text-align: left;">drop the first <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> members of sequence <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>→</mo><mi>a</mi><mo>,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">t \rightarrow a, b</annotation></semantics></math></td>
<td style="text-align: left;">McCarthy conditional “if <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math> then <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math> else <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>”</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>x</mi><mi>/</mi><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\rho[x/i]</annotation></semantics></math></td>
<td style="text-align: left;">substitution “<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math> with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math> for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>”</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">$x\hbox{ \rm in }{D}$</span></td>
<td style="text-align: left;">injection of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math> into domain <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>D</mi></mrow><annotation encoding="application/x-tex">x\,\vert\,D</annotation></semantics></math></td>
<td style="text-align: left;">projection of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math> to domain <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math></td>
</tr>
</tbody>
</table>
<p>The reason that expression continuations take sequences of values instead of single values is to simplify the formal treatment of procedure calls and multiple return values.</p>
<p>The boolean flag associated with pairs, vectors, and strings will be true for mutable objects and false for immutable objects.</p>
<p>The order of evaluation within a call is unspecified. We mimic that here by applying arbitrary permutations <span><em>permute</em></span> and <span> <em>unpermute</em></span>, which must be inverses, to the arguments in a call before and after they are evaluated. This is not quite right since it suggests, incorrectly, that the order of evaluation is constant throughout a program (for any given number of arguments), but it is a closer approximation to the intended semantics than a left-to-right evaluation would be.</p>
<p>The storage allocator <span><em>new</em></span> is implementation-dependent, but it must obey the following axiom: if <span class="math inline">$\hbox{\it new}⟶{}\sigma⟶{}\hbox{\raise.13ex\hbox{$\scriptstyle\in$}}⟶{}{\tt{}L}$</span>, then <span class="math inline">$\sigma⟶{}(\hbox{\it new}⟶{}\sigma⟶{}\vert⟶{}{\tt{}L})\downarrow 2 = {\it false}$</span>.</p>
<p>The definition of <span class="math inline">$\hbox{$\cal K$}$</span> is omitted because an accurate definition of <span class="math inline">$\hbox{$\cal K$}$</span> would complicate the semantics without being very interesting.</p>
<p>If P is a program in which all variables are defined before being referenced or assigned, then the meaning of P is <span class="math display">$$\hbox{$\cal E$}[\![\hbox{((lambda (\hbox{\rm I}\hbox{\rm*}) \hbox{\rm P}')
{\hbox{\rm\&lt;undefined\&gt;}} $\ldots\,$)}]\!]$$</span> where I is the sequence of variables defined in P, <span class="math inline">$\hbox{\rm P}'$</span> is the sequence of expressions obtained by replacing every definition in P by an assignment, <span>undefined</span> is an expression that evaluates to <em>undefined</em>, and <span class="math inline">$\hbox{$\cal E$}$</span> is the semantic function that assigns meaning to expressions.</p>
<h3 id="abstract-syntax">Abstract syntax</h3>
<table>
<tbody>
<tr class="odd">
<td style="text-align: right;">K</td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;">Con</td>
<td style="text-align: left;">constants, including quotations</td>
</tr>
<tr class="even">
<td style="text-align: right;">I</td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;">Ide</td>
<td style="text-align: left;">identifiers (variables)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">E</td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;">Exp</td>
<td style="text-align: left;">expressions</td>
</tr>
<tr class="even">
<td style="text-align: right;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math></td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;">Com <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>=</mo><annotation encoding="application/x-tex">=</annotation></semantics></math> Exp</td>
<td style="text-align: left;">commands</td>
</tr>
</tbody>
</table>
<p>=Exp⟶ =to 1 ̄ <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> ̄</p>
<p>Exp ⟶ K <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> I <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (E<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>0</mn></msub><annotation encoding="application/x-tex">_0</annotation></semantics></math> E) (lambda (I) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math> E<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>0</mn></msub><annotation encoding="application/x-tex">_0</annotation></semantics></math>) (lambda (I <span><strong>.</strong></span> I) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math> E<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>0</mn></msub><annotation encoding="application/x-tex">_0</annotation></semantics></math>) (lambda I <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math> E<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>0</mn></msub><annotation encoding="application/x-tex">_0</annotation></semantics></math>) (if E<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>0</mn></msub><annotation encoding="application/x-tex">_0</annotation></semantics></math> E<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math> E<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math>) <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">|</mo><annotation encoding="application/x-tex">\vert</annotation></semantics></math> (if E<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>0</mn></msub><annotation encoding="application/x-tex">_0</annotation></semantics></math> E<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>1</mn></msub><annotation encoding="application/x-tex">_1</annotation></semantics></math>) (set! I E)</p>
<h3 id="domain-equations">Domain equations</h3>
<table>
<tbody>
<tr class="odd">
<td style="text-align: right;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;"><span><code>L</code></span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">locations</td>
</tr>
<tr class="even">
<td style="text-align: right;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ν</mi><annotation encoding="application/x-tex">\nu</annotation></semantics></math></td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;"><span><code>N</code></span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">natural numbers</td>
</tr>
<tr class="odd">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><span><code>T</code></span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="prefix">{</mo><annotation encoding="application/x-tex">\{</annotation></semantics></math><em>false, true<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo stretchy="false" form="postfix">}</mo><annotation encoding="application/x-tex">\}</annotation></semantics></math></em></td>
<td style="text-align: left;">booleans</td>
</tr>
<tr class="even">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><span><code>Q</code></span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">symbols</td>
</tr>
<tr class="odd">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><span><code>H</code></span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">characters</td>
</tr>
<tr class="even">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><span><code>R</code></span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">numbers</td>
</tr>
<tr class="odd">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><span><code>E</code></span><span class="math inline">$_{\rm p}$</span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"><span class="math inline">${\tt{}L}\times {\tt{}L}\times {\tt{}T}$</span></td>
<td style="text-align: left;">pairs</td>
</tr>
<tr class="even">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><span><code>E</code></span><span class="math inline">$_{\rm v}$</span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"><span class="math inline">${\tt{}L}\hbox{\rm*} \times {\tt{}T}$</span></td>
<td style="text-align: left;">vectors</td>
</tr>
<tr class="odd">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><span><code>E</code></span><span class="math inline">$_{\rm s}$</span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"><span class="math inline">${\tt{}L}\hbox{\rm*} \times {\tt{}T}$</span></td>
<td style="text-align: left;">strings</td>
</tr>
<tr class="even">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><span><code>M</code></span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">miscellaneous</td>
</tr>
<tr class="even">
<td style="text-align: right;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math></td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;"><span><code>F</code></span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"><span class="math inline">${\tt{}L}\times({\tt{}E}\hbox{\rm*} \to \tt{P}\to {\tt{}K}\to {\tt{}C})$</span></td>
<td style="text-align: left;">procedure values</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;"><span><code>E</code></span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">expressed values</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;"><span><code>S</code></span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"><span class="math inline">${\tt{}L}\to({\tt{}E}\times{\tt{}T})$</span></td>
<td style="text-align: left;">stores</td>
</tr>
<tr class="even">
<td style="text-align: right;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math></td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;"><span><code>U</code></span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"><span class="math inline">$\hbox{\rm Ide}\to{\tt{}L}$</span></td>
<td style="text-align: left;">environments</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math></td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;"><span><code>C</code></span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"><span class="math inline">${\tt{}S}\to{\tt{}A}$</span></td>
<td style="text-align: left;">command conts</td>
</tr>
<tr class="even">
<td style="text-align: right;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>κ</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math></td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;"><span><code>K</code></span></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"><span class="math inline">${\tt{}E}\hbox{\rm*}\to{\tt{}C}$</span></td>
<td style="text-align: left;">expression conts</td>
</tr>
<tr class="odd">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><span><code>A</code></span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">answers</td>
</tr>
<tr class="even">
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><span><code>X</code></span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">errors</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ω</mi><annotation encoding="application/x-tex">\omega</annotation></semantics></math></td>
<td style="text-align: center;">.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math></td>
<td style="text-align: left;"><code>P</code></td>
<td style="text-align: left;">=</td>
<td style="text-align: left;"><span class="math inline">$({\tt{}F}\times {\tt{}F}\times \tt{P}) + \{\textit{root}\}$</span></td>
<td style="text-align: left;">dynamic points</td>
</tr>
</tbody>
</table>
<h3 id="semantic-functions">Semantic functions</h3>
<table>
<tbody>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">$\hbox{$\cal K$}:$</span></td>
<td style="text-align: left;"><span class="math inline">$\hbox{\rm Con}\to{\tt{}E}$</span></td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">$\hbox{$\cal E$}:$</span></td>
<td style="text-align: left;"><span class="math inline">$\hbox{\rm Exp}\to{\tt{}U}\to\tt{P}\to{\tt{}K}\to{\tt{}C}$</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">$\hbox{$\cal E$}\hbox{\rm*}:$</span></td>
<td style="text-align: left;"><span class="math inline">$\hbox{\rm Exp}\hbox{\rm*}\to{\tt{}U}\to\tt{P}\to{\tt{}K}\to{\tt{}C}$</span></td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">$\hbox{$\cal C$}:$</span></td>
<td style="text-align: left;"><span class="math inline">$\hbox{\rm Com}\hbox{\rm*}\to{\tt{}U}\to\tt{P}\to{\tt{}C}\to{\tt{}C}$</span></td>
</tr>
</tbody>
</table>
<p>Definition of <span class="math inline">$\cal K$</span> deliberately omitted.</p>
<p><span class="math inline">$\cal E$</span>[] = ⟶.⟶<em>send</em> (<span class="math inline">$\cal K$</span>[]) </p>
<p><span class="math inline">$\cal E$</span>[] = ⟶.⟶<em>hold</em>⟶ <span class="math inline">$\=$</span>(<em>lookup</em>⟶⟶I)<span class="math inline">$\\
     \&gt;$</span>(<em>single</em>(⟶.⟶ <span class="math inline">$\=$</span>= <em>undefined</em><span class="math inline">$\\
     \&gt;  \&gt; \hbox{\hspace*{2em}}$</span><em>wrong</em> “undefined variable”,<span class="math inline">$\\
     \&gt;  \&gt;\hbox{\hspace*{1em}}$</span><em>send</em>⟶⟶))</p>
<p><span class="math inline">$\cal E$</span>[] =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶<span class="math inline">$\cal E$</span> <span class="math inline">$\=$</span>(<em>permute</em>(E_0⟶§⟶E))<span class="math inline">$\\
     \&gt;$</span>⟶<span class="math inline">$\\
     \&gt;$</span>⟶<span class="math inline">$\\
     \&gt;$</span>(⟶.⟶ (<span class="math inline">$\=$</span>(⟶.⟶ <em>applicate</em>⟶() ⟶() ⟶)<span class="math inline">$\\
     \&gt;   \&gt;$</span>(<em>unpermute</em>⟶)))</p>
<p><span class="math inline">$\cal E$</span>[] =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶⟶.⟶<span class="math inline">$\\
  \hbox{\hspace*{2em}}$</span><em>new</em>⟶⟶.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math>⟶<span><code>L</code></span><span class="math inline">$\\
   \hbox{\hspace*{3em}}$</span><em>send</em>⟶ <span class="math inline">$\=$</span>( <span class="math inline">$\=$</span><em>new</em>⟶  <span><code>L</code></span>,<span class="math inline">$\\
      \&gt;  \&gt;$</span>^^⟶.⟶ <span class="math inline">$\=$</span># = #<span>I</span><span class="math inline">$\\
      \&gt;  \&gt;$</span><em>tievals</em> <span class="math inline">$\=$</span>(⟶.⟶ <span class="math inline">$\=$</span>(^⟶.⟶<span class="math inline">$\cal C$</span>[]^^ (<span class="math inline">$\cal E$</span>[]^^^))<span class="math inline">$\\
      \&gt;  \&gt;      \&gt;    \&gt;$</span>(<em>extends</em>⟶⟶<span>I</span>⟶))<span class="math inline">$\\
      \&gt;  \&gt;      \&gt;$</span>,<span class="math inline">$\\
      \&gt;  \&gt;    \hbox{\hspace*{1em}}$</span><em>wrong</em> “wrong number of arguments”<span class="math inline">$\\
      \&gt;  \&gt;$</span> in <span><code>E</code></span>)<span class="math inline">$\\
      \&gt;$</span><span class="math inline">$\\
      \&gt;$</span>(<em>update</em>⟶(<em>new</em>⟶  <span><code>L</code></span>) ⟶<em>unspecified</em> ⟶),<span class="math inline">$\\
  \hbox{\hspace*{3em}}$</span><em>wrong</em> “out of memory”⟶</p>
<p><span class="math inline">$\cal E$</span>[] =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶⟶.⟶<span class="math inline">$\\
  \hbox{\hspace*{2em}}$</span><em>new</em>⟶⟶.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math>⟶<span><code>L</code></span><span class="math inline">$\\
   \hbox{\hspace*{3em}}$</span><em>send</em>⟶ <span class="math inline">$\=$</span>( <span class="math inline">$\=$</span><em>new</em>⟶  <span><code>L</code></span>,<span class="math inline">$\\
      \&gt;  \&gt;$</span>^^⟶.⟶ <span class="math inline">$\=$</span># #I<span class="math inline">$\\
      \&gt;  \&gt;    \&gt;\hbox{\hspace*{1em}}$</span><em>tievalsrest</em><span class="math inline">$\\
      \&gt;  \&gt;    \&gt;\hbox{\hspace*{2em}}\=$</span>(⟶.⟶ <span class="math inline">$\=$</span>(^⟶.⟶<span class="math inline">$\cal C$</span>[]^^ (<span class="math inline">$\cal E$</span>[]^^^))<span class="math inline">$\\
      \&gt;  \&gt;    \&gt;       \&gt; \&gt;$</span>(<em>extends</em>⟶ ⟶(I⟶§⟶I) ⟶))<span class="math inline">$\\
      \&gt;  \&gt;    \&gt;       \&gt;$</span><span class="math inline">$\\
      \&gt;  \&gt;    \&gt;       \&gt;$</span>(#I),<span class="math inline">$\\
      \&gt;  \&gt;    \&gt;\hbox{\hspace*{1em}}$</span><em>wrong</em> “too few arguments” in <span><code>E</code></span>)<span class="math inline">$\\
      \&gt;$</span><span class="math inline">$\\
      \&gt;$</span>(<em>update</em>⟶(<em>new</em>⟶  <span><code>L</code></span>) ⟶<em>unspecified</em> ⟶),<span class="math inline">$\\
  \hbox{\hspace*{3em}}$</span><em>wrong</em> “out of memory”⟶</p>
<p><span class="math inline">$\cal E$</span>[] = <span class="math inline">$\cal E$</span>[]</p>
<p><span class="math inline">$\cal E$</span>[] =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶ <span class="math inline">$\cal E$</span>[]⟶⟶(<em>single</em>⟶(⟶.⟶ <span class="math inline">$\=$</span><em>truish</em>⟶<span class="math inline">$\cal E$</span>[],<span class="math inline">$\\
     \&gt;\hbox{\hspace*{1em}}$</span><span class="math inline">$\cal E$</span>[]))</p>
<p><span class="math inline">$\cal E$</span>[] =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶ <span class="math inline">$\cal E$</span>[]⟶⟶(<em>single</em>⟶(⟶.⟶ <span class="math inline">$\=$</span><em>truish</em>⟶<span class="math inline">$\cal E$</span>[],<span class="math inline">$\\
     \&gt;\hbox{\hspace*{1em}}$</span><em>send</em>⟶<em>unspecified</em>⟶))</p>
<p>Here and elsewhere, any expressed value other than <span><em>undefined</em></span> may be used in place of <span><em>unspecified</em></span>.</p>
<p><span class="math inline">$\cal E$</span>[] =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶<span class="math inline">$\cal E$</span>[]⟶⟶⟶ (<em>single</em>(⟶.⟶<em>assign</em>⟶ <span class="math inline">$\=$</span>(<em>lookup</em>⟶⟶I)<span class="math inline">$\\
        \&gt;$</span><span class="math inline">$\\
        \&gt;$</span>(<em>send</em>⟶<em>unspecified</em>⟶)))</p>
<p><span class="math inline">$\cal E$</span>[] = ⟶.⟶⟶</p>
<p><span class="math inline">$\cal E$</span>[] =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶ <span class="math inline">$\cal E$</span>[]⟶⟶ (<em>single</em> (_0⟶.⟶<span class="math inline">$\cal E$</span>[] ⟶⟶(⟶.⟶ ⟶(_0⟶§⟶))))</p>
<p><span class="math inline">$\cal C$</span>[] =  .⟶</p>
<p><span class="math inline">$\cal C$</span>[] = ⟶.⟶<span class="math inline">$\cal E$</span>[]⟶⟶(⟶.⟶ <span class="math inline">$\cal C$</span>[])</p>
<h3 id="auxiliary-functions">Auxiliary functions</h3>
<p><em>lookup</em> : <span><code>U</code></span>Ide<span class="math inline">$\\$</span> <em>lookup</em> = I⟶.⟶I</p>
<p><em>extends</em> : <span><code>U</code></span>Ide <span class="math inline">$\\$</span> <em>extends</em> =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>I⟶.⟶ <span class="math inline">$\=$</span>#I=0,<span class="math inline">$\\
    \&gt;$</span><em>extends</em>⟶() ⟶(I) ⟶()</p>
<p><em>wrong</em> : <span><code>X</code></span></p>
<p><em>send</em> : <span><code>E</code></span><span class="math inline">$\\$</span> <em>send</em> = ⟶.⟶</p>
<p><em>single</em> : (<span><code>E</code></span>) <span class="math inline">$\\$</span> <em>single</em> =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶ <span class="math inline">$\=$</span>#=1(),<span class="math inline">$\\
    \&gt;$</span><em>wrong</em> “wrong number of return values”</p>
<p><em>new</em> : <span><code>S</code></span>(<span><code>L</code></span>+ { <em>error</em> })</p>
<p><em>hold</em> : <span><code>L</code></span><span class="math inline">$\\$</span> <em>hold</em> = ⟶.⟶<em>send</em> ()</p>
<p><em>assign</em> : <span><code>L</code></span><span class="math inline">$\\$</span> <em>assign</em> = ⟶.⟶(<em>update</em>⟶)</p>
<p><em>update</em> : <span><code>L</code></span><span class="math inline">$\\$</span> <em>update</em> = ⟶.⟶</p>
<p><em>tievals</em> : (<span><code>L</code></span> ) <span class="math inline">$\\$</span> <em>tievals</em> =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶ <span class="math inline">$\=$</span>#=0⟶,<span class="math inline">$\\
    \&gt;$</span><em>new</em>⟶⟶.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math>⟶<span><code>L</code></span><em>tievals</em>  <span class="math inline">$\=$</span>(⟶.⟶(<em>new</em>⟶⟶⟶<span><code>L</code></span> ⟶§⟶))<span class="math inline">$\\
    \&gt;  \&gt;$</span>()<span class="math inline">$\\
    \&gt;  \&gt;$</span>(<em>update</em>(<em>new</em>⟶⟶⟶<span><code>L</code></span>) () ),<span class="math inline">$\\
    \&gt;$</span><em>wrong</em> “out of memory”</p>
<p><em>tievalsrest</em> : (<span><code>L</code></span> ) <span class="math inline">$\\$</span> <em>tievalsrest</em> =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶<em>list</em>⟶ <span class="math inline">$\=$</span>(<em>dropfirst</em>⟶)<span class="math inline">$\\
    \&gt;$</span>(<em>single</em>(⟶.⟶<em>tievals</em>⟶⟶ ((<em>takefirst</em>⟶)⟶§⟶)))</p>
<p><em>dropfirst</em> = l n ⟶.⟶ n=0 l, <em>dropfirst</em> (l )(n - 1)</p>
<p><em>takefirst</em> = l n ⟶.⟶ n=0 ⟶, l ⟶§⟶(<em>takefirst</em> (l )(n - 1))</p>
<p><em>truish</em> : <span><code>E</code></span><span class="math inline">$\\$</span> <em>truish</em> = ⟶.⟶ = <em>false</em> <em>false</em>, <em>true</em></p>
<p><em>permute</em> : Exp Exp</p>
<p><em>unpermute</em> : <span><code>E</code></span></p>
<p><em>applicate</em> : <span><code>E</code></span> <code>P\\ applicate =\\
 \hbox{\hspace*{1em}}⟶.⟶ \=⟶.13ex\scriptstyle\in⟶F(⟶⟶F), wrong “bad procedure” </code></p>
<p><em>onearg</em> : (<span><code>E</code></span><code>P) (E P)\\ onearg =\\
 \hbox{\hspace*{1em}}⟶.⟶ \=#=1(),\\
    \&gt;wrong “wrong number of arguments” </code></p>
<p><em>twoarg</em> : (<span><code>E</code></span><code>P) (E P)\\ twoarg =\\
 \hbox{\hspace*{1em}}⟶.⟶ \=#=2()(),\\
    \&gt;wrong “wrong number of arguments” </code></p>
<p><em>threearg</em> : (<span><code>E</code></span><code>P) (E P)\\ threearg =\\
 \hbox{\hspace*{1em}}⟶.⟶ \=#=3()()(),\\
    \&gt;wrong “wrong number of arguments” </code></p>
<p><em>list</em> : <span><code>E</code></span> <code>P\\ list =\\
 \hbox{\hspace*{1em}}⟶.⟶ \=#=0send⟶null⟶,\\
    \&gt;list () (single(⟶.⟶ cons,)) </code></p>
<p><em>cons</em> : <span><code>E</code></span> <code>P\\ cons =\\
 \hbox{\hspace*{1em}}twoarg (_1_2⟶.⟶ \=new⟶⟶.13ex\scriptstyle\in⟶L\\
    \&gt; 
        \=(^⟶.⟶ \=new⟶^⟶.13ex\scriptstyle\in⟶L\\
    \&gt;  \&gt;send  \=(\=new⟶⟶⟶L, new⟶^⟶⟶L, true\\
                                \&gt;  \&gt;  \&gt;  \&gt; in E)\\
    \&gt;  \&gt;  \&gt;\\
    \&gt;  \&gt;  \&gt;(update(new⟶^⟶⟶L) _2 ^),\\
    \&gt;  \&gt;wrong “out of memory”^)\\
    \&gt;(update(new⟶⟶⟶L)_1),\\
    \&gt;wrong “out of memory”) </code></p>
<p><em>less</em> : <span><code>E</code></span> <code>P\\ less =\\
 \hbox{\hspace*{1em}}twoarg (_1_2⟶.⟶ \=(_1⟶.13ex\scriptstyle\in⟶R_2⟶.13ex\scriptstyle\in⟶R)\\
    \&gt;send  (_1⟶⟶R&lt;_2⟶⟶R true, false) ,\\
    \&gt;wrong “non-numeric argument to &lt;”) </code></p>
<p><em>add</em> : <span><code>E</code></span> <code>P\\ add =\\
 \hbox{\hspace*{1em}}twoarg (_1_2⟶.⟶ \=(_1⟶.13ex\scriptstyle\in⟶R_2⟶.13ex\scriptstyle\in⟶R)\\
    \&gt;send  \=((_1⟶⟶R+_2⟶⟶R) in E) ,\\
    \&gt;wrong “non-numeric argument to +”) </code></p>
<p><em>car</em> : <span><code>E</code></span> <code>P\\ car =\\
 \hbox{\hspace*{1em}}onearg (⟶.⟶ \=⟶.13ex\scriptstyle\in⟶E_{\rm p} car-internal⟶,\\
    \&gt;wrong “non-pair argument to car”) </code></p>
<p><em>car-internal</em> : <span><code>E</code></span><span class="math inline">$\\$</span> <em>car-internal</em> = <span class="math inline">$\hbox{\hspace*{1em}}$</span>⟶.⟶ <span class="math inline">$\=$</span><em>hold</em>  (⟶⟶<span><code>E</code></span><span class="math inline">$_{\rm p}$</span>)</p>
<p><em>cdr</em> : <span><code>E</code></span> <code>P </code></p>
<p><em>cdr-internal</em> : <span><code>E</code></span></p>
<p><em>setcar</em> : <span><code>E</code></span> <code>P\\ setcar =\\
 \hbox{\hspace*{1em}}twoarg (_1_2⟶.⟶ \=_1⟶.13ex\scriptstyle\in⟶E_{\rm p}\\
    \&gt;(_1⟶⟶E_{\rm p}) assign \=(_1⟶⟶E_{\rm p})\\
    \&gt;                           \&gt;_2\\
    \&gt;                                  \&gt;(send⟶unspecified⟶),\\
    \&gt;wrong “immutable argument to set-car!”,\\
    \&gt;wrong “non-pair argument to set-car!”) </code></p>
<p><em>eqv</em> : <span><code>E</code></span> <code>P\\ eqv =\\
 \hbox{\hspace*{1em}}twoarg (_1_2⟶.⟶ \=(_1⟶.13ex\scriptstyle\in⟶M_2⟶.13ex\scriptstyle\in⟶M)\\
    \&gt;send  \=(_1⟶⟶M= _2⟶⟶Mtrue, false),\\
    \&gt;(_1⟶.13ex\scriptstyle\in⟶Q_2⟶.13ex\scriptstyle\in⟶Q)\\
    \&gt;send  \=(_1⟶⟶Q= _2⟶⟶Qtrue, false),\\
    \&gt;(_1⟶.13ex\scriptstyle\in⟶H_2⟶.13ex\scriptstyle\in⟶H)\\
    \&gt;send  \=(_1⟶⟶H= _2⟶⟶Htrue, false),\\
    \&gt;(_1⟶.13ex\scriptstyle\in⟶R_2⟶.13ex\scriptstyle\in⟶R)\\
    \&gt;send  \=(_1⟶⟶R=_2⟶⟶Rtrue, false),\\
    \&gt;(_1⟶.13ex\scriptstyle\in⟶E_{\rm p}_2⟶.13ex\scriptstyle\in⟶E_{\rm p})\\
    \&gt;send  \=(\=(⟶.⟶ (\=(p_1) = (p_2)\\
    \&gt;  \&gt;   \&gt;   \&gt;(p_1) = (p_2)) true,\\
    \&gt;  \&gt;   \&gt;   \&gt;false)\\
    \&gt;  \&gt;   \&gt;(_1⟶⟶E_{\rm p})\\
    \&gt;  \&gt;   \&gt;(_2⟶⟶E_{\rm p}))\\
    \&gt;  \&gt;,\\
    \&gt;(_1⟶.13ex\scriptstyle\in⟶E_{\rm v}_2⟶.13ex\scriptstyle\in⟶E_{\rm v}) …,\\
    \&gt;(_1⟶.13ex\scriptstyle\in⟶E_{\rm s}_2⟶.13ex\scriptstyle\in⟶E_{\rm s}) …,\\
    \&gt;(_1⟶.13ex\scriptstyle\in⟶F_2⟶.13ex\scriptstyle\in⟶F)\\
    \&gt;send  \=((_1⟶⟶F) = (_2⟶⟶F) true, false)\\
    \&gt;  \&gt;,\\
    \&gt;send ⟶false⟶) </code></p>
<p><em>apply</em> : <span><code>E</code></span> <code>P\\ apply =\\
 \hbox{\hspace*{1em}}twoarg (_1_2⟶.⟶ \=_1⟶.13ex\scriptstyle\in⟶F valueslist⟶_2 (⟶.⟶applicate⟶_1),\\
    \&gt;wrong “bad procedure argument to apply”) </code></p>
<p><em>valueslist</em> : <span><code>E</code></span><span class="math inline">$\\$</span> <em>valueslist</em> =<span class="math inline">$\\
 \hbox{\hspace*{1em}}$</span>⟶.⟶ <span class="math inline">$\=$</span>⟶.13ex<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>∈</mo><annotation encoding="application/x-tex">\scriptstyle\in</annotation></semantics></math>⟶<span><code>E</code></span><span class="math inline">$_{\rm p}$</span><span class="math inline">$\\
    \&gt;$</span><em>cdr-internal</em>⟶ <span class="math inline">$\=$</span><span class="math inline">$\\
    \&gt;    \&gt;$</span>(⟶.⟶ <span class="math inline">$\=$</span><em>valueslist</em>⟶<span class="math inline">$\\
    \&gt;    \&gt;       \&gt;$</span><span class="math inline">$\\
    \&gt;    \&gt;       \&gt;$</span>(⟶.⟶<span class="math inline">$\=$</span><em>car-internal</em><span class="math inline">$\\
    \&gt;    \&gt;       \&gt;                               \&gt;$</span>⟶<span class="math inline">$\\
    \&gt;    \&gt;       \&gt;                               \&gt;$</span> (<em>single</em>(⟶.⟶ (⟶§⟶))))),<span class="math inline">$\\
    \&gt;$</span>= <em>null</em>⟶,<span class="math inline">$\\
    \&gt;$</span><em>wrong</em> “non-list argument to <span>values-list</span>”</p>
<p><em>cwcc</em> <span class="math inline">$\=$</span>: <span><code>E</code></span> <code>P\\ \&gt; \\ cwcc =\\
 \hbox{\hspace*{1em}}onearg (⟶.⟶ \=⟶.13ex\scriptstyle\in⟶F\\
    \&gt;(⟶.⟶ \=new⟶⟶.13ex\scriptstyle\in⟶L\\
    \&gt;  \&gt;applicate⟶ \=\\
    \&gt;  \&gt;  \&gt;\=new⟶⟶⟶L,\\
    \&gt;  \&gt;  \&gt;  \&gt; ^^⟶.⟶ travel⟶^()\\
    \&gt;  \&gt;  \&gt;  in E\\
    \&gt;  \&gt;  \&gt;\\
    \&gt;  \&gt;  \&gt;\\
    \&gt;  \&gt;  \&gt;(update  \=(new⟶⟶⟶L)\\
    \&gt;  \&gt;  \&gt;   \&gt;unspecified\\
    \&gt;  \&gt;  \&gt;   \&gt;),\\
    \&gt;  \&gt;wrong “out of memory” ),\\
    \&gt;wrong “bad procedure argument”) </code></p>
<p><em>travel</em> : <code>PP\\ travel = \\
  \hbox{\hspace*{1em}}_1_2⟶.⟶ travelpath⟶(\=(pathup⟶_1(commonancest⟶_1_2)) ⟶§⟶\\
  \&gt; (pathdown⟶(commonancest⟶_1_2)_2)) </code></p>
<p><em>pointdepth</em> : <code>P\\ pointdepth = \\
  \hbox{\hspace*{1em}}⟶.⟶ = root , 1 + (pointdepth⟶(⟶⟶(F P))) </code></p>
<p><em>ancestors</em> : <code>PP\\ ancestors = \\
  \hbox{\hspace*{1em}}⟶.⟶ = root {}, {}⟶⟶(ancestors⟶(⟶⟶(F P))) </code></p>
<p><em>commonancest</em> : <code>PPP\\ commonancest = \\
  \hbox{\hspace*{1em}}_1_2⟶.⟶\= the only element of \\
  \&gt;{ ^⟶⟶\= ^(ancestors⟶_1)⟶⟶(ancestors⟶_2),\\
  \&gt;\&gt;pointdepth⟶^pointdepth⟶^\\
  \&gt;\&gt; ^(ancestors⟶_1)⟶⟶(ancestors⟶_2)} </code></p>
<p><em>pathup</em> : <code>PP(P)\\ pathup = \\
  \hbox{\hspace*{1em}}_1_2⟶.⟶ \=_1=_2,\\
  \&gt;(_1, _1⟶⟶(FP)) ⟶§⟶\\
  \&gt;(pathup⟶(_1⟶⟶(FP))_2) </code></p>
<p><em>pathdown</em> : <code>PP(P)\\ pathdown = \\
  \hbox{\hspace*{1em}}_1_2⟶.⟶ \=_1=_2,\\
  \&gt;(pathdown⟶_1(_2⟶⟶(FP))) ⟶§⟶\\
  \&gt;(_2, _2⟶⟶(FP)) </code></p>
<p><em>travelpath</em> : (<code>P) \\ travelpath = \\
  \hbox{\hspace*{1em}}⟶.⟶ \=#=0,\\
  \&gt;(())\=(())\\
  \&gt;\&gt;(⟶.⟶travelpath⟶( )) </code></p>
<p><em>dynamicwind</em> : <span><code>E</code></span> <code>P\\ dynamicwind = \\
\hbox{\hspace*{1em}}threearg (\=_1_2_3⟶.⟶ (_1⟶.13ex\scriptstyle\in⟶F_2⟶.13ex\scriptstyle\in⟶F_3⟶.13ex\scriptstyle\in⟶F)\\
  \&gt;applicate⟶ \=_1(\=⟶.⟶\\
  \&gt;\&gt;applicate⟶\=_2 ((_1⟶⟶F,_3⟶⟶F,) in P)\\
  \&gt;\&gt;\&gt;(⟶.⟶applicate⟶_3(⟶.⟶))),\\
  \&gt;wrong “bad procedure argument”) </code></p>
<p><em>values</em> : <span><code>E</code></span> <code>P\\ values = ⟶.⟶ </code></p>
<p><em>cwv</em> : <span><code>E</code></span> <code>P \\ cwv =\\
 \hbox{\hspace*{1em}}twoarg (_1_2⟶.⟶ \=applicate⟶_1⟶ (⟶.⟶applicate⟶_2⟶)) </code></p>
<h2 id="derived-expression-types-1">Derived expression types</h2>
<p>This section gives syntax definitions for the derived expression types in terms of the primitive expression types (literal, variable, call, <span>lambda</span>, <span>if</span>, and <span>set!</span>), except for <span>quasiquote</span>.</p>
<p>Conditional derived syntax types:</p>
<pre><code>(define-syntax \ide{cond}
  (syntax-rules (else =&gt;)
    ((cond (else result1 result2 ...))
     (begin result1 result2 ...))
    ((cond (test =&gt; result))
     (let ((temp test))
       (if temp (result temp))))
    ((cond (test =&gt; result) clause1 clause2 ...)
     (let ((temp test))
       (if temp
           (result temp)
           (cond clause1 clause2 ...))))
    ((cond (test)) test)
    ((cond (test) clause1 clause2 ...)
     (let ((temp test))
       (if temp
           temp
           (cond clause1 clause2 ...))))
    ((cond (test result1 result2 ...))
     (if test (begin result1 result2 ...)))
    ((cond (test result1 result2 ...)
           clause1 clause2 ...)
     (if test
         (begin result1 result2 ...)
         (cond clause1 clause2 ...)))))</code></pre>
<pre><code>(define-syntax \ide{case}
  (syntax-rules (else =&gt;)
    ((case (key ...)
       clauses ...)
     (let ((atom-key (key ...)))
       (case atom-key clauses ...)))
    ((case key
       (else =&gt; result))
     (result key))
    ((case key
       (else result1 result2 ...))
     (begin result1 result2 ...))
    ((case key
       ((atoms ...) =&gt; result))
     (if (memv key &#39;(atoms ...))
         (result key)))
    ((case key
       ((atoms ...) result1 result2 ...))
     (if (memv key &#39;(atoms ...))
         (begin result1 result2 ...)))
    ((case key
       ((atoms ...) =&gt; result)
       clause clauses ...)
     (if (memv key &#39;(atoms ...))
         (result key)
         (case key clause clauses ...)))
    ((case key
       ((atoms ...) result1 result2 ...)
       clause clauses ...)
     (if (memv key &#39;(atoms ...))
         (begin result1 result2 ...)
         (case key clause clauses ...)))))</code></pre>
<pre><code>(define-syntax \ide{and}
  (syntax-rules ()
    ((and) \sharpfoo{t})
    ((and test) test)
    ((and test1 test2 ...)
     (if test1 (and test2 ...) \sharpfoo{f}))))</code></pre>
<pre><code>(define-syntax \ide{or}
  (syntax-rules ()
    ((or) \sharpfoo{f})
    ((or test) test)
    ((or test1 test2 ...)
     (let ((x test1))
       (if x x (or test2 ...))))))</code></pre>
<pre><code>(define-syntax \ide{when}
  (syntax-rules ()
    ((when test result1 result2 ...)
     (if test
         (begin result1 result2 ...)))))</code></pre>
<pre><code>(define-syntax \ide{unless}
  (syntax-rules ()
    ((unless test result1 result2 ...)
     (if (not test)
         (begin result1 result2 ...)))))</code></pre>
<p>Binding constructs:</p>
<pre><code>(define-syntax \ide{let}
  (syntax-rules ()
    ((let ((name val) ...) body1 body2 ...)
     ((lambda (name ...) body1 body2 ...)
      val ...))
    ((let tag ((name val) ...) body1 body2 ...)
     ((letrec ((tag (lambda (name ...)
                      body1 body2 ...)))
        tag)
      val ...))))</code></pre>
<pre><code>(define-syntax \ide{let*}
  (syntax-rules ()
    ((let* () body1 body2 ...)
     (let () body1 body2 ...))
    ((let* ((name1 val1) (name2 val2) ...)
       body1 body2 ...)
     (let ((name1 val1))
       (let* ((name2 val2) ...)
         body1 body2 ...)))))</code></pre>
<p>The following <span>letrec</span> macro uses the symbol <span>&lt;undefined&gt;</span> in place of an expression which returns something that when stored in a location makes it an error to try to obtain the value stored in the location. (No such expression is defined in Verbatim.) A trick is used to generate the temporary names needed to avoid specifying the order in which the values are evaluated. This could also be accomplished by using an auxiliary macro.</p>
<pre><code>(define-syntax \ide{letrec}
  (syntax-rules ()
    ((letrec ((var1 init1) ...) body ...)
     (letrec &quot;generate\_temp\_names&quot;
       (var1 ...)
       ()
       ((var1 init1) ...)
       body ...))
    ((letrec &quot;generate\_temp\_names&quot;
       ()
       (temp1 ...)
       ((var1 init1) ...)
       body ...)
     (let ((var1 &lt;undefined&gt;) ...)
       (let ((temp1 init1) ...)
         (set! var1 temp1)
         ...
         body ...)))
    ((letrec &quot;generate\_temp\_names&quot;
       (x y ...)
       (temp ...)
       ((var1 init1) ...)
       body ...)
     (letrec &quot;generate\_temp\_names&quot;
       (y ...)
       (newtemp temp ...)
       ((var1 init1) ...)
       body ...))))</code></pre>
<pre><code>(define-syntax \ide{letrec*}
  (syntax-rules ()
    ((letrec* ((var1 init1) ...) body1 body2 ...)
     (let ((var1 &lt;undefined&gt;) ...)
       (set! var1 init1)
       ...
       (let () body1 body2 ...)))))%</code></pre>
<pre><code>(define-syntax \ide{let-values}
  (syntax-rules ()
    ((let-values (binding ...) body0 body1 ...)
     (let-values &quot;bind&quot;
         (binding ...) () (begin body0 body1 ...)))
    
    ((let-values &quot;bind&quot; () tmps body)
     (let tmps body))
    
    ((let-values &quot;bind&quot; ((b0 e0)
         binding ...) tmps body)
     (let-values &quot;mktmp&quot; b0 e0 ()
         (binding ...) tmps body))
    
    ((let-values &quot;mktmp&quot; () e0 args
         bindings tmps body)
     (call-with-values 
       (lambda () e0)
       (lambda args
         (let-values &quot;bind&quot;
             bindings tmps body))))
    
    ((let-values &quot;mktmp&quot; (a . b) e0 (arg ...)
         bindings (tmp ...) body)
     (let-values &quot;mktmp&quot; b e0 (arg ... x)
         bindings (tmp ... (a x)) body))
    
    ((let-values &quot;mktmp&quot; a e0 (arg ...)
        bindings (tmp ...) body)
     (call-with-values
       (lambda () e0)
       (lambda (arg ... . x)
         (let-values &quot;bind&quot;
             bindings (tmp ... (a x)) body))))))</code></pre>
<pre><code>(define-syntax \ide{let*-values}
  (syntax-rules ()
    ((let*-values () body0 body1 ...)
     (let () body0 body1 ...))

    ((let*-values (binding0 binding1 ...)
         body0 body1 ...)
     (let-values (binding0)
       (let*-values (binding1 ...)
         body0 body1 ...)))))</code></pre>
<pre><code>(define-syntax \ide{define-values}
  (syntax-rules ()
    ((define-values () expr)
     (define dummy
       (call-with-values (lambda () expr)
                         (lambda args \schfalse))))
    ((define-values (var) expr)
     (define var expr))
    ((define-values (var0 var1 ... varn) expr)
     (begin
       (define var0
         (call-with-values (lambda () expr)
                           list))
       (define var1
         (let ((v (cadr var0)))
           (set-cdr! var0 (cddr var0))
           v)) ...
       (define varn
         (let ((v (cadr var0)))
           (set! var0 (car var0))
           v))))
    ((define-values (var0 var1 ... . varn) expr)
     (begin
       (define var0
         (call-with-values (lambda () expr)
                           list))
       (define var1
         (let ((v (cadr var0)))
           (set-cdr! var0 (cddr var0))
           v)) ...
       (define varn
         (let ((v (cdr var0)))
           (set! var0 (car var0))
           v))))
    ((define-values var expr)
     (define var
       (call-with-values (lambda () expr)
                         list)))))</code></pre>
<pre><code>(define-syntax \ide{begin}
  (syntax-rules ()
    ((begin exp ...)
     ((lambda () exp ...)))))</code></pre>
<p>The following alternative expansion for <span>begin</span> does not make use of the ability to write more than one expression in the body of a lambda expression. In any case, note that these rules apply only if the body of the <span>begin</span> contains no definitions.</p>
<pre><code>(define-syntax begin
  (syntax-rules ()
    ((begin exp)
     exp)
    ((begin exp1 exp2 ...)
     (call-with-values
         (lambda () exp1)
       (lambda args
         (begin exp2 ...))))))</code></pre>
<p>The following syntax definition of <span>do</span> uses a trick to expand the variable clauses. As with <span>letrec</span> above, an auxiliary macro would also work. The expression <span>(if #f #f)</span> is used to obtain an unspecific value.</p>
<pre><code>(define-syntax \ide{do}
  (syntax-rules ()
    ((do ((var init step ...) ...)
         (test expr ...)
         command ...)
     (letrec
       ((loop
         (lambda (var ...)
           (if test
               (begin
                 (if \#f \#f)
                 expr ...)
               (begin
                 command
                 ...
                 (loop (do &quot;step&quot; var step ...)
                       ...))))))
       (loop init ...)))
    ((do &quot;step&quot; x)
     x)
    ((do &quot;step&quot; x y)
     y)))</code></pre>
<p>Here is a possible implementation of <span>delay</span>, <span>force</span> and <span> delay-force</span>. We define the expression</p>
<pre><code>(delay-force \hyper{expression})%</code></pre>
<p>to have the same meaning as the procedure call</p>
<pre><code>(make-promise \schfalse{} (lambda () \hyper{expression}))%</code></pre>
<p>as follows</p>
<pre><code>(define-syntax delay-force
  (syntax-rules ()
    ((delay-force expression) 
     (make-promise \schfalse{} (lambda () expression)))))%</code></pre>
<p>and we define the expression</p>
<pre><code>(delay \hyper{expression})%</code></pre>
<p>to have the same meaning as:</p>
<pre><code>(delay-force (make-promise \schtrue{} \hyper{expression}))%</code></pre>
<p>as follows</p>
<pre><code>(define-syntax delay
  (syntax-rules ()
    ((delay expression)
     (delay-force (make-promise \schtrue{} expression)))))%</code></pre>
<p>where <span>make-promise</span> is defined as follows:</p>
<pre><code>(define make-promise
  (lambda (done? proc)
    (list (cons done? proc))))%</code></pre>
<p>Finally, we define <span>force</span> to call the procedure expressions in promises iteratively using a trampoline technique following <span class="citation" data-cites="srfi45"></span> until a non-lazy result (i.e. a value created by <span> delay</span> instead of <span>delay-force</span>) is returned, as follows:</p>
<pre><code>(define (force promise)
  (if (promise-done? promise)
      (promise-value promise)
      (let ((promise* ((promise-value promise))))
        (unless (promise-done? promise)
          (promise-update! promise* promise))
        (force promise))))%</code></pre>
<p>with the following promise accessors:</p>
<pre><code>(define promise-done?
  (lambda (x) (car (car x))))
(define promise-value
  (lambda (x) (cdr (car x))))
(define promise-update!
  (lambda (new old)
    (set-car! (car old) (promise-done? new))
    (set-cdr! (car old) (promise-value new))
    (set-car! new (car old))))%</code></pre>
<p>The following implementation of <span>make-parameter</span> and <span> parameterize</span> is suitable for an implementation with no threads. Parameter objects are implemented here as procedures, using two arbitrary unique objects &lt;param-set!&gt; and &lt;param-convert&gt;:</p>
<pre><code>(define (make-parameter init . o)
  (let* ((converter
          (if (pair? o) (car o) (lambda (x) x)))
         (value (converter init)))
    (lambda args
      (cond
       ((null? args)
        value)
       ((eq? (car args) &lt;param-set!&gt;)
        (set! value (cadr args)))
       ((eq? (car args) &lt;param-convert&gt;)
        converter)
       (else
        (error &quot;bad parameter syntax&quot;))))))%</code></pre>
<p>Then <span>parameterize</span> uses <span>dynamic-wind</span> to dynamically rebind the associated value:</p>
<pre><code>(define-syntax parameterize
  (syntax-rules ()
    ((parameterize (&quot;step&quot;)
                   ((param value p old new) ...)
                   ()
                   body)
     (let ((p param) ...)
       (let ((old (p)) ...
             (new ((p &lt;param-convert&gt;) value)) ...)
         (dynamic-wind
          (lambda () (p &lt;param-set!&gt; new) ...)
          (lambda () . body)
          (lambda () (p &lt;param-set!&gt; old) ...)))))
    ((parameterize (&quot;step&quot;)
                   args
                   ((param value) . rest)
                   body)
     (parameterize (&quot;step&quot;)
                   ((param value p old new) . args)
                   rest
                   body))
    ((parameterize ((param value) ...) . body)
     (parameterize (&quot;step&quot;)
                   ()
                   ((param value) ...)
                   body))))</code></pre>
<p>The following implementation of <span>guard</span> depends on an auxiliary macro, here called <span>guard-aux</span>.</p>
<pre><code>(define-syntax guard
  (syntax-rules ()
    ((guard (var clause ...) e1 e2 ...)
     ((call/cc
       (lambda (guard-k)
         (with-exception-handler
          (lambda (condition)
            ((call/cc
               (lambda (handler-k)
                 (guard-k
                  (lambda ()
                    (let ((var condition))
                      (guard-aux
                        (handler-k
                          (lambda ()
                            (raise-continuable condition)))
                        clause ...))))))))
          (lambda ()
            (call-with-values
             (lambda () e1 e2 ...)
             (lambda args
               (guard-k
                 (lambda ()
                   (apply values args)))))))))))))

(define-syntax guard-aux
  (syntax-rules (else =&gt;)
    ((guard-aux reraise (else result1 result2 ...))
     (begin result1 result2 ...))
    ((guard-aux reraise (test =&gt; result))
     (let ((temp test))
       (if temp 
           (result temp)
           reraise)))
    ((guard-aux reraise (test =&gt; result)
                clause1 clause2 ...)
     (let ((temp test))
       (if temp
           (result temp)
           (guard-aux reraise clause1 clause2 ...))))
    ((guard-aux reraise (test))
     (or test reraise))
    ((guard-aux reraise (test) clause1 clause2 ...)
     (let ((temp test))
       (if temp
           temp
           (guard-aux reraise clause1 clause2 ...))))
    ((guard-aux reraise (test result1 result2 ...))
     (if test
         (begin result1 result2 ...)
         reraise))
    ((guard-aux reraise
                (test result1 result2 ...)
                clause1 clause2 ...)
     (if test
         (begin result1 result2 ...)
         (guard-aux reraise clause1 clause2 ...)))))</code></pre>
<pre><code>(define-syntax \ide{case-lambda}
  (syntax-rules ()
    ((case-lambda (params body0 ...) ...)
     (lambda args
       (let ((len (length args)))
         (letrec-syntax
             ((cl (syntax-rules ::: ()
                    ((cl)
                     (error &quot;no matching clause&quot;))
                    ((cl ((p :::) . body) . rest)
                     (if (= len (length &#39;(p :::)))
                         (apply (lambda (p :::)
                                  . body)
                                args)
                         (cl . rest)))
                    ((cl ((p ::: . tail) . body)
                         . rest)
                     (if (&gt;= len (length &#39;(p :::)))
                         (apply
                          (lambda (p ::: . tail)
                            . body)
                          args)
                         (cl . rest))))))
           (cl (params body0 ...) ...)))))))
</code></pre>
<p>This definition of <span>cond-expand</span> does not interact with the <span>features</span> procedure. It requires that each feature identifier provided by the implementation be explicitly mentioned.</p>
<pre><code>(define-syntax cond-expand
  ;; Extend this to mention all feature ids and libraries
  (syntax-rules (and or not else r7rs library verbatim base)
    ((cond-expand)
     (syntax-error &quot;Unfulfilled cond-expand&quot;))
    ((cond-expand (else body ...))
     (begin body ...))
    ((cond-expand ((and) body ...) more-clauses ...)
     (begin body ...))
    ((cond-expand ((and req1 req2 ...) body ...)
                  more-clauses ...)
     (cond-expand
       (req1
         (cond-expand
           ((and req2 ...) body ...)
           more-clauses ...))
       more-clauses ...))
    ((cond-expand ((or) body ...) more-clauses ...)
     (cond-expand more-clauses ...))
    ((cond-expand ((or req1 req2 ...) body ...)
                  more-clauses ...)
     (cond-expand
       (req1
        (begin body ...))
       (else
        (cond-expand
           ((or req2 ...) body ...)
           more-clauses ...))))
    ((cond-expand ((not req) body ...)
                  more-clauses ...)
     (cond-expand
       (req
         (cond-expand more-clauses ...))
       (else body ...)))
    ((cond-expand (r7rs body ...)
                  more-clauses ...)
       (begin body ...))
    ;; Add clauses here for each
    ;; supported feature identifier.
    ;; Samples:
    ;; ((cond-expand (exact-closed body ...)
    ;;               more-clauses ...)
    ;;   (begin body ...))
    ;; ((cond-expand (ieee-float body ...)
    ;;               more-clauses ...)
    ;;   (begin body ...))
    ((cond-expand ((library (verbatim base))
                   body ...)
                  more-clauses ...)
      (begin body ...))
    ;; Add clauses here for each library
    ((cond-expand (feature-id body ...)
                  more-clauses ...)
       (cond-expand more-clauses ...))
    ((cond-expand ((library (name ...))
                   body ...)
                  more-clauses ...)
       (cond-expand more-clauses ...))))
</code></pre>
<h1 id="standard-libraries">Standard Libraries</h1>
<p>This section lists the exports provided by the standard libraries. The libraries are factored so as to separate features which might not be supported by all implementations, or which might be expensive to load.</p>
<p>The <span>scheme</span> library prefix is used for all standard libraries, and is reserved for use by future standards.</p>
<p><strong>Base Library</strong></p>
<p>The (scheme base) library exports many of the procedures and syntax bindings that are traditionally associated with Scheme. The division between the base library and the other standard libraries is based on use, not on construction. In particular, some facilities that are typically implemented as primitives by a compiler or the run-time system rather than in terms of other standard procedures or syntax are not part of the base library, but are defined in separate libraries. By the same token, some exports of the base library are implementable in terms of other exports. They are redundant in the strict sense of the word, but they capture common patterns of usage, and are therefore provided as convenient abbreviations.</p>
<pre><code>{\cf *}                       {\cf +}
{\cf -}                       {\cf ...}
{\cf /}                       {\cf &lt;}
{\cf &lt;=}                      {\cf =}
{\cf =&gt;}                      {\cf &gt;}
{\cf &gt;=}                      {\cf \_}
{\cf abs}                     {\cf and}
{\cf append}                  {\cf apply}
{\cf assoc}                   {\cf assq}
{\cf assv}                    {\cf begin}
{\cf binary-port?\ }           {\cf boolean=?}
{\cf boolean?\ }               {\cf bytevector}
{\cf bytevector-append}       {\cf bytevector-copy}
{\cf bytevector-copy!}        {\cf bytevector-length}
{\cf bytevector-u8-ref}       {\cf bytevector-u8-set!}
{\cf bytevector?\ }            {\cf caar}
{\cf cadr}
{\cf call-with-current-continuation}
{\cf call-with-port}          {\cf call-with-values}
{\cf call/cc}                 {\cf car}
{\cf case}                    {\cf cdar}
{\cf cddr}                    {\cf cdr}
{\cf ceiling}                 {\cf char-&gt;integer}
{\cf char-ready?\ }            {\cf char&lt;=?}
{\cf char&lt;?\ }                 {\cf char=?}
{\cf char&gt;=?\ }                {\cf char&gt;?}
{\cf char?\ }                  {\cf close-input-port}
{\cf close-output-port}       {\cf close-port}
{\cf complex?\ }               {\cf cond}
{\cf cond-expand}             {\cf cons}
{\cf current-error-port}      {\cf current-input-port}
{\cf current-output-port}     {\cf define}
{\cf define-record-type}      {\cf define-syntax}
{\cf define-values}           {\cf denominator}
{\cf do}                      {\cf dynamic-wind}
{\cf else}                    {\cf eof-object}
{\cf eof-object?\ }            {\cf eq?}
{\cf equal?\ }                 {\cf eqv?}
{\cf error}                   {\cf error-object-irritants}
{\cf error-object-message}    {\cf error-object?}
{\cf even?\ }                  {\cf exact}
{\cf exact-integer-sqrt}      {\cf exact-integer?}
{\cf exact?\ }                 {\cf expt}
{\cf features}                {\cf file-error?}
{\cf floor}                   {\cf floor-quotient}
{\cf floor-remainder}         {\cf floor/}
{\cf flush-output-port}       {\cf for-each}
{\cf gcd}                     {\cf get-output-bytevector}
{\cf get-output-string}       {\cf guard}
{\cf if}                      {\cf include}
{\cf include-ci}              {\cf inexact}
{\cf inexact?\ }               {\cf input-port-open?}
{\cf input-port?\ }            {\cf integer-&gt;char}
{\cf integer?\ }               {\cf lambda}
{\cf lcm}                     {\cf length}
{\cf let}                     {\cf let*}
{\cf let*-values}             {\cf let-syntax}
{\cf let-values}              {\cf letrec}
{\cf letrec*}                 {\cf letrec-syntax}
{\cf list}                    {\cf list-&gt;string}
{\cf list-&gt;vector}            {\cf list-copy}
{\cf list-ref}                {\cf list-set!}
{\cf list-tail}               {\cf list?}
{\cf make-bytevector}         {\cf make-list}
{\cf make-parameter}          {\cf make-string}
{\cf make-vector}             {\cf map}
{\cf max}                     {\cf member}
{\cf memq}                    {\cf memv}
{\cf min}                     {\cf modulo}
{\cf negative?\ }              {\cf newline}
{\cf not}                     {\cf null?}
{\cf number-&gt;string}          {\cf number?}
{\cf numerator}               {\cf odd?}
{\cf open-input-bytevector}   {\cf open-input-string}
{\cf open-output-bytevector}  {\cf open-output-string}
{\cf or}                      {\cf output-port-open?}
{\cf output-port?\ }           {\cf pair?}
{\cf parameterize}            {\cf peek-char}
{\cf peek-u8}                 {\cf port?}
{\cf positive?\ }              {\cf procedure?}
{\cf quasiquote}              {\cf quote}
{\cf quotient}                {\cf raise}
{\cf raise-continuable}       {\cf rational?}
{\cf rationalize}             {\cf read-bytevector}
{\cf read-bytevector!}        {\cf read-char}
{\cf read-error?\ }            {\cf read-line}
{\cf read-string}             {\cf read-u8}
{\cf real?\ }                  {\cf remainder}
{\cf reverse}                 {\cf round}
{\cf set!}                    {\cf set-car!}
{\cf set-cdr!}                {\cf square}
{\cf string}                  {\cf string-&gt;list}
{\cf string-&gt;number}          {\cf string-&gt;symbol}
{\cf string-&gt;utf8}            {\cf string-&gt;vector}
{\cf string-append}           {\cf string-copy}
{\cf string-copy!}            {\cf string-fill!}
{\cf string-for-each}         {\cf string-length}
{\cf string-map}              {\cf string-ref}
{\cf string-set!}             {\cf string&lt;=?}
{\cf string&lt;?\ }               {\cf string=?}
{\cf string&gt;=?\ }              {\cf string&gt;?}
{\cf string?\ }                {\cf substring}
{\cf symbol-&gt;string}          {\cf symbol=?}
{\cf symbol?\ }                {\cf syntax-error}
{\cf syntax-rules}            {\cf textual-port?}
{\cf truncate}                {\cf truncate-quotient}
{\cf truncate-remainder}      {\cf truncate/}
{\cf u8-ready?\ }              {\cf unless}
{\cf unquote}                 {\cf unquote-splicing}
{\cf utf8-&gt;string}            {\cf values}
{\cf vector}                  {\cf vector-&gt;list}
{\cf vector-&gt;string}          {\cf vector-append}
{\cf vector-copy}             {\cf vector-copy!}
{\cf vector-fill!}            {\cf vector-for-each}
{\cf vector-length}           {\cf vector-map}
{\cf vector-ref}              {\cf vector-set!}
{\cf vector?\ }                {\cf when}
{\cf with-exception-handler}  {\cf write-bytevector}
{\cf write-char}              {\cf write-string}
{\cf write-u8}                {\cf zero?}</code></pre>
<p><strong>Case-Lambda Library</strong></p>
<p>The (scheme case-lambda) library exports the <span>case-lambda</span> syntax.</p>
<pre><code>{\cf case-lambda}</code></pre>
<p><strong>Char Library</strong></p>
<p>The (scheme char) library provides the procedures for dealing with characters that involve potentially large tables when supporting all of Unicode.</p>
<pre><code>{\cf char-alphabetic?\ }       {\cf char-ci&lt;=?}
{\cf char-ci&lt;?\ }              {\cf char-ci=?}
{\cf char-ci&gt;=?\ }             {\cf char-ci&gt;?}
{\cf char-downcase}           {\cf char-foldcase}
{\cf char-lower-case?\ }       {\cf char-numeric?}
{\cf char-upcase}             {\cf char-upper-case?}
{\cf char-whitespace?\ }       {\cf digit-value}
{\cf string-ci&lt;=?\ }           {\cf string-ci&lt;?}
{\cf string-ci=?\ }            {\cf string-ci&gt;=?}
{\cf string-ci&gt;?\ }            {\cf string-downcase}
{\cf string-foldcase}         {\cf string-upcase}</code></pre>
<p><strong>Complex Library</strong></p>
<p>The (scheme complex) library exports procedures which are typically only useful with non-real numbers.</p>
<pre><code>{\cf angle}                   {\cf imag-part}
{\cf magnitude}               {\cf make-polar}
{\cf make-rectangular}        {\cf real-part}</code></pre>
<p><strong>CxR Library</strong></p>
<p>The (scheme cxr) library exports twenty-four procedures which are the compositions of from three to four <span>car</span> and <span>cdr</span> operations. For example <span>caddar</span> could be defined by</p>
<pre><code>(define caddar
  (lambda (x) (car (cdr (cdr (car x)))))){\rm.}%</code></pre>
<p>The procedures <span>car</span> and <span>cdr</span> themselves and the four two-level compositions are included in the base library. See section <a href="#listsection" data-reference-type="ref" data-reference="listsection">[listsection]</a>.</p>
<pre><code>{\cf caaaar}                  {\cf caaadr}
{\cf caaar}                   {\cf caadar}
{\cf caaddr}                  {\cf caadr}
{\cf cadaar}                  {\cf cadadr}
{\cf cadar}                   {\cf caddar}
{\cf cadddr}                  {\cf caddr}
{\cf cdaaar}                  {\cf cdaadr}
{\cf cdaar}                   {\cf cdadar}
{\cf cdaddr}                  {\cf cdadr}
{\cf cddaar}                  {\cf cddadr}
{\cf cddar}                   {\cf cdddar}
{\cf cddddr}                  {\cf cdddr}</code></pre>
<p><strong>Eval Library</strong></p>
<p>The (scheme eval) library exports procedures for evaluating Scheme data as programs.</p>
<pre><code>{\cf environment}             {\cf eval}</code></pre>
<p><strong>File Library</strong></p>
<p>The (scheme file) library provides procedures for accessing files.</p>
<pre><code>{\cf call-with-input-file}    {\cf call-with-output-file}
{\cf delete-file}             {\cf file-exists?}
{\cf open-binary-input-file}  {\cf open-binary-output-file}
{\cf open-input-file}         {\cf open-output-file}
{\cf with-input-from-file}    {\cf with-output-to-file}</code></pre>
<p><strong>Inexact Library</strong></p>
<p>The (scheme inexact) library exports procedures which are typically only useful with inexact values.</p>
<pre><code>{\cf acos}                    {\cf asin}
{\cf atan}                    {\cf cos}
{\cf exp}                     {\cf finite?}
{\cf infinite?\ }              {\cf log}
{\cf nan?\ }                   {\cf sin}
{\cf sqrt}                    {\cf tan}</code></pre>
<p><strong>Lazy Library</strong></p>
<p>The (scheme lazy) library exports procedures and syntax keywords for lazy evaluation.</p>
<pre><code>{\cf delay}                   {\cf delay-force}
{\cf force}                   {\cf make-promise}
{\cf promise?}</code></pre>
<p><strong>Load Library</strong></p>
<p>The (scheme load) library exports procedures for loading Scheme expressions from files.</p>
<pre><code>{\cf load}</code></pre>
<p><strong>Process-Context Library</strong></p>
<p>The (scheme process-context) library exports procedures for accessing with the program’s calling context.</p>
<pre><code>{\cf command-line}            {\cf emergency-exit}
{\cf exit}
{\cf get-environment-variable}
{\cf get-environment-variables}</code></pre>
<p><strong>Read Library</strong></p>
<p>The (scheme read) library provides procedures for reading Scheme objects.</p>
<pre><code>{\cf read}</code></pre>
<p><strong>Repl Library</strong></p>
<p>The (scheme repl) library exports the <span> interaction-environment</span> procedure.</p>
<pre><code>{\cf interaction-environment}</code></pre>
<p><strong>Time Library</strong></p>
<p>The (scheme time) library provides access to time-related values.</p>
<pre><code>{\cf current-jiffy}           {\cf current-second}
{\cf jiffies-per-second}</code></pre>
<p><strong>Write Library</strong></p>
<p>The (scheme write) library provides procedures for writing Scheme objects.</p>
<pre><code>{\cf display}                 {\cf write}
{\cf write-shared}            {\cf write-simple}</code></pre>
<p><strong>R5RS Library</strong></p>
<p>The (scheme r5rs) library provides the identifiers defined by R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS, except that <span>transcript-on</span> and <span>transcript-off</span> are not present. Note that the <span>exact</span> and <span>inexact</span> procedures appear under their R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS names <span>inexact-&gt;exact</span> and <span>exact-&gt;inexact</span> respectively. However, if an implementation does not provide a particular library such as the complex library, the corresponding identifiers will not appear in this library either.</p>
<p><span>*</span> <span>+</span> <span>-</span> <span>...</span> <span>/</span> <span>&lt;</span> <span>&lt;=</span> <span>=</span> <span>=&gt;</span> <span>&gt;</span> <span>&gt;=</span> <span>_</span> <span>abs</span> <span>acos</span> <span>and</span> <span>angle</span> <span>append</span> <span>apply</span> <span>asin</span> <span>assoc</span> <span>assq</span> <span>assv</span> <span>atan</span> <span>begin</span> <span>boolean? </span> <span>caaaar</span> <span>caaadr</span> <span>caaar</span> <span>caadar</span> <span>caaddr</span> <span>caadr</span> <span>caar</span> <span>cadaar</span> <span>cadadr</span> <span>cadar</span> <span>caddar</span> <span>cadddr</span> <span>caddr</span> <span>cadr</span> <span>call-with-current-continuation</span> <span>call-with-input-file</span> <span>call-with-output-file</span> <span>call-with-values</span> <span>car</span> <span>case</span> <span>cdaaar</span> <span>cdaadr</span> <span>cdaar</span> <span>cdadar</span> <span>cdaddr</span> <span>cdadr</span> <span>cdar</span> <span>cddaar</span> <span>cddadr</span> <span>cddar</span> <span>cdddar</span> <span>cddddr</span> <span>cdddr</span> <span>cddr</span> <span>cdr</span> <span>ceiling</span> <span>char-&gt;integer</span> <span>char-alphabetic? </span> <span>char-ci&lt;=?</span> <span>char-ci&lt;? </span> <span>char-ci=?</span> <span>char-ci&gt;=? </span> <span>char-ci&gt;?</span> <span>char-downcase</span> <span>char-lower-case?</span> <span>char-numeric? </span> <span>char-ready?</span> <span>char-upcase</span> <span>char-upper-case?</span> <span>char-whitespace? </span> <span>char&lt;=?</span> <span>char&lt;? </span> <span>char=?</span> <span>char&gt;=? </span> <span>char&gt;?</span> <span>char? </span> <span>close-input-port</span> <span>close-output-port</span> <span>complex?</span> <span>cond</span> <span>cons</span> <span>cos</span> <span>current-input-port</span> <span>current-output-port</span> <span>define</span> <span>define-syntax</span> <span>delay</span> <span>denominator</span> <span>display</span> <span>do</span> <span>dynamic-wind</span> <span>else</span> <span>eof-object?</span> <span>eq? </span> <span>equal?</span> <span>eqv? </span> <span>eval</span> <span>even? </span> <span>exact-&gt;inexact</span> <span>exact? </span> <span>exp</span> <span>expt</span> <span>floor</span> <span>for-each</span> <span>force</span> <span>gcd</span> <span>if</span> <span>imag-part</span> <span>inexact-&gt;exact</span> <span>inexact? </span> <span>input-port?</span> <span>integer-&gt;char</span> <span>integer?</span> <span>interaction-environment</span> <span>lambda</span> <span>lcm</span> <span>length</span> <span>let</span> <span>let*</span> <span>let-syntax</span> <span>letrec</span> <span>letrec-syntax</span> <span>list</span> <span>list-&gt;string</span> <span>list-&gt;vector</span> <span>list-ref</span> <span>list-tail</span> <span>list? </span> <span>load</span> <span>log</span> <span>magnitude</span> <span>make-polar</span> <span>make-rectangular</span> <span>make-string</span> <span>make-vector</span> <span>map</span> <span>max</span> <span>member</span> <span>memq</span> <span>memv</span> <span>min</span> <span>modulo</span> <span>negative?</span> <span>newline</span> <span>not</span> <span>null-environment</span> <span>null?</span> <span>number-&gt;string</span> <span>number?</span> <span>numerator</span> <span>odd?</span> <span>open-input-file</span> <span>open-output-file</span> <span>or</span> <span>output-port?</span> <span>pair? </span> <span>peek-char</span> <span>positive? </span> <span>procedure?</span> <span>quasiquote</span> <span>quote</span> <span>quotient</span> <span>rational?</span> <span>rationalize</span> <span>read</span> <span>read-char</span> <span>real-part</span> <span>real? </span> <span>remainder</span> <span>reverse</span> <span>round</span> <span>scheme-report-environment</span> <span>set!</span> <span>set-car!</span> <span>set-cdr!</span> <span>sin</span> <span>sqrt</span> <span>string</span> <span>string-&gt;list</span> <span>string-&gt;number</span> <span>string-&gt;symbol</span> <span>string-append</span> <span>string-ci&lt;=? </span> <span>string-ci&lt;?</span> <span>string-ci=? </span> <span>string-ci&gt;=?</span> <span>string-ci&gt;? </span> <span>string-copy</span> <span>string-fill!</span> <span>string-length</span> <span>string-ref</span> <span>string-set!</span> <span>string&lt;=? </span> <span>string&lt;?</span> <span>string=? </span> <span>string&gt;=?</span> <span>string&gt;? </span> <span>string?</span> <span>substring</span> <span>symbol-&gt;string</span> <span>symbol? </span> <span>syntax-rules</span> <span>tan</span> <span>truncate</span> <span>values</span> <span>vector</span> <span>vector-&gt;list</span> <span>vector-fill!</span> <span>vector-length</span> <span>vector-ref</span> <span>vector-set!</span> <span>vector?</span> <span>with-input-from-file</span> <span>with-output-to-file</span> <span>write</span> <span>write-char</span> <span>zero?</span></p>
<h1 id="standard-feature-identifiers">Standard Feature Identifiers</h1>
<p>An implementation may provide any or all of the feature identifiers listed below for use by <span>cond-expand</span> and <span>features</span>, but must not provide a feature identifier if it does not provide the corresponding feature.</p>
<p>r7rs</p>
<p><span>All R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>7</mn></msup><annotation encoding="application/x-tex">^{7}</annotation></semantics></math>RS Scheme implementations have this feature.</span></p>
<p>exact-closed</p>
<p><span>The algebraic operations <span>+</span>, <span>-</span>, <span>*</span>, and <span>expt</span> where the second argument is a non-negative integer produce exact values given exact inputs.</span></p>
<p>exact-complex</p>
<p><span>Exact complex numbers are provided.</span></p>
<p>ieee-float</p>
<p><span>Inexact numbers are IEEE 754 binary floating point values.</span></p>
<p>full-unicode</p>
<p><span>All Unicode characters present in Unicode version 6.0 are supported as Scheme characters.</span></p>
<p>ratios</p>
<p><span><span>/</span> with exact arguments produces an exact result when the divisor is nonzero.</span></p>
<p>posix</p>
<p><span>This implementation is running on a POSIX system.</span></p>
<p>windows</p>
<p><span>This implementation is running on Windows.</span></p>
<p>unix, darwin, gnu-linux, bsd, freebsd, solaris, ...</p>
<p><span>Operating system flags (perhaps more than one).</span></p>
<p>i386, x86-64, ppc, sparc, jvm, clr, llvm, ...</p>
<p><span>CPU architecture flags.</span></p>
<p>ilp32, lp64, ilp64, ...</p>
<p><span>C memory model flags.</span></p>
<p>big-endian, little-endian</p>
<p><span>Byte order flags.</span></p>
<p><span>The name of this implementation.</span></p>
<p><span>The name and version of this implementation.</span></p>
<h1 class="unnumbered" id="language-changes">Language changes</h1>
<p>1ex</p>
<h3 class="unnumbered" id="incompatibilities-with-r5rs">Incompatibilities with R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS</h3>
<p>This section enumerates the incompatibilities between this report and the “Revised<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^5</annotation></semantics></math> report” <span class="citation" data-cites="R5RS"></span>.</p>
<p><span><em>This list is not authoritative, but is believed to be correct and complete.</em></span></p>
<ul>
<li><p>Case sensitivity is now the default in symbols and character names. This means that code written under the assumption that symbols could be written <span>FOO</span> or <span>Foo</span> in some contexts and <span>foo</span> in other contexts can either be changed, be marked with the new <span>#!fold-case</span> directive, or be included in a library using the <span>include-ci</span> library declaration. All standard identifiers are entirely in lower case.</p></li>
<li><p>The <span>syntax-rules</span> construct now recognizes <span><em>_</em></span> (underscore) as a wildcard, which means it cannot be used as a syntax variable. It can still be used as a literal.</p></li>
<li><p>The R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS procedures <span>exact-&gt;inexact</span> and <span>inexact-&gt;exact</span> have been renamed to their R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS names, <span>inexact</span> and <span>exact</span>, respectively, as these names are shorter and more correct. The former names are still available in the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS library.</p></li>
<li><p>The guarantee that string comparison (with <span>string&lt;?</span> and the related predicates) is a lexicographical extension of character comparison (with <span>char&lt;?</span> and the related predicates) has been removed.</p></li>
<li><p>Support for the # character in numeric literals is no longer required.</p></li>
<li><p>Support for the letters <span>s</span>, <span>f</span>, <span>d</span>, and <span>l</span> as exponent markers is no longer required.</p></li>
<li><p>Implementations of <span>stringnumber</span> are no longer permitted to return #<span>f</span> when the argument contains an explicit radix prefix, and must be compatible with <span>read</span> and the syntax of numbers in programs.</p></li>
<li><p>The procedures <span>transcript-on</span> and <span>transcript-off</span> have been removed.</p></li>
</ul>
<h3 class="unnumbered" id="other-language-changes-since-r5rs">Other language changes since R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS</h3>
<p>This section enumerates the additional differences between this report and the “Revised<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^5</annotation></semantics></math> report” <span class="citation" data-cites="R5RS"></span>.</p>
<p><span><em>This list is not authoritative, but is believed to be correct and complete.</em></span></p>
<ul>
<li><p>Various minor ambiguities and unclarities in R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS have been cleaned up.</p></li>
<li><p>Libraries have been added as a new program structure to improve encapsulation and sharing of code. Some existing and new identifiers have been factored out into separate libraries. Libraries can be imported into other libraries or main programs, with controlled exposure and renaming of identifiers. The contents of a library can be made conditional on the features of the implementation on which it is to be used. There is an R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS compatibility library.</p></li>
<li><p>The expressions types <span>include</span>, <span>include-ci</span>, and <span>cond-expand</span> have been added to the base library; they have the same semantics as the corresponding library declarations.</p></li>
<li><p>Exceptions can now be signaled explicitly with <span>raise</span>, <span>raise-continuable</span> or <span>error</span>, and can be handled with <span> with-exception-handler</span> and the <span>guard</span> syntax. Any object can specify an error condition; the implementation-defined conditions signaled by <span>error</span> have a predicate to detect them and accessor functions to retrieve the arguments passed to <span>error</span>. Conditions signaled by <span>read</span> and by file-related procedures also have predicates to detect them.</p></li>
<li><p>New disjoint types supporting access to multiple fields can be generated with the <span>define-record-type</span> of SRFI 9 <span class="citation" data-cites="srfi9"></span></p></li>
<li><p>Parameter objects can be created with <span>make-parameter</span>, and dynamically rebound with <span>parameterize</span>. The procedures <span>current-input-port</span> and <span>current-output-port</span> are now parameter objects, as is the newly introduced <span>current-error-port</span>.</p></li>
<li><p>Support for promises has been enhanced based on SRFI 45 <span class="citation" data-cites="srfi45"></span>.</p></li>
<li><p><span><em>Bytevectors</em></span>, vectors of exact integers in the range from 0 to 255 inclusive, have been added as a new disjoint type. A subset of the vector procedures is provided. Bytevectors can be converted to and from strings in accordance with the UTF-8 character encoding. Bytevectors have a datum representation and evaluate to themselves.</p></li>
<li><p>Vector constants evaluate to themselves.</p></li>
<li><p>The procedure <span>read-line</span> is provided to make line-oriented textual input simpler.</p></li>
<li><p>The procedure <span>flush-output-port</span> is provided to allow minimal control of output port buffering.</p></li>
<li><p><span><em>Ports</em></span> can now be designated as <span><em>textual</em></span> or <span> <em>binary</em></span> ports, with new procedures for reading and writing binary data. The new predicates <span>input-port-open?</span> and <span>output-port-open?</span> return whether a port is open or closed. The new procedure <span>close-port</span> now closes a port; if the port has both input and output sides, both are closed.</p></li>
<li><p><span><em>String ports</em></span> have been added as a way to read and write characters to and from strings, and <span><em>bytevector ports</em></span> to read and write bytes to and from bytevectors.</p></li>
<li><p>There are now I/O procedures specific to strings and bytevectors.</p></li>
<li><p>The <span>write</span> procedure now generates datum labels when applied to circular objects. The new procedure <span>write-simple</span> never generates labels; <span>write-shared</span> generates labels for all shared and circular structure. The <span>display</span> procedure must not loop on circular objects.</p></li>
<li><p>The R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS procedure <span>eof-object</span> has been added. Eof-objects are now required to be a disjoint type.</p></li>
<li><p>Syntax definitions are now allowed wherever variable definitions are.</p></li>
<li><p>The <span>syntax-rules</span> construct now allows the ellipsis symbol to be specified explicitly instead of the default <span>...</span>, allows template escapes with an ellipsis-prefixed list, and allows tail patterns to follow an ellipsis pattern.</p></li>
<li><p>The <span>syntax-error</span> syntax has been added as a way to signal immediate and more informative errors when a macro is expanded.</p></li>
<li><p>The <span>letrec*</span> binding construct has been added, and internal <span>define</span> is specified in terms of it.</p></li>
<li><p>Support for capturing multiple values has been enhanced with <span> define-values</span>, <span>let-values</span>, and <span>let*-values</span>. Standard expression types which contain a sequence of expressions now permit passing zero or more than one value to the continuations of all non-final expressions of the sequence.</p></li>
<li><p>The <span>case</span> conditional now supports <span><code>=&gt;</code></span> syntax analogous to <span>cond</span> not only in regular clauses but in the <span> else</span> clause as well.</p></li>
<li><p>To support dispatching on the number of arguments passed to a procedure, <span>case-lambda</span> has been added in its own library.</p></li>
<li><p>The convenience conditionals <span>when</span> and <span>unless</span> have been added.</p></li>
<li><p>The behavior of <span>eqv?</span> on inexact numbers now conforms to the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS definition.</p></li>
<li><p>When applied to procedures, <span>eq?</span> and <span>eqv?</span> are permitted to return different answers.</p></li>
<li><p>The R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS procedures <span>boolean=?</span> and <span>symbol=?</span> have been added.</p></li>
<li><p>Positive infinity, negative infinity, NaN, and negative inexact zero have been added to the numeric tower as inexact values with the written representations <span><code>+inf.0</code></span>, <span><code>-inf.0</code></span>, <span><code>+nan.0</code></span>, and <span>-0.0</span> respectively. Support for them is not required. The representation <span><code>-nan.0</code></span> is synonymous with <span><code>+nan.0</code></span>.</p></li>
<li><p>The <span>log</span> procedure now accepts a second argument specifying the logarithm base.</p></li>
<li><p>The procedures <span>map</span> and <span>for-each</span> are now required to terminate on the shortest argument list.</p></li>
<li><p>The procedures <span>member</span> and <span>assoc</span> now take an optional third argument specifying the equality predicate to be used.</p></li>
<li><p>The numeric procedures <span>finite?</span>, <span>infinite?</span>, <span>nan?</span>, <span>exact-integer?</span>, <span>square</span>, and <span>exact-integer-sqrt</span> have been added.</p></li>
<li><p>The <span>-</span> and <span>/</span> procedures and the character and string comparison predicates are now required to support more than two arguments.</p></li>
<li><p>The forms #<span>true</span> and #<span>false</span> are now supported as well as #<span>t</span> and #<span>f</span>.</p></li>
<li><p>The procedures <span>make-list</span>, <span>list-copy</span>, <span>list-set!</span>, <span>string-map</span>, <span>string-for-each</span>, <span>string-&gt;vector</span>, <span>vector-append</span>, <span>vector-copy</span>, <span>vector-map</span>, <span>vector-for-each</span>, <span>vector-&gt;string</span>, <span>vector-copy!</span>, and <span>string-copy!</span> have been added to round out the sequence operations.</p></li>
<li><p>Some string and vector procedures support processing of part of a string or vector using optional <em>start</em> and <em>end</em> arguments.</p></li>
<li><p>Some list procedures are now defined on circular lists.</p></li>
<li><p>Implementations may provide any subset of the full Unicode repertoire that includes ASCII, but implementations must support any such subset in a way consistent with Unicode. Various character and string procedures have been extended accordingly, and case conversion procedures added for strings. String comparison is no longer required to be consistent with character comparison, which is based solely on Unicode scalar values. The new <span>digit-value</span> procedure has been added to obtain the numerical value of a numeric character.</p></li>
<li><p>There are now two additional comment syntaxes: <span><code>#;</code></span> to skip the next datum, and <span><code>#| ... |#</code></span> for nestable block comments.</p></li>
<li><p>Data prefixed with datum labels <span><code>#&lt;n&gt;=</code></span> can be referenced with <span><code>#&lt;n&gt;#</code></span>, allowing for reading and writing of data with shared structure.</p></li>
<li><p>Strings and symbols now allow mnemonic and numeric escape sequences, and the list of named characters has been extended.</p></li>
<li><p>The procedures <span>file-exists?</span> and <span>delete-file</span> are available in the <span><code>(scheme file)</code></span> library.</p></li>
<li><p>An interface to the system environment, command line, and process exit status is available in the <span><code>(scheme process-context)</code></span> library.</p></li>
<li><p>Procedures for accessing time-related values are available in the <span><code>(scheme time)</code></span> library.</p></li>
<li><p>A less irregular set of integer division operators is provided with new and clearer names.</p></li>
<li><p>The <span>load</span> procedure now accepts a second argument specifying the environment to load into.</p></li>
<li><p>The <span>call-with-current-continuation</span> procedure now has the synonym <span>call/cc</span>.</p></li>
<li><p>The semantics of read-eval-print loops are now partly prescribed, requiring the redefinition of procedures, but not syntax keywords, to have retroactive effect.</p></li>
<li><p>The formal semantics now handles <span>dynamic-wind</span>.</p></li>
</ul>
<h3 class="unnumbered" id="incompatibilities-with-r6rs">Incompatibilities with R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS</h3>
<p>This section enumerates the incompatibilities between R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>7</mn></msup><annotation encoding="application/x-tex">^{7}</annotation></semantics></math>RS and the “Revised<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^6</annotation></semantics></math> report” <span class="citation" data-cites="R6RS"></span> and its accompanying Standard Libraries document.</p>
<p><span><em>This list is not authoritative, and is possibly incomplete.</em></span></p>
<ul>
<li><p>R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>7</mn></msup><annotation encoding="application/x-tex">^{7}</annotation></semantics></math>RS libraries begin with the keyword <span>define-library</span> rather than <span>library</span> in order to make them syntactically distinguishable from R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS libraries. In R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>7</mn></msup><annotation encoding="application/x-tex">^{7}</annotation></semantics></math>RS terms, the body of an R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS library consists of a single export declaration followed by a single import declaration, followed by commands and definitions. In R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>7</mn></msup><annotation encoding="application/x-tex">^{7}</annotation></semantics></math>RS, commands and definitions are not permitted directly within the body: they have to be wrapped in a <span>begin</span> library declaration.</p></li>
<li><p>There is no direct R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS equivalent of the <span>include</span>, <span>include-ci</span>, <span>include-library-declarations</span>, or <span>cond-expand</span> library declarations. On the other hand, the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>7</mn></msup><annotation encoding="application/x-tex">^{7}</annotation></semantics></math>RS library syntax does not support phase or version specifications.</p></li>
<li><p>The grouping of standardized identifiers into libraries is different from the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS approach. In particular, procedures which are optional in R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS  either expressly or by implication, have been removed from the base library. Only the base library itself is an absolute requirement.</p></li>
<li><p>No form of identifier syntax is provided.</p></li>
<li><p>Internal syntax definitions are allowed, but uses of a syntax form cannot appear before its definition; the <span>even</span>/<span>odd</span> example given in R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS is not allowed.</p></li>
<li><p>The R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS exception system was incorporated as-is, but the condition types have been left unspecified. In particular, where R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS requires a condition of a specified type to be signaled, R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>7</mn></msup><annotation encoding="application/x-tex">^{7}</annotation></semantics></math>RS says only “it is an error”, leaving the question of signaling open.</p></li>
<li><p>Full Unicode support is not required. Normalization is not provided. Character comparisons are defined by Unicode, but string comparisons are implementation-dependent. Non-Unicode characters are permitted.</p></li>
<li><p>The full numeric tower is optional as in R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS, but optional support for IEEE infinities, NaN, and <span>-0.0</span> was adopted from R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS. Most clarifications on numeric results were also adopted, but the semantics of the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS procedures <span>real?</span>, <span>rational?</span>, and <span>integer</span>? were not adopted. (Note that the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^{5}</annotation></semantics></math>RS/R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>7</mn></msup><annotation encoding="application/x-tex">^{7}</annotation></semantics></math>RS semantics are available in R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS using <span>real-valued?</span>, <span>rational-valued?</span>, and <span>integer-valued?</span>). The R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS division operators <span>div</span>, <span>mod</span>, <span>div-and-mod</span>, <span> div0</span>, <span>mod0</span> and <span>div0-and-mod0</span> are not provided.</p></li>
<li><p>When a result is unspecified, it is still required to be a single value. However, non-final expressions in a body can return any number of values.</p></li>
<li><p>The semantics of <span>map</span> and <span>for-each</span> have been changed to use the SRFI 1 <span class="citation" data-cites="srfi1"></span> early termination behavior. Likewise, <span>assoc</span> and <span>member</span> take an optional <span>equal?</span> argument as in SRFI 1, instead of the separate <span>assp</span> and <span>memp</span> procedures of R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS.</p></li>
<li><p>The R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS <span>quasiquote</span> clarifications have been adopted, with the exception of multiple-argument <span>unquote</span> and <span>unquote-splicing</span>.</p></li>
<li><p>The R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS method of specifying mantissa widths was not adopted.</p></li>
<li><p>String ports are compatible with SRFI 6 <span class="citation" data-cites="srfi6"></span> rather than R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS.</p></li>
<li><p>R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS-style bytevectors are included, but only the unsigned byte (<span>u8</span>) procedures have been provided. The lexical syntax uses <span>#u8</span> for compatibility with SRFI 4 <span class="citation" data-cites="srfi4"></span>, rather than the R<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^{6}</annotation></semantics></math>RS <span>#vu8</span> style.</p></li>
<li><p>The utility macros <span>when</span> and <span>unless</span> are provided, but their result is left unspecified.</p></li>
<li><p>The remaining features of the Standard Libraries document were left to future standardization efforts.</p></li>
</ul>
<h1 class="unnumbered" id="additional-material">Additional material</h1>
<p>1ex</p>
<p>The Scheme community website at <span>http://schemers.org</span> contains additional resources for learning and programming, job and event postings, and Scheme user group information.</p>
<p>A bibliography of Scheme-related research at <span>http://library.readscheme.org</span> links to technical papers and theses related to the Scheme language, including both classic papers and recent research.</p>
<p>On-line Scheme discussions are held using IRC on the <span>#scheme</span> channel at <span>irc.freenode.net</span> and on the Usenet discussion group <span>comp.lang.scheme</span>.</p>
<h1 class="unnumbered" id="example">Example</h1>
<p>1ex</p>
<p>The procedure <span>integrate-system</span> integrates the system <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>y</mi><mi>k</mi><mi>′</mi></msubsup><mo>=</mo><msub><mi>f</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="0.278em"></mspace><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">y_k^\prime = f_k(y_1, y_2, \ldots, y_n), \; k = 1, \ldots, n</annotation></semantics></math> of differential equations with the method of Runge-Kutta.</p>
<p>The parameter <span><code>system-derivative</code></span> is a function that takes a system state (a vector of values for the state variables <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>y</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">y_1, \ldots, y_n</annotation></semantics></math>) and produces a system derivative (the values <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>y</mi><mn>1</mn><mi>′</mi></msubsup><mo>,</mo><mi>…</mi><mo>,</mo><msubsup><mi>y</mi><mi>n</mi><mi>′</mi></msubsup></mrow><annotation encoding="application/x-tex">y_1^\prime, \ldots,
y_n^\prime</annotation></semantics></math>). The parameter <span><code>initial-state</code></span> provides an initial system state, and <span><code>h</code></span> is an initial guess for the length of the integration step.</p>
<p>The value returned by <span>integrate-system</span> is an infinite stream of system states.</p>
<pre><code>(define (integrate-system system-derivative
                          initial-state
                          h)
  (let ((next (runge-kutta-4 system-derivative h)))
    (letrec ((states
              (cons initial-state
                    (delay (map-streams next
                                        states)))))
      states)))%</code></pre>
<p>The procedure <span>runge-kutta-4</span> takes a function, <span><code>f</code></span>, that produces a system derivative from a system state. It produces a function that takes a system state and produces a new system state.</p>
<pre><code>(define (runge-kutta-4 f h)
  (let ((*h (scale-vector h))
        (*2 (scale-vector 2))
        (*1/2 (scale-vector (/ 1 2)))
        (*1/6 (scale-vector (/ 1 6))))
    (lambda (y)
      ;; y is a system state
      (let* ((k0 (*h (f y)))
             (k1 (*h (f (add-vectors y (*1/2 k0)))))
             (k2 (*h (f (add-vectors y (*1/2 k1)))))
             (k3 (*h (f (add-vectors y k2)))))
        (add-vectors y
          (*1/6 (add-vectors k0
                             (*2 k1)
                             (*2 k2)
                             k3)))))))

(define (elementwise f)
  (lambda vectors
    (generate-vector
     (vector-length (car vectors))
     (lambda (i)
       (apply f
              (map (lambda (v) (vector-ref  v i))
                   vectors))))))

(define (generate-vector size proc)
  (let ((ans (make-vector size)))
    (letrec ((loop
              (lambda (i)
                (cond ((= i size) ans)
                      (else
                       (vector-set! ans i (proc i))
                       (loop (+ i 1)))))))
      (loop 0))))

(define add-vectors (elementwise +))

(define (scale-vector s)
  (elementwise (lambda (x) (* x s))))%</code></pre>
<p>The <span>map-streams</span> procedure is analogous to <span>map</span>: it applies its first argument (a procedure) to all the elements of its second argument (a stream).</p>
<pre><code>(define (map-streams f s)
  (cons (f (head s))
        (delay (map-streams f (tail s)))))%</code></pre>
<p>Infinite streams are implemented as pairs whose car holds the first element of the stream and whose cdr holds a promise to deliver the rest of the stream.</p>
<pre><code>(define head car)
(define (tail stream)
  (force (cdr stream)))%</code></pre>
<p>The following illustrates the use of <span>integrate-system</span> in integrating the system <span class="math display">$$C {dv_C \over dt} = -i_L - {v_C \over R}$$</span> <span class="math display">$$L {di_L \over dt} = v_C$$</span> which models a damped oscillator.</p>
<pre><code>(define (damped-oscillator R L C)
  (lambda (state)
    (let ((Vc (vector-ref state 0))
          (Il (vector-ref state 1)))
      (vector (- 0 (+ (/ Vc (* R C)) (/ Il C)))
              (/ Vc L)))))

(define the-states
  (integrate-system
     (damped-oscillator 10000 1000 .001)
     &#39;\#(1 0)
     .01))%</code></pre>
<div class="thebibliography">
<p><span>999</span></p>
<p>Harold Abelson and Gerald Jay Sussman with Julie Sussman. <span><em>Structure and Interpretation of Computer Programs, second edition.</em></span> MIT Press, Cambridge, 1996.</p>
<p>Alan Bawden and Jonathan Rees. Syntactic closures. In <span><em>Proceedings of the 1988 ACM Symposium on Lisp and Functional Programming</em></span>, pages 86–95.</p>
<p>S. Bradner. Key words for use in RFCs to Indicate Requirement Levels. <a href="http://www.ietf.org/rfc/rfc2119.txt" class="uri">http://www.ietf.org/rfc/rfc2119.txt</a>, 1997.</p>
<p>Robert G. Burger and R. Kent Dybvig. Printing floating-point numbers quickly and accurately. In <span><em>Proceedings of the ACM SIGPLAN ’96 Conference on Programming Language Design and Implementation</em></span>, pages 108–116.</p>
<p>William Clinger. How to read floating point numbers accurately. In <span><em>Proceedings of the ACM SIGPLAN ’90 Conference on Programming Language Design and Implementation</em></span>, pages 92–101. Proceedings published as <span><em>SIGPLAN Notices</em></span> 25(6), June 1990.</p>
<p>William Clinger. Proper Tail Recursion and Space Efficiency. In <span><em>Proceedings of the 1998 ACM Conference on Programming Language Design and Implementation</em></span>, June 1998.</p>
<p>William Clinger. SRFI 6: Basic String Ports. <a href="http://srfi.schemers.org/srfi-6/" class="uri">http://srfi.schemers.org/srfi-6/</a>, 1999.</p>
<p>William Clinger, editor. The revised revised report on Scheme, or an uncommon Lisp. MIT Artificial Intelligence Memo 848, August 1985. Also published as Computer Science Department Technical Report 174, Indiana University, June 1985.</p>
<p>William Clinger and Jonathan Rees. Macros that work. In <span><em>Proceedings of the 1991 ACM Conference on Principles of Programming Languages</em></span>, pages 155–162.</p>
<p>William Clinger and Jonathan Rees, editors. The revised<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>4</mn></msup><annotation encoding="application/x-tex">^4</annotation></semantics></math> report on the algorithmic language Scheme. In <span><em>ACM Lisp Pointers</em></span> 4(3), pages 1–55, 1991.</p>
<p>Mark Davis. Unicode Standard Annex #44, Unicode Character Database. <a href="http://unicode.org/reports/tr44/" class="uri">http://unicode.org/reports/tr44/</a>, 2010.</p>
<p>R. Kent Dybvig, Robert Hieb, and Carl Bruggeman. Syntactic abstraction in Scheme. <span><em>Lisp and Symbolic Computation</em></span> 5(4):295–326, 1993.</p>
<p>Marc Feeley. SRFI 4: Homogeneous Numeric Vector Datatypes. <a href="http://srfi.schemers.org/srfi-4/" class="uri">http://srfi.schemers.org/srfi-4/</a>, 1999.</p>
<p>Carol Fessenden, William Clinger, Daniel P. Friedman, and Christopher Haynes. Scheme 311 version 4 reference manual. Indiana University Computer Science Technical Report 137, February 1983. Superseded by <span class="citation" data-cites="Scheme84"></span>.</p>
<p>D. Friedman, C. Haynes, E. Kohlbecker, and M. Wand. Scheme 84 interim reference manual. Indiana University Computer Science Technical Report 153, January 1985.</p>
<p>Martin Gardner. Mathematical Games: The fantastic combinations of John Conway’s new solitaire game “Life.” In <span><em>Scientific American</em></span>, 223:120–123, October 1970.</p>
<p><span><em>IEEE Standard 754-2008. IEEE Standard for Floating-Point Arithmetic.</em></span> IEEE, New York, 2008.</p>
<p><span><em>IEEE Standard 1178-1990. IEEE Standard for the Scheme Programming Language.</em></span> IEEE, New York, 1991.</p>
<p>Richard Kelsey. SRFI 9: Defining Record Types. <a href="http://srfi.schemers.org/srfi-9/" class="uri">http://srfi.schemers.org/srfi-9/</a>, 1999.</p>
<p>Richard Kelsey, William Clinger, and Jonathan Rees, editors. The revised<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>5</mn></msup><annotation encoding="application/x-tex">^5</annotation></semantics></math> report on the algorithmic language Scheme. <span><em>Higher-Order and Symbolic Computation</em></span>, 11(1):7-105, 1998.</p>
<p>Eugene E. Kohlbecker Jr. <span><em>Syntactic Extensions in the Programming Language Lisp.</em></span> PhD thesis, Indiana University, August 1986.</p>
<p>Eugene E. Kohlbecker Jr., Daniel P. Friedman, Matthias Felleisen, and Bruce Duba. Hygienic macro expansion. In <span><em>Proceedings of the 1986 ACM Conference on Lisp and Functional Programming</em></span>, pages 151–161.</p>
<p>John McCarthy. Recursive Functions of Symbolic Expressions and Their Computation by Machine, Part I. <span><em>Communications of the ACM</em></span> 3(4):184–195, April 1960.</p>
<p>MIT Department of Electrical Engineering and Computer Science. Scheme manual, seventh edition. September 1984.</p>
<p>Peter Naur et al. Revised report on the algorithmic language Algol 60. <span><em>Communications of the ACM</em></span> 6(1):1–17, January 1963.</p>
<p>Paul Penfield, Jr. Principal values and branch cuts in complex APL. In <span><em>APL ’81 Conference Proceedings,</em></span> pages 248–256. ACM SIGAPL, San Francisco, September 1981. Proceedings published as <span><em>APL Quote Quad</em></span> 12(1), ACM, September 1981.</p>
<p>Jonathan A. Rees and Norman I. Adams IV. T: A dialect of Lisp or, lambda: The ultimate software tool. In <span><em>Conference Record of the 1982 ACM Symposium on Lisp and Functional Programming</em></span>, pages 114–122.</p>
<p>Jonathan A. Rees, Norman I. Adams IV, and James R. Meehan. The T manual, fourth edition. Yale University Computer Science Department, January 1984.</p>
<p>Jonathan Rees and William Clinger, editors. The revised<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>3</mn></msup><annotation encoding="application/x-tex">^3</annotation></semantics></math> report on the algorithmic language Scheme. In <span><em>ACM SIGPLAN Notices</em></span> 21(12), pages 37–79, December 1986.</p>
<p>Olin Shivers. SRFI 1: List Library. <a href="http://srfi.schemers.org/srfi-1/" class="uri">http://srfi.schemers.org/srfi-1/</a>, 1999.</p>
<p>Guy Lewis Steele Jr. and Gerald Jay Sussman. The revised report on Scheme, a dialect of Lisp. MIT Artificial Intelligence Memo 452, January 1978.</p>
<p>Guy Lewis Steele Jr. Rabbit: a compiler for Scheme. MIT Artificial Intelligence Laboratory Technical Report 474, May 1978.</p>
<p>Michael Sperber, R. Kent Dybvig, Mathew Flatt, and Anton van Straaten, editors. <span><em>The revised<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>6</mn></msup><annotation encoding="application/x-tex">^6</annotation></semantics></math> report on the algorithmic language Scheme.</em></span> Cambridge University Press, 2010.</p>
<p>Guy Lewis Steele Jr. <span><em>Common Lisp: The Language, second edition.</em></span> Digital Press, Burlington MA, 1990.</p>
<p>Gerald Jay Sussman and Guy Lewis Steele Jr. Scheme: an interpreter for extended lambda calculus. MIT Artificial Intelligence Memo 349, December 1975.</p>
<p>Joseph E. Stoy. <span><em>Denotational Semantics: The Scott-Strachey Approach to Programming Language Theory.</em></span> MIT Press, Cambridge, 1977.</p>
<p>Texas Instruments, Inc. TI Scheme Language Reference Manual. Preliminary version 1.0, November 1985.</p>
<p>Andre van Tonder. SRFI 45: Primitives for Expressing Iterative Lazy Algorithms. <a href="http://srfi.schemers.org/srfi-45/" class="uri">http://srfi.schemers.org/srfi-45/</a>, 2002.</p>
<p>Martin Gasbichler, Eric Knauel, Michael Sperber and Richard Kelsey. How to Add Threads to a Sequential Language Without Getting Tangled Up. <span><em>Proceedings of the Fourth Workshop on Scheme and Functional Programming</em></span>, November 2003.</p>
<p>International Earth Rotation Service. Historical table of TAI-UTC offsets. <a href="http://maia.usno.navy.mil/ser7/tai-utc.dat" class="uri">http://maia.usno.navy.mil/ser7/tai-utc.dat</a></p>
</div>
</body>
</html>
